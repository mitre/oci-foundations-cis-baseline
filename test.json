{"platform":{"name":"mac_os_x","release":"25.2.0","target_id":"2d0eabe5-1994-5edc-8fe0-5a0b3d4d1252"},"profiles":[{"name":"cis-oracle-cloud-infrastructure-foundations-benchmark-v3.0.0","version":"3.0.1","sha256":"f573fd710e5fe3506b5fe3980a47f2ae54b4eb18ea0ee2e4ae88451b6ca0af8a","title":"CIS Oracle Cloud Infrastructure Foundations Benchmark v3.0.0","maintainer":"MITRE SAF Team","summary":"InSpec profile aligned to CIS Benchmark Guidance for CIS Oracle Cloud Infrastructure Foundations Benchmark v3.0.0","license":"Apache-2.0","copyright":"MITRE","copyright_email":"saf@groups.mitre.org","supports":[],"attributes":[{"name":"tenancy_ocid","options":{"type":"String","value":"ocid1.tenancy.oc1..aaaaaaaanh6z6vd7mfggmzc2t5qhtvienslomuwrxpjpaglcliaujr67u2cq"}},{"name":"tenancy_level_policy_statements","options":{"type":"Array","value":["allow service cloudguard to manage cloudevents-rules in tenancy where target.rule.type='managed'","allow service cloudguard to read vaults in tenancy","allow service cloudguard to read keys in tenancy","allow service cloudguard to read compartments in tenancy","allow service cloudguard to read tenancies in tenancy","allow service cloudguard to read audit-events in tenancy","allow service cloudguard to read compute-management-family in tenancy","allow service cloudguard to read instance-family in tenancy","allow service cloudguard to read virtual-network-family in tenancy","allow service cloudguard to read volume-family in tenancy","allow service cloudguard to read database-family in tenancy","allow service cloudguard to read object-family in tenancy","allow service cloudguard to read load-balancers in tenancy","allow service cloudguard to read users in tenancy","allow service cloudguard to read groups in tenancy","allow service cloudguard to read policies in tenancy","allow service cloudguard to read dynamic-groups in tenancy","allow service cloudguard to read authentication-policies in tenancy","allow service cloudguard to use network-security-groups in tenancy","allow service cloudguard to read data-safe-family in tenancy","allow service cloudguard to read autonomous-database-family in tenancy","allow service cloudguard to read log-groups in tenancy","Allow any-user to { WLP_BOM_READ } in tenancy where all { request.principal.id = target.agent.id, request.principal.type = 'workloadprotectionagent'}","Allow any-user to { WLP_CONFIG_READ } in tenancy where all { request.principal.id = target.agent.id, request.principal.type = 'workloadprotectionagent'}","ALLOW GROUP Administrators to manage all-resources IN TENANCY","Allow group IAMAdmins to use users in tenancy where target.group.name = 'Administrators'","Allow group IAMAdmins to use groups in tenancy where target.group.name != 'Administrators'","Allow group IAMAdmins to use users in tenancy where target.group.name != 'Administrators'","Allow group PowerUsers to manage all-resources in tenancy"]}},{"name":"compartment_level_policy_statements","options":{"type":"Array","value":[]}},{"name":"cloud_guard_check","options":{"type":"Boolean","value":true}},{"name":"detector_recipe_ocid","options":{"type":"String","value":"ocid1.cloudguarddetectorrecipe.oc1.iad.amaaaaaawrpxhicq5kqemadzqkveedxvwqc4bjpafe3zvd2mr3u7amhvpwja"}},{"name":"allowed_network_endpoint_types","options":{"type":"Array","value":["PUBLIC"]}},{"name":"identity_provider_notification_topic","options":{"value":"saf-notification-topic-1"}},{"name":"group_mapping_notification_topic","options":{"value":"saf-notification-topic-1"}},{"name":"iam_group_notification_topic","options":{"value":"saf-notification-topic-1"}},{"name":"iam_policy_notification_topic","options":{"value":"saf-notification-topic-1"}},{"name":"user_notification_topic","options":{"value":"saf-notification-topic-1"}},{"name":"vcn_list_notification_topic","options":{"value":"saf-notification-topic-1"}},{"name":"route_table_notification_topic","options":{"value":"saf-notification-topic-1"}},{"name":"security_list_notification_topic","options":{"value":"saf-notification-topic-2"}},{"name":"network_security_notification_topic","options":{"value":"saf-notification-topic-2"}},{"name":"network_gateway_notification_topic","options":{"value":"saf-notification-topic-2"}},{"name":"cloud_guard_notification_topic","options":{"value":"saf-notification-topic-2"}},{"name":"oac_allowed_network_endpoint_types","options":{"value":[]}}],"groups":[{"id":"controls/1_1.rb","controls":["1_1"]},{"id":"controls/1_10.rb","controls":["1_10"]},{"id":"controls/1_11.rb","controls":["1_11"]},{"id":"controls/1_12.rb","controls":["1_12"]},{"id":"controls/1_13.rb","controls":["1_13"]},{"id":"controls/1_14.rb","controls":["1_14"]},{"id":"controls/1_15.rb","controls":["1_15"]},{"id":"controls/1_16.rb","controls":["1_16"]},{"id":"controls/1_17.rb","controls":["1_17"]},{"id":"controls/1_2.rb","controls":["1_2"]},{"id":"controls/1_3.rb","controls":["1_3"]},{"id":"controls/1_4.rb","controls":["1_4"]},{"id":"controls/1_5.rb","controls":["1_5"]},{"id":"controls/1_6.rb","controls":["1_6"]},{"id":"controls/1_7.rb","controls":["1_7"]},{"id":"controls/1_8.rb","controls":["1_8"]},{"id":"controls/1_9.rb","controls":["1_9"]},{"id":"controls/2_1.rb","controls":["2_1"]},{"id":"controls/2_2.rb","controls":["2_2"]},{"id":"controls/2_3.rb","controls":["2_3"]},{"id":"controls/2_4.rb","controls":["2_4"]},{"id":"controls/2_5.rb","controls":["2_5"]},{"id":"controls/2_6.rb","controls":["2_6"]},{"id":"controls/2_7.rb","controls":["2_7"]},{"id":"controls/2_8.rb","controls":["2_8"]},{"id":"controls/3_1.rb","controls":["3_1"]},{"id":"controls/3_2.rb","controls":["3_2"]},{"id":"controls/3_3.rb","controls":["3_3"]},{"id":"controls/4_1.rb","controls":["4_1"]},{"id":"controls/4_10.rb","controls":["4_10"]},{"id":"controls/4_11.rb","controls":["4_11"]},{"id":"controls/4_12.rb","controls":["4_12"]},{"id":"controls/4_13.rb","controls":["4_13"]},{"id":"controls/4_14.rb","controls":["4_14"]},{"id":"controls/4_15.rb","controls":["4_15"]},{"id":"controls/4_16.rb","controls":["4_16"]},{"id":"controls/4_17.rb","controls":["4_17"]},{"id":"controls/4_18.rb","controls":["4_18"]},{"id":"controls/4_2.rb","controls":["4_2"]},{"id":"controls/4_3.rb","controls":["4_3"]},{"id":"controls/4_4.rb","controls":["4_4"]},{"id":"controls/4_5.rb","controls":["4_5"]},{"id":"controls/4_6.rb","controls":["4_6"]},{"id":"controls/4_7.rb","controls":["4_7"]},{"id":"controls/4_8.rb","controls":["4_8"]},{"id":"controls/4_9.rb","controls":["4_9"]},{"id":"controls/5_1_1.rb","controls":["5_1_1"]},{"id":"controls/5_1_2.rb","controls":["5_1_2"]},{"id":"controls/5_1_3.rb","controls":["5_1_3"]},{"id":"controls/5_2_1.rb","controls":["5_2_1"]},{"id":"controls/5_2_2.rb","controls":["5_2_2"]},{"id":"controls/5_3_1.rb","controls":["5_3_1"]},{"id":"controls/6_1.rb","controls":["6_1"]},{"id":"controls/6_2.rb","controls":["6_2"]}],"controls":[{"id":"1_1","title":"Ensure service level admins are created to manage resources of particular service","desc":"To apply least-privilege security principle, one can create service-level administrators in\ncorresponding groups and assigning specific users to each service-level administrative group\nin a tenancy. This limits administrative access in a tenancy. It means service-level\nadministrators can only manage resources of a specific service.\n\nExample policies for global/tenant level service-administrators:\n  - Allow group VolumeAdmins to manage volume-family in tenancy\n  - Allow group ComputeAdmins to manage instance-family in tenancy\n  - Allow group NetworkAdmins to manage virtual-network-family in tenancy\n\nA tenancy with identity domains:\nAn Identity Domain is a container of users, groups, Apps and other security configurations.\nA tenancy that has Identity Domains available comes seeded with a 'Default' identity domain.\n\nIf a group belongs to a domain different than the default domain, use a domain prefix in\nthe policy statements.","descriptions":[{"label":"default","data":"To apply least-privilege security principle, one can create service-level administrators in\ncorresponding groups and assigning specific users to each service-level administrative group\nin a tenancy. This limits administrative access in a tenancy. It means service-level\nadministrators can only manage resources of a specific service.\n\nExample policies for global/tenant level service-administrators:\n  - Allow group VolumeAdmins to manage volume-family in tenancy\n  - Allow group ComputeAdmins to manage instance-family in tenancy\n  - Allow group NetworkAdmins to manage virtual-network-family in tenancy\n\nA tenancy with identity domains:\nAn Identity Domain is a container of users, groups, Apps and other security configurations.\nA tenancy that has Identity Domains available comes seeded with a 'Default' identity domain.\n\nIf a group belongs to a domain different than the default domain, use a domain prefix in\nthe policy statements."},{"label":"check","data":"From CLI:\nSet up OCI CLI with an IAM administrator user who has read access to IAM resources such as\ngroups and policies. Run OCI CLI command providing the root_compartment_OCID.\n\nGet the list of groups in a tenancy:\n  oci iam group list --compartment-id <root_compartment_OCID> | grep name\n\nNote: A tenancy with identity domains - The above CLI commands work with the default identity\ndomain only. For IaaS resource management, users and groups created in the default domain are\nsufficient.\n\nEnsure distinct administrative groups are created as per your organization's definition of\nservice-administrators. Verify the appropriate policies are created for the service-administrators\ngroups to have the right access to the corresponding services.\n\nRetrieve the policy statements scoped at the tenancy level and/or per compartment:\n  oci iam policy list --compartment-id <root_compartment_OCID> | grep \"in tenancy\"\n  oci iam policy list --compartment-id <root_compartment_OCID> | grep \"in compartment\"\n\nThe --compartment-id parameter can be changed to a child compartment to get policies\nassociated with child compartments:\n  oci iam policy list --compartment-id <child_compartment_OCID> | grep \"in compartment\"\n\nVerify the results to ensure the right policies are created for service-administrators to\nhave the necessary access."},{"label":"fix","data":"Refer to the policy syntax document and create new policies if the audit results indicate\nthat the required policies are missing.\n\nThis can be done via OCI console or OCI CLI/SDK or API.\n\nCreating a new policy from CLI:\n  oci iam policy create [OPTIONS]\n\nThis creates a new policy in the specified compartment (either the tenancy or another of\nyour compartments). If you're new to policies, see Getting Started with Policies.\n\nYou must specify:\n  - A name for the policy (unique across all policies in your tenancy, cannot be changed)\n  - A description for the policy (can be empty, can be changed with UpdatePolicy)\n  - One or more policy statements in the statements array\n\nFor information about writing policies, see How Policies Work and Common Policies."}],"impact":0.5,"refs":[],"tags":{"check_id":"C-1_1","severity":"medium","gid":"CIS-1_1","rid":"xccdf_cis_cis_rule_1_1","stig_id":"1.1","gtitle":"<GroupDescription></GroupDescription>","cci":["CCI-000056","CCI-000059","CCI-000058","CCI-002113","CCI-002117","CCI-002118","CCI-002126","CCI-001682","CCI-000766","CCI-001643","CCI-000011","CCI-002113","CCI-002117","CCI-002118","CCI-000008"],"nist":["AC-11 b","AC-11 a","AC-11 a","AC-2 c","AC-2 d 2","AC-2 d 3","AC-2 i 1","AC-2 (2)","IA-2 (2)","RA-5 a","AC-2 f","AC-2 c","AC-2 d 2","AC-2 d 3","AC-2 c"]},"code":"control '1_1' do\n  title 'Ensure service level admins are created to manage resources of particular service'\n\n  desc <<~DESC\n    To apply least-privilege security principle, one can create service-level administrators in\n    corresponding groups and assigning specific users to each service-level administrative group\n    in a tenancy. This limits administrative access in a tenancy. It means service-level\n    administrators can only manage resources of a specific service.\n\n    Example policies for global/tenant level service-administrators:\n      - Allow group VolumeAdmins to manage volume-family in tenancy\n      - Allow group ComputeAdmins to manage instance-family in tenancy\n      - Allow group NetworkAdmins to manage virtual-network-family in tenancy\n\n    A tenancy with identity domains:\n    An Identity Domain is a container of users, groups, Apps and other security configurations.\n    A tenancy that has Identity Domains available comes seeded with a 'Default' identity domain.\n\n    If a group belongs to a domain different than the default domain, use a domain prefix in\n    the policy statements.\n  DESC\n\n  desc 'check', <<~CHECK\n    From CLI:\n    Set up OCI CLI with an IAM administrator user who has read access to IAM resources such as\n    groups and policies. Run OCI CLI command providing the root_compartment_OCID.\n\n    Get the list of groups in a tenancy:\n      oci iam group list --compartment-id <root_compartment_OCID> | grep name\n\n    Note: A tenancy with identity domains - The above CLI commands work with the default identity\n    domain only. For IaaS resource management, users and groups created in the default domain are\n    sufficient.\n\n    Ensure distinct administrative groups are created as per your organization's definition of\n    service-administrators. Verify the appropriate policies are created for the service-administrators\n    groups to have the right access to the corresponding services.\n\n    Retrieve the policy statements scoped at the tenancy level and/or per compartment:\n      oci iam policy list --compartment-id <root_compartment_OCID> | grep \"in tenancy\"\n      oci iam policy list --compartment-id <root_compartment_OCID> | grep \"in compartment\"\n\n    The --compartment-id parameter can be changed to a child compartment to get policies\n    associated with child compartments:\n      oci iam policy list --compartment-id <child_compartment_OCID> | grep \"in compartment\"\n\n    Verify the results to ensure the right policies are created for service-administrators to\n    have the necessary access.\n  CHECK\n\n  desc 'fix', <<~FIX\n    Refer to the policy syntax document and create new policies if the audit results indicate\n    that the required policies are missing.\n\n    This can be done via OCI console or OCI CLI/SDK or API.\n\n    Creating a new policy from CLI:\n      oci iam policy create [OPTIONS]\n\n    This creates a new policy in the specified compartment (either the tenancy or another of\n    your compartments). If you're new to policies, see Getting Started with Policies.\n\n    You must specify:\n      - A name for the policy (unique across all policies in your tenancy, cannot be changed)\n      - A description for the policy (can be empty, can be changed with UpdatePolicy)\n      - One or more policy statements in the statements array\n\n    For information about writing policies, see How Policies Work and Common Policies.\n  FIX\n\n  impact 0.5\n\n  tag check_id: 'C-1_1'\n  tag severity: 'medium'\n  tag gid: 'CIS-1_1'\n  tag rid: 'xccdf_cis_cis_rule_1_1'\n  tag stig_id: '1.1'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n\n  tag cci: [\n    'CCI-000056',\n    'CCI-000059',\n    'CCI-000058',\n    'CCI-002113',\n    'CCI-002117',\n    'CCI-002118',\n    'CCI-002126',\n    'CCI-001682',\n    'CCI-000766',\n    'CCI-001643',\n    'CCI-000011',\n    'CCI-002113',\n    'CCI-002117',\n    'CCI-002118',\n    'CCI-000008'\n  ]\n\n  tag nist: [\n    'AC-11 b',\n    'AC-11 a',\n    'AC-11 a',\n    'AC-2 c',\n    'AC-2 d 2',\n    'AC-2 d 3',\n    'AC-2 i 1',\n    'AC-2 (2)',\n    'IA-2 (2)',\n    'RA-5 a',\n    'AC-2 f',\n    'AC-2 c',\n    'AC-2 d 2',\n    'AC-2 d 3',\n    'AC-2 c'\n  ]\n\n  tenancy_ocid = input('tenancy_ocid')\n  tenancy_level_policy_statements = input('tenancy_level_policy_statements')\n  compartment_level_policy_statements = input('compartment_level_policy_statements')\n\n  tenancy_level_cmd = %(oci iam policy list --compartment-id '#{tenancy_ocid}' --all | jq '[.data[] | .statements[]? | select(test(\"in tenancy\"; \"i\"))]')\n  tenancy_level_policy_output = json(command: tenancy_level_cmd).params\n\n  compartment_cmd = %(oci iam policy list --compartment-id '#{tenancy_ocid}' --all | jq '[.data[] | .statements[]? | select(test(\"in compartment\"; \"i\"))]')\n  compartment_policy_output = json(command: compartment_cmd).params\n\n  tenancy_level_policy_statements_normalized = tenancy_level_policy_statements.map(&:downcase)\n  tenancy_level_policy_output_normalized = tenancy_level_policy_output.map(&:downcase)\n\n  tenancy_missing = tenancy_level_policy_statements.reject do |policy|\n    tenancy_level_policy_output_normalized.include?(policy.downcase)\n  end\n  tenancy_extra = tenancy_level_policy_output.reject do |policy|\n    tenancy_level_policy_statements_normalized.include?(policy.downcase)\n  end\n  tenancy_ok = tenancy_missing.empty? && tenancy_extra.empty?\n\n  tenancy_missing_lines = tenancy_missing.empty? ? '  - none' : tenancy_missing.map { |statement| \"  - #{statement}\" }.join(\"\\n\")\n  tenancy_extra_lines = tenancy_extra.empty? ? '  - none' : tenancy_extra.map { |statement| \"  - #{statement}\" }.join(\"\\n\")\n  tenancy_failure_details = [\"Missing statements:\\n#{tenancy_missing_lines}\", \"Extra statements:\\n#{tenancy_extra_lines}\"].join(\"\\n\")\n\n  compartment_level_policy_statements_normalized = compartment_level_policy_statements.map(&:downcase)\n  compartment_policy_output_normalized = compartment_policy_output.map(&:downcase)\n\n  compartment_missing = compartment_level_policy_statements.reject do |policy|\n    compartment_policy_output_normalized.include?(policy.downcase)\n  end\n  compartment_extra = compartment_policy_output.reject do |policy|\n    compartment_level_policy_statements_normalized.include?(policy.downcase)\n  end\n  compartment_ok = compartment_missing.empty? && compartment_extra.empty?\n\n  compartment_missing_lines = compartment_missing.empty? ? '  - none' : compartment_missing.map { |statement| \"  - #{statement}\" }.join(\"\\n\")\n  compartment_extra_lines = compartment_extra.empty? ? '  - none' : compartment_extra.map { |statement| \"  - #{statement}\" }.join(\"\\n\")\n  compartment_failure_details = [\n    \"Missing statements:\\n#{compartment_missing_lines}\",\n    \"Extra statements:\\n#{compartment_extra_lines}\"\n  ].join(\"\\n\")\n\n  describe 'Expected Tenancy level policy statements' do\n    it 'were found' do\n      expect(tenancy_ok).to eq(true), tenancy_failure_details\n    end\n  end\n\n  describe 'Expected Compartment level policy statements' do\n    it 'were found' do\n      expect(compartment_ok).to eq(true), compartment_failure_details\n    end\n  end\nend\n","source_location":{"line":1,"ref":"./controls/1_1.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Expected Tenancy level policy statements were found","run_time":0.001086,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Expected Tenancy level policy statements"},{"status":"passed","code_desc":"Expected Compartment level policy statements were found","run_time":0.00003,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Expected Compartment level policy statements"}],"status":"passed"},{"id":"1_10","title":"Ensure user auth tokens rotate within 90 days or less","desc":"Auth tokens are authentication tokens generated by Oracle. You use auth tokens to\nauthenticate with APIs that do not support the Oracle Cloud Infrastructure signature-based\nauthentication. If the service requires an auth token, the service-specific documentation\ninstructs you to generate one and how to use it. It is important to secure and rotate an\nauth token every 90 days or less as it provides the same level of access to APIs that do\nnot support the OCI signature-based authentication as the user associated to it.","descriptions":[{"label":"default","data":"Auth tokens are authentication tokens generated by Oracle. You use auth tokens to\nauthenticate with APIs that do not support the Oracle Cloud Infrastructure signature-based\nauthentication. If the service requires an auth token, the service-specific documentation\ninstructs you to generate one and how to use it. It is important to secure and rotate an\nauth token every 90 days or less as it provides the same level of access to APIs that do\nnot support the OCI signature-based authentication as the user associated to it."},{"label":"check","data":"From Console: Login to OCI Console. Select Identity & Security from the Services menu.\n\nSelect Domains from the Identity menu. For each domain listed, click on the name and\nselect Users . Click on an individual user under the Username heading. Click on Auth\nTokens in the lower left-hand corner of the page. Ensure the date of the Auth Token under\nthe Created column of the Customer Secret Key is no more than 90 days old."},{"label":"fix","data":"From Console: Login to OCI Console. Select Identity & Security from the Services menu.\n\nSelect Domains from the Identity menu. For each domain listed, click on the name and\nselect Users . Click on an individual user under the Username heading. Click on Auth\nTokens in the lower left-hand corner of the page. Delete any auth token with a date older\nthan 90 days under the Created column of the Customer Secret Keys."}],"impact":0.5,"refs":[],"tags":{"check_id":"C-1_10","severity":"medium","gid":"CIS-1_10","rid":"xccdf_cis_cis_rule_1_10","stig_id":"1.1","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-000364","CCI-000365","CCI-000366","CCI-000421","CCI-001097","CCI-001098","CCI-002395","CCI-002110","CCI-002111","CCI-002112","CCI-000012","CCI-000200","CCI-000199","CCI-000205","CCI-000204"],"nist":["CM-6 a","CM-6 a","CM-6 b","CM-9 a","SC-7 a","SC-7 c","SC-7 b","AC-2 a","AC-2 a","AC-2 b","AC-2 j","IA-5 (1) (e)","IA-5 (1) (d)","IA-5 (1) (a)","IA-5 (8)"]},"code":"control '1_10' do\n  title 'Ensure user auth tokens rotate within 90 days or less'\n\n  desc <<~DESC\n    Auth tokens are authentication tokens generated by Oracle. You use auth tokens to\n    authenticate with APIs that do not support the Oracle Cloud Infrastructure signature-based\n    authentication. If the service requires an auth token, the service-specific documentation\n    instructs you to generate one and how to use it. It is important to secure and rotate an\n    auth token every 90 days or less as it provides the same level of access to APIs that do\n    not support the OCI signature-based authentication as the user associated to it.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Login to OCI Console. Select Identity & Security from the Services menu.\n\n    Select Domains from the Identity menu. For each domain listed, click on the name and\n    select Users . Click on an individual user under the Username heading. Click on Auth\n    Tokens in the lower left-hand corner of the page. Ensure the date of the Auth Token under\n    the Created column of the Customer Secret Key is no more than 90 days old.\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Login to OCI Console. Select Identity & Security from the Services menu.\n\n    Select Domains from the Identity menu. For each domain listed, click on the name and\n    select Users . Click on an individual user under the Username heading. Click on Auth\n    Tokens in the lower left-hand corner of the page. Delete any auth token with a date older\n    than 90 days under the Created column of the Customer Secret Keys.\n  FIX\n\n  impact 0.5\n\n  tag check_id: 'C-1_10'\n  tag severity: 'medium'\n  tag gid: 'CIS-1_10'\n  tag rid: 'xccdf_cis_cis_rule_1_10'\n  tag stig_id: '1.1'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-000364',\n    'CCI-000365',\n    'CCI-000366',\n    'CCI-000421',\n    'CCI-001097',\n    'CCI-001098',\n    'CCI-002395',\n    'CCI-002110',\n    'CCI-002111',\n    'CCI-002112',\n    'CCI-000012',\n    'CCI-000200',\n    'CCI-000199',\n    'CCI-000205',\n    'CCI-000204'\n  ]\n\n  tag nist: [\n    'CM-6 a',\n    'CM-6 a',\n    'CM-6 b',\n    'CM-9 a',\n    'SC-7 a',\n    'SC-7 c',\n    'SC-7 b',\n    'AC-2 a',\n    'AC-2 a',\n    'AC-2 b',\n    'AC-2 j',\n    'IA-5 (1) (e)',\n    'IA-5 (1) (d)',\n    'IA-5 (1) (a)',\n    'IA-5 (8)'\n  ]\n\n  require 'time'\n\n  compartments_response = json(command: 'oci iam compartment list --include-root --compartment-id-in-subtree TRUE --all 2>/dev/null')\n  compartments_data = compartments_response.params.fetch('data', [])\n  compartment_ids = compartments_data.map { |compartment| compartment['id'] }.compact\n\n  domain_urls = []\n\n  compartment_ids.each do |compartment_id|\n    domains_response = json(command: %(oci iam domain list --compartment-id \"#{compartment_id}\" --all))\n    domains_data = domains_response.params.fetch('data', [])\n    domain_urls.concat(domains_data.map { |domain| domain['url'] }.compact)\n  end\n\n  now = Time.now.utc\n  cutoff_time = now - (90 * 24 * 60 * 60)\n  stale_auth_tokens = []\n  total_auth_tokens = 0\n  domain_urls.uniq!\n\n  domain_urls.each do |domain_url|\n    next if domain_url.to_s.empty?\n\n    users_cmd = %(oci identity-domains users list --endpoint \"#{domain_url}\" --all)\n    users_response = json(command: users_cmd).params\n    users = users_response.dig('data', 'resources') || []\n\n    users.each do |user|\n      user_ocid = user['ocid']\n      user_name = user['user-name']\n\n      auth_tokens_cmd = %(oci identity-domains auth-tokens list --endpoint \"#{domain_url}\" --all --filter 'user.ocid eq \"#{user_ocid}\"')\n      auth_tokens_response = json(command: auth_tokens_cmd).params\n      auth_tokens = auth_tokens_response.dig('data', 'resources') || []\n      total_auth_tokens += auth_tokens.length\n\n      auth_tokens.each do |auth_token|\n        created_at = auth_token.dig('meta', 'created')\n\n        token_details = {\n          'user_name' => user_name,\n          'domain_url' => domain_url,\n          'auth_token_id' => auth_token['id'],\n          'user_ocid' => user_ocid,\n          'created' => created_at\n        }\n\n        created_time = Time.parse(created_at.to_s).utc\n\n        next unless created_time < cutoff_time\n\n        age_days = ((now - created_time) / 86_400).floor\n        stale_auth_tokens << token_details.merge('age_days' => age_days)\n      end\n    end\n  end\n\n  if total_auth_tokens.zero?\n    impact 0.0\n    describe 'Ensure user auth tokens rotate within 90 days or less' do\n      skip 'No auth tokens found in tenancy.'\n    end\n  else\n    describe 'Ensure user auth tokens rotate within 90 days or less' do\n      subject { stale_auth_tokens }\n      it { should cmp [] }\n    end\n  end\nend\n","source_location":{"line":1,"ref":"./controls/1_10.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Ensure user auth tokens rotate within 90 days or less is expected to cmp == []","run_time":0.00012,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Ensure user auth tokens rotate within 90 days or less"}],"status":"passed"},{"id":"1_11","title":"Ensure user IAM Database Passwords rotate within 90 days","desc":"Users can create and manage their database password in their IAM user profile and use that\npassword to authenticate to databases in their tenancy. An IAM database password is a\ndifferent password than an OCI Console password. Setting an IAM database password allows\nan authorized IAM user to sign in to one or more Autonomous Databases in their tenancy. An\nIAM database password is a different password than an OCI Console password. Setting an IAM\ndatabase password allows an authorized IAM user to sign in to one or more Autonomous\nDatabases in their tenancy. It is important to secure and rotate an IAM Database password\n90 days or less as it provides the same access the user would have a using a local\ndatabase user.","descriptions":[{"label":"default","data":"Users can create and manage their database password in their IAM user profile and use that\npassword to authenticate to databases in their tenancy. An IAM database password is a\ndifferent password than an OCI Console password. Setting an IAM database password allows\nan authorized IAM user to sign in to one or more Autonomous Databases in their tenancy. An\nIAM database password is a different password than an OCI Console password. Setting an IAM\ndatabase password allows an authorized IAM user to sign in to one or more Autonomous\nDatabases in their tenancy. It is important to secure and rotate an IAM Database password\n90 days or less as it provides the same access the user would have a using a local\ndatabase user."},{"label":"check","data":"From Console: Login to OCI Console. Select Identity & Security from the Services menu.\n\nSelect Users from the Identity menu. Click on an individual user under the Name heading.\nClick on Database Passwords in the lower left-hand corner of the page. Ensure the date of\nthe Database Passwords under the Created column of the Database Passwords is no more than\n90 days From Console: Login to OCI Console. Select Identity & Security from the Services\nmenu. Select Domains from the Identity menu. For each domain listed, click on the name and\nselect Users . Click on an individual user under the Username heading. Click on Database\nPasswords in the lower left-hand corner of the page. Ensure the date of the Database\nPasswords under the Created column of the Database Password is no more than 90 days old."},{"label":"fix","data":"OCI IAM with Identity Domains From Console: Login to OCI Console. Select Identity &\nSecurity from the Services menu. Select Domains from the Identity menu. For each domain\nlisted, click on the name and select Users . Click on an individual user under the\nUsername heading. Click on IAM Database Passwords in the lower left-hand corner of the\npage. Delete any Database Passwords with a date older than 90 days under the Created\ncolumn of the Database Passwords."}],"impact":0.5,"refs":[],"tags":{"check_id":"C-1_11","severity":"medium","gid":"CIS-1_11","rid":"xccdf_cis_cis_rule_1_11","stig_id":"1.11","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-000364","CCI-000365","CCI-000366","CCI-000421","CCI-000200","CCI-000199","CCI-000205","CCI-000204"],"nist":["CM-6 a","CM-6 a","CM-6 b","CM-9 a","IA-5 (1) (e)","IA-5 (1) (d)","IA-5 (1) (a)","IA-5 (8)"]},"code":"control '1_11' do\n  title 'Ensure user IAM Database Passwords rotate within 90 days'\n\n  desc <<~DESC\n    Users can create and manage their database password in their IAM user profile and use that\n    password to authenticate to databases in their tenancy. An IAM database password is a\n    different password than an OCI Console password. Setting an IAM database password allows\n    an authorized IAM user to sign in to one or more Autonomous Databases in their tenancy. An\n    IAM database password is a different password than an OCI Console password. Setting an IAM\n    database password allows an authorized IAM user to sign in to one or more Autonomous\n    Databases in their tenancy. It is important to secure and rotate an IAM Database password\n    90 days or less as it provides the same access the user would have a using a local\n    database user.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Login to OCI Console. Select Identity & Security from the Services menu.\n\n    Select Users from the Identity menu. Click on an individual user under the Name heading.\n    Click on Database Passwords in the lower left-hand corner of the page. Ensure the date of\n    the Database Passwords under the Created column of the Database Passwords is no more than\n    90 days From Console: Login to OCI Console. Select Identity & Security from the Services\n    menu. Select Domains from the Identity menu. For each domain listed, click on the name and\n    select Users . Click on an individual user under the Username heading. Click on Database\n    Passwords in the lower left-hand corner of the page. Ensure the date of the Database\n    Passwords under the Created column of the Database Password is no more than 90 days old.\n  CHECK\n\n  desc 'fix', <<~FIX\n    OCI IAM with Identity Domains From Console: Login to OCI Console. Select Identity &\n    Security from the Services menu. Select Domains from the Identity menu. For each domain\n    listed, click on the name and select Users . Click on an individual user under the\n    Username heading. Click on IAM Database Passwords in the lower left-hand corner of the\n    page. Delete any Database Passwords with a date older than 90 days under the Created\n    column of the Database Passwords.\n  FIX\n\n  impact 0.5\n\n  tag check_id: 'C-1_11'\n  tag severity: 'medium'\n  tag gid: 'CIS-1_11'\n  tag rid: 'xccdf_cis_cis_rule_1_11'\n  tag stig_id: '1.11'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-000364',\n    'CCI-000365',\n    'CCI-000366',\n    'CCI-000421',\n    'CCI-000200',\n    'CCI-000199',\n    'CCI-000205',\n    'CCI-000204'\n  ]\n\n  tag nist: [\n    'CM-6 a',\n    'CM-6 a',\n    'CM-6 b',\n    'CM-9 a',\n    'IA-5 (1) (e)',\n    'IA-5 (1) (d)',\n    'IA-5 (1) (a)',\n    'IA-5 (8)'\n  ]\n\n  require 'time'\n\n  compartments_response = json(command: 'oci iam compartment list --include-root --compartment-id-in-subtree TRUE --all 2>/dev/null')\n  compartments_data = compartments_response.params.fetch('data', [])\n  compartment_ids = compartments_data.map { |compartment| compartment['id'] }.compact\n\n  domain_urls = []\n\n  compartment_ids.each do |compartment_id|\n    domains_response = json(command: %(oci iam domain list --compartment-id \"#{compartment_id}\" --all))\n    domains_data = domains_response.params.fetch('data', [])\n    domain_urls.concat(domains_data.map { |domain| domain['url'] }.compact)\n  end\n\n  now = Time.now.utc\n  cutoff_time = now - (90 * 24 * 60 * 60)\n  stale_database_passwords = []\n  total_database_passwords = 0\n  domain_urls.uniq!\n\n  domain_urls.each do |domain_url|\n    next if domain_url.to_s.empty?\n\n    users_cmd = %(oci identity-domains users list --endpoint \"#{domain_url}\" --all)\n    users_response = json(command: users_cmd).params\n    users = users_response.dig('data', 'resources') || []\n\n    users.each do |user|\n      user_ocid = user['ocid']\n      user_name = user['user-name']\n\n      database_passwords_cmd = %(oci identity-domains user-db-credentials list --endpoint \"#{domain_url}\" --all --filter 'user.ocid eq \"#{user_ocid}\"')\n      database_passwords_response = json(command: database_passwords_cmd).params\n      database_passwords = database_passwords_response.dig('data', 'resources') || []\n      total_database_passwords += database_passwords.length\n\n      database_passwords.each do |database_password|\n        created_at = database_password.dig('meta', 'created')\n\n        password_details = {\n          'user_name' => user_name,\n          'domain_url' => domain_url,\n          'database_password_id' => database_password['id'],\n          'user_ocid' => user_ocid,\n          'created' => created_at\n        }\n\n        created_time = Time.parse(created_at.to_s).utc\n\n        next unless created_time < cutoff_time\n\n        age_days = ((now - created_time) / 86_400).floor\n        stale_database_passwords << password_details.merge('age_days' => age_days)\n      end\n    end\n  end\n\n  if total_database_passwords.zero?\n    impact 0.0\n    describe 'Ensure user IAM Database Passwords rotate within 90 days' do\n      skip 'No database passwords found in tenancy.'\n    end\n  else\n    describe 'Ensure user IAM Database Passwords rotate within 90 days' do\n      subject { stale_database_passwords }\n      it { should cmp [] }\n    end\n  end\nend\n","source_location":{"line":1,"ref":"./controls/1_11.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Ensure user IAM Database Passwords rotate within 90 days is expected to cmp == []","run_time":0.000056,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Ensure user IAM Database Passwords rotate within 90 days"}],"status":"passed"},{"id":"1_12","title":"Ensure API keys are not created for tenancy administrator users","desc":"Tenancy administrator users have full access to the organization's OCI tenancy. API keys\nassociated with user accounts are used for invoking the OCI APIs via custom programs or\nclients like CLI/SDKs. The clients are typically used for performing day-to-day operations\nand should never require full tenancy access. Service-level administrative users with API\nkeys should be used instead. For performing day-to-day operations tenancy administrator\naccess is not needed. Service-level administrative users with API keys should be used to\napply privileged security principle.","descriptions":[{"label":"default","data":"Tenancy administrator users have full access to the organization's OCI tenancy. API keys\nassociated with user accounts are used for invoking the OCI APIs via custom programs or\nclients like CLI/SDKs. The clients are typically used for performing day-to-day operations\nand should never require full tenancy access. Service-level administrative users with API\nkeys should be used instead. For performing day-to-day operations tenancy administrator\naccess is not needed. Service-level administrative users with API keys should be used to\napply privileged security principle."},{"label":"check","data":"From Console: Login to OCI Console. Select Identity & Security from the Services menu.\n\nSelect Domains from the Identity menu. Click on the 'Default' Domain in the (root). Click\non 'Groups'. Select the 'Administrators' group by clicking on the Name Click on each local\nor synchronized Administrators member profile Click on API Keys to verify if a user has an\nAPI key associated."},{"label":"fix","data":"From Console: Login to OCI console. Select Identity from Services menu. Select Users from\n\nIdentity menu, or select Domains , select a domain, and select Users . Select the username\nof a tenancy administrator user with an API key. Select API Keys from the menu in the\nlower left-hand corner. Delete any associated keys from the API Keys table. Repeat steps\n3-6 for all tenancy administrator users with an API key. From CLI: For each tenancy\nadministrator user with an API key, execute the following command to retrieve API key\ndetails: oci iam user api-key list --user-id <user_id> For each API key, execute the\nfollowing command to delete the key: oci iam user api-key delete --user-id <user_id>\n--fingerprint <api_key_fingerprint> The following message will be displayed: Are you sure\nyou want to delete this resource? [y/N]: Type 'y' and press 'Enter'."}],"impact":0.5,"refs":[],"tags":{"check_id":"C-1_12","severity":"medium","gid":"CIS-1_12","rid":"xccdf_cis_cis_rule_1_12","stig_id":"1.12","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-000056","CCI-000059","CCI-000058","CCI-002113","CCI-002117","CCI-002118","CCI-002126"],"nist":["AC-11 b","AC-11 a","AC-11 a","AC-2 c","AC-2 d 2","AC-2 d 3","AC-2 i 1"]},"code":"control '1_12' do\n  title 'Ensure API keys are not created for tenancy administrator users'\n\n  desc <<~DESC\n    Tenancy administrator users have full access to the organization's OCI tenancy. API keys\n    associated with user accounts are used for invoking the OCI APIs via custom programs or\n    clients like CLI/SDKs. The clients are typically used for performing day-to-day operations\n    and should never require full tenancy access. Service-level administrative users with API\n    keys should be used instead. For performing day-to-day operations tenancy administrator\n    access is not needed. Service-level administrative users with API keys should be used to\n    apply privileged security principle.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Login to OCI Console. Select Identity & Security from the Services menu.\n\n    Select Domains from the Identity menu. Click on the 'Default' Domain in the (root). Click\n    on 'Groups'. Select the 'Administrators' group by clicking on the Name Click on each local\n    or synchronized Administrators member profile Click on API Keys to verify if a user has an\n    API key associated.\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Login to OCI console. Select Identity from Services menu. Select Users from\n\n    Identity menu, or select Domains , select a domain, and select Users . Select the username\n    of a tenancy administrator user with an API key. Select API Keys from the menu in the\n    lower left-hand corner. Delete any associated keys from the API Keys table. Repeat steps\n    3-6 for all tenancy administrator users with an API key. From CLI: For each tenancy\n    administrator user with an API key, execute the following command to retrieve API key\n    details: oci iam user api-key list --user-id <user_id> For each API key, execute the\n    following command to delete the key: oci iam user api-key delete --user-id <user_id>\n    --fingerprint <api_key_fingerprint> The following message will be displayed: Are you sure\n    you want to delete this resource? [y/N]: Type 'y' and press 'Enter'.\n  FIX\n\n  impact 0.5\n\n  tag check_id: 'C-1_12'\n  tag severity: 'medium'\n  tag gid: 'CIS-1_12'\n  tag rid: 'xccdf_cis_cis_rule_1_12'\n  tag stig_id: '1.12'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-000056',\n    'CCI-000059',\n    'CCI-000058',\n    'CCI-002113',\n    'CCI-002117',\n    'CCI-002118',\n    'CCI-002126'\n  ]\n\n  tag nist: [\n    'AC-11 b',\n    'AC-11 a',\n    'AC-11 a',\n    'AC-2 c',\n    'AC-2 d 2',\n    'AC-2 d 3',\n    'AC-2 i 1'\n  ]\n\n  tenancy_ocid = input('tenancy_ocid')\n\n  domains_response = json(command: %(oci iam domain list --compartment-id \"#{tenancy_ocid}\" --display-name \"Default\" --all))\n  domains_data = domains_response.params.fetch('data', [])\n  domain_urls = domains_data.map { |domain| domain['url'] }.compact\n\n  admins_with_api_keys = []\n  admin_user_count = 0\n  domain_urls.uniq!\n\n  domain_urls.each do |domain_url|\n    next if domain_url.to_s.empty?\n\n    groups_cmd = %(oci identity-domains groups list --endpoint \"#{domain_url}\" --all --filter 'displayName eq \"Administrators\"')\n    groups_response = json(command: groups_cmd).params\n    groups = groups_response.dig('data', 'resources') || []\n\n    groups.each do |group|\n      group_id = group['id']\n      next if group_id.to_s.empty?\n\n      users_cmd = %(oci identity-domains users list --endpoint \"#{domain_url}\" --all --filter 'groups.value eq \"#{group_id}\"')\n      users_response = json(command: users_cmd).params\n      users = users_response.dig('data', 'resources') || []\n\n      users.each do |user|\n        user_ocid = user['ocid']\n        user_name = user['user-name']\n        next if user_ocid.to_s.empty?\n\n        admin_user_count += 1\n\n        api_keys_cmd = %(oci identity-domains api-keys list --endpoint \"#{domain_url}\" --all --filter 'user.ocid eq \"#{user_ocid}\"')\n        api_keys_response = json(command: api_keys_cmd).params\n        api_keys = api_keys_response.dig('data', 'resources') || []\n\n        api_keys.each do |api_key|\n          admins_with_api_keys << {\n            'user_name' => user_name,\n            'user_ocid' => user_ocid,\n            'api_key_id' => api_key['id'],\n            'domain_url' => domain_url\n          }\n        end\n      end\n    end\n  end\n\n  if admin_user_count.zero?\n    impact 0.0\n    describe 'Ensure API keys are not created for tenancy administrator users' do\n      skip 'No Administrators group members found in the Default identity domain.'\n    end\n  else\n    describe 'Ensure API keys are not created for tenancy administrator users' do\n      subject { admins_with_api_keys }\n      it { should cmp [] }\n    end\n  end\nend\n","source_location":{"line":1,"ref":"./controls/1_12.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"Ensure API keys are not created for tenancy administrator users is expected to cmp == []","run_time":0.010503,"start_time":"2026-01-28T09:26:55-05:00","message":"\nexpected: []\n     got: [{\"user_name\"=>\"owilliams@mitre.org\", \"user_ocid\"=>\"ocid1.user.oc1..aaaaaaaaedcphouhzeiguz7asb26gzwqh7ligij4qyh7fay7ycyotprx42eq\", \"api_key_id\"=>\"c0e4bc99e16045e3abb5e1c4b875acbd\", \"domain_url\"=>\"https://idcs-d1f3bb0934614517ad699099701886ea.identity.oraclecloud.com:443\"}, {\"user_name\"=>\"schaconcai@mitre.org\", \"user_ocid\"=>\"ocid1.user.oc1..aaaaaaaax4oubjnw7ycvqjxsreiszwnr4rbllgrktgakhx7bbvyiz2v7l7na\", \"api_key_id\"=>\"ab2a403da9e34f54817aff9125fffbc9\", \"domain_url\"=>\"https://idcs-d1f3bb0934614517ad699099701886ea.identity.oraclecloud.com:443\"}, {\"user_name\"=>\"seansotheraccount\", \"user_ocid\"=>\"ocid1.user.oc1..aaaaaaaadfvhbekcrzki3aktb5rjq5cbzb4h7ehnwpolcznp7lo36livduaq\", \"api_key_id\"=>\"7c19c2bafcc54cff89e593df152c3a82\", \"domain_url\"=>\"https://idcs-d1f3bb0934614517ad699099701886ea.identity.oraclecloud.com:443\"}, {\"user_name\"=>\"wdower@mitre.org\", \"user_ocid\"=>\"ocid1.user.oc1..aaaaaaaappqdfam6dkotb43az5uqm63uz6fzjnjobvjn5pz3agm4lbany3tq\", \"api_key_id\"=>\"0328541fbe124bb091d932dc68dcfc77\", \"domain_url\"=>\"https://idcs-d1f3bb0934614517ad699099701886ea.identity.oraclecloud.com:443\"}]\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"Ensure API keys are not created for tenancy administrator users"}],"status":"failed"},{"id":"1_13","title":"Ensure all OCI IAM user accounts have a valid and current email address","desc":"All OCI IAM local user accounts have an email address field associated with the account.\nIt is recommended to specify an email address that is valid and current. If you have an\nemail address in your user profile, you can use the Forgot Password link on the sign on\npage to have a temporary password sent to you. Having a valid and current email address\nassociated with an OCI IAM local user account allows you to tie the account to identity in\nyour organization. It also allows that user to reset their password if it is forgotten or\nlost.","descriptions":[{"label":"default","data":"All OCI IAM local user accounts have an email address field associated with the account.\nIt is recommended to specify an email address that is valid and current. If you have an\nemail address in your user profile, you can use the Forgot Password link on the sign on\npage to have a temporary password sent to you. Having a valid and current email address\nassociated with an OCI IAM local user account allows you to tie the account to identity in\nyour organization. It also allows that user to reset their password if it is forgotten or\nlost."},{"label":"check","data":"From Console: Login to OCI Console. Select Identity & Security from the Services menu.\n\nSelect Domains from the Identity menu. For each domain listed, click on the name and\nselect Users . Click on an individual user under the Username heading. Ensure a valid and\ncurrent email address is next to Email and Recovery email."},{"label":"fix","data":"From Console: Login to OCI Console. Select Identity & Security from the Services menu.\n\nSelect Domains from the Identity menu. For each domain listed, click on the name and\nselect Users . Click on each non-complaint user. Click on Edit User . Enter a valid and\ncurrent email address in the Email and Recovery Email text boxes. Click Save Changes"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-1_13","severity":"medium","gid":"CIS-1_13","rid":"xccdf_cis_cis_rule_1_13","stig_id":"1.13","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-002110","CCI-002111","CCI-002112","CCI-000012","CCI-001054","CCI-001058","CCI-001060","CCI-001059","CCI-001057"],"nist":["AC-2 a","AC-2 a","AC-2 b","AC-2 j","RA-5 a","RA-5 c","RA-5 d","RA-5 d","RA-5 b 1"]},"code":"control '1_13' do\n  title 'Ensure all OCI IAM user accounts have a valid and current email address'\n\n  desc <<~DESC\n    All OCI IAM local user accounts have an email address field associated with the account.\n    It is recommended to specify an email address that is valid and current. If you have an\n    email address in your user profile, you can use the Forgot Password link on the sign on\n    page to have a temporary password sent to you. Having a valid and current email address\n    associated with an OCI IAM local user account allows you to tie the account to identity in\n    your organization. It also allows that user to reset their password if it is forgotten or\n    lost.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Login to OCI Console. Select Identity & Security from the Services menu.\n\n    Select Domains from the Identity menu. For each domain listed, click on the name and\n    select Users . Click on an individual user under the Username heading. Ensure a valid and\n    current email address is next to Email and Recovery email.\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Login to OCI Console. Select Identity & Security from the Services menu.\n\n    Select Domains from the Identity menu. For each domain listed, click on the name and\n    select Users . Click on each non-complaint user. Click on Edit User . Enter a valid and\n    current email address in the Email and Recovery Email text boxes. Click Save Changes\n  FIX\n\n  impact 0.5\n\n  tag check_id: 'C-1_13'\n  tag severity: 'medium'\n  tag gid: 'CIS-1_13'\n  tag rid: 'xccdf_cis_cis_rule_1_13'\n  tag stig_id: '1.13'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-002110',\n    'CCI-002111',\n    'CCI-002112',\n    'CCI-000012',\n    'CCI-001054',\n    'CCI-001058',\n    'CCI-001060',\n    'CCI-001059',\n    'CCI-001057'\n  ]\n\n  tag nist: [\n    'AC-2 a',\n    'AC-2 a',\n    'AC-2 b',\n    'AC-2 j',\n    'RA-5 a',\n    'RA-5 c',\n    'RA-5 d',\n    'RA-5 d',\n    'RA-5 b 1'\n  ]\n\n  describe 'Ensure all OCI IAM user accounts have a valid and current email address' do\n    skip 'The check for this control needs to be done manually'\n  end\nend\n","source_location":{"line":1,"ref":"./controls/1_13.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"Ensure all OCI IAM user accounts have a valid and current email address","run_time":0.000005,"start_time":"2026-01-28T09:26:55-05:00","resource":"","skip_message":"The check for this control needs to be done manually","resource_class":"Object","resource_params":"[]","resource_id":"Ensure all OCI IAM user accounts have a valid and current email address"}],"status":"not_reviewed"},{"id":"1_14","title":"Ensure Instance Principal authentication is used for OCI instances, OCI Cloud Databases and OCI Functions to access OCI resources.","desc":"OCI instances, OCI database and OCI functions can access other OCI resources either via an\nOCI API key associated to a user or via Instance Principal. Instance Principal\nauthentication can be achieved by inclusion in a Dynamic Group that has an IAM policy\ngranting it the required access or using an OCI IAM policy that has request.principal\nadded to the where clause. Access to OCI Resources refers to making API calls to another\nOCI resource like Object Storage, OCI Vaults, etc. Instance Principal reduces the risks\nrelated to hard-coded credentials. Hard-coded API keys can be shared and require rotation,\nwhich can open them up to being compromised. Compromised credentials could allow access to\nOCI services outside of the expected radius.","descriptions":[{"label":"default","data":"OCI instances, OCI database and OCI functions can access other OCI resources either via an\nOCI API key associated to a user or via Instance Principal. Instance Principal\nauthentication can be achieved by inclusion in a Dynamic Group that has an IAM policy\ngranting it the required access or using an OCI IAM policy that has request.principal\nadded to the where clause. Access to OCI Resources refers to making API calls to another\nOCI resource like Object Storage, OCI Vaults, etc. Instance Principal reduces the risks\nrelated to hard-coded credentials. Hard-coded API keys can be shared and require rotation,\nwhich can open them up to being compromised. Compromised credentials could allow access to\nOCI services outside of the expected radius."},{"label":"check","data":"From Console (Dynamic Groups): Go to https://cloud.oracle.com/identity/domains/ Select a\n\nCompartment Click on a Domain Click on Dynamic groups Click on the Dynamic Group Check if\nthe Matching Rules includes the instances accessing your OCI resources. From Console\n(request.principal): Go to https://cloud.oracle.com/identity/policies Select a Compartment\nClick on an individual policy under the Name heading. Ensure Policy statements look like\nthis : allow any-user to <verb> <resource> in compartment <compartment-name> where ALL\n{request.principal.type='<resource_type>', request.principal.id='<resource_ocid>'} or\nallow any-user to <verb> <resource> in compartment <compartment-name> where ALL\n{request.principal.type='<resource_type>',\nrequest.principal.compartment.id='<compartment_OCID>'} From CLI (request.principal):\n\nExecute the following for each compartment_OCID: oci iam policy list --compartment-id\n<compartment_OCID> | grep request.principal Ensure that the condition includes the\ninstances accessing your OCI resources"},{"label":"fix","data":"From Console (Dynamic Groups): Go to https://cloud.oracle.com/identity/domains/ Select a\n\nCompartment Click on the Domain Click on Dynamic groups Click Create Dynamic Group. Enter\na Name Enter a Description Enter Matching Rules to that includes the instances accessing\nyour OCI resources. Click Create."},{"label":"potential_impacts","data":"For an OCI instance that contains embedded credential audit the scripts and environment\nvariables to ensure that none of them contain OCI API Keys or credentials."}],"impact":0.5,"refs":[],"tags":{"check_id":"C-1_14","severity":"medium","gid":"CIS-1_14","rid":"xccdf_cis_cis_rule_1_14","stig_id":"1.14","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-002113","CCI-002117","CCI-002118","CCI-000008","CCI-000051","CCI-002856","CCI-003205"],"nist":["AC-2 c","AC-2 d 2","AC-2 d 3","AC-2 c","AC-8 a","CP-12","SA-12 (8)"]},"code":"control '1_14' do\n  title 'Ensure Instance Principal authentication is used for OCI instances, OCI Cloud Databases and OCI Functions to access OCI resources.'\n\n  desc <<~DESC\n    OCI instances, OCI database and OCI functions can access other OCI resources either via an\n    OCI API key associated to a user or via Instance Principal. Instance Principal\n    authentication can be achieved by inclusion in a Dynamic Group that has an IAM policy\n    granting it the required access or using an OCI IAM policy that has request.principal\n    added to the where clause. Access to OCI Resources refers to making API calls to another\n    OCI resource like Object Storage, OCI Vaults, etc. Instance Principal reduces the risks\n    related to hard-coded credentials. Hard-coded API keys can be shared and require rotation,\n    which can open them up to being compromised. Compromised credentials could allow access to\n    OCI services outside of the expected radius.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console (Dynamic Groups): Go to https://cloud.oracle.com/identity/domains/ Select a\n\n    Compartment Click on a Domain Click on Dynamic groups Click on the Dynamic Group Check if\n    the Matching Rules includes the instances accessing your OCI resources. From Console\n    (request.principal): Go to https://cloud.oracle.com/identity/policies Select a Compartment\n    Click on an individual policy under the Name heading. Ensure Policy statements look like\n    this : allow any-user to <verb> <resource> in compartment <compartment-name> where ALL\n    {request.principal.type='<resource_type>', request.principal.id='<resource_ocid>'} or\n    allow any-user to <verb> <resource> in compartment <compartment-name> where ALL\n    {request.principal.type='<resource_type>',\n    request.principal.compartment.id='<compartment_OCID>'} From CLI (request.principal):\n\n    Execute the following for each compartment_OCID: oci iam policy list --compartment-id\n    <compartment_OCID> | grep request.principal Ensure that the condition includes the\n    instances accessing your OCI resources\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console (Dynamic Groups): Go to https://cloud.oracle.com/identity/domains/ Select a\n\n    Compartment Click on the Domain Click on Dynamic groups Click Create Dynamic Group. Enter\n    a Name Enter a Description Enter Matching Rules to that includes the instances accessing\n    your OCI resources. Click Create.\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    For an OCI instance that contains embedded credential audit the scripts and environment\n    variables to ensure that none of them contain OCI API Keys or credentials.\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-1_14'\n  tag severity: 'medium'\n  tag gid: 'CIS-1_14'\n  tag rid: 'xccdf_cis_cis_rule_1_14'\n  tag stig_id: '1.14'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-002113',\n    'CCI-002117',\n    'CCI-002118',\n    'CCI-000008',\n    'CCI-000051',\n    'CCI-002856',\n    'CCI-003205'\n  ]\n\n  tag nist: [\n    'AC-2 c',\n    'AC-2 d 2',\n    'AC-2 d 3',\n    'AC-2 c',\n    'AC-8 a',\n    'CP-12',\n    'SA-12 (8)'\n  ]\nend\n","source_location":{"line":1,"ref":"./controls/1_14.rb"},"waiver_data":{},"results":[],"status":"passed"},{"id":"1_15","title":"Ensure storage service-level admins cannot delete resources they manage.","desc":"To apply the separation of duties security principle, one can restrict service-level\nadministrators from being able to delete resources they are managing. It means\nservice-level administrators can only manage resources of a specific service but not\ndelete resources for that specific service. Example policies for global/tenant level for\nblock volume service-administrators: Allow group VolumeUsers to manage volumes in tenancy\nwhere request.permission!='VOLUME_DELETE' Allow group VolumeUsers to manage volume-backups\nin tenancy where request.permission!='VOLUME_BACKUP_DELETE' Example policies for\nglobal/tenant level for file storage system service-administrators: Allow group FileUsers\nto manage file-systems in tenancy where request.permission!='FILE_SYSTEM_DELETE' Allow\ngroup FileUsers to manage mount-targets in tenancy where\nrequest.permission!='MOUNT_TARGET_DELETE' Allow group FileUsers to manage export-sets in\ntenancy where request.permission!='EXPORT_SET_DELETE' Example policies for global/tenant\nlevel for object storage system service-administrators: Allow group BucketUsers to manage\nobjects in tenancy where request.permission!='OBJECT_DELETE' Allow group BucketUsers to\nmanage buckets in tenancy where request.permission!='BUCKET_DELETE' Creating service-level\nadministrators without the ability to delete the resource they are managing helps in\ntightly controlling access to Oracle Cloud Infrastructure (OCI) services by implementing\nthe separation of duties security principle.","descriptions":[{"label":"default","data":"To apply the separation of duties security principle, one can restrict service-level\nadministrators from being able to delete resources they are managing. It means\nservice-level administrators can only manage resources of a specific service but not\ndelete resources for that specific service. Example policies for global/tenant level for\nblock volume service-administrators: Allow group VolumeUsers to manage volumes in tenancy\nwhere request.permission!='VOLUME_DELETE' Allow group VolumeUsers to manage volume-backups\nin tenancy where request.permission!='VOLUME_BACKUP_DELETE' Example policies for\nglobal/tenant level for file storage system service-administrators: Allow group FileUsers\nto manage file-systems in tenancy where request.permission!='FILE_SYSTEM_DELETE' Allow\ngroup FileUsers to manage mount-targets in tenancy where\nrequest.permission!='MOUNT_TARGET_DELETE' Allow group FileUsers to manage export-sets in\ntenancy where request.permission!='EXPORT_SET_DELETE' Example policies for global/tenant\nlevel for object storage system service-administrators: Allow group BucketUsers to manage\nobjects in tenancy where request.permission!='OBJECT_DELETE' Allow group BucketUsers to\nmanage buckets in tenancy where request.permission!='BUCKET_DELETE' Creating service-level\nadministrators without the ability to delete the resource they are managing helps in\ntightly controlling access to Oracle Cloud Infrastructure (OCI) services by implementing\nthe separation of duties security principle."},{"label":"check","data":"From Console: Login to OCI console. Go to Identity -> Policies, In the compartment\n\ndropdown, choose the compartment. Open each policy to view the policy statements. Verify\nthe policies to ensure that the policy statements that grant access to storage\nservice-level administrators have a condition that excludes access to delete the service\nthey are the administrator for. From CLI: Execute the following command: for compid in\n`oci iam compartment list --compartment-id-in-subtree TRUE 2>/dev/null | jq -r '.data[] |\n.id'` do for policy in `oci iam policy list --compartment-id $compid 2>/dev/null | jq -r\n'.data[] | .id'` do output=`oci iam policy list --compartment-id $compid 2>/dev/null | jq\n-r '.data[] | .id, .name, .statements'` if [ ! -z \"$output\" ]; then echo $output; fi done\ndone Verify the policies to ensure that the policy statements that grant access to storage\nservice-level administrators have a condition that excludes access to delete the service\nthey are the administrator for."},{"label":"fix","data":"From Console: Login to OCI console. Go to Identity -> Policies, In the compartment\n\ndropdown, choose the compartment. Open each policy to view the policy statements. Add the\nappropriate where condition to any policy statement that allows the storage service-level\nto manage the storage service."}],"impact":0.5,"refs":[],"tags":{"check_id":"C-1_15","severity":"medium","gid":"CIS-1_15","rid":"xccdf_cis_cis_rule_1_15","stig_id":"1.15","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-000056","CCI-000059","CCI-000058","CCI-002113","CCI-002117","CCI-002118","CCI-002126","CCI-002113","CCI-002117","CCI-002118","CCI-000008"],"nist":["AC-11 b","AC-11 a","AC-11 a","AC-2 c","AC-2 d 2","AC-2 d 3","AC-2 i 1","AC-2 c","AC-2 d 2","AC-2 d 3","AC-2 c"]},"code":"control '1_15' do\n  title 'Ensure storage service-level admins cannot delete resources they manage.'\n\n  desc <<~DESC\n    To apply the separation of duties security principle, one can restrict service-level\n    administrators from being able to delete resources they are managing. It means\n    service-level administrators can only manage resources of a specific service but not\n    delete resources for that specific service. Example policies for global/tenant level for\n    block volume service-administrators: Allow group VolumeUsers to manage volumes in tenancy\n    where request.permission!='VOLUME_DELETE' Allow group VolumeUsers to manage volume-backups\n    in tenancy where request.permission!='VOLUME_BACKUP_DELETE' Example policies for\n    global/tenant level for file storage system service-administrators: Allow group FileUsers\n    to manage file-systems in tenancy where request.permission!='FILE_SYSTEM_DELETE' Allow\n    group FileUsers to manage mount-targets in tenancy where\n    request.permission!='MOUNT_TARGET_DELETE' Allow group FileUsers to manage export-sets in\n    tenancy where request.permission!='EXPORT_SET_DELETE' Example policies for global/tenant\n    level for object storage system service-administrators: Allow group BucketUsers to manage\n    objects in tenancy where request.permission!='OBJECT_DELETE' Allow group BucketUsers to\n    manage buckets in tenancy where request.permission!='BUCKET_DELETE' Creating service-level\n    administrators without the ability to delete the resource they are managing helps in\n    tightly controlling access to Oracle Cloud Infrastructure (OCI) services by implementing\n    the separation of duties security principle.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Login to OCI console. Go to Identity -> Policies, In the compartment\n\n    dropdown, choose the compartment. Open each policy to view the policy statements. Verify\n    the policies to ensure that the policy statements that grant access to storage\n    service-level administrators have a condition that excludes access to delete the service\n    they are the administrator for. From CLI: Execute the following command: for compid in\n    `oci iam compartment list --compartment-id-in-subtree TRUE 2>/dev/null | jq -r '.data[] |\n    .id'` do for policy in `oci iam policy list --compartment-id $compid 2>/dev/null | jq -r\n    '.data[] | .id'` do output=`oci iam policy list --compartment-id $compid 2>/dev/null | jq\n    -r '.data[] | .id, .name, .statements'` if [ ! -z \"$output\" ]; then echo $output; fi done\n    done Verify the policies to ensure that the policy statements that grant access to storage\n    service-level administrators have a condition that excludes access to delete the service\n    they are the administrator for.\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Login to OCI console. Go to Identity -> Policies, In the compartment\n\n    dropdown, choose the compartment. Open each policy to view the policy statements. Add the\n    appropriate where condition to any policy statement that allows the storage service-level\n    to manage the storage service.\n  FIX\n\n  impact 0.5\n\n  tag check_id: 'C-1_15'\n  tag severity: 'medium'\n  tag gid: 'CIS-1_15'\n  tag rid: 'xccdf_cis_cis_rule_1_15'\n  tag stig_id: '1.15'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-000056',\n    'CCI-000059',\n    'CCI-000058',\n    'CCI-002113',\n    'CCI-002117',\n    'CCI-002118',\n    'CCI-002126',\n    'CCI-002113',\n    'CCI-002117',\n    'CCI-002118',\n    'CCI-000008'\n  ]\n\n  tag nist: [\n    'AC-11 b',\n    'AC-11 a',\n    'AC-11 a',\n    'AC-2 c',\n    'AC-2 d 2',\n    'AC-2 d 3',\n    'AC-2 i 1',\n    'AC-2 c',\n    'AC-2 d 2',\n    'AC-2 d 3',\n    'AC-2 c'\n  ]\nend\n","source_location":{"line":1,"ref":"./controls/1_15.rb"},"waiver_data":{},"results":[],"status":"passed"},{"id":"1_16","title":"Ensure OCI IAM credentials unused for 45 days or more are disabled","desc":"OCI IAM Local users can access OCI resources using different credentials, such as\npasswords or API keys. It is recommended that credentials that have been unused for 45\ndays or more be deactivated or removed. Disabling or removing unnecessary OCI IAM local\nusers will reduce the window of opportunity for credentials associated with a compromised\nor abandoned account to be used.","descriptions":[{"label":"default","data":"OCI IAM Local users can access OCI resources using different credentials, such as\npasswords or API keys. It is recommended that credentials that have been unused for 45\ndays or more be deactivated or removed. Disabling or removing unnecessary OCI IAM local\nusers will reduce the window of opportunity for credentials associated with a compromised\nor abandoned account to be used."},{"label":"check","data":"Perform the following to determine if unused credentials exist: From Console: For\nPasswords: Login to OCI Console. Select Identity & Security from the Services menu. Select\nDomains from the Identity menu. For each domain listed, click on the name Click Reports\nUnder Dormant users report click View report Enter a date 45 days from todays date in\nLast Successful Login Date Check and ensure that Last Successful Login Date is greater\nthan 45 days or empty For API Keys: Login to OCI Console. Select Observability &\nManagement from the Services menu. Select Search from Logging menu Click Show Advanced\nMode in the right corner Select Custom from Filter by time Under Select regions to search\nadd regions Under Query enter the following query in the text box: search\n\"<tenancy-ocid>/_Audit_Include_Subcompartment\" |\ndata.identity.credentials='<tenancy-ocid>/<user-ocid>/<key-fingerprint>' | summarize\ncount() by data.identity.principalId Enter a day range Note each query can only be 14 days\nmultiple queries will be required to go 45 days Click Search Expand the results If results\nthe count is not zero the user has used their API key during that period Repeat steps 8 \n11 for the 45-day period From CLI: For Passwords: Execute the below: oci identity-domains\nusers list --all --endpoint <identity-domain-endpoint> --attributes\nurn:ietf:params:scim:schemas:oracle:idcs:extension:userState:User:lastSuccessfulLoginDate\n--profile Oracle --query '.data.resources[]|.\"user-name\" + \" \" +\n.\"urn-ietf-params-scim-schemas-oracle-idcs-extension-user-state-user\".\"last-successful-login-date\"'\nReview the output the that the date is under 45 days, or no date means they have not\nlogged in For API Keys: Create the search query text: export query=\"search\n\"<tenancy-ocid>/_Audit_Include_Subcompartment\" |\ndata.identity.credentials='*<key-finger-print>' | summarize count() by\ndata.identity.principalId\" Select a day range. Date format is 2024-12-01 Note each query\ncan only be 14 days multiple queries will be required to go 45 days Execute the below: oci\nlogging-search search-logs --search-query $query --time-start <start-date> --time-end\n<end-date> --query 'data.results[0].data.count' export query=\"search\n\"<tenancy-ocid>/_Audit_Include_Subcompartment\" |\ndata.identity.credentials='*<key-finger-print>' | summarize count() by\ndata.identity.principalId\" If results the count is not zero, the user has used their API\nkey during that period Repeat steps 2  4 for the 45-day period"},{"label":"fix","data":"From Console: Login to OCI Console. Select Identity & Security from the Services menu.\n\nSelect Domains from the Identity menu. For each domain listed, click on the name and\nselect Users . Click on an individual user under the Username heading. Click More action\nSelect Deactivate From CLI: Create a input.json: { \"operations\": [ { \"op\": \"replace\",\n\"path\": \"active\",\"value\": false} ], \"schemas\":\n\n[\"urn:ietf:params:scim:api:messages:2.0:PatchOp\"], \"userId\": \"<user-ocid>\" } Execute the\nbelow: oci identity-domains user patch --from-json file://file.json --endpoint\n<identity-domain-endpoint>"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-1_16","severity":"medium","gid":"CIS-1_16","rid":"xccdf_cis_cis_rule_1_16","stig_id":"1.16","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-000011","CCI-002121","CCI-000012","CCI-002122","CCI-000664"],"nist":["AC-2 f","AC-2 f","AC-2 j","AC-2 g","SA-8"]},"code":"control '1_16' do\n  title 'Ensure OCI IAM credentials unused for 45 days or more are disabled'\n\n  desc <<~DESC\n    OCI IAM Local users can access OCI resources using different credentials, such as\n    passwords or API keys. It is recommended that credentials that have been unused for 45\n    days or more be deactivated or removed. Disabling or removing unnecessary OCI IAM local\n    users will reduce the window of opportunity for credentials associated with a compromised\n    or abandoned account to be used.\n  DESC\n\n  desc 'check', <<~CHECK\n    Perform the following to determine if unused credentials exist: From Console: For\n    Passwords: Login to OCI Console. Select Identity & Security from the Services menu. Select\n    Domains from the Identity menu. For each domain listed, click on the name Click Reports\n    Under Dormant users report click View report Enter a date 45 days from todays date in\n    Last Successful Login Date Check and ensure that Last Successful Login Date is greater\n    than 45 days or empty For API Keys: Login to OCI Console. Select Observability &\n    Management from the Services menu. Select Search from Logging menu Click Show Advanced\n    Mode in the right corner Select Custom from Filter by time Under Select regions to search\n    add regions Under Query enter the following query in the text box: search\n    \"<tenancy-ocid>/_Audit_Include_Subcompartment\" |\n    data.identity.credentials='<tenancy-ocid>/<user-ocid>/<key-fingerprint>' | summarize\n    count() by data.identity.principalId Enter a day range Note each query can only be 14 days\n    multiple queries will be required to go 45 days Click Search Expand the results If results\n    the count is not zero the user has used their API key during that period Repeat steps 8 \n    11 for the 45-day period From CLI: For Passwords: Execute the below: oci identity-domains\n    users list --all --endpoint <identity-domain-endpoint> --attributes\n    urn:ietf:params:scim:schemas:oracle:idcs:extension:userState:User:lastSuccessfulLoginDate\n    --profile Oracle --query '.data.resources[]|.\"user-name\" + \" \" +\n    .\"urn-ietf-params-scim-schemas-oracle-idcs-extension-user-state-user\".\"last-successful-login-date\"'\n    Review the output the that the date is under 45 days, or no date means they have not\n    logged in For API Keys: Create the search query text: export query=\"search\n    \\\"<tenancy-ocid>/_Audit_Include_Subcompartment\\\" |\n    data.identity.credentials='*<key-finger-print>' | summarize count() by\n    data.identity.principalId\" Select a day range. Date format is 2024-12-01 Note each query\n    can only be 14 days multiple queries will be required to go 45 days Execute the below: oci\n    logging-search search-logs --search-query $query --time-start <start-date> --time-end\n    <end-date> --query 'data.results[0].data.count' export query=\"search\n    \\\"<tenancy-ocid>/_Audit_Include_Subcompartment\\\" |\n    data.identity.credentials='*<key-finger-print>' | summarize count() by\n    data.identity.principalId\" If results the count is not zero, the user has used their API\n    key during that period Repeat steps 2  4 for the 45-day period\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Login to OCI Console. Select Identity & Security from the Services menu.\n\n    Select Domains from the Identity menu. For each domain listed, click on the name and\n    select Users . Click on an individual user under the Username heading. Click More action\n    Select Deactivate From CLI: Create a input.json: { \"operations\": [ { \"op\": \"replace\",\n    \"path\": \"active\",\"value\": false} ], \"schemas\":\n\n    [\"urn:ietf:params:scim:api:messages:2.0:PatchOp\"], \"userId\": \"<user-ocid>\" } Execute the\n    below: oci identity-domains user patch --from-json file://file.json --endpoint\n    <identity-domain-endpoint>\n  FIX\n\n  impact 0.5\n\n  tag check_id: 'C-1_16'\n  tag severity: 'medium'\n  tag gid: 'CIS-1_16'\n  tag rid: 'xccdf_cis_cis_rule_1_16'\n  tag stig_id: '1.16'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-000011',\n    'CCI-002121',\n    'CCI-000012',\n    'CCI-002122',\n    'CCI-000664'\n  ]\n\n  tag nist: [\n    'AC-2 f',\n    'AC-2 f',\n    'AC-2 j',\n    'AC-2 g',\n    'SA-8'\n  ]\nend\n","source_location":{"line":1,"ref":"./controls/1_16.rb"},"waiver_data":{},"results":[],"status":"passed"},{"id":"1_17","title":"Ensure there is only one active API Key for any single OCI IAM user","desc":"API Keys are long-term credentials for an OCI IAM user. They can be used to make\nprogrammatic requests to the OCI APIs directly or via, OCI SDKs or the OCI CLI. Having a\nsingle API Key for an OCI IAM reduces attack surface area and makes it easier to manage.","descriptions":[{"label":"default","data":"API Keys are long-term credentials for an OCI IAM user. They can be used to make\nprogrammatic requests to the OCI APIs directly or via, OCI SDKs or the OCI CLI. Having a\nsingle API Key for an OCI IAM reduces attack surface area and makes it easier to manage."},{"label":"check","data":"%q{From Console: Login to OCI Console. Select Identity & Security from the Services menu.\nSelect Users from the Identity menu. Click on an individual user under the Name heading.\nClick on API Keys in the lower left-hand corner of the page. Ensure the has only has a one\nAPI Key From CLI: Each user and in each Identity Domain oci raw-request --http-method GET\n--target-uri\n\"https://<domain-endpoint>/admin/v1/ApiKeys?filter=user.ocid+eq+%<user-ocid>%22\" | jq\n'.data.Resources[] | \"(.fingerprint) (.id)\"' Ensure only one key is returned}"},{"label":"fix","data":"From Console: Login to OCI Console. Select Identity & Security from the Services menu.\n\nSelect Domains from the Identity menu. For each domain listed, click on the name and\nselect Users. Click on an individual user under the Name heading. Click on API Keys in the\nlower left-hand corner of the page. Delete one of the API Keys From CLI: Follow the audit\nprocedure above. For API Key ID to be removed execute the following command: oci\nidentity-domains api-key delete api-key-id <id> --endpoint <domain-endpoint>"},{"label":"potential_impacts","data":"Deletion of an OCI API Key will remove programmatic access to OCI APIs"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-1_17","severity":"medium","gid":"CIS-1_17","rid":"xccdf_cis_cis_rule_1_17","stig_id":"1.17","gtitle":"<GroupDescription></GroupDescription>","cci":"%w[CCI-000364 CCI-000365 CCI-000366 CCI-000421 CCI-001097 CCI-001098 CCI-002395","documentable":null,"nist":["CM-6 a","CM-6 a","CM-6 b","CM-9 a","SC-7 a","SC-7 c","SC-7 b","AC-2 a","AC-2 a","AC-2 b"]},"code":"control '1_17' do\n  title 'Ensure there is only one active API Key for any single OCI IAM user'\n\n  desc <<~DESC\n    API Keys are long-term credentials for an OCI IAM user. They can be used to make\n    programmatic requests to the OCI APIs directly or via, OCI SDKs or the OCI CLI. Having a\n    single API Key for an OCI IAM reduces attack surface area and makes it easier to manage.\n  DESC\n\n  desc 'check', <<~CHECK\n    %q{From Console: Login to OCI Console. Select Identity & Security from the Services menu.\n    Select Users from the Identity menu. Click on an individual user under the Name heading.\n    Click on API Keys in the lower left-hand corner of the page. Ensure the has only has a one\n    API Key From CLI: Each user and in each Identity Domain oci raw-request --http-method GET\n    --target-uri\n    \"https://<domain-endpoint>/admin/v1/ApiKeys?filter=user.ocid+eq+%<user-ocid>%22\" | jq\n    '.data.Resources[] | \"\\(.fingerprint) \\(.id)\"' Ensure only one key is returned}\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Login to OCI Console. Select Identity & Security from the Services menu.\n\n    Select Domains from the Identity menu. For each domain listed, click on the name and\n    select Users. Click on an individual user under the Name heading. Click on API Keys in the\n    lower left-hand corner of the page. Delete one of the API Keys From CLI: Follow the audit\n    procedure above. For API Key ID to be removed execute the following command: oci\n    identity-domains api-key delete api-key-id <id> --endpoint <domain-endpoint>\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    Deletion of an OCI API Key will remove programmatic access to OCI APIs\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-1_17'\n  tag severity: 'medium'\n  tag gid: 'CIS-1_17'\n  tag rid: 'xccdf_cis_cis_rule_1_17'\n  tag stig_id: '1.17'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag cci: '%w[CCI-000364 CCI-000365 CCI-000366 CCI-000421 CCI-001097 CCI-001098 CCI-002395'\n  tag 'documentable'\n\n  tag nist: [\n    'CM-6 a',\n    'CM-6 a',\n    'CM-6 b',\n    'CM-9 a',\n    'SC-7 a',\n    'SC-7 c',\n    'SC-7 b',\n    'AC-2 a',\n    'AC-2 a',\n    'AC-2 b'\n  ]\nend\n","source_location":{"line":1,"ref":"./controls/1_17.rb"},"waiver_data":{},"results":[],"status":"passed"},{"id":"1_2","title":"Ensure permissions on all resources are given only to the tenancy administrator group","desc":"There is a built-in OCI IAM policy enabling the Administrators group to perform any action\nwithin a tenancy. In the OCI IAM console, this policy reads: Allow group Administrators to\nmanage all-resources in tenancy Administrators create more users, groups, and policies to\nprovide appropriate access to other groups. Administrators should not allow\nany-other-group full access to the tenancy by writing a policy like this - Allow group\nany-other-group to manage all-resources in tenancy The access should be narrowed down to\nensure the least-privileged principle is applied. Permission to manage all resources in a\ntenancy should be limited to a small number of users in the Administrators group for\nbreak-glass situations and to set up users/groups/policies when a tenancy is created. No\ngroup other than Administrators in a tenancy should need access to all resources in a\ntenancy, as this violates the enforcement of the least privilege principle.","descriptions":[{"label":"default","data":"There is a built-in OCI IAM policy enabling the Administrators group to perform any action\nwithin a tenancy. In the OCI IAM console, this policy reads: Allow group Administrators to\nmanage all-resources in tenancy Administrators create more users, groups, and policies to\nprovide appropriate access to other groups. Administrators should not allow\nany-other-group full access to the tenancy by writing a policy like this - Allow group\nany-other-group to manage all-resources in tenancy The access should be narrowed down to\nensure the least-privileged principle is applied. Permission to manage all resources in a\ntenancy should be limited to a small number of users in the Administrators group for\nbreak-glass situations and to set up users/groups/policies when a tenancy is created. No\ngroup other than Administrators in a tenancy should need access to all resources in a\ntenancy, as this violates the enforcement of the least privilege principle."},{"label":"check","data":"From CLI: Run OCI CLI command providing the root compartment OCID to get the list of\n\ngroups having access to manage all resources in your tenancy. oci iam policy list\n--compartment-id <root_compartment_OCID> | grep -i \"to manage all-resources in tenancy\"\nVerify the results to ensure only the Administrators group has access to manage all\nresources in tenancy. \"Allow group Administrators to manage all-resources in tenancy\""},{"label":"fix","data":"From Console: Login to OCI console. Go to Identity -> Policies , In the compartment\n\ndropdown, choose the root compartment. Open each policy to view the policy statements.\nRemove any policy statement that allows any group other than Administrators or any service\naccess to manage all resources in the tenancy. From CLI: The policies can also be updated\nvia OCI CLI, SDK and API, with an example of the CLI commands below: Delete a policy via\nthe CLI: oci iam policy delete --policy-id <policy-ocid> Update a policy via the CLI: oci\niam policy update --policy-id <policy-ocid> --statements <json-array-of-statements> Note:\n\nYou should generally not delete the policy that allows the Administrators group the\nability to manage all resources in the tenancy."}],"impact":0.5,"refs":[],"tags":{"check_id":"C-1_2","severity":"medium","gid":"CIS-1_2","rid":"xccdf_cis_cis_rule_1_2","stig_id":"1.2","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-000213","CCI-000225","CCI-000036","CCI-001003","CCI-000051","CCI-002856","CCI-003205"],"nist":["AC-3","AC-6","AC-5 a","MP-2","AC-8 a","CP-12","SA-12 (8)"]},"code":"control '1_2' do\n  title 'Ensure permissions on all resources are given only to the tenancy administrator group'\n\n  desc <<~DESC\n    There is a built-in OCI IAM policy enabling the Administrators group to perform any action\n    within a tenancy. In the OCI IAM console, this policy reads: Allow group Administrators to\n    manage all-resources in tenancy Administrators create more users, groups, and policies to\n    provide appropriate access to other groups. Administrators should not allow\n    any-other-group full access to the tenancy by writing a policy like this - Allow group\n    any-other-group to manage all-resources in tenancy The access should be narrowed down to\n    ensure the least-privileged principle is applied. Permission to manage all resources in a\n    tenancy should be limited to a small number of users in the Administrators group for\n    break-glass situations and to set up users/groups/policies when a tenancy is created. No\n    group other than Administrators in a tenancy should need access to all resources in a\n    tenancy, as this violates the enforcement of the least privilege principle.\n  DESC\n\n  desc 'check', <<~CHECK\n    From CLI: Run OCI CLI command providing the root compartment OCID to get the list of\n\n    groups having access to manage all resources in your tenancy. oci iam policy list\n    --compartment-id <root_compartment_OCID> | grep -i \"to manage all-resources in tenancy\"\n    Verify the results to ensure only the Administrators group has access to manage all\n    resources in tenancy. \"Allow group Administrators to manage all-resources in tenancy\"\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Login to OCI console. Go to Identity -> Policies , In the compartment\n\n    dropdown, choose the root compartment. Open each policy to view the policy statements.\n    Remove any policy statement that allows any group other than Administrators or any service\n    access to manage all resources in the tenancy. From CLI: The policies can also be updated\n    via OCI CLI, SDK and API, with an example of the CLI commands below: Delete a policy via\n    the CLI: oci iam policy delete --policy-id <policy-ocid> Update a policy via the CLI: oci\n    iam policy update --policy-id <policy-ocid> --statements <json-array-of-statements> Note:\n\n    You should generally not delete the policy that allows the Administrators group the\n    ability to manage all resources in the tenancy.\n  FIX\n\n  impact 0.5\n\n  tag check_id: 'C-1_2'\n  tag severity: 'medium'\n  tag gid: 'CIS-1_2'\n  tag rid: 'xccdf_cis_cis_rule_1_2'\n  tag stig_id: '1.2'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-000213',\n    'CCI-000225',\n    'CCI-000036',\n    'CCI-001003',\n    'CCI-000051',\n    'CCI-002856',\n    'CCI-003205'\n  ]\n\n  tag nist: [\n    'AC-3',\n    'AC-6',\n    'AC-5 a',\n    'MP-2',\n    'AC-8 a',\n    'CP-12',\n    'SA-12 (8)'\n  ]\n\n  tenancy_ocid = input('tenancy_ocid')\n\n  cmd = \"oci iam policy list --compartment-id '#{tenancy_ocid}' | grep -i 'to manage all-resources in tenancy' | jq -nR '[inputs]'\"\n\n  output = json(command: cmd)\n  policies = Array(output.params).map { |policy| policy.to_s.strip }.reject(&:empty?)\n  puts policies\n\n  admin_regex = /allow group administrators to manage all-resources in tenancy/i\n  admin_policies = policies.select { |policy| policy.match?(admin_regex) }\n  non_admin_policies = policies.reject { |policy| policy.match?(admin_regex) }\n\n  describe 'Ensure permissions on all resources are given only to the tenancy administrator group' do\n    it 'allows only Administrators to manage all resources' do\n      expect(admin_policies).not_to be_empty\n      expect(non_admin_policies).to be_empty\n    end\n  end\nend\n","source_location":{"line":1,"ref":"./controls/1_2.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"Ensure permissions on all resources are given only to the tenancy administrator group allows only Administrators to manage all resources","run_time":0.008319,"start_time":"2026-01-28T09:26:55-05:00","message":"expected `[\"\\\"Allow group PowerUsers to manage all-resources in tenancy\\\"\"].empty?` to be truthy, got false","resource_class":"Object","resource_params":"[]","resource_id":"Ensure permissions on all resources are given only to the tenancy administrator group"}],"status":"failed"},{"id":"1_3","title":"Ensure IAM administrators cannot update tenancy Administrators group","desc":"\"Tenancy administrators can create more users, groups, and policies to provide other\nservice administrators access to OCI resources. For example, an IAM administrator will\nneed to have access to manage resources like compartments, users, groups, dynamic-groups,\npolicies, identity-providers, tenancy","descriptions":[{"label":"default","data":"\"Tenancy administrators can create more users, groups, and policies to provide other\nservice administrators access to OCI resources. For example, an IAM administrator will\nneed to have access to manage resources like compartments, users, groups, dynamic-groups,\npolicies, identity-providers, tenancy"},{"label":"check","data":"From CLI: Run the following OCI CLI commands providing the root_compartment_OCID oci iam\n\npolicy list --compartment-id <root_compartment_OCID> | grep -i \" to use users in tenancy\"\noci iam policy list --compartment-id <root_compartment_OCID> | grep -i \" to use groups in\ntenancy\" Replace \"use\" with \"manage\" in the above commands to review manage statements as\nwell. Verify the results to ensure that the policy statements that grant access to use or\nmanage users or groups in the tenancy have a condition that excludes access to\nAdministrators group or to users in the Administrators group."},{"label":"fix","data":"From Console: Login to OCI Console. Select Identity from Services Menu. Select Policies\n\nfrom Identity Menu. Click on an individual policy under the Name heading. Ensure Policy\nstatements look like this - Allow group IAMAdmins to use users in tenancy where\ntarget.group.name != 'Administrators' Allow group IAMAdmins to use groups in tenancy where\ntarget.group.name != 'Administrators'"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-1_3","severity":"medium","gid":"CIS-1_3","rid":"xccdf_cis_cis_rule_1_3","stig_id":"1.3","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-000213","CCI-000225","CCI-000036","CCI-001003","CCI-000213","CCI-000225","CCI-000036","CCI-001003","CCI-000364","CCI-000365","CCI-000366","CCI-000421","CCI-002113","CCI-002117","CCI-002118","CCI-002126","CCI-000051","CCI-002856","CCI-003205"],"nist":["AC-3","AC-6","AC-5 a","MP-2","AC-3","AC-6","AC-5 a","MP-2","CM-6 a","CM-6 a","CM-6 b","CM-9 a","AC-2 c","AC-2 d 2","AC-2 d 3","AC-2 i 1","AC-8 a","CP-12","SA-12 (8)"]},"code":"control '1_3' do\n  title 'Ensure IAM administrators cannot update tenancy Administrators group'\n\n  desc <<~DESC\n    \"Tenancy administrators can create more users, groups, and policies to provide other\n    service administrators access to OCI resources. For example, an IAM administrator will\n    need to have access to manage resources like compartments, users, groups, dynamic-groups,\n    policies, identity-providers, tenancy\n  DESC\n\n  desc 'check', <<~CHECK\n    From CLI: Run the following OCI CLI commands providing the root_compartment_OCID oci iam\n\n    policy list --compartment-id <root_compartment_OCID> | grep -i \" to use users in tenancy\"\n    oci iam policy list --compartment-id <root_compartment_OCID> | grep -i \" to use groups in\n    tenancy\" Replace \"use\" with \"manage\" in the above commands to review manage statements as\n    well. Verify the results to ensure that the policy statements that grant access to use or\n    manage users or groups in the tenancy have a condition that excludes access to\n    Administrators group or to users in the Administrators group.\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Login to OCI Console. Select Identity from Services Menu. Select Policies\n\n    from Identity Menu. Click on an individual policy under the Name heading. Ensure Policy\n    statements look like this - Allow group IAMAdmins to use users in tenancy where\n    target.group.name != 'Administrators' Allow group IAMAdmins to use groups in tenancy where\n    target.group.name != 'Administrators'\n  FIX\n\n  impact 0.5\n\n  tag check_id: 'C-1_3'\n  tag severity: 'medium'\n  tag gid: 'CIS-1_3'\n  tag rid: 'xccdf_cis_cis_rule_1_3'\n  tag stig_id: '1.3'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-000213',\n    'CCI-000225',\n    'CCI-000036',\n    'CCI-001003',\n    'CCI-000213',\n    'CCI-000225',\n    'CCI-000036',\n    'CCI-001003',\n    'CCI-000364',\n    'CCI-000365',\n    'CCI-000366',\n    'CCI-000421',\n    'CCI-002113',\n    'CCI-002117',\n    'CCI-002118',\n    'CCI-002126',\n    'CCI-000051',\n    'CCI-002856',\n    'CCI-003205'\n  ]\n\n  tag nist: [\n    'AC-3',\n    'AC-6',\n    'AC-5 a',\n    'MP-2',\n    'AC-3',\n    'AC-6',\n    'AC-5 a',\n    'MP-2',\n    'CM-6 a',\n    'CM-6 a',\n    'CM-6 b',\n    'CM-9 a',\n    'AC-2 c',\n    'AC-2 d 2',\n    'AC-2 d 3',\n    'AC-2 i 1',\n    'AC-8 a',\n    'CP-12',\n    'SA-12 (8)'\n  ]\n\n  tenancy_ocid = input('tenancy_ocid')\n\n  cmd_users = \"oci iam policy list --compartment-id '#{tenancy_ocid}' | grep -i ' to use users in tenancy' | jq -nR '[inputs]'\"\n  cmd_groups = \"oci iam policy list --compartment-id '#{tenancy_ocid}' | grep -i ' to use groups in tenancy' | jq -nR '[inputs]'\"\n\n  users_output = json(command: cmd_users)\n  users_params = users_output.params\n\n  groups_output = json(command: cmd_groups)\n  groups_params = groups_output.params\n\n  policy_statements = [users_params, groups_params].flatten.compact.map { |policy| policy.to_s.strip }.reject(&:empty?)\n\n  exclusion_regex = /where .*target\\.group\\.name\\s*!=\\s*['\"]?Administrators['\"]?/i\n  non_excluded_policies = policy_statements.reject { |policy| policy.match?(exclusion_regex) }\n\n  describe 'Ensure IAM administrators cannot update tenancy Administrators group' do\n    subject { non_excluded_policies }\n    it { should be_empty }\n  end\nend\n","source_location":{"line":1,"ref":"./controls/1_3.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"Ensure IAM administrators cannot update tenancy Administrators group is expected to be empty","run_time":0.001051,"start_time":"2026-01-28T09:26:55-05:00","message":"expected `[\"\\\"Allow group IAMAdmins to use users in tenancy where target.group.name = 'Administrators'\\\",\"].empty?` to be truthy, got false","resource_class":"Object","resource_params":"[]","resource_id":"Ensure IAM administrators cannot update tenancy Administrators group"}],"status":"failed"},{"id":"1_4","title":"Ensure IAM password policy requires minimum length of 14 or greater","desc":"\"Password policies are used to enforce password complexity requirements. IAM password\npolicies can be used to ensure passwords are at least a certain length and are composed of\ncertain characters. It is recommended the password policy require a minimum password\nlength 14 characters and contain 1 non-alphabetic character (Number or Special\nCharacter). In keeping with the overall goal of having users create a password that is\nnot overly weak, an eight-character minimum password length is recommended for an MFA\naccount, and 14 characters for a password only account. In addition, maximum password\nlength should be made as long as possible based on system/software capabilities and not\nrestricted by policy. In general, it is true that longer passwords are better (harder to\ncrack), but it is also true that forced password length requirements can cause user\nbehavior that is predictable and undesirable. For example, requiring users to have a\nminimum 16-character password may cause them to choose repeating patterns like\nfourfourfourfour or passwordpassword that meet the requirement but arent hard to guess.\nAdditionally, length requirements increase the chances that users will adopt other\ninsecure practices, like writing them down, re-using them or storing them unencrypted in\ntheir documents. Password composition requirements are a poor defense against guessing\nattacks. Forcing users to choose some combination of upper-case, lower-case, numbers, and\nspecial characters has a negative","descriptions":[{"label":"default","data":"\"Password policies are used to enforce password complexity requirements. IAM password\npolicies can be used to ensure passwords are at least a certain length and are composed of\ncertain characters. It is recommended the password policy require a minimum password\nlength 14 characters and contain 1 non-alphabetic character (Number or Special\nCharacter). In keeping with the overall goal of having users create a password that is\nnot overly weak, an eight-character minimum password length is recommended for an MFA\naccount, and 14 characters for a password only account. In addition, maximum password\nlength should be made as long as possible based on system/software capabilities and not\nrestricted by policy. In general, it is true that longer passwords are better (harder to\ncrack), but it is also true that forced password length requirements can cause user\nbehavior that is predictable and undesirable. For example, requiring users to have a\nminimum 16-character password may cause them to choose repeating patterns like\nfourfourfourfour or passwordpassword that meet the requirement but arent hard to guess.\nAdditionally, length requirements increase the chances that users will adopt other\ninsecure practices, like writing them down, re-using them or storing them unencrypted in\ntheir documents. Password composition requirements are a poor defense against guessing\nattacks. Forcing users to choose some combination of upper-case, lower-case, numbers, and\nspecial characters has a negative"},{"label":"check","data":"Go to Identity Domains: https://cloud.oracle.com/identity/domains/ Select the Compartment\nyour Domain to review is in Click on the Domain to review Click on Settings Click on\nPassword policy Click each Password policy in the domain Ensure Password length (minimum)\nis greater than or equal to 14 Under The The following criteria apply to passwords\nsection, ensure that the number given in Numeric (minimum) setting is 1 , or the Special\n(minimum) setting is 1 . The following criteria apply to passwords: 6. Ensure that 1 or\nmore is selected for Numeric (minimum) OR Special (minimum) From Cloud Guard: To Enable\nCloud Guard Auditing: Ensure Cloud Guard is enabled in the root compartment of the\ntenancy. For more information about enabling Cloud Guard, please look at the instructions\nincluded in \"Ensure Cloud Guard is enabled in the root compartment of the tenancy\"\nRecommendation in the \"Logging and Monitoring\" section. From Console: Type Cloud Guard\ninto the Search box at the top of the Console. Click Cloud Guard from the Services\nsubmenu. Click Detector Recipes in the Cloud Guard menu. Click OCI Configuration Detector\nRecipe (Oracle Managed) under the Recipe Name column. Find Password policy does not meet\ncomplexity requirements in the Detector Rules column. Select the vertical ellipsis icon\nand chose Edit on the Password policy does not meet complexity requirements row. In the\nEdit Detector Rule window, find the Input Setting box and verify/change the Required\npassword length setting to 14. Click the Save button. From CLI: Update the Password policy\ndoes not meet complexity requirements Detector Rule in Cloud Guard to generate Problems if\nIAM password policy isnt configured to enforce a password length of at least 14\ncharacters with the following command: oci cloud-guard detector-recipe-detector-rule\nupdate --detector-recipe-id <insert detector recipe ocid> --detector-rule-id\nPASSWORD_POLICY_NOT_COMPLEX --details '{\"configurations\":[{ \"configKey\" :\n\n\"passwordPolicyMinLength\", \"name\" : \"Required password length\", \"value\" : \"14\", \"dataType\"\n: null, \"values\" : null }]}'"},{"label":"fix","data":"Go to Identity Domains: https://cloud.oracle.com/identity/domains/ Select the Compartment\nthe Domain to remediate is in Click on the Domain to remediate Click on Settings Click on\nPassword policy to remediate Click Edit password rules Update the Password length\n(minimum) setting to 14 or greater Under The Passwords must meet the following character\nrequirements section, update the number given in Special (minimum) setting to 1 or greater\nor Under The Passwords must meet the following character requirements section, update the\nnumber given in Numeric (minimum) setting to 1 or greater 7. Click Save changes"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-1_4","severity":"medium","gid":"CIS-1_4","rid":"xccdf_cis_cis_rule_1_4","stig_id":"1.4","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-000364","CCI-000365","CCI-000366","CCI-000421","CCI-001097","CCI-001098","CCI-002395","CCI-002110","CCI-002111","CCI-002112","CCI-000012","CCI-000200","CCI-000199","CCI-000205","CCI-000204"],"nist":["CM-6 a","CM-6 a","CM-6 b","CM-9 a","SC-7 a","SC-7 c","SC-7 b","AC-2 a","AC-2 a","AC-2 b","AC-2 j","IA-5 (1) (e)","IA-5 (1) (d)","IA-5 (1) (a)","IA-5 (8)"]},"code":"control '1_4' do\n  title 'Ensure IAM password policy requires minimum length of 14 or greater'\n\n  desc <<~DESC\n    \"Password policies are used to enforce password complexity requirements. IAM password\n    policies can be used to ensure passwords are at least a certain length and are composed of\n    certain characters. It is recommended the password policy require a minimum password\n    length 14 characters and contain 1 non-alphabetic character (Number or Special\n    Character). In keeping with the overall goal of having users create a password that is\n    not overly weak, an eight-character minimum password length is recommended for an MFA\n    account, and 14 characters for a password only account. In addition, maximum password\n    length should be made as long as possible based on system/software capabilities and not\n    restricted by policy. In general, it is true that longer passwords are better (harder to\n    crack), but it is also true that forced password length requirements can cause user\n    behavior that is predictable and undesirable. For example, requiring users to have a\n    minimum 16-character password may cause them to choose repeating patterns like\n    fourfourfourfour or passwordpassword that meet the requirement but arent hard to guess.\n    Additionally, length requirements increase the chances that users will adopt other\n    insecure practices, like writing them down, re-using them or storing them unencrypted in\n    their documents. Password composition requirements are a poor defense against guessing\n    attacks. Forcing users to choose some combination of upper-case, lower-case, numbers, and\n    special characters has a negative\n  DESC\n\n  desc 'check', <<~CHECK\n    Go to Identity Domains: https://cloud.oracle.com/identity/domains/ Select the Compartment\n    your Domain to review is in Click on the Domain to review Click on Settings Click on\n    Password policy Click each Password policy in the domain Ensure Password length (minimum)\n    is greater than or equal to 14 Under The The following criteria apply to passwords\n    section, ensure that the number given in Numeric (minimum) setting is 1 , or the Special\n    (minimum) setting is 1 . The following criteria apply to passwords: 6. Ensure that 1 or\n    more is selected for Numeric (minimum) OR Special (minimum) From Cloud Guard: To Enable\n    Cloud Guard Auditing: Ensure Cloud Guard is enabled in the root compartment of the\n    tenancy. For more information about enabling Cloud Guard, please look at the instructions\n    included in \"Ensure Cloud Guard is enabled in the root compartment of the tenancy\"\n    Recommendation in the \"Logging and Monitoring\" section. From Console: Type Cloud Guard\n    into the Search box at the top of the Console. Click Cloud Guard from the Services\n    submenu. Click Detector Recipes in the Cloud Guard menu. Click OCI Configuration Detector\n    Recipe (Oracle Managed) under the Recipe Name column. Find Password policy does not meet\n    complexity requirements in the Detector Rules column. Select the vertical ellipsis icon\n    and chose Edit on the Password policy does not meet complexity requirements row. In the\n    Edit Detector Rule window, find the Input Setting box and verify/change the Required\n    password length setting to 14. Click the Save button. From CLI: Update the Password policy\n    does not meet complexity requirements Detector Rule in Cloud Guard to generate Problems if\n    IAM password policy isnt configured to enforce a password length of at least 14\n    characters with the following command: oci cloud-guard detector-recipe-detector-rule\n    update --detector-recipe-id <insert detector recipe ocid> --detector-rule-id\n    PASSWORD_POLICY_NOT_COMPLEX --details '{\"configurations\":[{ \"configKey\" :\n\n    \"passwordPolicyMinLength\", \"name\" : \"Required password length\", \"value\" : \"14\", \"dataType\"\n    : null, \"values\" : null }]}'\n  CHECK\n\n  desc 'fix', <<~FIX\n    Go to Identity Domains: https://cloud.oracle.com/identity/domains/ Select the Compartment\n    the Domain to remediate is in Click on the Domain to remediate Click on Settings Click on\n    Password policy to remediate Click Edit password rules Update the Password length\n    (minimum) setting to 14 or greater Under The Passwords must meet the following character\n    requirements section, update the number given in Special (minimum) setting to 1 or greater\n    or Under The Passwords must meet the following character requirements section, update the\n    number given in Numeric (minimum) setting to 1 or greater 7. Click Save changes\n  FIX\n\n  impact 0.5\n\n  tag check_id: 'C-1_4'\n  tag severity: 'medium'\n  tag gid: 'CIS-1_4'\n  tag rid: 'xccdf_cis_cis_rule_1_4'\n  tag stig_id: '1.4'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-000364',\n    'CCI-000365',\n    'CCI-000366',\n    'CCI-000421',\n    'CCI-001097',\n    'CCI-001098',\n    'CCI-002395',\n    'CCI-002110',\n    'CCI-002111',\n    'CCI-002112',\n    'CCI-000012',\n    'CCI-000200',\n    'CCI-000199',\n    'CCI-000205',\n    'CCI-000204'\n  ]\n\n  tag nist: [\n    'CM-6 a',\n    'CM-6 a',\n    'CM-6 b',\n    'CM-9 a',\n    'SC-7 a',\n    'SC-7 c',\n    'SC-7 b',\n    'AC-2 a',\n    'AC-2 a',\n    'AC-2 b',\n    'AC-2 j',\n    'IA-5 (1) (e)',\n    'IA-5 (1) (d)',\n    'IA-5 (1) (a)',\n    'IA-5 (8)'\n  ]\n\n  tenancy_ocid = input('tenancy_ocid')\n\n  cmd = %(oci iam domain list --compartment-id '#{tenancy_ocid}' --all | jq '[.data[] | .url]')\n  domain_urls = json(command: cmd).params || []\n\n  min_length_values = []\n  min_numeric_values = []\n  min_special_values = []\n\n  domain_urls.each do |domain_url|\n    policy_cmd = %(oci identity-domains password-policies list --endpoint \"#{domain_url}\" --all)\n    policies = json(command: policy_cmd).params.dig('data', 'resources') || []\n\n    policies.each do |policy|\n      next unless ['StandardPasswordPolicy', 'PasswordPolicy'].include?(policy['id'])\n\n      length_value = policy.fetch('min-length', nil)\n      min_length_values << (length_value.nil? ? nil : length_value.to_i)\n\n      numeric_value = policy.fetch('min-numerals', nil)\n      min_numeric_values << (numeric_value.nil? ? nil : numeric_value.to_i)\n\n      special_value = policy.fetch('min-special-chars', nil)\n      min_special_values << (special_value.nil? ? nil : special_value.to_i)\n    end\n  end\n\n  describe 'Ensure IAM password policy requires at least 1 numeric or special character' do\n    it 'is enabled' do\n      per_policy_pass = min_numeric_values.zip(min_special_values).map do |min_numerals, min_special|\n        (min_numerals.to_i >= 1) || (min_special.to_i >= 1)\n      end\n      expect(per_policy_pass).to all(eq(true))\n    end\n  end\n\n  describe 'Ensure IAM password policy enforces a minimum password length of 14 characters' do\n    subject { min_length_values }\n    it { should_not be_empty }\n    it { should_not include(nil) }\n    it { should all(be >= 14) }\n  end\n\n  cloud_guard_check = input('cloud_guard_check')\n  detector_recipe_ocid = input('detector_recipe_ocid')\n\n  if cloud_guard_check\n    tenancy_ocid = input('tenancy_ocid')\n    cloud_guard = cloud_guard_helper(tenancy_ocid: tenancy_ocid, detector_recipe_ocid: detector_recipe_ocid)\n    cloud_guard_status = cloud_guard.status\n    cloud_guard_rule_enabled = cloud_guard.detector_rule_enabled?(rule_id: 'PASSWORD_POLICY_NOT_COMPLEX')\n    cloud_guard_min_length = cloud_guard.detector_rule_value(rule_id: 'PASSWORD_POLICY_NOT_COMPLEX', config_key: 'passwordPolicyMinLength')\n  end\n\n  describe 'Cloud Guard' do\n    if cloud_guard_check\n      it 'is enabled' do\n        expect(cloud_guard_status).to cmp 'ENABLED'\n      end\n\n      it 'detector rule \"Password policy does not meet complexity requirements\" is enabled' do\n        expect(cloud_guard_rule_enabled).to cmp true\n      end\n\n      it 'detector rule \"Password policy does not meet complexity requirements\" enforces minimum password length of 14 or greater' do\n        expect(cloud_guard_min_length.to_i).to be >= 14\n      end\n    else\n      skip 'Cloud Guard check skipped. cloud_guard_check is set to false.'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"./controls/1_4.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Ensure IAM password policy requires at least 1 numeric or special character is enabled","run_time":0.000856,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Ensure IAM password policy requires at least 1 numeric or special character"},{"status":"passed","code_desc":"Ensure IAM password policy enforces a minimum password length of 14 characters is expected not to be empty","run_time":0.001085,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Ensure IAM password policy enforces a minimum password length of 14 characters"},{"status":"passed","code_desc":"Ensure IAM password policy enforces a minimum password length of 14 characters is expected not to include nil","run_time":0.002195,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Ensure IAM password policy enforces a minimum password length of 14 characters"},{"status":"failed","code_desc":"Ensure IAM password policy enforces a minimum password length of 14 characters is expected to all be >= 14","run_time":0.000137,"start_time":"2026-01-28T09:26:55-05:00","message":"expected [8, 12, 17, 8] to all be >= 14\n\n   object at index 0 failed to match:\n      expected: >= 14\n           got:    8\n\n   object at index 1 failed to match:\n      expected: >= 14\n           got:    12\n\n   object at index 3 failed to match:\n      expected: >= 14\n           got:    8","resource_class":"Object","resource_params":"[]","resource_id":"Ensure IAM password policy enforces a minimum password length of 14 characters"},{"status":"passed","code_desc":"Cloud Guard is enabled","run_time":0.000064,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Cloud Guard"},{"status":"passed","code_desc":"Cloud Guard detector rule \"Password policy does not meet complexity requirements\" is enabled","run_time":0.000047,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Cloud Guard"},{"status":"passed","code_desc":"Cloud Guard detector rule \"Password policy does not meet complexity requirements\" enforces minimum password length of 14 or greater","run_time":0.00003,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Cloud Guard"}],"status":"failed"},{"id":"1_5","title":"Ensure IAM password policy expires passwords within 365 days","desc":"IAM password policies can require passwords to be rotated or expired after a given number\nof days. It is recommended that the password policy expire passwords after 365 and are\nchanged immediately based on events. Excessive password expiration requirements do more\nharm than good, because these requirements make users select predictable passwords,\ncomposed of sequential words and numbers that are closely related to each other.10 In\nthese cases, the next password can be predicted based on the previous one (incrementing a\nnumber used in the password for example). Also, password expiration requirements offer no\ncontainment benefits because attackers will often use credentials as soon as they\ncompromise them. Instead, immediate password changes should be based on key events\nincluding, but not limited to: Indication of compromise Change of user roles When a user\nleaves the organization. Not only does changing passwords every few weeks or months\nfrustrate the user, its been suggested that it does more harm than good, because it could\nlead to bad practices by the user such as adding a character to the end of their existing\npassword. In addition, we also recommend a yearly password change. This is primarily\nbecause for all their good intentions users will share credentials across accounts.\nTherefore, even if a breach is publicly identified, the user may not see this\nnotification, or forget they have an account on that site. This could leave a shared\ncredential vulnerable indefinitely. Having an organizational policy of a 1-year (annual)\npassword expiration is a reasonable compromise to mitigate this with minimal user burden.","descriptions":[{"label":"default","data":"IAM password policies can require passwords to be rotated or expired after a given number\nof days. It is recommended that the password policy expire passwords after 365 and are\nchanged immediately based on events. Excessive password expiration requirements do more\nharm than good, because these requirements make users select predictable passwords,\ncomposed of sequential words and numbers that are closely related to each other.10 In\nthese cases, the next password can be predicted based on the previous one (incrementing a\nnumber used in the password for example). Also, password expiration requirements offer no\ncontainment benefits because attackers will often use credentials as soon as they\ncompromise them. Instead, immediate password changes should be based on key events\nincluding, but not limited to: Indication of compromise Change of user roles When a user\nleaves the organization. Not only does changing passwords every few weeks or months\nfrustrate the user, its been suggested that it does more harm than good, because it could\nlead to bad practices by the user such as adding a character to the end of their existing\npassword. In addition, we also recommend a yearly password change. This is primarily\nbecause for all their good intentions users will share credentials across accounts.\nTherefore, even if a breach is publicly identified, the user may not see this\nnotification, or forget they have an account on that site. This could leave a shared\ncredential vulnerable indefinitely. Having an organizational policy of a 1-year (annual)\npassword expiration is a reasonable compromise to mitigate this with minimal user burden."},{"label":"check","data":"Go to Identity Domains: https://cloud.oracle.com/identity/domains/ Select the Compartment\nyour Domain to review is in Click on the Domain to review Click on Settings Click on\nPassword policy Click each Password policy in the domain Ensure Expires after (days) is\nless than or equal to 365 days"},{"label":"fix","data":"Go to Identity Domains: https://cloud.oracle.com/identity/domains/ Select the Compartment\nthe Domain to remediate is in Click on the Domain to remediate Click on Settings Click on\nPassword policy to remediate Click Edit password rules Change Expires after (days) to 365"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-1_5","severity":"medium","gid":"CIS-1_5","rid":"xccdf_cis_cis_rule_1_5","stig_id":"1.5","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-000364","CCI-000365","CCI-000366","CCI-000421","CCI-001097","CCI-001098","CCI-002395","CCI-002110","CCI-002111","CCI-002112","CCI-000012","CCI-000200","CCI-000199","CCI-000205","CCI-000204"],"nist":["CM-6 a","CM-6 a","CM-6 b","CM-9 a","SC-7 a","SC-7 c","SC-7 b","AC-2 a","AC-2 a","AC-2 b","AC-2 j","IA-5 (1) (e)","IA-5 (1) (d)","IA-5 (1) (a)","IA-5 (8)"]},"code":"control '1_5' do\n  title 'Ensure IAM password policy expires passwords within 365 days'\n\n  desc <<~DESC\n    IAM password policies can require passwords to be rotated or expired after a given number\n    of days. It is recommended that the password policy expire passwords after 365 and are\n    changed immediately based on events. Excessive password expiration requirements do more\n    harm than good, because these requirements make users select predictable passwords,\n    composed of sequential words and numbers that are closely related to each other.10 In\n    these cases, the next password can be predicted based on the previous one (incrementing a\n    number used in the password for example). Also, password expiration requirements offer no\n    containment benefits because attackers will often use credentials as soon as they\n    compromise them. Instead, immediate password changes should be based on key events\n    including, but not limited to: Indication of compromise Change of user roles When a user\n    leaves the organization. Not only does changing passwords every few weeks or months\n    frustrate the user, its been suggested that it does more harm than good, because it could\n    lead to bad practices by the user such as adding a character to the end of their existing\n    password. In addition, we also recommend a yearly password change. This is primarily\n    because for all their good intentions users will share credentials across accounts.\n    Therefore, even if a breach is publicly identified, the user may not see this\n    notification, or forget they have an account on that site. This could leave a shared\n    credential vulnerable indefinitely. Having an organizational policy of a 1-year (annual)\n    password expiration is a reasonable compromise to mitigate this with minimal user burden.\n  DESC\n\n  desc 'check', <<~CHECK\n    Go to Identity Domains: https://cloud.oracle.com/identity/domains/ Select the Compartment\n    your Domain to review is in Click on the Domain to review Click on Settings Click on\n    Password policy Click each Password policy in the domain Ensure Expires after (days) is\n    less than or equal to 365 days\n  CHECK\n\n  desc 'fix', <<~FIX\n    Go to Identity Domains: https://cloud.oracle.com/identity/domains/ Select the Compartment\n    the Domain to remediate is in Click on the Domain to remediate Click on Settings Click on\n    Password policy to remediate Click Edit password rules Change Expires after (days) to 365\n  FIX\n\n  impact 0.5\n\n  tag check_id: 'C-1_5'\n  tag severity: 'medium'\n  tag gid: 'CIS-1_5'\n  tag rid: 'xccdf_cis_cis_rule_1_5'\n  tag stig_id: '1.5'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-000364',\n    'CCI-000365',\n    'CCI-000366',\n    'CCI-000421',\n    'CCI-001097',\n    'CCI-001098',\n    'CCI-002395',\n    'CCI-002110',\n    'CCI-002111',\n    'CCI-002112',\n    'CCI-000012',\n    'CCI-000200',\n    'CCI-000199',\n    'CCI-000205',\n    'CCI-000204'\n  ]\n\n  tag nist: [\n    'CM-6 a',\n    'CM-6 a',\n    'CM-6 b',\n    'CM-9 a',\n    'SC-7 a',\n    'SC-7 c',\n    'SC-7 b',\n    'AC-2 a',\n    'AC-2 a',\n    'AC-2 b',\n    'AC-2 j',\n    'IA-5 (1) (e)',\n    'IA-5 (1) (d)',\n    'IA-5 (1) (a)',\n    'IA-5 (8)'\n  ]\n\n  tenancy_ocid = input('tenancy_ocid')\n\n  cmd = %(oci iam domain list --compartment-id '#{tenancy_ocid}' --all | jq '[.data[] | .url]')\n  domain_urls = json(command: cmd).params || []\n\n  expires_after_values = []\n\n  domain_urls.each do |domain_url|\n    policy_cmd = %(oci identity-domains password-policies list --endpoint \"#{domain_url}\" --all)\n    policies = json(command: policy_cmd).params.dig('data', 'resources') || []\n\n    policies.each do |policy|\n      next unless ['StandardPasswordPolicy', 'PasswordPolicy'].include?(policy['id'])\n\n      value = policy['password-expires-after']\n      expires_after_values << (value.nil? ? nil : value.to_i)\n    end\n  end\n\n  describe 'Ensure IAM password policy expires passwords within 365 days' do\n    subject { expires_after_values }\n\n    it { should_not be_empty }\n    it { should_not include(nil) }\n    it { should all(be <= 365) }\n  end\nend\n","source_location":{"line":1,"ref":"./controls/1_5.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Ensure IAM password policy expires passwords within 365 days is expected not to be empty","run_time":0.00103,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Ensure IAM password policy expires passwords within 365 days"},{"status":"passed","code_desc":"Ensure IAM password policy expires passwords within 365 days is expected not to include nil","run_time":0.000041,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Ensure IAM password policy expires passwords within 365 days"},{"status":"failed","code_desc":"Ensure IAM password policy expires passwords within 365 days is expected to all be <= 365","run_time":0.000073,"start_time":"2026-01-28T09:26:55-05:00","message":"expected [120, 500, 300, 120] to all be <= 365\n\n   object at index 1 failed to match:\n      expected: <= 365\n           got:    500","resource_class":"Object","resource_params":"[]","resource_id":"Ensure IAM password policy expires passwords within 365 days"}],"status":"failed"},{"id":"1_6","title":"Ensure IAM password policy prevents password reuse","desc":"IAM password policies can prevent the reuse of a given password by the same user. It is\nrecommended the password policy prevent the reuse of passwords. Enforcing password history\nensures that passwords are not reused in for a certain period of time by the same user. If\na user is not allowed to use last 24 passwords, that window of time is greater. This helps\nmaintain the effectiveness of password security.","descriptions":[{"label":"default","data":"IAM password policies can prevent the reuse of a given password by the same user. It is\nrecommended the password policy prevent the reuse of passwords. Enforcing password history\nensures that passwords are not reused in for a certain period of time by the same user. If\na user is not allowed to use last 24 passwords, that window of time is greater. This helps\nmaintain the effectiveness of password security."},{"label":"check","data":"Go to Identity Domains: https://cloud.oracle.com/identity/domains/ Select the Compartment\nyour Domain to review is in Click on the Domain to review Click on Settings Click on\nPassword policy Click each Password policy in the domain Ensure Previous passwords\nremembered is set 24 or greater"},{"label":"fix","data":"Go to Identity Domains: https://cloud.oracle.com/identity/domains/ Select the Compartment\nthe Domain to remediate is in Click on the Domain to remediate Click on Settings Click on\nPassword policy to remediate Click Edit password rules Update the number of remembered\npasswords in Previous passwords remembered setting to 24 or greater."}],"impact":0.5,"refs":[],"tags":{"check_id":"C-1_6","severity":"medium","gid":"CIS-1_6","rid":"xccdf_cis_cis_rule_1_6","stig_id":"1.6","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-001097","CCI-001098","CCI-002395","CCI-000200","CCI-000199","CCI-000205","CCI-000204"],"nist":["SC-7 a","SC-7 c","SC-7 b","IA-5 (1) (e)","IA-5 (1) (d)","IA-5 (1) (a)","IA-5 (8)"]},"code":"control '1_6' do\n  title 'Ensure IAM password policy prevents password reuse'\n\n  desc <<~DESC\n    IAM password policies can prevent the reuse of a given password by the same user. It is\n    recommended the password policy prevent the reuse of passwords. Enforcing password history\n    ensures that passwords are not reused in for a certain period of time by the same user. If\n    a user is not allowed to use last 24 passwords, that window of time is greater. This helps\n    maintain the effectiveness of password security.\n  DESC\n\n  desc 'check', <<~CHECK\n    Go to Identity Domains: https://cloud.oracle.com/identity/domains/ Select the Compartment\n    your Domain to review is in Click on the Domain to review Click on Settings Click on\n    Password policy Click each Password policy in the domain Ensure Previous passwords\n    remembered is set 24 or greater\n  CHECK\n\n  desc 'fix', <<~FIX\n    Go to Identity Domains: https://cloud.oracle.com/identity/domains/ Select the Compartment\n    the Domain to remediate is in Click on the Domain to remediate Click on Settings Click on\n    Password policy to remediate Click Edit password rules Update the number of remembered\n    passwords in Previous passwords remembered setting to 24 or greater.\n  FIX\n\n  impact 0.5\n\n  tag check_id: 'C-1_6'\n  tag severity: 'medium'\n  tag gid: 'CIS-1_6'\n  tag rid: 'xccdf_cis_cis_rule_1_6'\n  tag stig_id: '1.6'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-001097',\n    'CCI-001098',\n    'CCI-002395',\n    'CCI-000200',\n    'CCI-000199',\n    'CCI-000205',\n    'CCI-000204'\n  ]\n\n  tag nist: [\n    'SC-7 a',\n    'SC-7 c',\n    'SC-7 b',\n    'IA-5 (1) (e)',\n    'IA-5 (1) (d)',\n    'IA-5 (1) (a)',\n    'IA-5 (8)'\n  ]\n\n  tenancy_ocid = input('tenancy_ocid')\n\n  cmd = %(oci iam domain list --compartment-id '#{tenancy_ocid}' --all | jq '[.data[] | .url]')\n  domain_urls = json(command: cmd).params || []\n\n  history_values = []\n\n  domain_urls.each do |domain_url|\n    policy_cmd = %(oci identity-domains password-policies list --endpoint \"#{domain_url}\" --all)\n    policies = json(command: policy_cmd).params.dig('data', 'resources') || []\n\n    policies.each do |policy|\n      next unless ['StandardPasswordPolicy', 'PasswordPolicy'].include?(policy['id'])\n\n      value = policy['num-passwords-in-history']\n      history_values << (value.nil? ? nil : value.to_i)\n    end\n  end\n\n  describe 'Ensure IAM password policy prevents password reuse' do\n    subject { history_values }\n    it { should_not be_empty }\n    it { should_not include(nil) }\n    it { should all(be >= 24) }\n  end\nend\n","source_location":{"line":1,"ref":"./controls/1_6.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Ensure IAM password policy prevents password reuse is expected not to be empty","run_time":0.000981,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Ensure IAM password policy prevents password reuse"},{"status":"passed","code_desc":"Ensure IAM password policy prevents password reuse is expected not to include nil","run_time":0.00004,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Ensure IAM password policy prevents password reuse"},{"status":"failed","code_desc":"Ensure IAM password policy prevents password reuse is expected to all be >= 24","run_time":0.000242,"start_time":"2026-01-28T09:26:55-05:00","message":"expected [1, 4, 25, 1] to all be >= 24\n\n   object at index 0 failed to match:\n      expected: >= 24\n           got:    1\n\n   object at index 1 failed to match:\n      expected: >= 24\n           got:    4\n\n   object at index 3 failed to match:\n      expected: >= 24\n           got:    1","resource_class":"Object","resource_params":"[]","resource_id":"Ensure IAM password policy prevents password reuse"}],"status":"failed"},{"id":"1_7","title":"Ensure MFA is enabled for all users with a console password","desc":"Multi-factor authentication is a method of authentication that requires the use of more\nthan one factor to verify a users identity. With MFA enabled in the IAM service, when a\nuser signs in to Oracle Cloud Infrastructure, they are prompted for their user name and\npassword, which is the first factor (something that they know). The user is then prompted\nto provide a verification code from a registered MFA device, which is the second factor\n(something that they have). The two factors work together, requiring an extra layer of\nsecurity to verify the users identity and complete the sign-in process. OCI IAM supports\ntwo-factor authentication using a password (first factor) and a device that can generate a\ntime-based one-time password (TOTP) (second factor). See OCI documentation for more\ndetails. Multi factor authentication adds an extra layer of security during the login\nprocess and makes it harder for unauthorized users to gain access to OCI resources.","descriptions":[{"label":"default","data":"Multi-factor authentication is a method of authentication that requires the use of more\nthan one factor to verify a users identity. With MFA enabled in the IAM service, when a\nuser signs in to Oracle Cloud Infrastructure, they are prompted for their user name and\npassword, which is the first factor (something that they know). The user is then prompted\nto provide a verification code from a registered MFA device, which is the second factor\n(something that they have). The two factors work together, requiring an extra layer of\nsecurity to verify the users identity and complete the sign-in process. OCI IAM supports\ntwo-factor authentication using a password (first factor) and a device that can generate a\ntime-based one-time password (TOTP) (second factor). See OCI documentation for more\ndetails. Multi factor authentication adds an extra layer of security during the login\nprocess and makes it harder for unauthorized users to gain access to OCI resources."},{"label":"check","data":"From Console: Go to Identity Domains: https://cloud.oracle.com/identity/domains/ Select\n\nthe Compartment your Domain to review is in Click on the Domain to review Click on\nSecurity Click Sign-on policies Select the sign-on policy to review Under the sign-on\nrules header, click the three dots on the rule with the highest priority. Select Edit\nsign-on rule Verify that allow access is selected and prompt for an additional factor is\nenabled This requires users to enable MFA when they next login next however, to determine\nusers have enabled MFA use the below CLI. From the CLI: This CLI command checks which\nusers have enabled MFA for their accounts Execute the below: tenancy_ocid=`oci iam\ncompartment list --raw-output --query\n\"data[?contains(\"compartment-id\",'.tenancy.')].\"compartment-id\" | [0]\"` for\nid_domain_url in `oci iam domain list --compartment-id $tenancy_ocid --all | jq -r\n'.data[] | .url'` do oci identity-domains users list --endpoint $id_domain_url 2>/dev/null\n| jq -r '.data.resources[] |\nselect(.\"urn-ietf-params-scim-schemas-oracle-idcs-extension-mfa-user\".\"mfa-status\"!=\"ENROLLED\")'\n2>/dev/null | jq -r '.ocid' done for region in `oci iam region-subscription list | jq -r\n'.data[] | .\"region-name\"'`; do for compid in `oci iam compartment list\n--compartment-id-in-subtree TRUE --all 2>/dev/null | jq -r '.data[] | .id'` do for\nid_domain_url in `oci iam domain list --compartment-id $compid --region $region --all\n2>/dev/null | jq -r '.data[] | .url'` do oci identity-domains users list --endpoint\n$id_domain_url 2>/dev/null | jq -r '.data.resources[] |\nselect(.\"urn-ietf-params-scim-schemas-oracle-idcs-extension-mfa-user\".\"mfa-status\"!=\"ENROLLED\")'\n2>/dev/null | jq -r '.ocid' done done done Ensure no results are returned"},{"label":"fix","data":"Each user must enable MFA for themselves using a device they will have access to every\ntime they sign in. An administrator cannot enable MFA for another user but can enforce MFA\nby identifying the list of non-complaint users, notifying them or disabling access by\nresetting the password for non-complaint accounts. Disabling access from Console: Go to\nhttps://cloud.oracle.com/identity/ . Select Domains from Identity menu. Select the domain\nClick Security Click Sign-on polices then the \"Default Sign-on Policy\" Under the sign-on\nrules header, click the three dots on the rule with the highest priority. Select Edit\nsign-on rule Make a change to ensure that allow access is selected and prompt for an\nadditional factor is enabled"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-1_7","severity":"medium","gid":"CIS-1_7","rid":"xccdf_cis_cis_rule_1_7","stig_id":"1.7","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-001097","CCI-001098","CCI-002395","CCI-000766","CCI-001942","CCI-001643","CCI-001682","CCI-000766","CCI-001682","CCI-001643","CCI-001954","CCI-001225","CCI-001226","CCI-001227","CCI-001230"],"nist":["SC-7 a","SC-7 c","SC-7 b","IA-2 (2)","IA-2 (9)","RA-5 a","AC-2 (2)","IA-2 (2)","AC-2 (2)","RA-5 a","IA-2 (12)","SI-2 a","SI-2 a","SI-2 a","SI-2 d"]},"code":"control '1_7' do\n  title 'Ensure MFA is enabled for all users with a console password'\n\n  desc <<~DESC\n    Multi-factor authentication is a method of authentication that requires the use of more\n    than one factor to verify a users identity. With MFA enabled in the IAM service, when a\n    user signs in to Oracle Cloud Infrastructure, they are prompted for their user name and\n    password, which is the first factor (something that they know). The user is then prompted\n    to provide a verification code from a registered MFA device, which is the second factor\n    (something that they have). The two factors work together, requiring an extra layer of\n    security to verify the users identity and complete the sign-in process. OCI IAM supports\n    two-factor authentication using a password (first factor) and a device that can generate a\n    time-based one-time password (TOTP) (second factor). See OCI documentation for more\n    details. Multi factor authentication adds an extra layer of security during the login\n    process and makes it harder for unauthorized users to gain access to OCI resources.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Go to Identity Domains: https://cloud.oracle.com/identity/domains/ Select\n\n    the Compartment your Domain to review is in Click on the Domain to review Click on\n    Security Click Sign-on policies Select the sign-on policy to review Under the sign-on\n    rules header, click the three dots on the rule with the highest priority. Select Edit\n    sign-on rule Verify that allow access is selected and prompt for an additional factor is\n    enabled This requires users to enable MFA when they next login next however, to determine\n    users have enabled MFA use the below CLI. From the CLI: This CLI command checks which\n    users have enabled MFA for their accounts Execute the below: tenancy_ocid=`oci iam\n    compartment list --raw-output --query\n    \"data[?contains(\\\"compartment-id\\\",'.tenancy.')].\\\"compartment-id\\\" | [0]\"` for\n    id_domain_url in `oci iam domain list --compartment-id $tenancy_ocid --all | jq -r\n    '.data[] | .url'` do oci identity-domains users list --endpoint $id_domain_url 2>/dev/null\n    | jq -r '.data.resources[] |\n    select(.\"urn-ietf-params-scim-schemas-oracle-idcs-extension-mfa-user\".\"mfa-status\"!=\"ENROLLED\")'\n    2>/dev/null | jq -r '.ocid' done for region in `oci iam region-subscription list | jq -r\n    '.data[] | .\"region-name\"'`; do for compid in `oci iam compartment list\n    --compartment-id-in-subtree TRUE --all 2>/dev/null | jq -r '.data[] | .id'` do for\n    id_domain_url in `oci iam domain list --compartment-id $compid --region $region --all\n    2>/dev/null | jq -r '.data[] | .url'` do oci identity-domains users list --endpoint\n    $id_domain_url 2>/dev/null | jq -r '.data.resources[] |\n    select(.\"urn-ietf-params-scim-schemas-oracle-idcs-extension-mfa-user\".\"mfa-status\"!=\"ENROLLED\")'\n    2>/dev/null | jq -r '.ocid' done done done Ensure no results are returned\n  CHECK\n\n  desc 'fix', <<~FIX\n    Each user must enable MFA for themselves using a device they will have access to every\n    time they sign in. An administrator cannot enable MFA for another user but can enforce MFA\n    by identifying the list of non-complaint users, notifying them or disabling access by\n    resetting the password for non-complaint accounts. Disabling access from Console: Go to\n    https://cloud.oracle.com/identity/ . Select Domains from Identity menu. Select the domain\n    Click Security Click Sign-on polices then the \"Default Sign-on Policy\" Under the sign-on\n    rules header, click the three dots on the rule with the highest priority. Select Edit\n    sign-on rule Make a change to ensure that allow access is selected and prompt for an\n    additional factor is enabled\n  FIX\n\n  impact 0.5\n\n  tag check_id: 'C-1_7'\n  tag severity: 'medium'\n  tag gid: 'CIS-1_7'\n  tag rid: 'xccdf_cis_cis_rule_1_7'\n  tag stig_id: '1.7'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-001097',\n    'CCI-001098',\n    'CCI-002395',\n    'CCI-000766',\n    'CCI-001942',\n    'CCI-001643',\n    'CCI-001682',\n    'CCI-000766',\n    'CCI-001682',\n    'CCI-001643',\n    'CCI-001954',\n    'CCI-001225',\n    'CCI-001226',\n    'CCI-001227',\n    'CCI-001230'\n  ]\n\n  tag nist: [\n    'SC-7 a',\n    'SC-7 c',\n    'SC-7 b',\n    'IA-2 (2)',\n    'IA-2 (9)',\n    'RA-5 a',\n    'AC-2 (2)',\n    'IA-2 (2)',\n    'AC-2 (2)',\n    'RA-5 a',\n    'IA-2 (12)',\n    'SI-2 a',\n    'SI-2 a',\n    'SI-2 a',\n    'SI-2 d'\n  ]\n\n  cmd = <<~CMD\n    (\n      do\n        oci identity-domains users list --endpoint $id_domain_url 2>/dev/null | jq -r '.data.resources[] | select(.\"urn-ietf-params-scim-schemas-oracle-idcs-extension-mfa-user\".\"mfa-status\"!=\"ENROLLED\")' 2>/dev/null | jq -r '.ocid'\n      done\n      for region in `oci iam region-subscription list | jq -r '.data[] | .\"region-name\"'`;\n      do\n        for compid in `oci iam compartment list --compartment-id-in-subtree TRUE --all 2>/dev/null | jq -r '.data[] | .id'`\n        do\n          for id_domain_url in `oci iam domain list --compartment-id $compid --region $region --all 2>/dev/null | jq -r '.data[] | .url'`\n          do\n            oci identity-domains users list --endpoint $id_domain_url 2>/dev/null | jq -r '.data.resources[] | select(.\"urn-ietf-params-scim-schemas-oracle-idcs-extension-mfa-user\".\"mfa-status\"!=\"ENROLLED\")' 2>/dev/null | jq -r '.ocid'\n          done\n        done\n      done\n    ) | jq -nR '[inputs]'\n  CMD\n\n  json_output = json(command: cmd)\n  output = json_output.params\n\n  describe 'Ensure MFA is enabled for all users with a console password' do\n    subject { output }\n    it { should be_empty }\n  end\nend\n","source_location":{"line":1,"ref":"./controls/1_7.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Ensure MFA is enabled for all users with a console password is expected to be empty","run_time":0.000985,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Ensure MFA is enabled for all users with a console password"}],"status":"passed"},{"id":"1_8","title":"Ensure user API keys rotate within 90 days","desc":"API keys are used by administrators, developers, services and scripts for accessing OCI\nAPIs directly or via SDKs/OCI CLI to search, create, update or delete OCI resources. The\nAPI key is an RSA key pair. The private key is used for signing the API requests and the\npublic key is associated with a local or synchronized user's profile. It is important to\nsecure and rotate an API key every 90 days or less as it provides the same level of access\nthat a user it is associated with has. In addition to a security engineering best\npractice, this is also a compliance requirement. For example, PCI-DSS Section 3.6.4\nstates, \"Verify that key-management procedures include a defined cryptoperiod for each key\ntype in use and define a process for key changes at the end of the defined crypto\nperiod(s).\"","descriptions":[{"label":"default","data":"API keys are used by administrators, developers, services and scripts for accessing OCI\nAPIs directly or via SDKs/OCI CLI to search, create, update or delete OCI resources. The\nAPI key is an RSA key pair. The private key is used for signing the API requests and the\npublic key is associated with a local or synchronized user's profile. It is important to\nsecure and rotate an API key every 90 days or less as it provides the same level of access\nthat a user it is associated with has. In addition to a security engineering best\npractice, this is also a compliance requirement. For example, PCI-DSS Section 3.6.4\nstates, \"Verify that key-management procedures include a defined cryptoperiod for each key\ntype in use and define a process for key changes at the end of the defined crypto\nperiod(s).\""},{"label":"check","data":"From Console: Login to OCI Console. Select Identity & Security from the Services menu.\n\nSelect Domains from the Identity menu. For each domain listed, click on the name and\nselect Users . Click on an individual user under the Name heading. Click on API Keys in\nthe lower left-hand corner of the page. Ensure the date of the API key under the Created\ncolumn of the API Key is no more than 90 days old."},{"label":"fix","data":"From Console: Login to OCI Console. Select Identity & Security from the Services menu.\n\nSelect Domains from the Identity menu. For each domain listed, click on the name and\nselect Users . Click on an individual user under the Name heading. Click on API Keys in\nthe lower left-hand corner of the page. Delete any API Keys that are older than 90 days\nunder the Created column of the API Key table. From CLI: oci iam user api-key delete\n--user-id _<user_ocid>_ --fingerprint <fingerprint_of_the_key_to_be_deleted>"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-1_8","severity":"medium","gid":"CIS-1_8","rid":"xccdf_cis_cis_rule_1_8","stig_id":"1.8","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-000364","CCI-000365","CCI-000366","CCI-000421","CCI-001097","CCI-001098","CCI-002395","CCI-002110","CCI-002111","CCI-002112","CCI-000012","CCI-000200","CCI-000199","CCI-000205","CCI-000204"],"nist":["CM-6 a","CM-6 a","CM-6 b","CM-9 a","SC-7 a","SC-7 c","SC-7 b","AC-2 a","AC-2 a","AC-2 b","AC-2 j","IA-5 (1) (e)","IA-5 (1) (d)","IA-5 (1) (a)","IA-5 (8)"]},"code":"control '1_8' do\n  title 'Ensure user API keys rotate within 90 days'\n\n  desc <<~DESC\n    API keys are used by administrators, developers, services and scripts for accessing OCI\n    APIs directly or via SDKs/OCI CLI to search, create, update or delete OCI resources. The\n    API key is an RSA key pair. The private key is used for signing the API requests and the\n    public key is associated with a local or synchronized user's profile. It is important to\n    secure and rotate an API key every 90 days or less as it provides the same level of access\n    that a user it is associated with has. In addition to a security engineering best\n    practice, this is also a compliance requirement. For example, PCI-DSS Section 3.6.4\n    states, \"Verify that key-management procedures include a defined cryptoperiod for each key\n    type in use and define a process for key changes at the end of the defined crypto\n    period(s).\"\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Login to OCI Console. Select Identity & Security from the Services menu.\n\n    Select Domains from the Identity menu. For each domain listed, click on the name and\n    select Users . Click on an individual user under the Name heading. Click on API Keys in\n    the lower left-hand corner of the page. Ensure the date of the API key under the Created\n    column of the API Key is no more than 90 days old.\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Login to OCI Console. Select Identity & Security from the Services menu.\n\n    Select Domains from the Identity menu. For each domain listed, click on the name and\n    select Users . Click on an individual user under the Name heading. Click on API Keys in\n    the lower left-hand corner of the page. Delete any API Keys that are older than 90 days\n    under the Created column of the API Key table. From CLI: oci iam user api-key delete\n    --user-id _<user_ocid>_ --fingerprint <fingerprint_of_the_key_to_be_deleted>\n  FIX\n\n  impact 0.5\n\n  tag check_id: 'C-1_8'\n  tag severity: 'medium'\n  tag gid: 'CIS-1_8'\n  tag rid: 'xccdf_cis_cis_rule_1_8'\n  tag stig_id: '1.8'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-000364',\n    'CCI-000365',\n    'CCI-000366',\n    'CCI-000421',\n    'CCI-001097',\n    'CCI-001098',\n    'CCI-002395',\n    'CCI-002110',\n    'CCI-002111',\n    'CCI-002112',\n    'CCI-000012',\n    'CCI-000200',\n    'CCI-000199',\n    'CCI-000205',\n    'CCI-000204'\n  ]\n\n  tag nist: [\n    'CM-6 a',\n    'CM-6 a',\n    'CM-6 b',\n    'CM-9 a',\n    'SC-7 a',\n    'SC-7 c',\n    'SC-7 b',\n    'AC-2 a',\n    'AC-2 a',\n    'AC-2 b',\n    'AC-2 j',\n    'IA-5 (1) (e)',\n    'IA-5 (1) (d)',\n    'IA-5 (1) (a)',\n    'IA-5 (8)'\n  ]\n\n  require 'time'\n\n  compartments_response = json(command: 'oci iam compartment list --include-root --compartment-id-in-subtree TRUE --all 2>/dev/null')\n  compartments_data = compartments_response.params.fetch('data', [])\n  compartment_ids = compartments_data.map { |compartment| compartment['id'] }.compact\n\n  domain_urls = []\n\n  compartment_ids.each do |compartment_id|\n    domains_response = json(command: %(oci iam domain list --compartment-id \"#{compartment_id}\" --all))\n    domains_data = domains_response.params.fetch('data', [])\n    domain_urls.concat(domains_data.map { |domain| domain['url'] }.compact)\n  end\n\n  now = Time.now.utc\n  cutoff_time = now - (90 * 24 * 60 * 60)\n  stale_api_keys = []\n  total_api_keys = 0\n  domain_urls.uniq!\n\n  domain_urls.each do |domain_url|\n    next if domain_url.to_s.empty?\n\n    users_cmd = %(oci identity-domains users list --endpoint \"#{domain_url}\" --all)\n    users_response = json(command: users_cmd).params\n    users = users_response.dig('data', 'resources') || []\n\n    users.each do |user|\n      user_ocid = user['ocid']\n      user_name = user['user-name']\n\n      api_keys_cmd = %(oci identity-domains api-keys list --endpoint \"#{domain_url}\" --all --filter 'user.ocid eq \"#{user_ocid}\"')\n      api_keys_response = json(command: api_keys_cmd).params\n      api_keys = api_keys_response.dig('data', 'resources') || []\n      total_api_keys += api_keys.length\n\n      api_keys.each do |api_key|\n        created_at = api_key.dig('meta', 'created')\n\n        key_details = {\n          'user_name' => user_name,\n          'domain_url' => domain_url,\n          'api_key_id' => api_key['id'],\n          'user_ocid' => user_ocid,\n          'created' => created_at\n        }\n\n        created_time = Time.parse(created_at.to_s).utc\n\n        next unless created_time < cutoff_time\n\n        age_days = ((now - created_time) / 86_400).floor\n        stale_api_keys << key_details.merge('age_days' => age_days)\n      end\n    end\n  end\n\n  if total_api_keys.zero?\n    impact 0.0\n    describe 'Ensure user API keys rotate within 90 days' do\n      skip 'No API keys found in tenancy.'\n    end\n  else\n    describe 'Ensure user API keys rotate within 90 days' do\n      subject { stale_api_keys }\n      it { should cmp [] }\n    end\n  end\nend\n","source_location":{"line":1,"ref":"./controls/1_8.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Ensure user API keys rotate within 90 days is expected to cmp == []","run_time":0.000061,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Ensure user API keys rotate within 90 days"}],"status":"passed"},{"id":"1_9","title":"Ensure user customer secret keys rotate every 90 days","desc":"Object Storage provides an API to enable interoperability with Amazon S3. To use this\nAmazon S3 Compatibility API, you need to generate the signing key required to authenticate\nwith Amazon S3. This special signing key is an Access Key/Secret Key pair. Oracle\ngenerates the Customer Secret key to pair with the Access Key. It is important to rotate\ncustomer secret keys at least every 90 days, as they provide the same level of object\nstorage access that the user they are associated with has.","descriptions":[{"label":"default","data":"Object Storage provides an API to enable interoperability with Amazon S3. To use this\nAmazon S3 Compatibility API, you need to generate the signing key required to authenticate\nwith Amazon S3. This special signing key is an Access Key/Secret Key pair. Oracle\ngenerates the Customer Secret key to pair with the Access Key. It is important to rotate\ncustomer secret keys at least every 90 days, as they provide the same level of object\nstorage access that the user they are associated with has."},{"label":"check","data":"From Console: Login to OCI Console. Select Identity & Security from the Services menu.\n\nSelect Domains from the Identity menu. For each domain listed, click on the name and\nselect Users . Click on an individual user under the Username heading. Click on Customer\nSecret Keys in the lower left-hand corner of the page. Ensure the date of the Customer\nSecret Key under the Created column of the Customer Secret Key is no more than 90 days\nold."},{"label":"fix","data":"From Console: Login to OCI Console. Select Identity & Security from the Services menu.\n\nSelect Domains from the Identity menu. For each domain listed, click on the name and\nselect Users . Click on an individual user under the Username heading. Click on Customer\nSecret Keys in the lower left-hand corner of the page. Delete any Access Keys with a date\nolder than 90 days under the Created column of the Customer Secret Keys."}],"impact":0.5,"refs":[],"tags":{"check_id":"C-1_9","severity":"medium","gid":"CIS-1_9","rid":"xccdf_cis_cis_rule_1_9","stig_id":"1.9","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-000364","CCI-000365","CCI-000366","CCI-000421","CCI-001097","CCI-001098","CCI-002395","CCI-002110","CCI-002111","CCI-002112","CCI-000012","CCI-000200","CCI-000199","CCI-000205","CCI-000204"],"nist":["CM-6 a","CM-6 a","CM-6 b","CM-9 a","SC-7 a","SC-7 c","SC-7 b","AC-2 a","AC-2 a","AC-2 b","AC-2 j","IA-5 (1) (e)","IA-5 (1) (d)","IA-5 (1) (a)","IA-5 (8)"]},"code":"control '1_9' do\n  title 'Ensure user customer secret keys rotate every 90 days'\n\n  desc <<~DESC\n    Object Storage provides an API to enable interoperability with Amazon S3. To use this\n    Amazon S3 Compatibility API, you need to generate the signing key required to authenticate\n    with Amazon S3. This special signing key is an Access Key/Secret Key pair. Oracle\n    generates the Customer Secret key to pair with the Access Key. It is important to rotate\n    customer secret keys at least every 90 days, as they provide the same level of object\n    storage access that the user they are associated with has.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Login to OCI Console. Select Identity & Security from the Services menu.\n\n    Select Domains from the Identity menu. For each domain listed, click on the name and\n    select Users . Click on an individual user under the Username heading. Click on Customer\n    Secret Keys in the lower left-hand corner of the page. Ensure the date of the Customer\n    Secret Key under the Created column of the Customer Secret Key is no more than 90 days\n    old.\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Login to OCI Console. Select Identity & Security from the Services menu.\n\n    Select Domains from the Identity menu. For each domain listed, click on the name and\n    select Users . Click on an individual user under the Username heading. Click on Customer\n    Secret Keys in the lower left-hand corner of the page. Delete any Access Keys with a date\n    older than 90 days under the Created column of the Customer Secret Keys.\n  FIX\n\n  impact 0.5\n\n  tag check_id: 'C-1_9'\n  tag severity: 'medium'\n  tag gid: 'CIS-1_9'\n  tag rid: 'xccdf_cis_cis_rule_1_9'\n  tag stig_id: '1.9'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-000364',\n    'CCI-000365',\n    'CCI-000366',\n    'CCI-000421',\n    'CCI-001097',\n    'CCI-001098',\n    'CCI-002395',\n    'CCI-002110',\n    'CCI-002111',\n    'CCI-002112',\n    'CCI-000012',\n    'CCI-000200',\n    'CCI-000199',\n    'CCI-000205',\n    'CCI-000204'\n  ]\n\n  tag nist: [\n    'CM-6 a',\n    'CM-6 a',\n    'CM-6 b',\n    'CM-9 a',\n    'SC-7 a',\n    'SC-7 c',\n    'SC-7 b',\n    'AC-2 a',\n    'AC-2 a',\n    'AC-2 b',\n    'AC-2 j',\n    'IA-5 (1) (e)',\n    'IA-5 (1) (d)',\n    'IA-5 (1) (a)',\n    'IA-5 (8)'\n  ]\n\n  require 'time'\n\n  compartments_response = json(command: 'oci iam compartment list --include-root --compartment-id-in-subtree TRUE --all 2>/dev/null')\n  compartments_data = compartments_response.params.fetch('data', [])\n  compartment_ids = compartments_data.map { |compartment| compartment['id'] }.compact\n\n  domain_urls = []\n\n  compartment_ids.each do |compartment_id|\n    domains_response = json(command: %(oci iam domain list --compartment-id \"#{compartment_id}\" --all))\n    domains_data = domains_response.params.fetch('data', [])\n    domain_urls.concat(domains_data.map { |domain| domain['url'] }.compact)\n  end\n\n  now = Time.now.utc\n  cutoff_time = now - (90 * 24 * 60 * 60)\n  stale_customer_secret_keys = []\n  total_customer_secret_keys = 0\n  domain_urls.uniq!\n\n  domain_urls.each do |domain_url|\n    next if domain_url.to_s.empty?\n\n    users_cmd = %(oci identity-domains users list --endpoint \"#{domain_url}\" --all)\n    users_response = json(command: users_cmd).params\n    users = users_response.dig('data', 'resources') || []\n\n    users.each do |user|\n      user_ocid = user['ocid']\n      user_name = user['user-name']\n\n      secret_keys_cmd = %(oci identity-domains customer-secret-keys list --endpoint \"#{domain_url}\" --all --filter 'user.ocid eq \"#{user_ocid}\"')\n      secret_keys_response = json(command: secret_keys_cmd).params\n      secret_keys = secret_keys_response.dig('data', 'resources') || []\n      total_customer_secret_keys += secret_keys.length\n\n      secret_keys.each do |secret_key|\n        created_at = secret_key.dig('meta', 'created')\n\n        key_details = {\n          'user_name' => user_name,\n          'domain_url' => domain_url,\n          'customer_secret_key_id' => secret_key['id'],\n          'user_ocid' => user_ocid,\n          'created' => created_at\n        }\n\n        created_time = Time.parse(created_at.to_s).utc\n\n        next unless created_time < cutoff_time\n\n        age_days = ((now - created_time) / 86_400).floor\n        stale_customer_secret_keys << key_details.merge('age_days' => age_days)\n      end\n    end\n  end\n\n  if total_customer_secret_keys.zero?\n    impact 0.0\n    describe 'Ensure user customer secret keys rotate every 90 days' do\n      skip 'No customer secret keys found in tenancy.'\n    end\n  else\n    describe 'Ensure user customer secret keys rotate every 90 days' do\n      subject { stale_customer_secret_keys }\n      it { should cmp [] }\n    end\n  end\nend\n","source_location":{"line":1,"ref":"./controls/1_9.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Ensure user customer secret keys rotate every 90 days is expected to cmp == []","run_time":0.000055,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Ensure user customer secret keys rotate every 90 days"}],"status":"passed"},{"id":"2_1","title":"Ensure no security lists allow ingress from 0.0.0.0/0 to port 22","desc":"Security lists provide stateful and stateless filtering of ingress and egress network\ntraffic to OCI resources on a subnet level. It is recommended that no security list allows\nunrestricted ingress access to port 22. Removing unfettered connectivity to remote console\nservices, such as Secure Shell (SSH), reduces a server's exposure to risk.","descriptions":[{"label":"default","data":"Security lists provide stateful and stateless filtering of ingress and egress network\ntraffic to OCI resources on a subnet level. It is recommended that no security list allows\nunrestricted ingress access to port 22. Removing unfettered connectivity to remote console\nservices, such as Secure Shell (SSH), reduces a server's exposure to risk."},{"label":"check","data":"From Console: Login to the OCI Console. Click the search bar at the top of the screen.\n\nType Advanced Resource Query and hit enter . Click the Advanced Resource Query button in\nthe upper right corner of the screen. Enter the following query in the query box: query\nSecurityList resources where (IngressSecurityRules.source = '0.0.0.0/0' &&\nIngressSecurityRules.protocol = 6 &&\nIngressSecurityRules.tcpOptions.destinationPortRange.max >= 22 &&\nIngressSecurityRules.tcpOptions.destinationPortRange.min =<= 22) Ensure the query returns\nno results. From CLI: Execute the following command: oci search resource structured-search\n--query-text \"query SecurityList resources where (IngressSecurityRules.source =\n'0.0.0.0/0' && IngressSecurityRules.protocol = 6 &&\nIngressSecurityRules.tcpOptions.destinationPortRange.max >= 22 &&\nIngressSecurityRules.tcpOptions.destinationPortRange.min <= 22) \" Ensure the query returns\nno results. Cloud Guard Ensure Cloud Guard is enabled in the root compartment of the\ntenancy. For more information about enabling Cloud Guard, please look at the instructions\nincluded in Recommendation 3.15. From Console: Type Cloud Guard into the Search box at the\ntop of the Console. Click Cloud Guard from the Services submenu. Click Detector Recipes\nin the Cloud Guard menu. Click OCI Configuration Detector Recipe (Oracle Managed) under\nthe Recipe Name column. Find VCN Security list allows traffic to non-public port from all\nsources (0.0.0.0/0) in the Detector Rules column. Select the vertical ellipsis icon and\nchose Edit on the VCN Security list allows traffic to non-public port from all sources\n(0.0.0.0/0) row. In the Edit Detector Rule window find the Input Setting box and\nverify/add to the Restricted Protocol: Ports List setting to TCP:[22], UDP:[22]. Click the\nSave button. From CLI: Update the VCN Security list allows traffic to non-public port from\nall sources (0.0.0.0/0) Detector Rule in Cloud Guard to generate Problems if a VCN\nsecurity list allows public access via port 22 with the following command: oci cloud-guard\ndetector-recipe-detector-rule update --detector-recipe-id <insert detector recipe ocid>\n--detector-rule-id SECURITY_LISTS_OPEN_SOURCE --details '{\"configurations\":[{ \"configKey\"\n: \"securityListsOpenSourceConfig\", \"name\" : \"Restricted Protocol:Ports List\", \"value\" :\n\n\"TCP:[22], UDP:[22]\", \"dataType\" : null, \"values\" : null }]}'"},{"label":"fix","data":"From Console: Follow the audit procedure above. For each security list in the returned\n\nresults, click the security list name Either edit the ingress rule to be more restrictive,\ndelete the ingress rule or click on the VCN and terminate the security list as\nappropriate. From CLI: Follow the audit procedure. For each of the security lists\nidentified, execute the following command: oci network security-list get\n--security-list-id <security list id> Then either: Update the security list by copying the\ningress-security-rules element from the JSON returned by the above command, edit it\nappropriately and use it in the following command: oci network security-list update\n--security-list-id <security-list-id> --ingress-security-rules '<ingress security rules\nJSON>' or Delete the security list with the following command: oci network security-list\ndelete --security-list-id <security list id>"},{"label":"potential_impacts","data":"For updating an existing environment, care should be taken to ensure that administrators\ncurrently relying on an existing ingress from 0.0.0.0/0 have access to ports 22 and/or\n3389 through another network security group or security list."}],"impact":0.5,"refs":[],"tags":{"check_id":"C-2_1","severity":"medium","gid":"CIS-2_1","rid":"xccdf_cis_cis_rule_2_1","stig_id":"2.1","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-001097","CCI-001098","CCI-002395","CCI-002668","CCI-002669","CCI-001243","CCI-001184","CCI-000364","CCI-000366","CCI-000381"],"nist":["SC-7 a","SC-7 c","SC-7 b","SI-4 (11)","SI-4 (13) (c)","SI-3 c 2","SC-23","CM-6 a","CM-6 b","CM-7 a"]},"code":"control '2_1' do\n  title 'Ensure no security lists allow ingress from 0.0.0.0/0 to port 22'\n\n  desc <<~DESC\n    Security lists provide stateful and stateless filtering of ingress and egress network\n    traffic to OCI resources on a subnet level. It is recommended that no security list allows\n    unrestricted ingress access to port 22. Removing unfettered connectivity to remote console\n    services, such as Secure Shell (SSH), reduces a server's exposure to risk.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Login to the OCI Console. Click the search bar at the top of the screen.\n\n    Type Advanced Resource Query and hit enter . Click the Advanced Resource Query button in\n    the upper right corner of the screen. Enter the following query in the query box: query\n    SecurityList resources where (IngressSecurityRules.source = '0.0.0.0/0' &&\n    IngressSecurityRules.protocol = 6 &&\n    IngressSecurityRules.tcpOptions.destinationPortRange.max >= 22 &&\n    IngressSecurityRules.tcpOptions.destinationPortRange.min =<= 22) Ensure the query returns\n    no results. From CLI: Execute the following command: oci search resource structured-search\n    --query-text \"query SecurityList resources where (IngressSecurityRules.source =\n    '0.0.0.0/0' && IngressSecurityRules.protocol = 6 &&\n    IngressSecurityRules.tcpOptions.destinationPortRange.max >= 22 &&\n    IngressSecurityRules.tcpOptions.destinationPortRange.min <= 22) \" Ensure the query returns\n    no results. Cloud Guard Ensure Cloud Guard is enabled in the root compartment of the\n    tenancy. For more information about enabling Cloud Guard, please look at the instructions\n    included in Recommendation 3.15. From Console: Type Cloud Guard into the Search box at the\n    top of the Console. Click Cloud Guard from the Services submenu. Click Detector Recipes\n    in the Cloud Guard menu. Click OCI Configuration Detector Recipe (Oracle Managed) under\n    the Recipe Name column. Find VCN Security list allows traffic to non-public port from all\n    sources (0.0.0.0/0) in the Detector Rules column. Select the vertical ellipsis icon and\n    chose Edit on the VCN Security list allows traffic to non-public port from all sources\n    (0.0.0.0/0) row. In the Edit Detector Rule window find the Input Setting box and\n    verify/add to the Restricted Protocol: Ports List setting to TCP:[22], UDP:[22]. Click the\n    Save button. From CLI: Update the VCN Security list allows traffic to non-public port from\n    all sources (0.0.0.0/0) Detector Rule in Cloud Guard to generate Problems if a VCN\n    security list allows public access via port 22 with the following command: oci cloud-guard\n    detector-recipe-detector-rule update --detector-recipe-id <insert detector recipe ocid>\n    --detector-rule-id SECURITY_LISTS_OPEN_SOURCE --details '{\"configurations\":[{ \"configKey\"\n    : \"securityListsOpenSourceConfig\", \"name\" : \"Restricted Protocol:Ports List\", \"value\" :\n\n    \"TCP:[22], UDP:[22]\", \"dataType\" : null, \"values\" : null }]}'\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Follow the audit procedure above. For each security list in the returned\n\n    results, click the security list name Either edit the ingress rule to be more restrictive,\n    delete the ingress rule or click on the VCN and terminate the security list as\n    appropriate. From CLI: Follow the audit procedure. For each of the security lists\n    identified, execute the following command: oci network security-list get\n    --security-list-id <security list id> Then either: Update the security list by copying the\n    ingress-security-rules element from the JSON returned by the above command, edit it\n    appropriately and use it in the following command: oci network security-list update\n    --security-list-id <security-list-id> --ingress-security-rules '<ingress security rules\n    JSON>' or Delete the security list with the following command: oci network security-list\n    delete --security-list-id <security list id>\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    For updating an existing environment, care should be taken to ensure that administrators\n    currently relying on an existing ingress from 0.0.0.0/0 have access to ports 22 and/or\n    3389 through another network security group or security list.\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-2_1'\n  tag severity: 'medium'\n  tag gid: 'CIS-2_1'\n  tag rid: 'xccdf_cis_cis_rule_2_1'\n  tag stig_id: '2.1'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-001097',\n    'CCI-001098',\n    'CCI-002395',\n    'CCI-002668',\n    'CCI-002669',\n    'CCI-001243',\n    'CCI-001184',\n    'CCI-000364',\n    'CCI-000366',\n    'CCI-000381'\n  ]\n\n  tag nist: [\n    'SC-7 a',\n    'SC-7 c',\n    'SC-7 b',\n    'SI-4 (11)',\n    'SI-4 (13) (c)',\n    'SI-3 c 2',\n    'SC-23',\n    'CM-6 a',\n    'CM-6 b',\n    'CM-7 a'\n  ]\n\n  cmd = %q{oci search resource structured-search --query-text \"query SecurityList resources where (IngressSecurityRules.source = '0.0.0.0/0' && IngressSecurityRules.protocol = 6 && IngressSecurityRules.tcpOptions.destinationPortRange.max >= 22 && IngressSecurityRules.tcpOptions.destinationPortRange.min <= 22)\"}\n  json_output = json(command: cmd)\n  output = json_output.params.dig('data', 'items')\n\n  describe 'Ensure no security lists allow ingress from 0.0.0.0/0 to port 22' do\n    subject { output }\n    it { should be_empty }\n  end\n\n  cloud_guard_check = input('cloud_guard_check')\n  detector_recipe_ocid = input('detector_recipe_ocid')\n\n  if cloud_guard_check\n    tenancy_ocid = input('tenancy_ocid')\n    cloud_guard = cloud_guard_helper(tenancy_ocid: tenancy_ocid, detector_recipe_ocid: detector_recipe_ocid)\n    cloud_guard_status = cloud_guard.status\n    cloud_guard_output = cloud_guard.detector_rule_value(rule_id: 'SECURITY_LISTS_OPEN_SOURCE', config_key: 'securityListsOpenSourceConfig')\n    cloud_guard_rule_enabled = cloud_guard.detector_rule_enabled?(rule_id: 'SECURITY_LISTS_OPEN_SOURCE')\n  end\n\n  describe 'Cloud Guard' do\n    if cloud_guard_check\n      it 'is enabled' do\n        expect(cloud_guard_status).to cmp 'ENABLED'\n      end\n\n      it 'detector rule \"VCN Security list allows traffic to non-public port from all sources (0.0.0.0/0)\" is enabled' do\n        expect(cloud_guard_rule_enabled).to cmp true\n      end\n\n      it 'detector rule \"VCN Security list allows traffic to non-public port from all sources (0.0.0.0/0)\" includes TCP and UDP port 22' do\n        expect(cloud_guard.port_list_check?(config_value: cloud_guard_output, protocol: 'TCP', port: 22)).to cmp true\n        expect(cloud_guard.port_list_check?(config_value: cloud_guard_output, protocol: 'UDP', port: 22)).to cmp true\n      end\n    else\n      skip 'Cloud Guard check skipped. cloud_guard_check is set to false.'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"./controls/2_1.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"Ensure no security lists allow ingress from 0.0.0.0/0 to port 22 is expected to be empty","run_time":0.001131,"start_time":"2026-01-28T09:26:55-05:00","message":"expected `[{\"additional-details\"=>{}, \"availability-domain\"=>nil, \"compartment-id\"=>\"ocid1.tenancy.oc1..aaaaaaa...ist\", \"search-context\"=>nil, \"system-tags\"=>{}, \"time-created\"=>\"2025-12-10T19:14:14.584000+00:00\"}].empty?` to be truthy, got false","resource_class":"Object","resource_params":"[]","resource_id":"Ensure no security lists allow ingress from 0.0.0.0/0 to port 22"},{"status":"passed","code_desc":"Cloud Guard is enabled","run_time":0.000043,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Cloud Guard"},{"status":"passed","code_desc":"Cloud Guard detector rule \"VCN Security list allows traffic to non-public port from all sources (0.0.0.0/0)\" is enabled","run_time":0.000041,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Cloud Guard"},{"status":"passed","code_desc":"Cloud Guard detector rule \"VCN Security list allows traffic to non-public port from all sources (0.0.0.0/0)\" includes TCP and UDP port 22","run_time":0.000095,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Cloud Guard"}],"status":"failed"},{"id":"2_2","title":"Ensure no security lists allow ingress from 0.0.0.0/0 to port 3389","desc":"Security lists provide stateful and stateless filtering of ingress and egress network\ntraffic to OCI resources on a subnet level. It is recommended that no security group\nallows unrestricted ingress access to port 3389. Removing unfettered connectivity to\nremote console services, such as Remote Desktop Protocol (RDP), reduces a server's\nexposure to risk.","descriptions":[{"label":"default","data":"Security lists provide stateful and stateless filtering of ingress and egress network\ntraffic to OCI resources on a subnet level. It is recommended that no security group\nallows unrestricted ingress access to port 3389. Removing unfettered connectivity to\nremote console services, such as Remote Desktop Protocol (RDP), reduces a server's\nexposure to risk."},{"label":"check","data":"From Console: Login into the OCI Console Click in the search bar at the top of the screen.\n\nType Advanced Resource Query and hit enter . Click the Advanced Resource Query button in\nthe upper right corner of the screen. Enter the following query in the query box: query\nSecurityList resources where (IngressSecurityRules.source = '0.0.0.0/0' &&\nIngressSecurityRules.protocol = 6 &&\nIngressSecurityRules.tcpOptions.destinationPortRange.max >= 3389 &&\nIngressSecurityRules.tcpOptions.destinationPortRange.min <= 3389) Ensure query returns no\nresults. From CLI: Execute the following command: oci search resource structured-search\n--query-text \"query SecurityList resources where (IngressSecurityRules.source =\n'0.0.0.0/0' && IngressSecurityRules.protocol = 6 &&\nIngressSecurityRules.tcpOptions.destinationPortRange.max >= 3389 &&\nIngressSecurityRules.tcpOptions.destinationPortRange.min <= 3389) \" Ensure query returns\nno results. Cloud Guard To Enable Cloud Guard Auditing: Ensure Cloud Guard is enabled in\nthe root compartment of the tenancy. For more information about enabling Cloud Guard,\nplease look at the instructions included in Recommendation 3.15. From Console: Type Cloud\nGuard into the Search box at the top of the Console . Click Cloud Guard from the\nServices submenu. Click Detector Recipes in the Cloud Guard menu. Click OCI\nConfiguration Detector Recipe (Oracle Managed) under the Recipe Name column. Find VCN\nSecurity list allows traffic to non-public port from all sources (0.0.0.0/0) in the\nDetector Rules column. Select the vertical ellipsis icon and choose Edit on the VCN\nSecurity list allows traffic to non-public port from all sources (0.0.0.0/0) row. In the\nEdit Detector Rule window find the Input Setting box and verify/add to the Restricted\nProtocol: Ports List setting to TCP:[3389], UDP:[3389]. Click the Save button. From CLI:\n\nUpdate the VCN Security list allows traffic to non-public port from all sources\n(0.0.0.0/0) Detector Rule in Cloud Guard to generate Problems if a VCN security list\nallows public access via port 3389 with the following command: oci cloud-guard\ndetector-recipe-detector-rule update --detector-recipe-id <insert detector recipe ocid>\n--detector-rule-id SECURITY_LISTS_OPEN_SOURCE --details '{\"configurations\":[{ \"configKey\"\n: \"securityListsOpenSourceConfig\", \"name\" : \"Restricted Protocol:Ports List\", \"value\" :\n\n\"TCP:[3389], UDP:[3389]\", \"dataType\" : null, \"values\" : null }]}'"},{"label":"fix","data":"From Console: Follow the audit procedure above. For each security list in the returned\n\nresults, click the security list name Either edit the ingress rule to be more restrictive,\ndelete the ingress rule or click on the VCN and terminate the security list as\nappropriate. From CLI: Follow the audit procedure. For each of the security lists\nidentified, execute the following command: oci network security-list get\n--security-list-id <security list id> Then either: Update the security list by copying the\ningress-security-rules element from the JSON returned by the above command, edit it\nappropriately, and use it in the following command oci network security-list update\n--security-list-id <security-list-id> --ingress-security-rules '<ingress security rules\nJSON>' or Delete the security list with the following command: oci network security-list\ndelete --security-list-id <security list id>"},{"label":"potential_impacts","data":"For updating an existing environment, care should be taken to ensure that administrators\ncurrently relying on an existing ingress from 0.0.0.0/0 have access to ports 22 and/or\n3389 through another network security group or security list."}],"impact":0.5,"refs":[],"tags":{"check_id":"C-2_2","severity":"medium","gid":"CIS-2_2","rid":"xccdf_cis_cis_rule_2_2","stig_id":"2.2","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-001097","CCI-001098","CCI-002395","CCI-002668","CCI-002669","CCI-001243","CCI-001184","CCI-000364","CCI-000366","CCI-000381"],"nist":["SC-7 a","SC-7 c","SC-7 b","SI-4 (11)","SI-4 (13) (c)","SI-3 c 2","SC-23","CM-6 a","CM-6 b","CM-7 a"]},"code":"control '2_2' do\n  title 'Ensure no security lists allow ingress from 0.0.0.0/0 to port 3389'\n\n  desc <<~DESC\n    Security lists provide stateful and stateless filtering of ingress and egress network\n    traffic to OCI resources on a subnet level. It is recommended that no security group\n    allows unrestricted ingress access to port 3389. Removing unfettered connectivity to\n    remote console services, such as Remote Desktop Protocol (RDP), reduces a server's\n    exposure to risk.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Login into the OCI Console Click in the search bar at the top of the screen.\n\n    Type Advanced Resource Query and hit enter . Click the Advanced Resource Query button in\n    the upper right corner of the screen. Enter the following query in the query box: query\n    SecurityList resources where (IngressSecurityRules.source = '0.0.0.0/0' &&\n    IngressSecurityRules.protocol = 6 &&\n    IngressSecurityRules.tcpOptions.destinationPortRange.max >= 3389 &&\n    IngressSecurityRules.tcpOptions.destinationPortRange.min <= 3389) Ensure query returns no\n    results. From CLI: Execute the following command: oci search resource structured-search\n    --query-text \"query SecurityList resources where (IngressSecurityRules.source =\n    '0.0.0.0/0' && IngressSecurityRules.protocol = 6 &&\n    IngressSecurityRules.tcpOptions.destinationPortRange.max >= 3389 &&\n    IngressSecurityRules.tcpOptions.destinationPortRange.min <= 3389) \" Ensure query returns\n    no results. Cloud Guard To Enable Cloud Guard Auditing: Ensure Cloud Guard is enabled in\n    the root compartment of the tenancy. For more information about enabling Cloud Guard,\n    please look at the instructions included in Recommendation 3.15. From Console: Type Cloud\n    Guard into the Search box at the top of the Console . Click Cloud Guard from the\n    Services submenu. Click Detector Recipes in the Cloud Guard menu. Click OCI\n    Configuration Detector Recipe (Oracle Managed) under the Recipe Name column. Find VCN\n    Security list allows traffic to non-public port from all sources (0.0.0.0/0) in the\n    Detector Rules column. Select the vertical ellipsis icon and choose Edit on the VCN\n    Security list allows traffic to non-public port from all sources (0.0.0.0/0) row. In the\n    Edit Detector Rule window find the Input Setting box and verify/add to the Restricted\n    Protocol: Ports List setting to TCP:[3389], UDP:[3389]. Click the Save button. From CLI:\n\n    Update the VCN Security list allows traffic to non-public port from all sources\n    (0.0.0.0/0) Detector Rule in Cloud Guard to generate Problems if a VCN security list\n    allows public access via port 3389 with the following command: oci cloud-guard\n    detector-recipe-detector-rule update --detector-recipe-id <insert detector recipe ocid>\n    --detector-rule-id SECURITY_LISTS_OPEN_SOURCE --details '{\"configurations\":[{ \"configKey\"\n    : \"securityListsOpenSourceConfig\", \"name\" : \"Restricted Protocol:Ports List\", \"value\" :\n\n    \"TCP:[3389], UDP:[3389]\", \"dataType\" : null, \"values\" : null }]}'\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Follow the audit procedure above. For each security list in the returned\n\n    results, click the security list name Either edit the ingress rule to be more restrictive,\n    delete the ingress rule or click on the VCN and terminate the security list as\n    appropriate. From CLI: Follow the audit procedure. For each of the security lists\n    identified, execute the following command: oci network security-list get\n    --security-list-id <security list id> Then either: Update the security list by copying the\n    ingress-security-rules element from the JSON returned by the above command, edit it\n    appropriately, and use it in the following command oci network security-list update\n    --security-list-id <security-list-id> --ingress-security-rules '<ingress security rules\n    JSON>' or Delete the security list with the following command: oci network security-list\n    delete --security-list-id <security list id>\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    For updating an existing environment, care should be taken to ensure that administrators\n    currently relying on an existing ingress from 0.0.0.0/0 have access to ports 22 and/or\n    3389 through another network security group or security list.\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-2_2'\n  tag severity: 'medium'\n  tag gid: 'CIS-2_2'\n  tag rid: 'xccdf_cis_cis_rule_2_2'\n  tag stig_id: '2.2'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-001097',\n    'CCI-001098',\n    'CCI-002395',\n    'CCI-002668',\n    'CCI-002669',\n    'CCI-001243',\n    'CCI-001184',\n    'CCI-000364',\n    'CCI-000366',\n    'CCI-000381'\n  ]\n\n  tag nist: [\n    'SC-7 a',\n    'SC-7 c',\n    'SC-7 b',\n    'SI-4 (11)',\n    'SI-4 (13) (c)',\n    'SI-3 c 2',\n    'SC-23',\n    'CM-6 a',\n    'CM-6 b',\n    'CM-7 a'\n  ]\n\n  cmd = %q{oci search resource structured-search --query-text \"query SecurityList resources where (IngressSecurityRules.source = '0.0.0.0/0' && IngressSecurityRules.protocol = 6 && IngressSecurityRules.tcpOptions.destinationPortRange.max >= 3389 && IngressSecurityRules.tcpOptions.destinationPortRange.min <= 3389)\"}\n  json_output = json(command: cmd)\n  output = json_output.params.dig('data', 'items')\n\n  describe 'Ensure no security lists allow ingress from 0.0.0.0/0 to port 3389' do\n    subject { output }\n    it { should be_empty }\n  end\n\n  cloud_guard_check = input('cloud_guard_check')\n  detector_recipe_ocid = input('detector_recipe_ocid')\n\n  if cloud_guard_check\n    tenancy_ocid = input('tenancy_ocid')\n    cloud_guard = cloud_guard_helper(tenancy_ocid: tenancy_ocid, detector_recipe_ocid: detector_recipe_ocid)\n    cloud_guard_status = cloud_guard.status\n    cloud_guard_output = cloud_guard.detector_rule_value(rule_id: 'SECURITY_LISTS_OPEN_SOURCE', config_key: 'securityListsOpenSourceConfig')\n    cloud_guard_rule_enabled = cloud_guard.detector_rule_enabled?(rule_id: 'SECURITY_LISTS_OPEN_SOURCE')\n  end\n\n  describe 'Cloud Guard' do\n    if cloud_guard_check\n      it 'is enabled' do\n        expect(cloud_guard_status).to cmp 'ENABLED'\n      end\n\n      it 'detector rule \"VCN Security list allows traffic to non-public port from all sources (0.0.0.0/0)\" is enabled' do\n        expect(cloud_guard_rule_enabled).to cmp true\n      end\n\n      it 'detector rule \"VCN Security list allows traffic to non-public port from all sources (0.0.0.0/0)\" includes TCP and UDP port 3389' do\n        expect(cloud_guard.port_list_check?(config_value: cloud_guard_output, protocol: 'TCP', port: 3389)).to cmp true\n        expect(cloud_guard.port_list_check?(config_value: cloud_guard_output, protocol: 'UDP', port: 3389)).to cmp true\n      end\n    else\n      skip 'Cloud Guard check skipped. cloud_guard_check is set to false.'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"./controls/2_2.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Ensure no security lists allow ingress from 0.0.0.0/0 to port 3389 is expected to be empty","run_time":0.000996,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Ensure no security lists allow ingress from 0.0.0.0/0 to port 3389"},{"status":"passed","code_desc":"Cloud Guard is enabled","run_time":0.000052,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Cloud Guard"},{"status":"passed","code_desc":"Cloud Guard detector rule \"VCN Security list allows traffic to non-public port from all sources (0.0.0.0/0)\" is enabled","run_time":0.000044,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Cloud Guard"},{"status":"passed","code_desc":"Cloud Guard detector rule \"VCN Security list allows traffic to non-public port from all sources (0.0.0.0/0)\" includes TCP and UDP port 3389","run_time":0.000078,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Cloud Guard"}],"status":"passed"},{"id":"2_3","title":"Ensure no network security groups allow ingress from 0.0.0.0/0 to port 22","desc":"Network security groups provide stateful filtering of ingress/egress network traffic to\nOCI resources. It is recommended that no security group allows unrestricted ingress to\nport 22. Removing unfettered connectivity to remote console services, such as Secure Shell\n(SSH), reduces a server's exposure to risk.","descriptions":[{"label":"default","data":"Network security groups provide stateful filtering of ingress/egress network traffic to\nOCI resources. It is recommended that no security group allows unrestricted ingress to\nport 22. Removing unfettered connectivity to remote console services, such as Secure Shell\n(SSH), reduces a server's exposure to risk."},{"label":"check","data":"From Console: Login into the OCI Console. Click the search bar at the top of the screen.\n\nType Advanced Resource Query and hit enter. Click the Advanced Resource Query button in\nthe upper right corner of the screen. Enter the following query in the query box: query\nnetworksecuritygroup resources where lifeCycleState = 'AVAILABLE' For each of the network\nsecurity groups in the returned results, click the name and inspect each of the security\nrules. Ensure that there are no security rules with direction: Ingress, Source: 0.0.0.0/0,\nand Destination Port Range: 22. From CLI: Issue the following command, it should return no\nvalues. for region in $(oci iam region-subscription list | jq -r '.data[] |\n.\"region-name\"') do echo \"Enumerating region $region\" for compid in $(oci iam compartment\nlist --include-root --compartment-id-in-subtree TRUE 2>/dev/null | jq -r '.data[] | .id')\ndo echo \"Enumerating compartment $compid\" for nsgid in $(oci network nsg list\n--compartment-id $compid --region $region --all 2>/dev/null | jq -r '.data[] | .id') do\noutput=$(oci network nsg rules list --nsg-id=$nsgid --all 2>/dev/null | jq -r '.data[] |\nselect(.source == \"0.0.0.0/0\" and .direction == \"INGRESS\" and\n((.\"tcp-options\".\"destination-port-range\".max >= 22 and\n.\"tcp-options\".\"destination-port-range\".min <= 22) or\n.\"tcp-options\".\"destination-port-range\" == null))') if [ ! -z \"$output\" ]; then echo\n\"NSGID: \", $nsgid, \"Security Rules: \", $output; fi done done done Cloud Guard: To Enable\nCloud Guard Auditing: Ensure Cloud Guard is enabled in the root compartment of the\ntenancy. For more information about enabling Cloud Guard, please look at the instructions\nincluded in Recommendation 3.15. From Console: Type Cloud Guard into the Search box at the\ntop of the Console . Click Cloud Guard from the Services submenu. Click Detector Recipes\nin the Cloud Guard menu. Click OCI Configuration Detector Recipe (Oracle Managed) under\nthe Recipe Name column. Find NSG ingress rule contains disallowed IP/port in the Detector\nRules column. Select the vertical ellipsis icon and chose Edit on the NSG ingress rule\ncontains disallowed IP/port row. In the Edit Detector Rule window find the Input Setting\nbox and verify/add to the Restricted Protocol: Ports List setting to TCP:[22], UDP:[22].\nClick the Save button. From CLI: Update the NSG ingress rule contains disallowed IP/port\nDetector Rule in Cloud Guard to generate Problems if a network security group allows\ningress network traffic to port 22 with the following command: oci cloud-guard\ndetector-recipe-detector-rule update --detector-recipe-id <insert detector recipe ocid>\n--detector-rule-id VCN_NSG_INGRESS_RULE_PORTS_CHECK --details '{\"configurations\":[\n{\"configKey\" : \"nsgIngressRuleDisallowedPortsConfig\", \"name\" : \"Default disallowed ports\",\n\"value\" : \"TCP:[22], UDP:[22]\", \"dataType\" : null, \"values\" : null }]}'"},{"label":"fix","data":"From Console: Login into the OCI Console. Click the search bar at the top of the screen.\n\nType Advanced Resource Query and hit enter. Click the Advanced Resource Query button in\nthe upper right corner of the screen. Enter the following query in the query box: query\nnetworksecuritygroup resources where lifeCycleState = 'AVAILABLE' For each of the network\nsecurity groups in the returned results, click the name and inspect each of the security\nrules. Remove all security rules with direction: Ingress, Source: 0.0.0.0/0, and\nDestination Port Range: 22. From CLI: Issue the following command and identify the\nsecurity rule to remove. for region in `oci iam region list | jq -r '.data[] | .name'`; do\nfor compid in `oci iam compartment list 2>/dev/null | jq -r '.data[] | .id'`; do for nsgid\nin `oci network nsg list --compartment-id $compid --region $region --all 2>/dev/null | jq\n-r '.data[] | .id'` do output=`oci network nsg rules list --nsg-id=$nsgid --all\n2>/dev/null | jq -r '.data[] | select(.source == \"0.0.0.0/0\" and .direction == \"INGRESS\"\nand ((.\"tcp-options\".\"destination-port-range\".max >= 22 and\n.\"tcp-options\".\"destination-port-range\".min <= 22) or\n.\"tcp-options\".\"destination-port-range\" == null))'` if [ ! -z \"$output\" ]; then echo\n\"NSGID=\", $nsgid, \"Security Rules=\", $output; fi done done done Remove the security rules\noci network nsg rules remove --nsg-id=<NSGID from audit output> or Update the security\nrules oci network nsg rules update --nsg-id=<NSGID from audit output>\n--security-rules='[<updated security-rules JSON (without isValid and TimrCreated\nfields)>]' eg: oci network nsg rules update\n--nsg-id=ocid1.networksecuritygroup.oc1.iad.xxxxxxxxxxxxxxxxxxxxxx --security-rules='[{\n\"description\": null, \"destination\": null, \"destination-type\": null, \"direction\":\n\n\"INGRESS\", \"icmp-options\": null, \"id\": \"709001\", \"is-stateless\": null, \"protocol\": \"6\",\n\"source\": \"140.238.154.0/24\", \"source-type\": \"CIDR_BLOCK\", \"tcp-options\": {\n\"destination-port-range\": { \"max\": 22, \"min\": 22 }, \"source-port-range\": null },\n\"udp-options\": null }]'"},{"label":"potential_impacts","data":"For updating an existing environment, care should be taken to ensure that administrators\ncurrently relying on an existing ingress from 0.0.0.0/0 have access to ports 22 and/or\n3389 through another network security group or security list."}],"impact":0.5,"refs":[],"tags":{"check_id":"C-2_3","severity":"medium","gid":"CIS-2_3","rid":"xccdf_cis_cis_rule_2_3","stig_id":"2.3","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-001097","CCI-001098","CCI-002395","CCI-002668","CCI-002669","CCI-001243","CCI-001184","CCI-000364","CCI-000366","CCI-000381"],"nist":["SC-7 a","SC-7 c","SC-7 b","SI-4 (11)","SI-4 (13) (c)","SI-3 c 2","SC-23","CM-6 a","CM-6 b","CM-7 a"]},"code":"control '2_3' do\n  title 'Ensure no network security groups allow ingress from 0.0.0.0/0 to port 22'\n\n  desc <<~DESC\n    Network security groups provide stateful filtering of ingress/egress network traffic to\n    OCI resources. It is recommended that no security group allows unrestricted ingress to\n    port 22. Removing unfettered connectivity to remote console services, such as Secure Shell\n    (SSH), reduces a server's exposure to risk.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Login into the OCI Console. Click the search bar at the top of the screen.\n\n    Type Advanced Resource Query and hit enter. Click the Advanced Resource Query button in\n    the upper right corner of the screen. Enter the following query in the query box: query\n    networksecuritygroup resources where lifeCycleState = 'AVAILABLE' For each of the network\n    security groups in the returned results, click the name and inspect each of the security\n    rules. Ensure that there are no security rules with direction: Ingress, Source: 0.0.0.0/0,\n    and Destination Port Range: 22. From CLI: Issue the following command, it should return no\n    values. for region in $(oci iam region-subscription list | jq -r '.data[] |\n    .\"region-name\"') do echo \"Enumerating region $region\" for compid in $(oci iam compartment\n    list --include-root --compartment-id-in-subtree TRUE 2>/dev/null | jq -r '.data[] | .id')\n    do echo \"Enumerating compartment $compid\" for nsgid in $(oci network nsg list\n    --compartment-id $compid --region $region --all 2>/dev/null | jq -r '.data[] | .id') do\n    output=$(oci network nsg rules list --nsg-id=$nsgid --all 2>/dev/null | jq -r '.data[] |\n    select(.source == \"0.0.0.0/0\" and .direction == \"INGRESS\" and\n    ((.\"tcp-options\".\"destination-port-range\".max >= 22 and\n    .\"tcp-options\".\"destination-port-range\".min <= 22) or\n    .\"tcp-options\".\"destination-port-range\" == null))') if [ ! -z \"$output\" ]; then echo\n    \"NSGID: \", $nsgid, \"Security Rules: \", $output; fi done done done Cloud Guard: To Enable\n    Cloud Guard Auditing: Ensure Cloud Guard is enabled in the root compartment of the\n    tenancy. For more information about enabling Cloud Guard, please look at the instructions\n    included in Recommendation 3.15. From Console: Type Cloud Guard into the Search box at the\n    top of the Console . Click Cloud Guard from the Services submenu. Click Detector Recipes\n    in the Cloud Guard menu. Click OCI Configuration Detector Recipe (Oracle Managed) under\n    the Recipe Name column. Find NSG ingress rule contains disallowed IP/port in the Detector\n    Rules column. Select the vertical ellipsis icon and chose Edit on the NSG ingress rule\n    contains disallowed IP/port row. In the Edit Detector Rule window find the Input Setting\n    box and verify/add to the Restricted Protocol: Ports List setting to TCP:[22], UDP:[22].\n    Click the Save button. From CLI: Update the NSG ingress rule contains disallowed IP/port\n    Detector Rule in Cloud Guard to generate Problems if a network security group allows\n    ingress network traffic to port 22 with the following command: oci cloud-guard\n    detector-recipe-detector-rule update --detector-recipe-id <insert detector recipe ocid>\n    --detector-rule-id VCN_NSG_INGRESS_RULE_PORTS_CHECK --details '{\"configurations\":[\n    {\"configKey\" : \"nsgIngressRuleDisallowedPortsConfig\", \"name\" : \"Default disallowed ports\",\n    \"value\" : \"TCP:[22], UDP:[22]\", \"dataType\" : null, \"values\" : null }]}'\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Login into the OCI Console. Click the search bar at the top of the screen.\n\n    Type Advanced Resource Query and hit enter. Click the Advanced Resource Query button in\n    the upper right corner of the screen. Enter the following query in the query box: query\n    networksecuritygroup resources where lifeCycleState = 'AVAILABLE' For each of the network\n    security groups in the returned results, click the name and inspect each of the security\n    rules. Remove all security rules with direction: Ingress, Source: 0.0.0.0/0, and\n    Destination Port Range: 22. From CLI: Issue the following command and identify the\n    security rule to remove. for region in `oci iam region list | jq -r '.data[] | .name'`; do\n    for compid in `oci iam compartment list 2>/dev/null | jq -r '.data[] | .id'`; do for nsgid\n    in `oci network nsg list --compartment-id $compid --region $region --all 2>/dev/null | jq\n    -r '.data[] | .id'` do output=`oci network nsg rules list --nsg-id=$nsgid --all\n    2>/dev/null | jq -r '.data[] | select(.source == \"0.0.0.0/0\" and .direction == \"INGRESS\"\n    and ((.\"tcp-options\".\"destination-port-range\".max >= 22 and\n    .\"tcp-options\".\"destination-port-range\".min <= 22) or\n    .\"tcp-options\".\"destination-port-range\" == null))'` if [ ! -z \"$output\" ]; then echo\n    \"NSGID=\", $nsgid, \"Security Rules=\", $output; fi done done done Remove the security rules\n    oci network nsg rules remove --nsg-id=<NSGID from audit output> or Update the security\n    rules oci network nsg rules update --nsg-id=<NSGID from audit output>\n    --security-rules='[<updated security-rules JSON (without isValid and TimrCreated\n    fields)>]' eg: oci network nsg rules update\n    --nsg-id=ocid1.networksecuritygroup.oc1.iad.xxxxxxxxxxxxxxxxxxxxxx --security-rules='[{\n    \"description\": null, \"destination\": null, \"destination-type\": null, \"direction\":\n\n    \"INGRESS\", \"icmp-options\": null, \"id\": \"709001\", \"is-stateless\": null, \"protocol\": \"6\",\n    \"source\": \"140.238.154.0/24\", \"source-type\": \"CIDR_BLOCK\", \"tcp-options\": {\n    \"destination-port-range\": { \"max\": 22, \"min\": 22 }, \"source-port-range\": null },\n    \"udp-options\": null }]'\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    For updating an existing environment, care should be taken to ensure that administrators\n    currently relying on an existing ingress from 0.0.0.0/0 have access to ports 22 and/or\n    3389 through another network security group or security list.\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-2_3'\n  tag severity: 'medium'\n  tag gid: 'CIS-2_3'\n  tag rid: 'xccdf_cis_cis_rule_2_3'\n  tag stig_id: '2.3'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-001097',\n    'CCI-001098',\n    'CCI-002395',\n    'CCI-002668',\n    'CCI-002669',\n    'CCI-001243',\n    'CCI-001184',\n    'CCI-000364',\n    'CCI-000366',\n    'CCI-000381'\n  ]\n\n  tag nist: [\n    'SC-7 a',\n    'SC-7 c',\n    'SC-7 b',\n    'SI-4 (11)',\n    'SI-4 (13) (c)',\n    'SI-3 c 2',\n    'SC-23',\n    'CM-6 a',\n    'CM-6 b',\n    'CM-7 a'\n  ]\n\n  cmd = <<~CMD\n    (\n      for region in $(oci iam region-subscription list | jq -r '.data[] | .\"region-name\"')\n      do\n        for compid in $(oci iam compartment list --include-root --compartment-id-in-subtree TRUE 2>/dev/null | jq -r '.data[] | .id')\n        do\n          for nsgid in $(oci network nsg list --compartment-id $compid --region $region --all 2>/dev/null | jq -r '.data[] | .id')\n          do\n            output=$(oci network nsg rules list --nsg-id=$nsgid --all 2>/dev/null | jq -r '.data[] | select(.source == \"0.0.0.0/0\" and .direction== \"INGRESS\" and ((.\"tcp-options\".\"destination-port-range\".max >= 22 and.\"tcp-options\".\"destination-port-range\".min <= 22) or .\"tcp-options\".\"destination-port-range\" == null))')\n            if [ ! -z \"$output\" ]; then echo \"NSGID: \", $nsgid, \"SecurityRules: \", $output; fi\n          done\n        done\n      done\n    ) | jq -nR '[inputs]'\n  CMD\n\n  json_output = json(command: cmd)\n  output = json_output.params\n\n  describe 'Ensure no network security groups allow ingress from 0.0.0.0/0 to port 22' do\n    subject { output }\n    it { should be_empty }\n  end\n\n  cloud_guard_check = input('cloud_guard_check')\n  detector_recipe_ocid = input('detector_recipe_ocid')\n\n  if cloud_guard_check\n    tenancy_ocid = input('tenancy_ocid')\n    cloud_guard = cloud_guard_helper(tenancy_ocid: tenancy_ocid, detector_recipe_ocid: detector_recipe_ocid)\n    cloud_guard_status = cloud_guard.status\n    cloud_guard_output = cloud_guard.detector_rule_value(rule_id: 'VCN_NSG_INGRESS_RULE_PORTS_CHECK', config_key: 'nsgIngressRuleDisallowedPortsConfig')\n    cloud_guard_rule_enabled = cloud_guard.detector_rule_enabled?(rule_id: 'VCN_NSG_INGRESS_RULE_PORTS_CHECK')\n  end\n\n  describe 'Cloud Guard' do\n    if cloud_guard_check\n      it 'is enabled' do\n        expect(cloud_guard_status).to cmp 'ENABLED'\n      end\n\n      it 'detector rule \"NSG ingress rule contains disallowed IP/port\" is enabled' do\n        expect(cloud_guard_rule_enabled).to cmp true\n      end\n\n      it 'detector rule \"NSG ingress rule contains disallowed IP/port\" includes TCP and UDP port 22' do\n        expect(cloud_guard.port_list_check?(config_value: cloud_guard_output, protocol: 'TCP', port: 22)).to cmp true\n        expect(cloud_guard.port_list_check?(config_value: cloud_guard_output, protocol: 'UDP', port: 22)).to cmp true\n      end\n    else\n      skip 'Cloud Guard check skipped. cloud_guard_check is set to false.'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"./controls/2_3.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Ensure no network security groups allow ingress from 0.0.0.0/0 to port 22 is expected to be empty","run_time":0.001055,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Ensure no network security groups allow ingress from 0.0.0.0/0 to port 22"},{"status":"passed","code_desc":"Cloud Guard is enabled","run_time":0.000047,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Cloud Guard"},{"status":"passed","code_desc":"Cloud Guard detector rule \"NSG ingress rule contains disallowed IP/port\" is enabled","run_time":0.000042,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Cloud Guard"},{"status":"passed","code_desc":"Cloud Guard detector rule \"NSG ingress rule contains disallowed IP/port\" includes TCP and UDP port 22","run_time":0.000102,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Cloud Guard"}],"status":"passed"},{"id":"2_4","title":"Ensure no network security groups allow ingress from 0.0.0.0/0 to port 3389","desc":"Network security groups provide stateful filtering of ingress/egress network traffic to\nOCI resources. It is recommended that no security group allows unrestricted ingress access\nto port 3389. Removing unfettered connectivity to remote console services, such as Remote\nDesktop Protocol (RDP), reduces a server's exposure to risk.","descriptions":[{"label":"default","data":"Network security groups provide stateful filtering of ingress/egress network traffic to\nOCI resources. It is recommended that no security group allows unrestricted ingress access\nto port 3389. Removing unfettered connectivity to remote console services, such as Remote\nDesktop Protocol (RDP), reduces a server's exposure to risk."},{"label":"check","data":"From CLI: Issue the following command, it should not return anything. for region in $(oci\n\niam region-subscription list | jq -r '.data[] | .\"region-name\"') do echo \"Enumerating\nregion $region\" for compid in $(oci iam compartment list --include-root\n--compartment-id-in-subtree TRUE 2>/dev/null | jq -r '.data[] | .id') do echo \"Enumerating\ncompartment $compid\" for nsgid in $(oci network nsg list --compartment-id $compid --region\n$region --all 2>/dev/null | jq -r '.data[] | .id') do output=$(oci network nsg rules list\n--nsg-id=$nsgid --all 2>/dev/null | jq -r '.data[] | select(.source == \"0.0.0.0/0\" and\n.direction == \"INGRESS\" and ((.\"tcp-options\".\"destination-port-range\".max >= 3389 and\n.\"tcp-options\".\"destination-port-range\".min <= 3389) or\n.\"tcp-options\".\"destination-port-range\" == null))') if [ ! -z \"$output\" ]; then echo\n\"NSGID: \", $nsgid, \"Security Rules: \", $output; fi done done done From Cloud Guard: To\nEnable Cloud Guard Auditing: Ensure Cloud Guard is enabled in the root compartment of the\ntenancy. For more information about enabling Cloud Guard, please look at the instructions\nincluded in Recommendation 3.15. From Console: Type Cloud Guard into the Search box at the\ntop of the Console. Click Cloud Guard from the Services submenu. Click Detector Recipes\nin the Cloud Guard menu. Click OCI Configuration Detector Recipe (Oracle Managed) under\nthe Recipe Name column. Find NSG ingress rule contains disallowed IP/port in the Detector\nRules column. Select the vertical ellipsis icon and chose Edit on the NSG ingress rule\ncontains disallowed IP/port row. In the Edit Detector Rule window find the Input Setting\nbox and verify/add to the Restricted Protocol: Ports List setting to TCP:[3389],\nUDP:[3389]. Click the Save button. From CLI: Update the NSG ingress rule contains\ndisallowed IP/port Detector Rule in Cloud Guard to generate Problems if a network security\ngroup allows ingress network traffic to port 3389 with the following command: oci\ncloud-guard detector-recipe-detector-rule update --detector-recipe-id <insert detector\nrecipe ocid> --detector-rule-id VCN_NSG_INGRESS_RULE_PORTS_CHECK --details\n'{\"configurations\":[ {\"configKey\" : \"nsgIngressRuleDisallowedPortsConfig\", \"name\" :\n\n\"Default disallowed ports\", \"value\" : \"TCP:[3389], UDP:[3389]\", \"dataType\" : null,\n\"values\" : null }]}'"},{"label":"fix","data":"From CLI: Using the details returned from the audit procedure either: Remove the security\n\nrules oci network nsg rules remove --nsg-id=<NSGID from audit output> or Update the\nsecurity rules oci network nsg rules update --nsg-id=<NSGID from audit output>\n--security-rules=<updated security-rules JSON (without the isValid or TimeCreated fields)>\neg: oci network nsg rules update\n--nsg-id=ocid1.networksecuritygroup.oc1.iad.xxxxxxxxxxxxxxxxxxxxxx --security-rules='[{\n\"description\": null, \"destination\": null, \"destination-type\": null, \"direction\":\n\n\"INGRESS\", \"icmp-options\": null, \"id\": \"709001\", \"is-stateless\": null, \"protocol\": \"6\",\n\"source\": \"140.238.154.0/24\", \"source-type\": \"CIDR_BLOCK\", \"tcp-options\": {\n\"destination-port-range\": { \"max\": 3389, \"min\": 3389 }, \"source-port-range\": null },\n\"udp-options\": null }]'"},{"label":"potential_impacts","data":"For updating an existing environment, care should be taken to ensure that administrators\ncurrently relying on an existing ingress from 0.0.0.0/0 have access to ports 22 and/or\n3389 through another network security group or security list."}],"impact":0.5,"refs":[],"tags":{"check_id":"C-2_4","severity":"medium","gid":"CIS-2_4","rid":"xccdf_cis_cis_rule_2_4","stig_id":"2.4","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-001097","CCI-001098","CCI-002395","CCI-002668","CCI-002669","CCI-001243","CCI-001184","CCI-000364","CCI-000366","CCI-000381"],"nist":["SC-7 a","SC-7 c","SC-7 b","SI-4 (11)","SI-4 (13) (c)","SI-3 c 2","SC-23","CM-6 a","CM-6 b","CM-7 a"]},"code":"control '2_4' do\n  title 'Ensure no network security groups allow ingress from 0.0.0.0/0 to port 3389'\n\n  desc <<~DESC\n    Network security groups provide stateful filtering of ingress/egress network traffic to\n    OCI resources. It is recommended that no security group allows unrestricted ingress access\n    to port 3389. Removing unfettered connectivity to remote console services, such as Remote\n    Desktop Protocol (RDP), reduces a server's exposure to risk.\n  DESC\n\n  desc 'check', <<~CHECK\n    From CLI: Issue the following command, it should not return anything. for region in $(oci\n\n    iam region-subscription list | jq -r '.data[] | .\"region-name\"') do echo \"Enumerating\n    region $region\" for compid in $(oci iam compartment list --include-root\n    --compartment-id-in-subtree TRUE 2>/dev/null | jq -r '.data[] | .id') do echo \"Enumerating\n    compartment $compid\" for nsgid in $(oci network nsg list --compartment-id $compid --region\n    $region --all 2>/dev/null | jq -r '.data[] | .id') do output=$(oci network nsg rules list\n    --nsg-id=$nsgid --all 2>/dev/null | jq -r '.data[] | select(.source == \"0.0.0.0/0\" and\n    .direction == \"INGRESS\" and ((.\"tcp-options\".\"destination-port-range\".max >= 3389 and\n    .\"tcp-options\".\"destination-port-range\".min <= 3389) or\n    .\"tcp-options\".\"destination-port-range\" == null))') if [ ! -z \"$output\" ]; then echo\n    \"NSGID: \", $nsgid, \"Security Rules: \", $output; fi done done done From Cloud Guard: To\n    Enable Cloud Guard Auditing: Ensure Cloud Guard is enabled in the root compartment of the\n    tenancy. For more information about enabling Cloud Guard, please look at the instructions\n    included in Recommendation 3.15. From Console: Type Cloud Guard into the Search box at the\n    top of the Console. Click Cloud Guard from the Services submenu. Click Detector Recipes\n    in the Cloud Guard menu. Click OCI Configuration Detector Recipe (Oracle Managed) under\n    the Recipe Name column. Find NSG ingress rule contains disallowed IP/port in the Detector\n    Rules column. Select the vertical ellipsis icon and chose Edit on the NSG ingress rule\n    contains disallowed IP/port row. In the Edit Detector Rule window find the Input Setting\n    box and verify/add to the Restricted Protocol: Ports List setting to TCP:[3389],\n    UDP:[3389]. Click the Save button. From CLI: Update the NSG ingress rule contains\n    disallowed IP/port Detector Rule in Cloud Guard to generate Problems if a network security\n    group allows ingress network traffic to port 3389 with the following command: oci\n    cloud-guard detector-recipe-detector-rule update --detector-recipe-id <insert detector\n    recipe ocid> --detector-rule-id VCN_NSG_INGRESS_RULE_PORTS_CHECK --details\n    '{\"configurations\":[ {\"configKey\" : \"nsgIngressRuleDisallowedPortsConfig\", \"name\" :\n\n    \"Default disallowed ports\", \"value\" : \"TCP:[3389], UDP:[3389]\", \"dataType\" : null,\n    \"values\" : null }]}'\n  CHECK\n\n  desc 'fix', <<~FIX\n    From CLI: Using the details returned from the audit procedure either: Remove the security\n\n    rules oci network nsg rules remove --nsg-id=<NSGID from audit output> or Update the\n    security rules oci network nsg rules update --nsg-id=<NSGID from audit output>\n    --security-rules=<updated security-rules JSON (without the isValid or TimeCreated fields)>\n    eg: oci network nsg rules update\n    --nsg-id=ocid1.networksecuritygroup.oc1.iad.xxxxxxxxxxxxxxxxxxxxxx --security-rules='[{\n    \"description\": null, \"destination\": null, \"destination-type\": null, \"direction\":\n\n    \"INGRESS\", \"icmp-options\": null, \"id\": \"709001\", \"is-stateless\": null, \"protocol\": \"6\",\n    \"source\": \"140.238.154.0/24\", \"source-type\": \"CIDR_BLOCK\", \"tcp-options\": {\n    \"destination-port-range\": { \"max\": 3389, \"min\": 3389 }, \"source-port-range\": null },\n    \"udp-options\": null }]'\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    For updating an existing environment, care should be taken to ensure that administrators\n    currently relying on an existing ingress from 0.0.0.0/0 have access to ports 22 and/or\n    3389 through another network security group or security list.\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-2_4'\n  tag severity: 'medium'\n  tag gid: 'CIS-2_4'\n  tag rid: 'xccdf_cis_cis_rule_2_4'\n  tag stig_id: '2.4'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-001097',\n    'CCI-001098',\n    'CCI-002395',\n    'CCI-002668',\n    'CCI-002669',\n    'CCI-001243',\n    'CCI-001184',\n    'CCI-000364',\n    'CCI-000366',\n    'CCI-000381'\n  ]\n\n  tag nist: [\n    'SC-7 a',\n    'SC-7 c',\n    'SC-7 b',\n    'SI-4 (11)',\n    'SI-4 (13) (c)',\n    'SI-3 c 2',\n    'SC-23',\n    'CM-6 a',\n    'CM-6 b',\n    'CM-7 a'\n  ]\n\n  cmd = <<~CMD\n    (\n      for region in $(oci iam region-subscription list | jq -r '.data[] |.\"region-name\"')\n      do\n          for compid in $(oci iam compartment list --include-root --compartment-id-in-subtree TRUE 2>/dev/null | jq -r '.data[] | .id')\n          do\n            for nsgid in $(oci network nsg list --compartment-id $compid --region $region --all 2>/dev/null | jq -r '.data[] | .id')\n            do\n              output=$(oci network nsg rules list --nsg-id=$nsgid --all 2>/dev/null | jq -r '.data[] | select(.source == \"0.0.0.0/0\" and .direction== \"INGRESS\" and ((.\"tcp-options\".\"destination-port-range\".max >= 3389 and.\"tcp-options\".\"destination-port-range\".min <= 3389) or .\"tcp-options\".\"destination-port-range\" == null))')\n              if [ ! -z \"$output\" ]; then echo \"NSGID: \", $nsgid, \"SecurityRules: \", $output; fi\n          done\n        done\n      done\n    ) | jq -nR '[inputs]'\n  CMD\n\n  json_output = json(command: cmd)\n  output = json_output.params\n\n  describe 'Ensure no network security groups allow ingress from 0.0.0.0/0 to port 3389' do\n    subject { output }\n    it { should be_empty }\n  end\n\n  cloud_guard_check = input('cloud_guard_check')\n  detector_recipe_ocid = input('detector_recipe_ocid')\n\n  if cloud_guard_check\n    tenancy_ocid = input('tenancy_ocid')\n    cloud_guard = cloud_guard_helper(tenancy_ocid: tenancy_ocid, detector_recipe_ocid: detector_recipe_ocid)\n    cloud_guard_status = cloud_guard.status\n    cloud_guard_output = cloud_guard.detector_rule_value(rule_id: 'VCN_NSG_INGRESS_RULE_PORTS_CHECK', config_key: 'nsgIngressRuleDisallowedPortsConfig')\n    cloud_guard_rule_enabled = cloud_guard.detector_rule_enabled?(rule_id: 'VCN_NSG_INGRESS_RULE_PORTS_CHECK')\n  end\n\n  describe 'Cloud Guard' do\n    if cloud_guard_check\n      it 'is enabled' do\n        expect(cloud_guard_status).to cmp 'ENABLED'\n      end\n\n      it 'detector rule \"NSG ingress rule contains disallowed IP/port\" is enabled' do\n        expect(cloud_guard_rule_enabled).to cmp true\n      end\n\n      it 'detector rule \"NSG ingress rule contains disallowed IP/port\" includes TCP and UDP port 3389' do\n        expect(cloud_guard.port_list_check?(config_value: cloud_guard_output, protocol: 'TCP', port: 3389)).to cmp true\n        expect(cloud_guard.port_list_check?(config_value: cloud_guard_output, protocol: 'UDP', port: 3389)).to cmp true\n      end\n    else\n      skip 'Cloud Guard check skipped. cloud_guard_check is set to false.'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"./controls/2_4.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"Ensure no network security groups allow ingress from 0.0.0.0/0 to port 3389 is expected to be empty","run_time":0.001196,"start_time":"2026-01-28T09:26:55-05:00","message":"expected `[\"NSGID: , ocid1.networksecuritygroup.oc1.iad.aaaaaaaa6no7mxmzyq57en4d5kurhfvlk3vgi3xpnwgimtu2fxpm2is...\\\"min\\\": 3389 } }, \\\"time-created\\\": \\\"2025-12-18T18:17:04.086000+00:00\\\", \\\"udp-options\\\": null }\"].empty?` to be truthy, got false","resource_class":"Object","resource_params":"[]","resource_id":"Ensure no network security groups allow ingress from 0.0.0.0/0 to port 3389"},{"status":"passed","code_desc":"Cloud Guard is enabled","run_time":0.000044,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Cloud Guard"},{"status":"passed","code_desc":"Cloud Guard detector rule \"NSG ingress rule contains disallowed IP/port\" is enabled","run_time":0.000045,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Cloud Guard"},{"status":"passed","code_desc":"Cloud Guard detector rule \"NSG ingress rule contains disallowed IP/port\" includes TCP and UDP port 3389","run_time":0.000093,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Cloud Guard"}],"status":"failed"},{"id":"2_5","title":"Ensure the default security list of every VCN restricts all traffic except ICMP within VCN","desc":"A default security list is created when a Virtual Cloud Network (VCN) is created and\nattached to the public subnets in the VCN. Security lists provide stateful or stateless\nfiltering of ingress and egress network traffic to OCI resources in the VCN. It is\nrecommended that the default security list does not allow unrestricted ingress and egress\naccess to resources in the VCN. Removing unfettered connectivity to OCI resource, reduces\na server's exposure to unauthorized access or data exfiltration.","descriptions":[{"label":"default","data":"A default security list is created when a Virtual Cloud Network (VCN) is created and\nattached to the public subnets in the VCN. Security lists provide stateful or stateless\nfiltering of ingress and egress network traffic to OCI resources in the VCN. It is\nrecommended that the default security list does not allow unrestricted ingress and egress\naccess to resources in the VCN. Removing unfettered connectivity to OCI resource, reduces\na server's exposure to unauthorized access or data exfiltration."},{"label":"check","data":"From Console: Login into the OCI Console Click on Networking -> Virtual Cloud Networks\n\nfrom the services menu For each VCN listed Click on Security Lists Click on Default\nSecurity List for <VCN Name> Verify that there is no Ingress rule with 'Source 0.0.0.0/0'\nVerify that there is no Egress rule with 'Destination 0.0.0.0/0, All Protocols'"},{"label":"fix","data":"From Console: Login into the OCI Console Click on Networking -> Virtual Cloud Networks\n\nfrom the services menu For each VCN listed Click on Security Lists Click on Default\nSecurity List for <VCN Name> Identify the Ingress Rule with 'Source 0.0.0.0/0' Either Edit\nthe Security rule to restrict the source and/or port range or delete the rule. Identify\nthe Egress Rule with 'Destination 0.0.0.0/0, All Protocols' Either Edit the Security rule\nto restrict the source and/or port range or delete the rule."},{"label":"potential_impacts","data":"For updating an existing environment, care should be taken to ensure that administrators\ncurrently relying on an existing ingress from 0.0.0.0/0 have access to port 22 through\nanother network security group and servers have egress to specified ports and protocols\nthrough another network security group."}],"impact":0.5,"refs":[],"tags":{"check_id":"C-2_5","severity":"medium","gid":"CIS-2_5","rid":"xccdf_cis_cis_rule_2_5","stig_id":"2.5","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-002668","CCI-002669","CCI-001243","CCI-001184","CCI-000364","CCI-000366","CCI-000381"],"nist":["SI-4 (11)","SI-4 (13) (c)","SI-3 c 2","SC-23","CM-6 a","CM-6 b","CM-7 a"]},"code":"control '2_5' do\n  title 'Ensure the default security list of every VCN restricts all traffic except ICMP within VCN'\n\n  desc <<~DESC\n    A default security list is created when a Virtual Cloud Network (VCN) is created and\n    attached to the public subnets in the VCN. Security lists provide stateful or stateless\n    filtering of ingress and egress network traffic to OCI resources in the VCN. It is\n    recommended that the default security list does not allow unrestricted ingress and egress\n    access to resources in the VCN. Removing unfettered connectivity to OCI resource, reduces\n    a server's exposure to unauthorized access or data exfiltration.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Login into the OCI Console Click on Networking -> Virtual Cloud Networks\n\n    from the services menu For each VCN listed Click on Security Lists Click on Default\n    Security List for <VCN Name> Verify that there is no Ingress rule with 'Source 0.0.0.0/0'\n    Verify that there is no Egress rule with 'Destination 0.0.0.0/0, All Protocols'\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Login into the OCI Console Click on Networking -> Virtual Cloud Networks\n\n    from the services menu For each VCN listed Click on Security Lists Click on Default\n    Security List for <VCN Name> Identify the Ingress Rule with 'Source 0.0.0.0/0' Either Edit\n    the Security rule to restrict the source and/or port range or delete the rule. Identify\n    the Egress Rule with 'Destination 0.0.0.0/0, All Protocols' Either Edit the Security rule\n    to restrict the source and/or port range or delete the rule.\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    For updating an existing environment, care should be taken to ensure that administrators\n    currently relying on an existing ingress from 0.0.0.0/0 have access to port 22 through\n    another network security group and servers have egress to specified ports and protocols\n    through another network security group.\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-2_5'\n  tag severity: 'medium'\n  tag gid: 'CIS-2_5'\n  tag rid: 'xccdf_cis_cis_rule_2_5'\n  tag stig_id: '2.5'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-002668',\n    'CCI-002669',\n    'CCI-001243',\n    'CCI-001184',\n    'CCI-000364',\n    'CCI-000366',\n    'CCI-000381'\n  ]\n\n  tag nist: [\n    'SI-4 (11)',\n    'SI-4 (13) (c)',\n    'SI-3 c 2',\n    'SC-23',\n    'CM-6 a',\n    'CM-6 b',\n    'CM-7 a'\n  ]\n\n  regions_response = json(command: 'oci iam region-subscription list --all')\n  regions_data = regions_response.params.fetch('data', [])\n  regions = regions_data.map { |region| region['region-name'] }.compact\n\n  compartments_response = json(command: 'oci iam compartment list --include-root --compartment-id-in-subtree TRUE 2>/dev/null')\n  compartments_data = compartments_response.params.fetch('data', [])\n  compartments = compartments_data.map { |compartment| compartment['id'] }.compact\n\n  security_list_findings = []\n\n  regions.each do |region|\n    compartments.each do |compartment_id|\n      vcns_response = json(\n        command: %(oci network vcn list --compartment-id \"#{compartment_id}\" --region \"#{region}\" --all 2>/dev/null)\n      )\n      vcns = vcns_response.params.fetch('data', [])\n\n      vcns.each do |vcn|\n        security_list_id = vcn['default-security-list-id']\n        next if security_list_id.to_s.strip.empty?\n\n        security_list_check_cmd = %(\n          oci network security-list get --security-list-id \"#{security_list_id}\" --region \"#{region}\" |\n          jq '{ bad_ingress: [.data[\"ingress-security-rules\"][]? | select(.source==\"0.0.0.0/0\")],\n                bad_egress:  [.data[\"egress-security-rules\"][]? | select(.destination==\"0.0.0.0/0\" and (.protocol|ascii_downcase)==\"all\")] }'\n        )\n        security_list_check = json(command: security_list_check_cmd).params\n        bad_ingress = security_list_check['bad_ingress'] || []\n        bad_egress = security_list_check['bad_egress'] || []\n\n        next if bad_ingress.empty? && bad_egress.empty?\n\n        security_list_findings << {\n          'vcn_name' => vcn['display-name'],\n          'region' => region\n        }\n      end\n    end\n  end\n\n  describe 'Ensure the default security list of every VCN restricts all traffic except ICMP within VCN' do\n    subject { security_list_findings }\n    it { should be_empty }\n  end\nend\n","source_location":{"line":1,"ref":"./controls/2_5.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"Ensure the default security list of every VCN restricts all traffic except ICMP within VCN is expected to be empty","run_time":0.001031,"start_time":"2026-01-28T09:26:55-05:00","message":"expected `[{\"region\"=>\"us-ashburn-1\", \"vcn_name\"=>\"saf-virtual-cloud-1\"}].empty?` to be truthy, got false","resource_class":"Object","resource_params":"[]","resource_id":"Ensure the default security list of every VCN restricts all traffic except ICMP within VCN"}],"status":"failed"},{"id":"2_6","title":"Ensure Oracle Integration Cloud (OIC) access is restricted to allowed sources.","desc":"Oracle Integration (OIC) is a complete, secure, but lightweight integration solution that\nenables you to connect your applications in the cloud. It simplifies connectivity between\nyour applications and connects both your applications that live in the cloud and your\napplications that still live on premises. Oracle Integration provides secure,\nenterprise-grade connectivity regardless of the applications you are connecting or where\nthey reside. OIC instances are created within an Oracle managed secure private network\nwith each having a public endpoint. The capability to configure ingress filtering of\nnetwork traffic to protect your OIC instances from unauthorized network access is\nincluded. It is recommended that network access to your OIC instances be restricted to\nyour approved corporate IP Addresses or Virtual Cloud Networks (VCN)s. Restricting\nconnectivity to OIC Instances reduces an OIC instances exposure to risk.","descriptions":[{"label":"default","data":"Oracle Integration (OIC) is a complete, secure, but lightweight integration solution that\nenables you to connect your applications in the cloud. It simplifies connectivity between\nyour applications and connects both your applications that live in the cloud and your\napplications that still live on premises. Oracle Integration provides secure,\nenterprise-grade connectivity regardless of the applications you are connecting or where\nthey reside. OIC instances are created within an Oracle managed secure private network\nwith each having a public endpoint. The capability to configure ingress filtering of\nnetwork traffic to protect your OIC instances from unauthorized network access is\nincluded. It is recommended that network access to your OIC instances be restricted to\nyour approved corporate IP Addresses or Virtual Cloud Networks (VCN)s. Restricting\nconnectivity to OIC Instances reduces an OIC instances exposure to risk."},{"label":"check","data":"From Console: Login into the OCI Console Click in the search bar, top of the screen. Type\n\nAdvanced Resource Query and hit enter. Click the Advanced Resource Query button in the\nupper right of the screen. Enter the following query in the query box: query\nintegrationinstance resources For each OIC Instance returned click on the link under\nDisplay name Click on Network Access 8 .Ensure Restrict Network Access is selected and the\nIP Address/CIDR Block as well as Virtual Cloud Networks are correct Repeat for other\nsubscribed regions From CLI: Execute the following command: for region in `oci iam region\nlist | jq -r '.data[] | .name'`; do for compid in `oci iam compartment list\n--compartment-id-in-subtree TRUE 2>/dev/null | jq -r '.data[] | .id'` do output=`oci\nintegration integration-instance list --compartment-id $compid --region $region --all\n2>/dev/null | jq -r '.data[] | select(.\"network-endpoint-details\".\"network-endpoint-type\"\n== null)'` if [ ! -z \"$output\" ]; then echo $output; fi done done Ensure\nallowlisted-http-ips and allowed-http-vcns are correct"},{"label":"fix","data":"From Console: Follow the audit procedure above. For each OIC instance in the returned\n\nresults, click the OIC Instance name Click Network Access Either edit the Network Access\nto be more restrictive From CLI Follow the audit procedure. Get the json input format\nusing the below command: oci integration integration-instance change-network-endpoint\n--generate-param-json-input 3.For each of the OIC Instances identified get its details.\n4.Update the Network Access , copy the network-endpoint-details element from the JSON\nreturned by the above get call, edit it appropriately and use it in the following command\nOci integration integration-instance change-network-endpoint --id <oic-instance-id>\n--from-json '<network endpoints JSON>'"},{"label":"potential_impacts","data":"When updating ingress filters for an existing environment, care should be taken to ensure\nthat IP addresses and VCNs currently used by administrators, users, and services to access\nyour OIC instances are included in the updated filters."}],"impact":0.5,"refs":[],"tags":{"check_id":"C-2_6","severity":"medium","gid":"CIS-2_6","rid":"xccdf_cis_cis_rule_2_6","stig_id":"2.6","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-001097","CCI-001098","CCI-002395","CCI-002668","CCI-002669","CCI-001243","CCI-001184","CCI-000364","CCI-000366","CCI-000381"],"nist":["SC-7 a","SC-7 c","SC-7 b","SI-4 (11)","SI-4 (13) (c)","SI-3 c 2","SC-23","CM-6 a","CM-6 b","CM-7 a"]},"code":"control '2_6' do\n  title 'Ensure Oracle Integration Cloud (OIC) access is restricted to allowed sources.'\n\n  desc <<~DESC\n    Oracle Integration (OIC) is a complete, secure, but lightweight integration solution that\n    enables you to connect your applications in the cloud. It simplifies connectivity between\n    your applications and connects both your applications that live in the cloud and your\n    applications that still live on premises. Oracle Integration provides secure,\n    enterprise-grade connectivity regardless of the applications you are connecting or where\n    they reside. OIC instances are created within an Oracle managed secure private network\n    with each having a public endpoint. The capability to configure ingress filtering of\n    network traffic to protect your OIC instances from unauthorized network access is\n    included. It is recommended that network access to your OIC instances be restricted to\n    your approved corporate IP Addresses or Virtual Cloud Networks (VCN)s. Restricting\n    connectivity to OIC Instances reduces an OIC instances exposure to risk.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Login into the OCI Console Click in the search bar, top of the screen. Type\n\n    Advanced Resource Query and hit enter. Click the Advanced Resource Query button in the\n    upper right of the screen. Enter the following query in the query box: query\n    integrationinstance resources For each OIC Instance returned click on the link under\n    Display name Click on Network Access 8 .Ensure Restrict Network Access is selected and the\n    IP Address/CIDR Block as well as Virtual Cloud Networks are correct Repeat for other\n    subscribed regions From CLI: Execute the following command: for region in `oci iam region\n    list | jq -r '.data[] | .name'`; do for compid in `oci iam compartment list\n    --compartment-id-in-subtree TRUE 2>/dev/null | jq -r '.data[] | .id'` do output=`oci\n    integration integration-instance list --compartment-id $compid --region $region --all\n    2>/dev/null | jq -r '.data[] | select(.\"network-endpoint-details\".\"network-endpoint-type\"\n    == null)'` if [ ! -z \"$output\" ]; then echo $output; fi done done Ensure\n    allowlisted-http-ips and allowed-http-vcns are correct\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Follow the audit procedure above. For each OIC instance in the returned\n\n    results, click the OIC Instance name Click Network Access Either edit the Network Access\n    to be more restrictive From CLI Follow the audit procedure. Get the json input format\n    using the below command: oci integration integration-instance change-network-endpoint\n    --generate-param-json-input 3.For each of the OIC Instances identified get its details.\n    4.Update the Network Access , copy the network-endpoint-details element from the JSON\n    returned by the above get call, edit it appropriately and use it in the following command\n    Oci integration integration-instance change-network-endpoint --id <oic-instance-id>\n    --from-json '<network endpoints JSON>'\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    When updating ingress filters for an existing environment, care should be taken to ensure\n    that IP addresses and VCNs currently used by administrators, users, and services to access\n    your OIC instances are included in the updated filters.\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-2_6'\n  tag severity: 'medium'\n  tag gid: 'CIS-2_6'\n  tag rid: 'xccdf_cis_cis_rule_2_6'\n  tag stig_id: '2.6'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-001097',\n    'CCI-001098',\n    'CCI-002395',\n    'CCI-002668',\n    'CCI-002669',\n    'CCI-001243',\n    'CCI-001184',\n    'CCI-000364',\n    'CCI-000366',\n    'CCI-000381'\n  ]\n\n  tag nist: [\n    'SC-7 a',\n    'SC-7 c',\n    'SC-7 b',\n    'SI-4 (11)',\n    'SI-4 (13) (c)',\n    'SI-3 c 2',\n    'SC-23',\n    'CM-6 a',\n    'CM-6 b',\n    'CM-7 a'\n  ]\n\n  cmd = <<~CMD\n    (\n      for region in `oci iam region-subscription list --all| jq -r '.data[] | .\"region-name\"'`;\n      do\n        for compid in `oci iam compartment list --include-root --compartment-id-in-subtree TRUE 2>/dev/null | jq -r '.data[] | .id'`\n        do\n          output=`oci integration integration-instance list --compartment-id $compid --region $region --all 2>/dev/null | jq -r '.data[] |select(.\"network-endpoint-details\".\"network-endpoint-type\" == null)'`\n          if [ ! -z \"$output\" ]; then echo $output; fi\n        done\n      done\n    ) | jq -nR '[inputs]'\n  CMD\n\n  json_output = json(command: cmd)\n  output = json_output.params\n\n  describe 'Ensure Oracle Integration Cloud (OIC) access is restricted to allowed sources' do\n    subject { output }\n    it { should be_empty }\n  end\nend\n","source_location":{"line":1,"ref":"./controls/2_6.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"Ensure Oracle Integration Cloud (OIC) access is restricted to allowed sources is expected to be empty","run_time":0.001021,"start_time":"2026-01-28T09:26:55-05:00","message":"expected `[\"{ \\\"alternate-custom-endpoints\\\": null, \\\"compartment-id\\\": \\\"ocid1.compartment.oc1..aaaaaaaabee6ga...\\\": \\\"2026-01-08T18:46:08.207000+00:00\\\", \\\"time-updated\\\": \\\"2026-01-08T18:46:08.207000+00:00\\\" }\"].empty?` to be truthy, got false","resource_class":"Object","resource_params":"[]","resource_id":"Ensure Oracle Integration Cloud (OIC) access is restricted to allowed sources"}],"status":"failed"},{"id":"2_7","title":"Ensure Oracle Analytics Cloud (OAC) access is restricted to allowed sources or deployed within a Virtual Cloud Network.","desc":"Oracle Analytics Cloud (OAC) is a scalable and secure public cloud service that provides a\nfull set of capabilities to explore and perform collaborative analytics for you, your\nworkgroup, and your enterprise. OAC instances provide ingress filtering of network traffic\nor can be deployed with in an existing Virtual Cloud Network VCN. It is recommended that\nall new OAC instances be deployed within a VCN and that the Access Control Rules are\nrestricted to your corporate IP Addresses or VCNs for existing OAC instances. Restricting\nconnectivity to Oracle Analytics Cloud instances reduces an OAC instances exposure to\nrisk.","descriptions":[{"label":"default","data":"Oracle Analytics Cloud (OAC) is a scalable and secure public cloud service that provides a\nfull set of capabilities to explore and perform collaborative analytics for you, your\nworkgroup, and your enterprise. OAC instances provide ingress filtering of network traffic\nor can be deployed with in an existing Virtual Cloud Network VCN. It is recommended that\nall new OAC instances be deployed within a VCN and that the Access Control Rules are\nrestricted to your corporate IP Addresses or VCNs for existing OAC instances. Restricting\nconnectivity to Oracle Analytics Cloud instances reduces an OAC instances exposure to\nrisk."},{"label":"check","data":"From Console: 1 Login into the OCI Console 2. Click in the search bar, top of the screen.\n\n3. Type Advanced Resource Query and hit enter. 4. Click the Advanced Resource Query button\nin the upper right of the screen. 5. Enter the following query in the query box: query\nanalyticsinstance resources For each OAC Instance returned click on the link under Display\nname . Ensure Access Control Rules IP Address/CIDR Block as well as Virtual Cloud Networks\nare correct. Repeat for other subscribed regions. From CLI: Execute the following command:\n\nfor region in `oci iam region list | jq -r '.data[] | .name'`; do for compid in `oci iam\ncompartment list --compartment-id-in-subtree TRUE 2>/dev/null | jq -r '.data[] | .id'` do\noutput=`oci analytics analytics-instance list --compartment-id $compid --region $region\n--all 2>/dev/null | jq -r '.data[] |\nselect(.\"network-endpoint-details\".\"network-endpoint-type\" == \"PUBLIC\")'` if [ ! -z\n\"$output\" ]; then echo $output; fi done done Ensure network-endpoint-type are correct."},{"label":"fix","data":"From Console: Follow the audit procedure above. For each OAC instance in the returned\n\nresults, click the OAC Instance name Click Edit next to Access Control Rules Click\n+Another Rule and add rules as required From CLI: Follow the audit procedure. Get the json\ninput format by executing the below command: oci analytics analytics-instance\nchange-network-endpoint --generate-full-command-json-input For each of the OAC Instances\nidentified get its details. Update the Access Control Rules , copy the\nnetwork-endpoint-details element from the JSON returned by the above get call, edit it\nappropriately and use it in the following command: oci integration analytics-instance\nchange-network-endpoint --from-json '<network endpoints JSON>'"},{"label":"potential_impacts","data":"When updating ingress filters for an existing environment, care should be taken to ensure\nthat IP addresses and VCNs currently used by administrators, users, and services to access\nyour OAC instances are included in the updated filters. Also, these changes will\ntemporarily bring the OAC instance offline."}],"impact":0.0,"refs":[],"tags":{"check_id":"C-2_7","severity":"medium","gid":"CIS-2_7","rid":"xccdf_cis_cis_rule_2_7","stig_id":"2.7","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-001097","CCI-001098","CCI-002395","CCI-002668","CCI-002669","CCI-001243","CCI-001184","CCI-000364","CCI-000366","CCI-000381"],"nist":["SC-7 a","SC-7 c","SC-7 b","SI-4 (11)","SI-4 (13) (c)","SI-3 c 2","SC-23","CM-6 a","CM-6 b","CM-7 a"]},"code":"control '2_7' do\n  title 'Ensure Oracle Analytics Cloud (OAC) access is restricted to allowed sources or deployed within a Virtual Cloud Network.'\n\n  desc <<~DESC\n    Oracle Analytics Cloud (OAC) is a scalable and secure public cloud service that provides a\n    full set of capabilities to explore and perform collaborative analytics for you, your\n    workgroup, and your enterprise. OAC instances provide ingress filtering of network traffic\n    or can be deployed with in an existing Virtual Cloud Network VCN. It is recommended that\n    all new OAC instances be deployed within a VCN and that the Access Control Rules are\n    restricted to your corporate IP Addresses or VCNs for existing OAC instances. Restricting\n    connectivity to Oracle Analytics Cloud instances reduces an OAC instances exposure to\n    risk.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: 1 Login into the OCI Console 2. Click in the search bar, top of the screen.\n\n    3. Type Advanced Resource Query and hit enter. 4. Click the Advanced Resource Query button\n    in the upper right of the screen. 5. Enter the following query in the query box: query\n    analyticsinstance resources For each OAC Instance returned click on the link under Display\n    name . Ensure Access Control Rules IP Address/CIDR Block as well as Virtual Cloud Networks\n    are correct. Repeat for other subscribed regions. From CLI: Execute the following command:\n\n    for region in `oci iam region list | jq -r '.data[] | .name'`; do for compid in `oci iam\n    compartment list --compartment-id-in-subtree TRUE 2>/dev/null | jq -r '.data[] | .id'` do\n    output=`oci analytics analytics-instance list --compartment-id $compid --region $region\n    --all 2>/dev/null | jq -r '.data[] |\n    select(.\"network-endpoint-details\".\"network-endpoint-type\" == \"PUBLIC\")'` if [ ! -z\n    \"$output\" ]; then echo $output; fi done done Ensure network-endpoint-type are correct.\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Follow the audit procedure above. For each OAC instance in the returned\n\n    results, click the OAC Instance name Click Edit next to Access Control Rules Click\n    +Another Rule and add rules as required From CLI: Follow the audit procedure. Get the json\n    input format by executing the below command: oci analytics analytics-instance\n    change-network-endpoint --generate-full-command-json-input For each of the OAC Instances\n    identified get its details. Update the Access Control Rules , copy the\n    network-endpoint-details element from the JSON returned by the above get call, edit it\n    appropriately and use it in the following command: oci integration analytics-instance\n    change-network-endpoint --from-json '<network endpoints JSON>'\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    When updating ingress filters for an existing environment, care should be taken to ensure\n    that IP addresses and VCNs currently used by administrators, users, and services to access\n    your OAC instances are included in the updated filters. Also, these changes will\n    temporarily bring the OAC instance offline.\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-2_7'\n  tag severity: 'medium'\n  tag gid: 'CIS-2_7'\n  tag rid: 'xccdf_cis_cis_rule_2_7'\n  tag stig_id: '2.7'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-001097',\n    'CCI-001098',\n    'CCI-002395',\n    'CCI-002668',\n    'CCI-002669',\n    'CCI-001243',\n    'CCI-001184',\n    'CCI-000364',\n    'CCI-000366',\n    'CCI-000381'\n  ]\n\n  tag nist: [\n    'SC-7 a',\n    'SC-7 c',\n    'SC-7 b',\n    'SI-4 (11)',\n    'SI-4 (13) (c)',\n    'SI-3 c 2',\n    'SC-23',\n    'CM-6 a',\n    'CM-6 b',\n    'CM-7 a'\n  ]\n\n  allowed_network_endpoint_types = input('allowed_network_endpoint_types')\n  allowed_network_endpoint_types = allowed_network_endpoint_types.map { |value| value.to_s.strip.downcase }.reject(&:empty?)\n\n  regions_response = json(command: 'oci iam region-subscription list --all')\n  regions_data = regions_response.params.fetch('data', [])\n  regions = regions_data.map { |region| region['region-name'] }.compact\n\n  compartments_response = json(command: 'oci iam compartment list --include-root --compartment-id-in-subtree TRUE 2>/dev/null')\n  compartments_data = compartments_response.params.fetch('data', [])\n  compartment_ids = compartments_data.map { |compartment| compartment['id'] }.compact\n\n  endpoint_type_findings = []\n  total_oac_instances = 0\n\n  regions.each do |region|\n    compartment_ids.each do |compartment_id|\n      instances_response = json(\n        command: %(oci analytics analytics-instance list --compartment-id \"#{compartment_id}\" --region \"#{region}\" --all 2>/dev/null)\n      )\n      instances = instances_response.params.fetch('data', [])\n\n      instances.each do |instance|\n        next unless instance['lifecycle-state'] == 'ACTIVE'\n\n        total_oac_instances += 1\n        endpoint_type = instance.dig('network-endpoint-details', 'network-endpoint-type')\n        endpoint_type_normalized = endpoint_type.to_s.strip.downcase\n        puts endpoint_type_normalized\n\n        next if allowed_network_endpoint_types.include?(endpoint_type_normalized)\n\n        endpoint_type_findings << {\n          'name' => instance['name'],\n          'id' => instance['id'],\n          'region' => region,\n          'compartment_id' => compartment_id,\n          'network_endpoint_type' => endpoint_type\n        }\n      end\n    end\n  end\n\n  if total_oac_instances.zero?\n    impact 0.0\n    describe 'Ensure Oracle Analytics Cloud (OAC) access is restricted to allowed sources or deployed within a Virtual Cloud Network.' do\n      skip 'No Oracle Analytics Cloud instances found in tenancy.'\n    end\n  else\n    describe 'Ensure Oracle Analytics Cloud (OAC) access is restricted to allowed sources or deployed within a Virtual Cloud Network.' do\n      subject { endpoint_type_findings }\n      it { should cmp [] }\n    end\n  end\nend\n","source_location":{"line":1,"ref":"./controls/2_7.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"Ensure Oracle Analytics Cloud (OAC) access is restricted to allowed sources or deployed within a Virtual Cloud Network.","run_time":0.000002,"start_time":"2026-01-28T09:26:55-05:00","resource":"","skip_message":"No Oracle Analytics Cloud instances found in tenancy.","resource_class":"Object","resource_params":"[]","resource_id":"Ensure Oracle Analytics Cloud (OAC) access is restricted to allowed sources or deployed within a Virtual Cloud Network."}],"status":"not_applicable"},{"id":"2_8","title":"Ensure Oracle Autonomous Shared Databases (ADB) access is restricted to allowed sources or deployed within a Virtual Cloud Network","desc":"Oracle Autonomous Database Shared (ADB-S) automates database tuning, security, backups,\nupdates, and other routine management tasks traditionally performed by DBAs. ADB-S provide\ningress filtering of network traffic or can be deployed within an existing Virtual Cloud\nNetwork (VCN). It is recommended that all new ADB-S databases be deployed within a VCN and\nthat the Access Control Rules are restricted to your corporate IP Addresses or VCNs for\nexisting ADB-S databases. Restricting connectivity to ADB-S Databases reduces an ADB-S\ndatabases exposure to risk.","descriptions":[{"label":"default","data":"Oracle Autonomous Database Shared (ADB-S) automates database tuning, security, backups,\nupdates, and other routine management tasks traditionally performed by DBAs. ADB-S provide\ningress filtering of network traffic or can be deployed within an existing Virtual Cloud\nNetwork (VCN). It is recommended that all new ADB-S databases be deployed within a VCN and\nthat the Access Control Rules are restricted to your corporate IP Addresses or VCNs for\nexisting ADB-S databases. Restricting connectivity to ADB-S Databases reduces an ADB-S\ndatabases exposure to risk."},{"label":"check","data":"From Console: Login into the OCI Console Click in the search bar, top of the screen. Type\n\nAdvanced Resource Query and hit enter. Click the Advanced Resource Query button in the\nupper right of the screen. Enter the following query in the query box: query\nautonomousdatabase resources For each ABD-S database returned click on the link under\nDisplay name Click Edit next to Access Control List Ensure `Access Control Rules IP\nAddress/CIDR Block as well as VCNs are correct Repeat for other subscribed regions From\nCLI: Execute the following command: for region in `oci iam region list | jq -r '.data[] |\n.name'`; do for compid in `oci iam compartment list --compartment-id-in-subtree TRUE\n2>/dev/null | jq -r '.data[] | .id'` do for adbid in `oci db autonomous-database list\n--compartment-id $compid --region $region --all 2>/dev/null | jq -r '.data[] |\nselect(.\"nsg-ids\" == null).id'` do output=`oci db autonomous-database get\n--autonomous-database-id $adbid --region $region\n--query=data.{\"WhiteListIPs:\"whitelisted-ips\",\"id:id\"\"} --output table 2>/dev/null` if [\n! -z \"$output\" ]; then echo $output; fi done done done Ensure WhiteListIPs are correct."},{"label":"fix","data":"From Console: Follow the audit procedure above. For each ADB-S database in the returned\n\nresults, click the ADB-S database name Click Edit next to Access Control Rules Click\n+Another Rule and add rules as required Click Save Changes From CLI: Follow the audit\nprocedure. Get the json input format by executing the following command: oci db\nautonomous-database update --generate-full-command-json-input For each of the ADB-S\nDatabase identified get its details. Update the whitelistIps , copy the WhiteListIPs\nelement from the JSON returned by the above get call, edit it appropriately and use it in\nthe following command: oci db autonomous-database update -autonomous-database-id <ABD-S\nOCID> --from-json '<network endpoints JSON>'"},{"label":"potential_impacts","data":"When updating ingress filters for an existing environment, care should be taken to ensure\nthat IP addresses and VCNs currently used by administrators, users, and services to access\nyour ADB-S instances are included in the updated filters."}],"impact":0.5,"refs":[],"tags":{"check_id":"C-2_8","severity":"medium","gid":"CIS-2_8","rid":"xccdf_cis_cis_rule_2_8","stig_id":"2.8","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-001097","CCI-001098","CCI-002395","CCI-002668","CCI-002669","CCI-001243","CCI-001184","CCI-000364","CCI-000366","CCI-000381"],"nist":["SC-7 a","SC-7 c","SC-7 b","SI-4 (11)","SI-4 (13) (c)","SI-3 c 2","SC-23","CM-6 a","CM-6 b","CM-7 a"]},"code":"control '2_8' do\n  title 'Ensure Oracle Autonomous Shared Databases (ADB) access is restricted to allowed sources or deployed within a Virtual Cloud Network'\n\n  desc <<~DESC\n    Oracle Autonomous Database Shared (ADB-S) automates database tuning, security, backups,\n    updates, and other routine management tasks traditionally performed by DBAs. ADB-S provide\n    ingress filtering of network traffic or can be deployed within an existing Virtual Cloud\n    Network (VCN). It is recommended that all new ADB-S databases be deployed within a VCN and\n    that the Access Control Rules are restricted to your corporate IP Addresses or VCNs for\n    existing ADB-S databases. Restricting connectivity to ADB-S Databases reduces an ADB-S\n    databases exposure to risk.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Login into the OCI Console Click in the search bar, top of the screen. Type\n\n    Advanced Resource Query and hit enter. Click the Advanced Resource Query button in the\n    upper right of the screen. Enter the following query in the query box: query\n    autonomousdatabase resources For each ABD-S database returned click on the link under\n    Display name Click Edit next to Access Control List Ensure `Access Control Rules IP\n    Address/CIDR Block as well as VCNs are correct Repeat for other subscribed regions From\n    CLI: Execute the following command: for region in `oci iam region list | jq -r '.data[] |\n    .name'`; do for compid in `oci iam compartment list --compartment-id-in-subtree TRUE\n    2>/dev/null | jq -r '.data[] | .id'` do for adbid in `oci db autonomous-database list\n    --compartment-id $compid --region $region --all 2>/dev/null | jq -r '.data[] |\n    select(.\"nsg-ids\" == null).id'` do output=`oci db autonomous-database get\n    --autonomous-database-id $adbid --region $region\n    --query=data.{\"WhiteListIPs:\\\"whitelisted-ips\\\",\"id:id\"\"} --output table 2>/dev/null` if [\n    ! -z \"$output\" ]; then echo $output; fi done done done Ensure WhiteListIPs are correct.\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Follow the audit procedure above. For each ADB-S database in the returned\n\n    results, click the ADB-S database name Click Edit next to Access Control Rules Click\n    +Another Rule and add rules as required Click Save Changes From CLI: Follow the audit\n    procedure. Get the json input format by executing the following command: oci db\n    autonomous-database update --generate-full-command-json-input For each of the ADB-S\n    Database identified get its details. Update the whitelistIps , copy the WhiteListIPs\n    element from the JSON returned by the above get call, edit it appropriately and use it in\n    the following command: oci db autonomous-database update -autonomous-database-id <ABD-S\n    OCID> --from-json '<network endpoints JSON>'\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    When updating ingress filters for an existing environment, care should be taken to ensure\n    that IP addresses and VCNs currently used by administrators, users, and services to access\n    your ADB-S instances are included in the updated filters.\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-2_8'\n  tag severity: 'medium'\n  tag gid: 'CIS-2_8'\n  tag rid: 'xccdf_cis_cis_rule_2_8'\n  tag stig_id: '2.8'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-001097',\n    'CCI-001098',\n    'CCI-002395',\n    'CCI-002668',\n    'CCI-002669',\n    'CCI-001243',\n    'CCI-001184',\n    'CCI-000364',\n    'CCI-000366',\n    'CCI-000381'\n  ]\n\n  tag nist: [\n    'SC-7 a',\n    'SC-7 c',\n    'SC-7 b',\n    'SI-4 (11)',\n    'SI-4 (13) (c)',\n    'SI-3 c 2',\n    'SC-23',\n    'CM-6 a',\n    'CM-6 b',\n    'CM-7 a'\n  ]\nend\n","source_location":{"line":1,"ref":"./controls/2_8.rb"},"waiver_data":{},"results":[],"status":"passed"},{"id":"3_1","title":"Ensure Compute Instance Legacy Metadata service endpoint is disabled","desc":"Compute Instances that utilize Legacy MetaData service endpoints (IMDSv1) are susceptible\nto potential SSRF attacks. To bolster security measures, it is strongly advised to\nreconfigure Compute Instances to adopt Instance Metadata Service v2, aligning with the\nindustry's best security practices. Enabling Instance Metadata Service v2 enhances\nsecurity and grants precise control over metadata access. Transitioning from IMDSv1\nreduces the risk of SSRF attacks, bolstering system protection. IMDv1 poses security risks\ndue to its inferior security measures and limited auditing capabilities. Transitioning to\nIMDv2 ensures a more secure environment with robust security features and improved\nmonitoring capabilities.","descriptions":[{"label":"default","data":"Compute Instances that utilize Legacy MetaData service endpoints (IMDSv1) are susceptible\nto potential SSRF attacks. To bolster security measures, it is strongly advised to\nreconfigure Compute Instances to adopt Instance Metadata Service v2, aligning with the\nindustry's best security practices. Enabling Instance Metadata Service v2 enhances\nsecurity and grants precise control over metadata access. Transitioning from IMDSv1\nreduces the risk of SSRF attacks, bolstering system protection. IMDv1 poses security risks\ndue to its inferior security measures and limited auditing capabilities. Transitioning to\nIMDv2 ensures a more secure environment with robust security features and improved\nmonitoring capabilities."},{"label":"check","data":"From Console: Login to the OCI Console Select compute instance in your compartment. Click\n\non each instance name. In the Instance Details section, next to Instance metadata service\nmake sure Version 2 only is selected. From CLI: Run command: for region in `oci iam\nregion-subscription list | jq -r '.data[] | .\"region-name\"'`; do for compid in `oci iam\ncompartment list --compartment-id-in-subtree TRUE 2>/dev/null | jq -r '.data[] | .id'` do\noutput=`oci compute instance list --compartment-id $compid --region $region --all\n2>/dev/null | jq -r '.data[] |\nselect(.\"instance-options\".\"are-legacy-imds-endpoints-disabled\" == false )'` if [ ! -z\n\"$output\" ]; then echo $output; fi done done No results should be returned"},{"label":"fix","data":"From Console: Login to the OCI Console Click on the search box at the top of the console\n\nand search for compute instance name. Click on the instance name, In the Instance Details\nsection, next to Instance Metadata Service, click Edit . For the Instance metadata service\n, select the Version 2 only option. Click Save Changes . Note : Disabling IMDSv1 on an\nincompatible instance may result in connectivity issues upon launch. To re-enable IMDSv1,\nfollow these steps: On the Instance Details page in the Console, click Edit next to\nInstance Metadata Service. Choose the Version 1 and version 2 option, and save your\nchanges. From CLI: Run Below Command, oci compute instance update --instance-id\n[instance-ocid] --instance-options '{\"areLegacyImdsEndpointsDisabled\" :\"true\"}' This will\nset Instance Metadata Service to use Version 2 Only."},{"label":"potential_impacts","data":"If you disable IMDSv1 on an instance that does not support IMDSv2, you might not be able\nto connect to the instance when you launch it. IMDSv2 is supported on the following\nplatform images: Oracle Autonomous Linux 8.x images Oracle Autonomous Linux 7.x images\nreleased in June 2020 or later Oracle Linux 8.x, Oracle Linux 7.x, and Oracle Linux 6.x\nimages released in July 2020 or later Other platform images, most custom images, and most\nMarketplace images do not support IMDSv2. Custom Linux images might support IMDSv2 if\ncloud-init is updated to version 20.3 or later and Oracle Cloud Agent is updated to\nversion 0.0.19 or later. Custom Windows images might support IMDSv2 if Oracle Cloud Agent\nis updated to version 1.0.0.0 or later; cloudbase-init does not support IMDSv2."}],"impact":0.5,"refs":[],"tags":{"check_id":"C-3_1","severity":"medium","gid":"CIS-3_1","rid":"xccdf_cis_cis_rule_3_1","stig_id":"3.1","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-000381","CCI-000382","CCI-000380"],"nist":["CM-7 a","CM-7 b","CM-7 b"]},"code":"control '3_1' do\n  title 'Ensure Compute Instance Legacy Metadata service endpoint is disabled'\n\n  desc <<~DESC\n    Compute Instances that utilize Legacy MetaData service endpoints (IMDSv1) are susceptible\n    to potential SSRF attacks. To bolster security measures, it is strongly advised to\n    reconfigure Compute Instances to adopt Instance Metadata Service v2, aligning with the\n    industry's best security practices. Enabling Instance Metadata Service v2 enhances\n    security and grants precise control over metadata access. Transitioning from IMDSv1\n    reduces the risk of SSRF attacks, bolstering system protection. IMDv1 poses security risks\n    due to its inferior security measures and limited auditing capabilities. Transitioning to\n    IMDv2 ensures a more secure environment with robust security features and improved\n    monitoring capabilities.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Login to the OCI Console Select compute instance in your compartment. Click\n\n    on each instance name. In the Instance Details section, next to Instance metadata service\n    make sure Version 2 only is selected. From CLI: Run command: for region in `oci iam\n    region-subscription list | jq -r '.data[] | .\"region-name\"'`; do for compid in `oci iam\n    compartment list --compartment-id-in-subtree TRUE 2>/dev/null | jq -r '.data[] | .id'` do\n    output=`oci compute instance list --compartment-id $compid --region $region --all\n    2>/dev/null | jq -r '.data[] |\n    select(.\"instance-options\".\"are-legacy-imds-endpoints-disabled\" == false )'` if [ ! -z\n    \"$output\" ]; then echo $output; fi done done No results should be returned\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Login to the OCI Console Click on the search box at the top of the console\n\n    and search for compute instance name. Click on the instance name, In the Instance Details\n    section, next to Instance Metadata Service, click Edit . For the Instance metadata service\n    , select the Version 2 only option. Click Save Changes . Note : Disabling IMDSv1 on an\n    incompatible instance may result in connectivity issues upon launch. To re-enable IMDSv1,\n    follow these steps: On the Instance Details page in the Console, click Edit next to\n    Instance Metadata Service. Choose the Version 1 and version 2 option, and save your\n    changes. From CLI: Run Below Command, oci compute instance update --instance-id\n    [instance-ocid] --instance-options '{\"areLegacyImdsEndpointsDisabled\" :\"true\"}' This will\n    set Instance Metadata Service to use Version 2 Only.\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    If you disable IMDSv1 on an instance that does not support IMDSv2, you might not be able\n    to connect to the instance when you launch it. IMDSv2 is supported on the following\n    platform images: Oracle Autonomous Linux 8.x images Oracle Autonomous Linux 7.x images\n    released in June 2020 or later Oracle Linux 8.x, Oracle Linux 7.x, and Oracle Linux 6.x\n    images released in July 2020 or later Other platform images, most custom images, and most\n    Marketplace images do not support IMDSv2. Custom Linux images might support IMDSv2 if\n    cloud-init is updated to version 20.3 or later and Oracle Cloud Agent is updated to\n    version 0.0.19 or later. Custom Windows images might support IMDSv2 if Oracle Cloud Agent\n    is updated to version 1.0.0.0 or later; cloudbase-init does not support IMDSv2.\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-3_1'\n  tag severity: 'medium'\n  tag gid: 'CIS-3_1'\n  tag rid: 'xccdf_cis_cis_rule_3_1'\n  tag stig_id: '3.1'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-000381',\n    'CCI-000382',\n    'CCI-000380'\n  ]\n\n  tag nist: [\n    'CM-7 a',\n    'CM-7 b',\n    'CM-7 b'\n  ]\n\n  cmd = <<~CMD\n    (\n      for region in `oci iam region-subscription list | jq -r '.data[] | .\"region-name\"'`;\n      do\n        for compid in `oci iam compartment list --include-root --compartment-id-in-subtree TRUE 2>/dev/null | jq -r '.data[] | .id'`\n        do\n          output=`oci compute instance list --compartment-id $compid --region $region --all 2>/dev/null | jq -r'.data[]|select(.\"instance-options\".\"are-legacy-imds-endpoints-disabled\" == false )'`\n          if [ ! -z \"$output\" ]; then echo $output; fi\n        done\n      done\n    ) | jq -nR '[inputs]'\n  CMD\n\n  json_output = json(command: cmd)\n  output = json_output.params\n\n  describe 'Ensure Compute Instance Legacy Metadata service endpoint is disabled' do\n    subject { output }\n    it { should be_empty }\n  end\nend\n","source_location":{"line":1,"ref":"./controls/3_1.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Ensure Compute Instance Legacy Metadata service endpoint is disabled is expected to be empty","run_time":0.001143,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Ensure Compute Instance Legacy Metadata service endpoint is disabled"}],"status":"passed"},{"id":"3_2","title":"Ensure Secure Boot is enabled on Compute Instance","desc":"Shielded Instances with Secure Boot enabled prevents unauthorized boot loaders and\noperating systems from booting. This prevent rootkits, bootkits, and unauthorized software\nfrom running before the operating system loads. Secure Boot verifies the digital signature\nof the system's boot software to check its authenticity. The digital signature ensures the\noperating system has not been tampered with and is from a trusted source. When the system\nboots and attempts to execute the software, it will first check the digital signature to\nensure validity. If the digital signature is not valid, the system will not allow the\nsoftware to run. Secure Boot is a feature of UEFI(Unified Extensible Firmware Interface)\nthat only allows approved operating systems to boot up. A Threat Actor with access to the\noperating system may seek to alter boot components to persist malware or rootkits during\nsystem initialization. Secure Boot helps ensure that the system only runs authentic\nsoftware by verifying the digital signature of all boot components.","descriptions":[{"label":"default","data":"Shielded Instances with Secure Boot enabled prevents unauthorized boot loaders and\noperating systems from booting. This prevent rootkits, bootkits, and unauthorized software\nfrom running before the operating system loads. Secure Boot verifies the digital signature\nof the system's boot software to check its authenticity. The digital signature ensures the\noperating system has not been tampered with and is from a trusted source. When the system\nboots and attempts to execute the software, it will first check the digital signature to\nensure validity. If the digital signature is not valid, the system will not allow the\nsoftware to run. Secure Boot is a feature of UEFI(Unified Extensible Firmware Interface)\nthat only allows approved operating systems to boot up. A Threat Actor with access to the\noperating system may seek to alter boot components to persist malware or rootkits during\nsystem initialization. Secure Boot helps ensure that the system only runs authentic\nsoftware by verifying the digital signature of all boot components."},{"label":"check","data":"From Console: Login to the OCI Console Select compute instance in your compartment. Click\n\non each instance name. In the Launch Options section, Check if Secure Boot is Enabled .\n\nFrom CLI: Run command: for region in `oci iam region-subscription list | jq -r '.data[] |\n\n.\"region-name\"'`; do for compid in `oci iam compartment list --compartment-id-in-subtree\nTRUE 2>/dev/null | jq -r '.data[] | .id'` do output=`oci compute instance list\n--compartment-id $compid --region $region --all 2>/dev/null | jq -r '.data[] |\nselect(.\"platform-config\" == null or \"platform-config\".\"is-secure-boot-enabled\" == false\n)'` if [ ! -z \"$output\" ]; then echo $output; fi done done In response, check if\nplatform-config are not null and is-secure-boot-enabled is set to true"},{"label":"fix","data":"Note: Secure Boot facility is available on selected VM images and Shapes in OCI. User have\n\nto configure Secured Boot at time of instance creation only. From Console: Navigate to\nhttps://cloud.oracle.com/compute/instances Select the instance from the Audit Procedure\nClick Terminate . Determine whether or not to permanently delete instance's attached boot\nvolume. Click Terminate instance . Click on Create Instance . Select Image and Shape which\nsupports Shielded Instance configuration. Icon for Shield in front of Image/Shape row\nindicates support of Shielded Instance. Click on edit of Security Blade. Turn On Shielded\nInstance, then Turn on the Secure Boot Toggle. Fill in the rest of the details as per\nrequirements. Click Create ."},{"label":"potential_impacts","data":"\"An existing instance cannot be changed to a Shielded instance with Secure boot enabled.\nShielded Secure Boot not available on all instance shapes and Operating systems.\nAdditionally the following limitations exist: Thus to enable you have to terminate the\ninstance and create a new one. Also, Shielded instances do not support live migration.\nDuring an infrastructure maintenance event, Oracle Cloud Infrastructure live migrates\nsupported VM instances from the physical VM host that needs maintenance to a healthy VM\nhost with minimal disruption to running instances. If you enable Secure Boot on an\ninstance, the instance cannot be migrated, because the hardware TPM is not migratable.\nThis may result in an ou"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-3_2","severity":"medium","gid":"CIS-3_2","rid":"xccdf_cis_cis_rule_3_2","stig_id":"3.2","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-000364","CCI-000365","CCI-000366","CCI-000421"],"nist":["CM-6 a","CM-6 a","CM-6 b","CM-9 a"]},"code":"control '3_2' do\n  title 'Ensure Secure Boot is enabled on Compute Instance'\n\n  desc <<~DESC\n    Shielded Instances with Secure Boot enabled prevents unauthorized boot loaders and\n    operating systems from booting. This prevent rootkits, bootkits, and unauthorized software\n    from running before the operating system loads. Secure Boot verifies the digital signature\n    of the system's boot software to check its authenticity. The digital signature ensures the\n    operating system has not been tampered with and is from a trusted source. When the system\n    boots and attempts to execute the software, it will first check the digital signature to\n    ensure validity. If the digital signature is not valid, the system will not allow the\n    software to run. Secure Boot is a feature of UEFI(Unified Extensible Firmware Interface)\n    that only allows approved operating systems to boot up. A Threat Actor with access to the\n    operating system may seek to alter boot components to persist malware or rootkits during\n    system initialization. Secure Boot helps ensure that the system only runs authentic\n    software by verifying the digital signature of all boot components.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Login to the OCI Console Select compute instance in your compartment. Click\n\n    on each instance name. In the Launch Options section, Check if Secure Boot is Enabled .\n\n    From CLI: Run command: for region in `oci iam region-subscription list | jq -r '.data[] |\n\n    .\"region-name\"'`; do for compid in `oci iam compartment list --compartment-id-in-subtree\n    TRUE 2>/dev/null | jq -r '.data[] | .id'` do output=`oci compute instance list\n    --compartment-id $compid --region $region --all 2>/dev/null | jq -r '.data[] |\n    select(.\"platform-config\" == null or \"platform-config\".\"is-secure-boot-enabled\" == false\n    )'` if [ ! -z \"$output\" ]; then echo $output; fi done done In response, check if\n    platform-config are not null and is-secure-boot-enabled is set to true\n  CHECK\n\n  desc 'fix', <<~FIX\n    Note: Secure Boot facility is available on selected VM images and Shapes in OCI. User have\n\n    to configure Secured Boot at time of instance creation only. From Console: Navigate to\n    https://cloud.oracle.com/compute/instances Select the instance from the Audit Procedure\n    Click Terminate . Determine whether or not to permanently delete instance's attached boot\n    volume. Click Terminate instance . Click on Create Instance . Select Image and Shape which\n    supports Shielded Instance configuration. Icon for Shield in front of Image/Shape row\n    indicates support of Shielded Instance. Click on edit of Security Blade. Turn On Shielded\n    Instance, then Turn on the Secure Boot Toggle. Fill in the rest of the details as per\n    requirements. Click Create .\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    \"An existing instance cannot be changed to a Shielded instance with Secure boot enabled.\n    Shielded Secure Boot not available on all instance shapes and Operating systems.\n    Additionally the following limitations exist: Thus to enable you have to terminate the\n    instance and create a new one. Also, Shielded instances do not support live migration.\n    During an infrastructure maintenance event, Oracle Cloud Infrastructure live migrates\n    supported VM instances from the physical VM host that needs maintenance to a healthy VM\n    host with minimal disruption to running instances. If you enable Secure Boot on an\n    instance, the instance cannot be migrated, because the hardware TPM is not migratable.\n    This may result in an ou\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-3_2'\n  tag severity: 'medium'\n  tag gid: 'CIS-3_2'\n  tag rid: 'xccdf_cis_cis_rule_3_2'\n  tag stig_id: '3.2'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-000364',\n    'CCI-000365',\n    'CCI-000366',\n    'CCI-000421'\n  ]\n\n  tag nist: [\n    'CM-6 a',\n    'CM-6 a',\n    'CM-6 b',\n    'CM-9 a'\n  ]\nend\n","source_location":{"line":1,"ref":"./controls/3_2.rb"},"waiver_data":{},"results":[],"status":"passed"},{"id":"3_3","title":"Ensure In-transit Encryption is enabled on Compute Instance","desc":"The Block Volume service provides the option to enable in-transit encryption for\nparavirtualized volume attachments on virtual machine (VM) instances. All the data moving\nbetween the instance and the block volume is transferred over an internal and highly\nsecure network. If you have specific compliance requirements related to the encryption of\nthe data while it is moving between the instance and the block volume, you should enable\nthe in-transit encryption option.","descriptions":[{"label":"default","data":"The Block Volume service provides the option to enable in-transit encryption for\nparavirtualized volume attachments on virtual machine (VM) instances. All the data moving\nbetween the instance and the block volume is transferred over an internal and highly\nsecure network. If you have specific compliance requirements related to the encryption of\nthe data while it is moving between the instance and the block volume, you should enable\nthe in-transit encryption option."},{"label":"check","data":"From Console: Go to https://cloud.oracle.com/compute/instances Select compute instance in\n\nyour compartment. Click on each instance name. Click on Boot volume on the bottom left.\nUnder the In-transit encryption column make sure it is Enabled From CLI: Execute the\nfollowing: for region in `oci iam region-subscription list | jq -r '.data[] |\n.\"region-name\"'`; do for compid in `oci iam compartment list --compartment-id-in-subtree\nTRUE 2>/dev/null | jq -r '.data[] | .id'` do output=`oci compute instance list\n--compartment-id $compid --region $region --all 2>/dev/null | jq -r '.data[] |\nselect(.\"launch-options\".\"is-pv-encryption-in-transit-enabled\" == false )'` if [ ! -z\n\"$output\" ]; then echo $output; fi done done Ensure no results are returned"},{"label":"fix","data":"From Console: Navigate to https://cloud.oracle.com/compute/instances Select the instance\n\nfrom the Audit Procedure Click Terminate . Determine whether or not to permanently delete\ninstance's attached boot volume. Click Terminate instance . Click on Create Instance .\nFill in the details as per requirements. In the Boot volume section ensure Use in-transit\nencryption is checked. Fill in the rest of the details as per requirements. Click Create ."},{"label":"potential_impacts","data":"In-transit encryption for boot and block volumes is only available for virtual machine\n(VM) instances launched from platform images, along with bare metal instances that use the\nfollowing shapes: BM.Standard.E3.128, BM.Standard.E4.128, BM.DenseIO.E4.128. It is not\nsupported on other bare metal instances."}],"impact":0.5,"refs":[],"tags":{"check_id":"C-3_3","severity":"medium","gid":"CIS-3_3","rid":"xccdf_cis_cis_rule_3_3","stig_id":"3.3","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-002418","CCI-002310","CCI-000183","CCI-000364","CCI-000365","CCI-000366","CCI-000421"],"nist":["SC-8","AC-17 a","IA-5 g","CM-6 a","CM-6 a","CM-6 b","CM-9 a"]},"code":"control '3_3' do\n  title 'Ensure In-transit Encryption is enabled on Compute Instance'\n\n  desc <<~DESC\n    The Block Volume service provides the option to enable in-transit encryption for\n    paravirtualized volume attachments on virtual machine (VM) instances. All the data moving\n    between the instance and the block volume is transferred over an internal and highly\n    secure network. If you have specific compliance requirements related to the encryption of\n    the data while it is moving between the instance and the block volume, you should enable\n    the in-transit encryption option.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Go to https://cloud.oracle.com/compute/instances Select compute instance in\n\n    your compartment. Click on each instance name. Click on Boot volume on the bottom left.\n    Under the In-transit encryption column make sure it is Enabled From CLI: Execute the\n    following: for region in `oci iam region-subscription list | jq -r '.data[] |\n    .\"region-name\"'`; do for compid in `oci iam compartment list --compartment-id-in-subtree\n    TRUE 2>/dev/null | jq -r '.data[] | .id'` do output=`oci compute instance list\n    --compartment-id $compid --region $region --all 2>/dev/null | jq -r '.data[] |\n    select(.\"launch-options\".\"is-pv-encryption-in-transit-enabled\" == false )'` if [ ! -z\n    \"$output\" ]; then echo $output; fi done done Ensure no results are returned\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Navigate to https://cloud.oracle.com/compute/instances Select the instance\n\n    from the Audit Procedure Click Terminate . Determine whether or not to permanently delete\n    instance's attached boot volume. Click Terminate instance . Click on Create Instance .\n    Fill in the details as per requirements. In the Boot volume section ensure Use in-transit\n    encryption is checked. Fill in the rest of the details as per requirements. Click Create .\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    In-transit encryption for boot and block volumes is only available for virtual machine\n    (VM) instances launched from platform images, along with bare metal instances that use the\n    following shapes: BM.Standard.E3.128, BM.Standard.E4.128, BM.DenseIO.E4.128. It is not\n    supported on other bare metal instances.\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-3_3'\n  tag severity: 'medium'\n  tag gid: 'CIS-3_3'\n  tag rid: 'xccdf_cis_cis_rule_3_3'\n  tag stig_id: '3.3'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-002418',\n    'CCI-002310',\n    'CCI-000183',\n    'CCI-000364',\n    'CCI-000365',\n    'CCI-000366',\n    'CCI-000421'\n  ]\n\n  tag nist: [\n    'SC-8',\n    'AC-17 a',\n    'IA-5 g',\n    'CM-6 a',\n    'CM-6 a',\n    'CM-6 b',\n    'CM-9 a'\n  ]\n\n  cmd = <<~CMD\n    (\n      for region in `oci iam region-subscription list | jq -r '.data[] | .\"region-name\"'`;\n      do\n        for compid in `oci iam compartment list --include-root --compartment-id-in-subtree TRUE 2>/dev/null | jq -r '.data[] | .id'`\n        do\n          output=`oci compute instance list --compartment-id $compid --region $region --all 2>/dev/null | jq -r '.data[] | select(.\"launch-options\".\"is-pv-encryption-in-transit-enabled\" == false )'`\n          if [ ! -z \"$output\" ]; then echo $output; fi\n        done\n      done\n    ) | jq -nR '[inputs]'\n  CMD\n\n  json_output = json(command: cmd)\n  output = json_output.params\n\n  describe 'Ensure In-transit Encryption is enabled on Compute Instance' do\n    subject { output }\n    it { should be_empty }\n  end\nend\n","source_location":{"line":1,"ref":"./controls/3_3.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"Ensure In-transit Encryption is enabled on Compute Instance is expected to be empty","run_time":0.001262,"start_time":"2026-01-28T09:26:55-05:00","message":"expected `[\"{ \\\"agent-config\\\": { \\\"are-all-plugins-disabled\\\": false, \\\"is-management-disabled\\\": false, \\\"is-...}, \\\"time-created\\\": \\\"2025-12-18T16:58:01.199000+00:00\\\", \\\"time-maintenance-reboot-due\\\": null }\"].empty?` to be truthy, got false","resource_class":"Object","resource_params":"[]","resource_id":"Ensure In-transit Encryption is enabled on Compute Instance"}],"status":"failed"},{"id":"4_1","title":"Ensure default tags are used on resources","desc":"Default tags automatically apply a set of tags to supported resources in a compartment.\nEnforcing a tag that captures the principal who created the resource improves traceability\nand ownership for audit and lifecycle management.","descriptions":[{"label":"default","data":"Default tags automatically apply a set of tags to supported resources in a compartment.\nEnforcing a tag that captures the principal who created the resource improves traceability\nand ownership for audit and lifecycle management."},{"label":"check","data":"From CLI: Execute the following command and ensure at least one active tag default value\nis set to ${iam.principal.name}:\n\noci iam tag-default list --compartment-id \"<tenancy-ocid>\" --all --query\n\"data[?'lifecycle-state'=='ACTIVE'].{name:\"tag-definition-name\",value:value}\""},{"label":"fix","data":"From Console: Login to OCI Console. From the navigation menu, select Identity &\nSecurity. Under Identity, select Compartments and choose the root compartment. Under\nResources, select Tag Defaults. Create or edit a tag default so that a tag value is set to\n${iam.principal.name}.\n\nFrom CLI: Create or update the relevant tag default using oci iam tag-default\ncreate/update with the value ${iam.principal.name}."},{"label":"potential_impacts","data":"Applying tag defaults adds tags to every new supported resource in the compartment; verify\nthe key and value so that unintended tags are not propagated."}],"impact":0.5,"refs":[],"tags":{"check_id":"C-4_1","severity":"medium","gid":"CIS-4_1","rid":"xccdf_cis_cis_rule_4_1","stig_id":"4.1","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-000389","CCI-000395","CCI-000399","CCI-001780","CCI-000389","CCI-000395","CCI-001780"],"nist":["CM-8 a 1","CM-8 a 3","CM-8 a 4","CM-8 b","CM-8 a 1","CM-8 a 3","CM-8 b"]},"code":"control '4_1' do\n  title 'Ensure default tags are used on resources'\n\n  desc <<~DESC\n    Default tags automatically apply a set of tags to supported resources in a compartment.\n    Enforcing a tag that captures the principal who created the resource improves traceability\n    and ownership for audit and lifecycle management.\n  DESC\n\n  desc 'check', <<~CHECK\n    From CLI: Execute the following command and ensure at least one active tag default value\n    is set to ${iam.principal.name}:\n\n    oci iam tag-default list --compartment-id \"<tenancy-ocid>\" --all --query\n    \"data[?'lifecycle-state'=='ACTIVE'].{name:\\\"tag-definition-name\\\",value:value}\"\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Login to OCI Console. From the navigation menu, select Identity &\n    Security. Under Identity, select Compartments and choose the root compartment. Under\n    Resources, select Tag Defaults. Create or edit a tag default so that a tag value is set to\n    ${iam.principal.name}.\n\n    From CLI: Create or update the relevant tag default using oci iam tag-default\n    create/update with the value ${iam.principal.name}.\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    Applying tag defaults adds tags to every new supported resource in the compartment; verify\n    the key and value so that unintended tags are not propagated.\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-4_1'\n  tag severity: 'medium'\n  tag gid: 'CIS-4_1'\n  tag rid: 'xccdf_cis_cis_rule_4_1'\n  tag stig_id: '4.1'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-000389',\n    'CCI-000395',\n    'CCI-000399',\n    'CCI-001780',\n    'CCI-000389',\n    'CCI-000395',\n    'CCI-001780'\n  ]\n\n  tag nist: [\n    'CM-8 a 1',\n    'CM-8 a 3',\n    'CM-8 a 4',\n    'CM-8 b',\n    'CM-8 a 1',\n    'CM-8 a 3',\n    'CM-8 b'\n  ]\n\n  tenancy_ocid = input('tenancy_ocid')\n\n  cmd = \"oci iam tag-default list --compartment-id='#{tenancy_ocid}' --query=\\\"data[?\\\\\\\"lifecycle-state\\\\\\\"=='ACTIVE'].{\\\\\\\"name\\\\\\\":\\\\\\\"tag-definition-name\\\\\\\",\\\\\\\"value\\\\\\\":value}\\\"\"\n\n  json_output = json(command: cmd)\n  output = json_output.params\n\n  values = output.map { |dict| dict['value'] }\n\n  describe 'Ensure default tags are used on resources' do\n    subject { values }\n    it { should include '${iam.principal.name}' }\n  end\nend\n","source_location":{"line":1,"ref":"./controls/4_1.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Ensure default tags are used on resources is expected to include \"${iam.principal.name}\"","run_time":0.000062,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Ensure default tags are used on resources"}],"status":"passed"},{"id":"4_10","title":"Ensure a notification is configured for security list changes","desc":"It is recommended to setup an Event Rule and Notification that gets triggered when\nsecurity lists are created, updated or deleted. Event Rules are compartment scoped and\nwill detect events in child compartments, it is recommended to create the Event rule at\nthe root compartment level. Security Lists control traffic flowing into and out of Subnets\nwithin a Virtual Cloud Network. Monitoring and alerting on changes to Security Lists will\nhelp in identifying changes to these security controls.","descriptions":[{"label":"default","data":"It is recommended to setup an Event Rule and Notification that gets triggered when\nsecurity lists are created, updated or deleted. Event Rules are compartment scoped and\nwill detect events in child compartments, it is recommended to create the Event rule at\nthe root compartment level. Security Lists control traffic flowing into and out of Subnets\nwithin a Virtual Cloud Network. Monitoring and alerting on changes to Security Lists will\nhelp in identifying changes to these security controls."},{"label":"check","data":"From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\nthe Compartment that hosts the rules Find and click the Rule that handles Security List\nChanges (if any) Click the Edit Rule button and verify that the RuleConditions section\ncontains a condition for the Service Networking and Event Types: Security List  Change\nCompartment , Security List  Create , Security List - Delete and Security List  Update\nVerify that in the Actions section the Action Type contains: Notifications and that a\nvalid Topic is referenced. From CLI: Find the OCID of the specific Event Rule based on\nDisplay Name and Compartment OCID oci events rule list --compartment-id <compartment-ocid>\n--query \"data [?\"display-name\"=='<display-name>']\".{\"id:id\"} --output table List the\ndetails of a specific Event Rule based on the OCID of the rule. oci events rule get\n--rule-id <rule-ocid> In the JSON output locate the Conditions key value pair and verify\nthat the following Conditions are present:\n\ncom.oraclecloud.virtualnetwork.changesecuritylistcompartment\ncom.oraclecloud.virtualnetwork.createsecuritylist\ncom.oraclecloud.virtualnetwork.deletesecuritylist\ncom.oraclecloud.virtualnetwork.updatesecuritylist Verify the value of the is-enabled\nattribute is true In the JSON output verify that actionType is ONS and locate the topic-id\nVerify the correct topic is used by checking the topic name oci ons topic get --topic-id\n<topic-id> --query data.{\"name:name\"} --output table"},{"label":"fix","data":"From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\nthe compartment that should host the rule Click Create Rule Provide a Display Name and\nDescription Create a Rule Condition by selecting Networking in the Service Name Drop-down\nand selecting Security List  Change Compartment , Security List  Create , Security List\n- Delete and Security List  Update In the Actions section select Notifications as Action\nType Select the Compartment that hosts the Topic to be used. Select the Topic to be used\nOptionally add Tags to the Rule Click Create Rule From CLI: Find the topic-id of the topic\nthe Event Rule should use for sending Notifications by using the topic name and\nCompartment OCID oci ons topic list --compartment-id <compartment-ocid> --all --query\n\"data [?name=='<topic-name>']\".{\"name:name,topic_id:\"topic-id\"\"} --output table Create a\nJSON file to be used when creating the Event Rule. Replace topic-id, display name,\ndescription and compartment OCID. { \"actions\": { \"actions\": [ { \"actionType\": \"ONS\",\n\"isEnabled\": true, \"topicId\": \"<topic-id>\" }] }, \"condition\":\n\n\"{\"eventType\":[\"com.oraclecloud.virtualnetwork.changesecuritylistcompartment\",\"com.oraclecloud.virtualnetwork.createsecuritylist\",\"com.oraclecloud.virtualnetwork.deletesecuritylist\",\"com.oraclecloud.virtualnetwork.updatesecuritylist\"],\"data\":{}}\",\n\"displayName\": \"<display-name>\", \"description\": \"<description>\", \"isEnabled\": true,\n\"compartmentId\": \"<compartment-ocid>\" } Create the actual event rule oci events rule\ncreate --from-json file://event_rule.json Note in the JSON returned that it lists the\nparameters specified in the JSON file provided and that there is an OCID provided for the\nEvent Rule"},{"label":"potential_impacts","data":"\"There is no performance"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-4_10","severity":"medium","gid":"CIS-4_10","rid":"xccdf_cis_cis_rule_4_10","stig_id":"4.1","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-002323","CCI-000364","CCI-000366","CCI-000381","CCI-001199","CCI-000540","CCI-002472"],"nist":["AC-18 a","CM-6 a","CM-6 b","CM-7 a","SC-28","CP-9 (d)","SC-28"]},"code":"control '4_10' do\n  title 'Ensure a notification is configured for security list changes'\n\n  desc <<~DESC\n    It is recommended to setup an Event Rule and Notification that gets triggered when\n    security lists are created, updated or deleted. Event Rules are compartment scoped and\n    will detect events in child compartments, it is recommended to create the Event rule at\n    the root compartment level. Security Lists control traffic flowing into and out of Subnets\n    within a Virtual Cloud Network. Monitoring and alerting on changes to Security Lists will\n    help in identifying changes to these security controls.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\n    the Compartment that hosts the rules Find and click the Rule that handles Security List\n    Changes (if any) Click the Edit Rule button and verify that the RuleConditions section\n    contains a condition for the Service Networking and Event Types: Security List  Change\n    Compartment , Security List  Create , Security List - Delete and Security List  Update\n    Verify that in the Actions section the Action Type contains: Notifications and that a\n    valid Topic is referenced. From CLI: Find the OCID of the specific Event Rule based on\n    Display Name and Compartment OCID oci events rule list --compartment-id <compartment-ocid>\n    --query \"data [?\\\"display-name\\\"=='<display-name>']\".{\"id:id\"} --output table List the\n    details of a specific Event Rule based on the OCID of the rule. oci events rule get\n    --rule-id <rule-ocid> In the JSON output locate the Conditions key value pair and verify\n    that the following Conditions are present:\n\n    com.oraclecloud.virtualnetwork.changesecuritylistcompartment\n    com.oraclecloud.virtualnetwork.createsecuritylist\n    com.oraclecloud.virtualnetwork.deletesecuritylist\n    com.oraclecloud.virtualnetwork.updatesecuritylist Verify the value of the is-enabled\n    attribute is true In the JSON output verify that actionType is ONS and locate the topic-id\n    Verify the correct topic is used by checking the topic name oci ons topic get --topic-id\n    <topic-id> --query data.{\"name:name\"} --output table\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\n    the compartment that should host the rule Click Create Rule Provide a Display Name and\n    Description Create a Rule Condition by selecting Networking in the Service Name Drop-down\n    and selecting Security List  Change Compartment , Security List  Create , Security List\n    - Delete and Security List  Update In the Actions section select Notifications as Action\n    Type Select the Compartment that hosts the Topic to be used. Select the Topic to be used\n    Optionally add Tags to the Rule Click Create Rule From CLI: Find the topic-id of the topic\n    the Event Rule should use for sending Notifications by using the topic name and\n    Compartment OCID oci ons topic list --compartment-id <compartment-ocid> --all --query\n    \"data [?name=='<topic-name>']\".{\"name:name,topic_id:\\\"topic-id\\\"\"} --output table Create a\n    JSON file to be used when creating the Event Rule. Replace topic-id, display name,\n    description and compartment OCID. { \"actions\": { \"actions\": [ { \"actionType\": \"ONS\",\n    \"isEnabled\": true, \"topicId\": \"<topic-id>\" }] }, \"condition\":\n\n    \"{\\\"eventType\\\":[\\\"com.oraclecloud.virtualnetwork.changesecuritylistcompartment\\\",\\\"com.oraclecloud.virtualnetwork.createsecuritylist\\\",\\\"com.oraclecloud.virtualnetwork.deletesecuritylist\\\",\\\"com.oraclecloud.virtualnetwork.updatesecuritylist\\\"],\\\"data\\\":{}}\",\n    \"displayName\": \"<display-name>\", \"description\": \"<description>\", \"isEnabled\": true,\n    \"compartmentId\": \"<compartment-ocid>\" } Create the actual event rule oci events rule\n    create --from-json file://event_rule.json Note in the JSON returned that it lists the\n    parameters specified in the JSON file provided and that there is an OCID provided for the\n    Event Rule\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    \"There is no performance\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-4_10'\n  tag severity: 'medium'\n  tag gid: 'CIS-4_10'\n  tag rid: 'xccdf_cis_cis_rule_4_10'\n  tag stig_id: '4.1'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-002323',\n    'CCI-000364',\n    'CCI-000366',\n    'CCI-000381',\n    'CCI-001199',\n    'CCI-000540',\n    'CCI-002472'\n  ]\n\n  tag nist: [\n    'AC-18 a',\n    'CM-6 a',\n    'CM-6 b',\n    'CM-7 a',\n    'SC-28',\n    'CP-9 (d)',\n    'SC-28'\n  ]\n\n  required_rule_conditions = [\n    'com.oraclecloud.virtualnetwork.changesecuritylistcompartment',\n    'com.oraclecloud.virtualnetwork.createsecuritylist',\n    'com.oraclecloud.virtualnetwork.deletesecuritylist',\n    'com.oraclecloud.virtualnetwork.updatesecuritylist'\n  ]\n\n  tenancy_ocid = input('tenancy_ocid')\n  security_list_notification_topic = input('security_list_notification_topic')\n\n  regions = json(command: 'oci iam region-subscription list --all').params.fetch('data', []).map { |region| region['region-name'] }.compact\n\n  findings = regions.each_with_object([]) do |region, missing|\n    rules = json(command: %(oci events rule list --compartment-id \"#{tenancy_ocid}\" --region \"#{region}\" --all 2>/dev/null)).params.fetch('data', [])\n\n    rule_present = rules.any? do |rule|\n      rule_details = json(command: %(oci events rule get --rule-id \"#{rule['id']}\" --region \"#{region}\" 2>/dev/null)).params.fetch('data', {})\n\n      next false unless rule_details['is-enabled']\n\n      condition_data = begin\n        json(content: rule_details['condition'].to_s).params\n      rescue StandardError\n        {}\n      end\n\n      event_types = condition_data['eventType']\n      next false unless (required_rule_conditions - event_types).empty?\n\n      actions = rule_details.dig('actions', 'actions') || []\n      actions.any? do |action|\n        next false unless action['action-type'] == 'ONS' && action['is-enabled']\n\n        topic_id = action['topic-id']\n        next false if topic_id.to_s.strip.empty?\n\n        topic = json(command: %(oci ons topic get --topic-id \"#{topic_id}\" --region \"#{region}\" 2>/dev/null)).params.fetch('data', {})\n        topic['name'] == security_list_notification_topic && topic['lifecycle-state'] == 'ACTIVE'\n      end\n    end\n\n    missing << { region: region, issue: 'Missing enabled security list change notification rule(s)' } unless rule_present\n  end\n\n  describe 'Ensure a notification is configured for security list changes' do\n    subject { findings }\n    it { should be_empty }\n  end\nend\n","source_location":{"line":1,"ref":"./controls/4_10.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Ensure a notification is configured for security list changes is expected to be empty","run_time":0.00109,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Ensure a notification is configured for security list changes"}],"status":"passed"},{"id":"4_11","title":"Ensure a notification is configured for network security group changes","desc":"It is recommended to setup an Event Rule and Notification that gets triggered when network\nsecurity groups are created, updated or deleted. Event Rules are compartment scoped and\nwill detect events in child compartments, it is recommended to create the Event rule at\nthe root compartment level. Network Security Groups control traffic flowing between\nVirtual Network Cards attached to Compute instances. Monitoring and alerting on changes to\nNetwork Security Groups will help in identifying changes these security controls.","descriptions":[{"label":"default","data":"It is recommended to setup an Event Rule and Notification that gets triggered when network\nsecurity groups are created, updated or deleted. Event Rules are compartment scoped and\nwill detect events in child compartments, it is recommended to create the Event rule at\nthe root compartment level. Network Security Groups control traffic flowing between\nVirtual Network Cards attached to Compute instances. Monitoring and alerting on changes to\nNetwork Security Groups will help in identifying changes these security controls."},{"label":"check","data":"From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\nthe Compartment that hosts the rules Find and click the Rule that handles Network Security\nGroup Changes (if any) Click the Edit Rule button and verify that the RuleConditions\nsection contains a condition for the Service Networking and Event Types: Network Security\nGroup  Change Compartment , Network Security Group  Create , Network Security Group -\nDelete and Network Security Group  Update Verify that in the Actions section the Action\nType contains: Notifications and that a valid Topic is referenced. From CLI: Find the OCID\nof the specific Event Rule based on Display Name and Compartment OCID oci events rule list\n--compartment-id <compartment-ocid> --query \"data [?\"display-name\"=='<display name\nused>']\".{\"id:id\"} --output table List the details of a specific Event Rule based on the\nOCID of the rule. oci events rule get --rule-id <rule-id> In the JSON output locate the\nConditions key value pair and verify that the following conditions are present:\n\ncom.oraclecloud.virtualnetwork.changenetworksecuritygroupcompartment\ncom.oraclecloud.virtualnetwork.createnetworksecuritygroup\ncom.oraclecloud.virtualnetwork.deletenetworksecuritygroup\ncom.oraclecloud.virtualnetwork.updatenetworksecuritygroup Verify the value of the\nis-enabled attribute is true In the JSON output verify that actionType is ONS and locate\nthe topic-id Verify the correct topic is used by checking the topic name oci ons topic get\n--topic-id <topic-id> --query data.{\"name:name\"} --output table"},{"label":"fix","data":"From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\nthe compartment that should host the rule Click Create Rule Provide a Display Name and\nDescription Create a Rule Condition by selecting Networking in the Service Name Drop-down\nand selecting Network Security Group  Change Compartment , Network Security Group \nCreate , Network Security Group - Delete and Network Security Group  Update In the\nActions section select Notifications as Action Type Select the Compartment that hosts the\nTopic to be used. Select the Topic to be used Optionally add Tags to the Rule Click Create\nRule From CLI: Find the topic-id of the topic the Event Rule should use for sending\nNotifications by using the topic name and Compartment OCID oci ons topic list\n--compartment-id <compartment-ocid> --all --query \"data\n[?name=='<topic-name>']\".{\"name:name,topic_id:\"topic-id\"\"} --output table Create a JSON\nfile to be used when creating the Event Rule. Replace topic id, display name, description\nand compartment OCID. { \"actions\": { \"actions\": [ { \"actionType\": \"ONS\", \"isEnabled\":\n\ntrue, \"topicId\": \"<topic-id>\" } ] }, \"condition\":\n\n\"{\"eventType\":[\"com.oraclecloud.virtualnetwork.changenetworksecuritygroupcompartment\",\"com.oraclecloud.virtualnetwork.createnetworksecuritygroup\",\"com.oraclecloud.virtualnetwork.deletenetworksecuritygroup\",\"com.oraclecloud.virtualnetwork.updatenetworksecuritygroup\"],\"data\":{}}\",\n\"displayName\": \"<display-name>\", \"description\": \"<description>\", \"isEnabled\": true,\n\"compartmentId\": \"<compartment-ocid>\" } Create the actual event rule oci events rule\ncreate --from-json file://event_rule.json Note in the JSON returned that it lists the\nparameters specified in the JSON file provided and that there is an OCID provided for the\nEvent Rule"},{"label":"potential_impacts","data":"\"There is no performance"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-4_11","severity":"medium","gid":"CIS-4_11","rid":"xccdf_cis_cis_rule_4_11","stig_id":"4.11","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-002323","CCI-000364","CCI-000366","CCI-000381","CCI-000381","CCI-000382","CCI-000380"],"nist":["AC-18 a","CM-6 a","CM-6 b","CM-7 a","CM-7 a","CM-7 b","CM-7 b"]},"code":"control '4_11' do\n  title 'Ensure a notification is configured for network security group changes'\n\n  desc <<~DESC\n    It is recommended to setup an Event Rule and Notification that gets triggered when network\n    security groups are created, updated or deleted. Event Rules are compartment scoped and\n    will detect events in child compartments, it is recommended to create the Event rule at\n    the root compartment level. Network Security Groups control traffic flowing between\n    Virtual Network Cards attached to Compute instances. Monitoring and alerting on changes to\n    Network Security Groups will help in identifying changes these security controls.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\n    the Compartment that hosts the rules Find and click the Rule that handles Network Security\n    Group Changes (if any) Click the Edit Rule button and verify that the RuleConditions\n    section contains a condition for the Service Networking and Event Types: Network Security\n    Group  Change Compartment , Network Security Group  Create , Network Security Group -\n    Delete and Network Security Group  Update Verify that in the Actions section the Action\n    Type contains: Notifications and that a valid Topic is referenced. From CLI: Find the OCID\n    of the specific Event Rule based on Display Name and Compartment OCID oci events rule list\n    --compartment-id <compartment-ocid> --query \"data [?\\\"display-name\\\"=='<display name\n    used>']\".{\"id:id\"} --output table List the details of a specific Event Rule based on the\n    OCID of the rule. oci events rule get --rule-id <rule-id> In the JSON output locate the\n    Conditions key value pair and verify that the following conditions are present:\n\n    com.oraclecloud.virtualnetwork.changenetworksecuritygroupcompartment\n    com.oraclecloud.virtualnetwork.createnetworksecuritygroup\n    com.oraclecloud.virtualnetwork.deletenetworksecuritygroup\n    com.oraclecloud.virtualnetwork.updatenetworksecuritygroup Verify the value of the\n    is-enabled attribute is true In the JSON output verify that actionType is ONS and locate\n    the topic-id Verify the correct topic is used by checking the topic name oci ons topic get\n    --topic-id <topic-id> --query data.{\"name:name\"} --output table\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\n    the compartment that should host the rule Click Create Rule Provide a Display Name and\n    Description Create a Rule Condition by selecting Networking in the Service Name Drop-down\n    and selecting Network Security Group  Change Compartment , Network Security Group \n    Create , Network Security Group - Delete and Network Security Group  Update In the\n    Actions section select Notifications as Action Type Select the Compartment that hosts the\n    Topic to be used. Select the Topic to be used Optionally add Tags to the Rule Click Create\n    Rule From CLI: Find the topic-id of the topic the Event Rule should use for sending\n    Notifications by using the topic name and Compartment OCID oci ons topic list\n    --compartment-id <compartment-ocid> --all --query \"data\n    [?name=='<topic-name>']\".{\"name:name,topic_id:\\\"topic-id\\\"\"} --output table Create a JSON\n    file to be used when creating the Event Rule. Replace topic id, display name, description\n    and compartment OCID. { \"actions\": { \"actions\": [ { \"actionType\": \"ONS\", \"isEnabled\":\n\n    true, \"topicId\": \"<topic-id>\" } ] }, \"condition\":\n\n    \"{\\\"eventType\\\":[\\\"com.oraclecloud.virtualnetwork.changenetworksecuritygroupcompartment\\\",\\\"com.oraclecloud.virtualnetwork.createnetworksecuritygroup\\\",\\\"com.oraclecloud.virtualnetwork.deletenetworksecuritygroup\\\",\\\"com.oraclecloud.virtualnetwork.updatenetworksecuritygroup\\\"],\\\"data\\\":{}}\",\n    \"displayName\": \"<display-name>\", \"description\": \"<description>\", \"isEnabled\": true,\n    \"compartmentId\": \"<compartment-ocid>\" } Create the actual event rule oci events rule\n    create --from-json file://event_rule.json Note in the JSON returned that it lists the\n    parameters specified in the JSON file provided and that there is an OCID provided for the\n    Event Rule\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    \"There is no performance\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-4_11'\n  tag severity: 'medium'\n  tag gid: 'CIS-4_11'\n  tag rid: 'xccdf_cis_cis_rule_4_11'\n  tag stig_id: '4.11'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-002323',\n    'CCI-000364',\n    'CCI-000366',\n    'CCI-000381',\n    'CCI-000381',\n    'CCI-000382',\n    'CCI-000380'\n  ]\n\n  tag nist: [\n    'AC-18 a',\n    'CM-6 a',\n    'CM-6 b',\n    'CM-7 a',\n    'CM-7 a',\n    'CM-7 b',\n    'CM-7 b'\n  ]\n\n  required_rule_conditions = [\n    'com.oraclecloud.virtualnetwork.changenetworksecuritygroupcompartment',\n    'com.oraclecloud.virtualnetwork.createnetworksecuritygroup',\n    'com.oraclecloud.virtualnetwork.deletenetworksecuritygroup',\n    'com.oraclecloud.virtualnetwork.updatenetworksecuritygroup'\n  ]\n\n  tenancy_ocid = input('tenancy_ocid')\n  network_security_notification_topic = input('network_security_notification_topic')\n\n  regions = json(command: 'oci iam region-subscription list --all').params.fetch('data', []).map { |region| region['region-name'] }.compact\n\n  findings = regions.each_with_object([]) do |region, missing|\n    rules = json(command: %(oci events rule list --compartment-id \"#{tenancy_ocid}\" --region \"#{region}\" --all 2>/dev/null)).params.fetch('data', [])\n\n    rule_present = rules.any? do |rule|\n      rule_details = json(command: %(oci events rule get --rule-id \"#{rule['id']}\" --region \"#{region}\" 2>/dev/null)).params.fetch('data', {})\n\n      next false unless rule_details['is-enabled']\n\n      condition_data = begin\n        json(content: rule_details['condition'].to_s).params\n      rescue StandardError\n        {}\n      end\n\n      event_types = condition_data['eventType']\n      next false unless (required_rule_conditions - event_types).empty?\n\n      actions = rule_details.dig('actions', 'actions') || []\n      actions.any? do |action|\n        next false unless action['action-type'] == 'ONS' && action['is-enabled']\n\n        topic_id = action['topic-id']\n        next false if topic_id.to_s.strip.empty?\n\n        topic = json(command: %(oci ons topic get --topic-id \"#{topic_id}\" --region \"#{region}\" 2>/dev/null)).params.fetch('data', {})\n        topic['name'] == network_security_notification_topic && topic['lifecycle-state'] == 'ACTIVE'\n      end\n    end\n\n    missing << { region: region, issue: 'Missing enabled network security group change notification rule(s)' } unless rule_present\n  end\n\n  describe 'Ensure a notification is configured for network security group changes' do\n    subject { findings }\n    it { should be_empty }\n  end\nend\n","source_location":{"line":1,"ref":"./controls/4_11.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Ensure a notification is configured for network security group changes is expected to be empty","run_time":0.001008,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Ensure a notification is configured for network security group changes"}],"status":"passed"},{"id":"4_12","title":"Ensure a notification is configured for changes to network gateways","desc":"It is recommended to setup an Event Rule and Notification that gets triggered when Network\nGateways are created, updated, deleted, attached, detached, or moved. This recommendation\nincludes Internet Gateways, Dynamic Routing Gateways, Service Gateways, Local Peering\nGateways, and NAT Gateways. Event Rules are compartment scoped and will detect events in\nchild compartments, it is recommended to create the Event rule at the root compartment\nlevel. Network Gateways act as routers between VCNs and the Internet, Oracle Services\nNetworks, other VCNS, and on-premise networks. Monitoring and alerting on changes to\nNetwork Gateways will help in identifying changes to the security posture.","descriptions":[{"label":"default","data":"It is recommended to setup an Event Rule and Notification that gets triggered when Network\nGateways are created, updated, deleted, attached, detached, or moved. This recommendation\nincludes Internet Gateways, Dynamic Routing Gateways, Service Gateways, Local Peering\nGateways, and NAT Gateways. Event Rules are compartment scoped and will detect events in\nchild compartments, it is recommended to create the Event rule at the root compartment\nlevel. Network Gateways act as routers between VCNs and the Internet, Oracle Services\nNetworks, other VCNS, and on-premise networks. Monitoring and alerting on changes to\nNetwork Gateways will help in identifying changes to the security posture."},{"label":"check","data":"From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\nthe Compartment that hosts the rules Find and click the Rule that handles Network Gateways\nChanges (if any) Click the Edit Rule button and verify that the RuleConditions section\ncontains a condition for the Service Networking and Event Types: DRG  Create DRG  Delete\nDRG  Update DRG Attachment  Create DRG Attachment  Delete DRG Attachment  Update\nInternet Gateway  Create Internet Gateway  Delete Internet Gateway  Update Internet\nGateway  Change Compartment Local Peering Gateway  Create Local Peering Gateway  Delete\nEnd Local Peering Gateway  Update Local Peering Gateway  Change Compartment NAT Gateway\n Create NAT Gateway  Delete NAT Gateway  Update NAT Gateway  Change Compartment\nService Gateway  Create Service Gateway  Delete End Service Gateway  Update Service\nGateway  Attach Service Service Gateway  Detach Service Service Gateway  Change\nCompartment Verify that in the Actions section the Action Type contains: Notifications and\nthat a valid Topic is referenced. From CLI: Find the OCID of the specific Event Rule based\non Display Name and Compartment OCID oci events rule list --compartment-id\n<compartment-ocid> --query \"data [?\"display-name\"=='<display-name>']\".{\"id:id\"} --output\ntable List the details of a specific Event Rule based on the OCID of the rule. oci events\nrule get --rule-id <rule-id> In the JSON output locate the Conditions key value pair and\nverify that the following Conditions are present: com.oraclecloud.virtualnetwork.createdrg\ncom.oraclecloud.virtualnetwork.deletedrg com.oraclecloud.virtualnetwork.updatedrg\ncom.oraclecloud.virtualnetwork.createdrgattachment\ncom.oraclecloud.virtualnetwork.deletedrgattachment\ncom.oraclecloud.virtualnetwork.updatedrgattachment\ncom.oraclecloud.virtualnetwork.changeinternetgatewaycompartment\ncom.oraclecloud.virtualnetwork.createinternetgateway\ncom.oraclecloud.virtualnetwork.deleteinternetgateway\ncom.oraclecloud.virtualnetwork.updateinternetgateway\ncom.oraclecloud.virtualnetwork.changelocalpeeringgatewaycompartment\ncom.oraclecloud.virtualnetwork.createlocalpeeringgateway\ncom.oraclecloud.virtualnetwork.deletelocalpeeringgateway.end\ncom.oraclecloud.virtualnetwork.updatelocalpeeringgateway\ncom.oraclecloud.natgateway.changenatgatewaycompartment\ncom.oraclecloud.natgateway.createnatgateway com.oraclecloud.natgateway.deletenatgateway\ncom.oraclecloud.natgateway.updatenatgateway com.oraclecloud.servicegateway.attachserviceid\ncom.oraclecloud.servicegateway.changeservicegatewaycompartment\ncom.oraclecloud.servicegateway.createservicegateway\ncom.oraclecloud.servicegateway.deleteservicegateway.end\ncom.oraclecloud.servicegateway.detachserviceid\ncom.oraclecloud.servicegateway.updateservicegateway Verify the value of the is-enabled\nattribute is true In the JSON output verify that actionType is ONS and locate the topic-id\nVerify the correct topic is used by checking the topic name oci ons topic get --topic-id\n<topic-id> --query data.{\"name:name\"} --output table"},{"label":"fix","data":"From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\nthe compartment that should host the rule Click Create Rule Provide a Display Name and\nDescription Create a Rule Condition by selecting Networking in the Service Name Drop-down\nand selecting: DRG  Create DRG  Delete DRG  Update DRG Attachment  Create DRG\nAttachment  Delete DRG Attachment  Update Internet Gateway  Create Internet Gateway \nDelete Internet Gateway  Update Internet Gateway  Change Compartment Local Peering\nGateway  Create Local Peering Gateway  Delete End Local Peering Gateway  Update Local\nPeering Gateway  Change Compartment NAT Gateway  Create NAT Gateway  Delete NAT Gateway\n Update NAT Gateway  Change Compartment Service Gateway  Create Service Gateway \nDelete End Service Gateway  Update Service Gateway  Attach Service Service Gateway \nDetach Service Service Gateway  Change Compartment In the Actions section select\nNotifications as Action Type Select the Compartment that hosts the Topic to be used.\nSelect the Topic to be used Optionally add Tags to the Rule Click Create Rule From CLI:\n\nFind the topic-id of the topic the Event Rule should use for sending Notifications by\nusing the topic name and Compartment OCID oci ons topic list --compartment-id\n<compartment-ocid> --all --query \"data\n[?name=='<topic_name>']\".{\"name:name,topic_id:\"topic-id\"\"} --output table Create a JSON\nfile to be used when creating the Event Rule. Replace topic id, display name, description\nand compartment OCID. { \"actions\": { \"actions\": [ { \"actionType\": \"ONS\", \"isEnabled\":\n\ntrue, \"topicId\": \"<topic-id>\" } ] }, \"condition\":\n\n\"{\"eventType\":[\"com.oraclecloud.virtualnetwork.createdrg\",\"com.oraclecloud.virtualnetwork.deletedrg\",\"com.oraclecloud.virtualnetwork.updatedrg\",\"com.oraclecloud.virtualnetwork.createdrgattachment\",\"com.oraclecloud.virtualnetwork.deletedrgattachment\",\"com.oraclecloud.virtualnetwork.updatedrgattachment\",\"com.oraclecloud.virtualnetwork.changeinternetgatewaycompartment\",\"com.oraclecloud.virtualnetwork.createinternetgateway\",\"com.oraclecloud.virtualnetwork.deleteinternetgateway\",\"com.oraclecloud.virtualnetwork.updateinternetgateway\",\"com.oraclecloud.virtualnetwork.changelocalpeeringgatewaycompartment\",\"com.oraclecloud.virtualnetwork.createlocalpeeringgateway\",\"com.oraclecloud.virtualnetwork.deletelocalpeeringgateway.end\",\"com.oraclecloud.virtualnetwork.updatelocalpeeringgateway\",\"com.oraclecloud.natgateway.changenatgatewaycompartment\",\"com.oraclecloud.natgateway.createnatgateway\",\"com.oraclecloud.natgateway.deletenatgateway\",\"com.oraclecloud.natgateway.updatenatgateway\",\"com.oraclecloud.servicegateway.attachserviceid\",\"com.oraclecloud.servicegateway.changeservicegatewaycompartment\",\"com.oraclecloud.servicegateway.createservicegateway\",\"com.oraclecloud.servicegateway.deleteservicegateway.end\",\"com.oraclecloud.servicegateway.detachserviceid\",\"com.oraclecloud.servicegateway.updateservicegateway\"],\"data\":{}}\",\n\"displayName\": \"<display-name>\", \"description\": \"<description>\", \"isEnabled\": true,\n\"compartmentId\": \"<compartment-ocid>\" } Create the actual event rule oci events rule\ncreate --from-json file://event_rule.json Note in the JSON returned that it lists the\nparameters specified in the JSON file provided and that there is an OCID provided for the\nEvent Rule"},{"label":"potential_impacts","data":"\"There is no performance"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-4_12","severity":"medium","gid":"CIS-4_12","rid":"xccdf_cis_cis_rule_4_12","stig_id":"4.12","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-002323","CCI-000364","CCI-000366","CCI-000381","CCI-001199","CCI-000540","CCI-002472"],"nist":["AC-18 a","CM-6 a","CM-6 b","CM-7 a","SC-28","CP-9 (d)","SC-28"]},"code":"control '4_12' do\n  title 'Ensure a notification is configured for changes to network gateways'\n\n  desc <<~DESC\n    It is recommended to setup an Event Rule and Notification that gets triggered when Network\n    Gateways are created, updated, deleted, attached, detached, or moved. This recommendation\n    includes Internet Gateways, Dynamic Routing Gateways, Service Gateways, Local Peering\n    Gateways, and NAT Gateways. Event Rules are compartment scoped and will detect events in\n    child compartments, it is recommended to create the Event rule at the root compartment\n    level. Network Gateways act as routers between VCNs and the Internet, Oracle Services\n    Networks, other VCNS, and on-premise networks. Monitoring and alerting on changes to\n    Network Gateways will help in identifying changes to the security posture.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\n    the Compartment that hosts the rules Find and click the Rule that handles Network Gateways\n    Changes (if any) Click the Edit Rule button and verify that the RuleConditions section\n    contains a condition for the Service Networking and Event Types: DRG  Create DRG  Delete\n    DRG  Update DRG Attachment  Create DRG Attachment  Delete DRG Attachment  Update\n    Internet Gateway  Create Internet Gateway  Delete Internet Gateway  Update Internet\n    Gateway  Change Compartment Local Peering Gateway  Create Local Peering Gateway  Delete\n    End Local Peering Gateway  Update Local Peering Gateway  Change Compartment NAT Gateway\n     Create NAT Gateway  Delete NAT Gateway  Update NAT Gateway  Change Compartment\n    Service Gateway  Create Service Gateway  Delete End Service Gateway  Update Service\n    Gateway  Attach Service Service Gateway  Detach Service Service Gateway  Change\n    Compartment Verify that in the Actions section the Action Type contains: Notifications and\n    that a valid Topic is referenced. From CLI: Find the OCID of the specific Event Rule based\n    on Display Name and Compartment OCID oci events rule list --compartment-id\n    <compartment-ocid> --query \"data [?\\\"display-name\\\"=='<display-name>']\".{\"id:id\"} --output\n    table List the details of a specific Event Rule based on the OCID of the rule. oci events\n    rule get --rule-id <rule-id> In the JSON output locate the Conditions key value pair and\n    verify that the following Conditions are present: com.oraclecloud.virtualnetwork.createdrg\n    com.oraclecloud.virtualnetwork.deletedrg com.oraclecloud.virtualnetwork.updatedrg\n    com.oraclecloud.virtualnetwork.createdrgattachment\n    com.oraclecloud.virtualnetwork.deletedrgattachment\n    com.oraclecloud.virtualnetwork.updatedrgattachment\n    com.oraclecloud.virtualnetwork.changeinternetgatewaycompartment\n    com.oraclecloud.virtualnetwork.createinternetgateway\n    com.oraclecloud.virtualnetwork.deleteinternetgateway\n    com.oraclecloud.virtualnetwork.updateinternetgateway\n    com.oraclecloud.virtualnetwork.changelocalpeeringgatewaycompartment\n    com.oraclecloud.virtualnetwork.createlocalpeeringgateway\n    com.oraclecloud.virtualnetwork.deletelocalpeeringgateway.end\n    com.oraclecloud.virtualnetwork.updatelocalpeeringgateway\n    com.oraclecloud.natgateway.changenatgatewaycompartment\n    com.oraclecloud.natgateway.createnatgateway com.oraclecloud.natgateway.deletenatgateway\n    com.oraclecloud.natgateway.updatenatgateway com.oraclecloud.servicegateway.attachserviceid\n    com.oraclecloud.servicegateway.changeservicegatewaycompartment\n    com.oraclecloud.servicegateway.createservicegateway\n    com.oraclecloud.servicegateway.deleteservicegateway.end\n    com.oraclecloud.servicegateway.detachserviceid\n    com.oraclecloud.servicegateway.updateservicegateway Verify the value of the is-enabled\n    attribute is true In the JSON output verify that actionType is ONS and locate the topic-id\n    Verify the correct topic is used by checking the topic name oci ons topic get --topic-id\n    <topic-id> --query data.{\"name:name\"} --output table\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\n    the compartment that should host the rule Click Create Rule Provide a Display Name and\n    Description Create a Rule Condition by selecting Networking in the Service Name Drop-down\n    and selecting: DRG  Create DRG  Delete DRG  Update DRG Attachment  Create DRG\n    Attachment  Delete DRG Attachment  Update Internet Gateway  Create Internet Gateway \n    Delete Internet Gateway  Update Internet Gateway  Change Compartment Local Peering\n    Gateway  Create Local Peering Gateway  Delete End Local Peering Gateway  Update Local\n    Peering Gateway  Change Compartment NAT Gateway  Create NAT Gateway  Delete NAT Gateway\n     Update NAT Gateway  Change Compartment Service Gateway  Create Service Gateway \n    Delete End Service Gateway  Update Service Gateway  Attach Service Service Gateway \n    Detach Service Service Gateway  Change Compartment In the Actions section select\n    Notifications as Action Type Select the Compartment that hosts the Topic to be used.\n    Select the Topic to be used Optionally add Tags to the Rule Click Create Rule From CLI:\n\n    Find the topic-id of the topic the Event Rule should use for sending Notifications by\n    using the topic name and Compartment OCID oci ons topic list --compartment-id\n    <compartment-ocid> --all --query \"data\n    [?name=='<topic_name>']\".{\"name:name,topic_id:\\\"topic-id\\\"\"} --output table Create a JSON\n    file to be used when creating the Event Rule. Replace topic id, display name, description\n    and compartment OCID. { \"actions\": { \"actions\": [ { \"actionType\": \"ONS\", \"isEnabled\":\n\n    true, \"topicId\": \"<topic-id>\" } ] }, \"condition\":\n\n    \"{\\\"eventType\\\":[\\\"com.oraclecloud.virtualnetwork.createdrg\\\",\\\"com.oraclecloud.virtualnetwork.deletedrg\\\",\\\"com.oraclecloud.virtualnetwork.updatedrg\\\",\\\"com.oraclecloud.virtualnetwork.createdrgattachment\\\",\\\"com.oraclecloud.virtualnetwork.deletedrgattachment\\\",\\\"com.oraclecloud.virtualnetwork.updatedrgattachment\\\",\\\"com.oraclecloud.virtualnetwork.changeinternetgatewaycompartment\\\",\\\"com.oraclecloud.virtualnetwork.createinternetgateway\\\",\\\"com.oraclecloud.virtualnetwork.deleteinternetgateway\\\",\\\"com.oraclecloud.virtualnetwork.updateinternetgateway\\\",\\\"com.oraclecloud.virtualnetwork.changelocalpeeringgatewaycompartment\\\",\\\"com.oraclecloud.virtualnetwork.createlocalpeeringgateway\\\",\\\"com.oraclecloud.virtualnetwork.deletelocalpeeringgateway.end\\\",\\\"com.oraclecloud.virtualnetwork.updatelocalpeeringgateway\\\",\\\"com.oraclecloud.natgateway.changenatgatewaycompartment\\\",\\\"com.oraclecloud.natgateway.createnatgateway\\\",\\\"com.oraclecloud.natgateway.deletenatgateway\\\",\\\"com.oraclecloud.natgateway.updatenatgateway\\\",\\\"com.oraclecloud.servicegateway.attachserviceid\\\",\\\"com.oraclecloud.servicegateway.changeservicegatewaycompartment\\\",\\\"com.oraclecloud.servicegateway.createservicegateway\\\",\\\"com.oraclecloud.servicegateway.deleteservicegateway.end\\\",\\\"com.oraclecloud.servicegateway.detachserviceid\\\",\\\"com.oraclecloud.servicegateway.updateservicegateway\\\"],\\\"data\\\":{}}\",\n    \"displayName\": \"<display-name>\", \"description\": \"<description>\", \"isEnabled\": true,\n    \"compartmentId\": \"<compartment-ocid>\" } Create the actual event rule oci events rule\n    create --from-json file://event_rule.json Note in the JSON returned that it lists the\n    parameters specified in the JSON file provided and that there is an OCID provided for the\n    Event Rule\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    \"There is no performance\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-4_12'\n  tag severity: 'medium'\n  tag gid: 'CIS-4_12'\n  tag rid: 'xccdf_cis_cis_rule_4_12'\n  tag stig_id: '4.12'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-002323',\n    'CCI-000364',\n    'CCI-000366',\n    'CCI-000381',\n    'CCI-001199',\n    'CCI-000540',\n    'CCI-002472'\n  ]\n\n  tag nist: [\n    'AC-18 a',\n    'CM-6 a',\n    'CM-6 b',\n    'CM-7 a',\n    'SC-28',\n    'CP-9 (d)',\n    'SC-28'\n  ]\n\n  required_rule_conditions = [\n    'com.oraclecloud.virtualnetwork.createdrg',\n    'com.oraclecloud.virtualnetwork.deletedrg',\n    'com.oraclecloud.virtualnetwork.updatedrg',\n    'com.oraclecloud.virtualnetwork.createdrgattachment',\n    'com.oraclecloud.virtualnetwork.deletedrgattachment',\n    'com.oraclecloud.virtualnetwork.updatedrgattachment',\n    'com.oraclecloud.virtualnetwork.changeinternetgatewaycompartment',\n    'com.oraclecloud.virtualnetwork.createinternetgateway',\n    'com.oraclecloud.virtualnetwork.deleteinternetgateway',\n    'com.oraclecloud.virtualnetwork.updateinternetgateway',\n    'com.oraclecloud.virtualnetwork.changelocalpeeringgatewaycompartment',\n    'com.oraclecloud.virtualnetwork.createlocalpeeringgateway',\n    'com.oraclecloud.virtualnetwork.deletelocalpeeringgateway.end',\n    'com.oraclecloud.virtualnetwork.updatelocalpeeringgateway',\n    'com.oraclecloud.natgateway.changenatgatewaycompartment',\n    'com.oraclecloud.natgateway.createnatgateway',\n    'com.oraclecloud.natgateway.deletenatgateway',\n    'com.oraclecloud.natgateway.updatenatgateway',\n    'com.oraclecloud.servicegateway.attachserviceid',\n    'com.oraclecloud.servicegateway.changeservicegatewaycompartment',\n    'com.oraclecloud.servicegateway.createservicegateway',\n    'com.oraclecloud.servicegateway.deleteservicegateway.end',\n    'com.oraclecloud.servicegateway.detachserviceid',\n    'com.oraclecloud.servicegateway.updateservicegateway'\n  ]\n\n  tenancy_ocid = input('tenancy_ocid')\n  network_gateway_notification_topic = input('network_gateway_notification_topic')\n\n  regions = json(command: 'oci iam region-subscription list --all').params.fetch('data', []).map { |region| region['region-name'] }.compact\n\n  findings = regions.each_with_object([]) do |region, missing|\n    rules = json(command: %(oci events rule list --compartment-id \"#{tenancy_ocid}\" --region \"#{region}\" --all 2>/dev/null)).params.fetch('data', [])\n\n    rule_present = rules.any? do |rule|\n      rule_details = json(command: %(oci events rule get --rule-id \"#{rule['id']}\" --region \"#{region}\" 2>/dev/null)).params.fetch('data', {})\n\n      next false unless rule_details['is-enabled']\n\n      condition_data = begin\n        json(content: rule_details['condition'].to_s).params\n      rescue StandardError\n        {}\n      end\n\n      event_types = condition_data['eventType']\n      next false unless (required_rule_conditions - event_types).empty?\n\n      actions = rule_details.dig('actions', 'actions') || []\n      actions.any? do |action|\n        next false unless action['action-type'] == 'ONS' && action['is-enabled']\n\n        topic_id = action['topic-id']\n        next false if topic_id.to_s.strip.empty?\n\n        topic = json(command: %(oci ons topic get --topic-id \"#{topic_id}\" --region \"#{region}\" 2>/dev/null)).params.fetch('data', {})\n        topic['name'] == network_gateway_notification_topic && topic['lifecycle-state'] == 'ACTIVE'\n      end\n    end\n\n    missing << { region: region, issue: 'Missing enabled network gateway change notification rule(s)' } unless rule_present\n  end\n\n  describe 'Ensure a notification is configured for changes to network gateways' do\n    subject { findings }\n    it { should be_empty }\n  end\nend\n","source_location":{"line":1,"ref":"./controls/4_12.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Ensure a notification is configured for changes to network gateways is expected to be empty","run_time":0.000998,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Ensure a notification is configured for changes to network gateways"}],"status":"passed"},{"id":"4_13","title":"Ensure VCN flow logging is enabled for all subnets","desc":"VCN flow logs record details about traffic that has been accepted or rejected based on the\nsecurity list rule. Enabling VCN flow logs enables you to monitor traffic flowing within\nyour virtual network and can be used to detect anomalous traffic.","descriptions":[{"label":"default","data":"VCN flow logs record details about traffic that has been accepted or rejected based on the\nsecurity list rule. Enabling VCN flow logs enables you to monitor traffic flowing within\nyour virtual network and can be used to detect anomalous traffic."},{"label":"check","data":"From Console (For Logging enabled Flow logs): Go to the Virtual Cloud Network (VCN) page (\n\nhttps://cloud.oracle.com/networking/vcns ) Select the Compartment Click on the name of\neach VCN Click on each subnet within the VCN Under Resources click on Logs or the\nMonitoring tab Verify that there is a log enabled for the subnet Click the Log Name Verify\nFlowlogs Capture Filter is set to No filter (collecting all logs) If there is a Capture\nfilter click the 'Capture Filter Name' Click Edit Verify Sampling rate is 100% Click\nCancel Verify there is a in the Rules list that is: Enabled, Traffic disposition: All,\nInclude/Exclude: Include, Source CIDR: Any, Destination CIDR: Any, IP Protocol: All From\nConsole (For Network Command Center Enabled Flow logs): Go to the Network Command Center\npage ( https://cloud.oracle.com/networking/network-command-center ) Click on Flow Logs\nClick on the Flow log Name Click Edit Verify Sampling rate is 100% Click Cancel Verify\nthere is a in the Rules list that is: Enabled, Traffic disposition: All, Include/Exclude:\n\nInclude, Source CIDR: Any, Destination CIDR: Any, IP Protocol: All"},{"label":"fix","data":"From Console: First, if a Capture filter has not already been created, create a Capture\n\nFilter by the following steps: Go to the Network Command Center page (\nhttps://cloud.oracle.com/networking/network-command-center ) Click 'Capture filters' Click\n'Create Capture filter' Type a name for the Capture filter in the Name box. Select 'Flow\nlog capture filter' For Sample rating select 100% Scroll to Rules For Traffic disposition\nselect All For Include/Exclude select Include Level Source IPv4 CIDR or IPv6 prefix and\nDestination IPv4 CIDR or IPv6 prefix empty For IP protocol select Include Click Create\nCapture filter Second, enable VCN flow logging for your VCN or subnet(s) by the following\nsteps: Go to the Logs page ( https://cloud.oracle.com/logging/logs ) Click the Enable\nService Log button in the middle of the screen. Select the relevant resource compartment.\nSelect Virtual Cloud Networks - Flow logs from the Service drop down menu. Select the\nrelevant resource level from the resource drop down menu either VCN or subnet . Select the\nrelevant resource from the resource drop down menu. Select the from the Log Category drop\ndown menu that either Flow Logs - subnet records or Flow Logs - vcn records . Select the\nCapture filter from above Type a name for your flow logs in the Log Name text box. Select\nthe Compartment for the Log Location Select the Log Group for the Log Location or Click\nCreate New Group to create a new log group Click the Enable Log button in the lower\nleft-hand corner."},{"label":"potential_impacts","data":"Enabling VCN flow logs will not affect the performance of your virtual network but it will\ngenerate additional use of object storage that should be controlled via object lifecycle\nmanagement. By default, VCN flow logs are stored for 30 days in object storage. Users can\nspecify a longer retention period."}],"impact":0.5,"refs":[],"tags":{"check_id":"C-4_13","severity":"medium","gid":"CIS-4_13","rid":"xccdf_cis_cis_rule_4_13","stig_id":"4.13","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-000011","CCI-002124","CCI-002123","CCI-002121","CCI-000123","CCI-000169","CCI-000172","CCI-000126","CCI-000130","CCI-000131","CCI-000132","CCI-000172","CCI-002110","CCI-002111","CCI-002122","CCI-001253","CCI-002641","CCI-001255","CCI-002654"],"nist":["AC-2 f","AC-2 h 2","AC-2 h 1","AC-2 f","AU-2 a","AU-12 a","AU-12 c","AU-2 c","AU-3 a","AU-3 b","AU-3 c","AU-12 c","AC-2 a","AC-2 a","AC-2 g","SI-4 a 1","SI-4 a 1","SI-4 c 1","SI-4 g"]},"code":"control '4_13' do\n  title 'Ensure VCN flow logging is enabled for all subnets'\n\n  desc <<~DESC\n    VCN flow logs record details about traffic that has been accepted or rejected based on the\n    security list rule. Enabling VCN flow logs enables you to monitor traffic flowing within\n    your virtual network and can be used to detect anomalous traffic.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console (For Logging enabled Flow logs): Go to the Virtual Cloud Network (VCN) page (\n\n    https://cloud.oracle.com/networking/vcns ) Select the Compartment Click on the name of\n    each VCN Click on each subnet within the VCN Under Resources click on Logs or the\n    Monitoring tab Verify that there is a log enabled for the subnet Click the Log Name Verify\n    Flowlogs Capture Filter is set to No filter (collecting all logs) If there is a Capture\n    filter click the 'Capture Filter Name' Click Edit Verify Sampling rate is 100% Click\n    Cancel Verify there is a in the Rules list that is: Enabled, Traffic disposition: All,\n    Include/Exclude: Include, Source CIDR: Any, Destination CIDR: Any, IP Protocol: All From\n    Console (For Network Command Center Enabled Flow logs): Go to the Network Command Center\n    page ( https://cloud.oracle.com/networking/network-command-center ) Click on Flow Logs\n    Click on the Flow log Name Click Edit Verify Sampling rate is 100% Click Cancel Verify\n    there is a in the Rules list that is: Enabled, Traffic disposition: All, Include/Exclude:\n\n    Include, Source CIDR: Any, Destination CIDR: Any, IP Protocol: All\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: First, if a Capture filter has not already been created, create a Capture\n\n    Filter by the following steps: Go to the Network Command Center page (\n    https://cloud.oracle.com/networking/network-command-center ) Click 'Capture filters' Click\n    'Create Capture filter' Type a name for the Capture filter in the Name box. Select 'Flow\n    log capture filter' For Sample rating select 100% Scroll to Rules For Traffic disposition\n    select All For Include/Exclude select Include Level Source IPv4 CIDR or IPv6 prefix and\n    Destination IPv4 CIDR or IPv6 prefix empty For IP protocol select Include Click Create\n    Capture filter Second, enable VCN flow logging for your VCN or subnet(s) by the following\n    steps: Go to the Logs page ( https://cloud.oracle.com/logging/logs ) Click the Enable\n    Service Log button in the middle of the screen. Select the relevant resource compartment.\n    Select Virtual Cloud Networks - Flow logs from the Service drop down menu. Select the\n    relevant resource level from the resource drop down menu either VCN or subnet . Select the\n    relevant resource from the resource drop down menu. Select the from the Log Category drop\n    down menu that either Flow Logs - subnet records or Flow Logs - vcn records . Select the\n    Capture filter from above Type a name for your flow logs in the Log Name text box. Select\n    the Compartment for the Log Location Select the Log Group for the Log Location or Click\n    Create New Group to create a new log group Click the Enable Log button in the lower\n    left-hand corner.\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    Enabling VCN flow logs will not affect the performance of your virtual network but it will\n    generate additional use of object storage that should be controlled via object lifecycle\n    management. By default, VCN flow logs are stored for 30 days in object storage. Users can\n    specify a longer retention period.\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-4_13'\n  tag severity: 'medium'\n  tag gid: 'CIS-4_13'\n  tag rid: 'xccdf_cis_cis_rule_4_13'\n  tag stig_id: '4.13'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-000011',\n    'CCI-002124',\n    'CCI-002123',\n    'CCI-002121',\n    'CCI-000123',\n    'CCI-000169',\n    'CCI-000172',\n    'CCI-000126',\n    'CCI-000130',\n    'CCI-000131',\n    'CCI-000132',\n    'CCI-000172',\n    'CCI-002110',\n    'CCI-002111',\n    'CCI-002122',\n    'CCI-001253',\n    'CCI-002641',\n    'CCI-001255',\n    'CCI-002654'\n  ]\n\n  tag nist: [\n    'AC-2 f',\n    'AC-2 h 2',\n    'AC-2 h 1',\n    'AC-2 f',\n    'AU-2 a',\n    'AU-12 a',\n    'AU-12 c',\n    'AU-2 c',\n    'AU-3 a',\n    'AU-3 b',\n    'AU-3 c',\n    'AU-12 c',\n    'AC-2 a',\n    'AC-2 a',\n    'AC-2 g',\n    'SI-4 a 1',\n    'SI-4 a 1',\n    'SI-4 c 1',\n    'SI-4 g'\n  ]\n\n  describe 'Ensure VCN flow logging is enabled for all subnets' do\n    skip 'The check for this control needs to be done manually'\n  end\nend\n","source_location":{"line":1,"ref":"./controls/4_13.rb"},"waiver_data":{},"results":[{"status":"skipped","code_desc":"Ensure VCN flow logging is enabled for all subnets","run_time":0.000002,"start_time":"2026-01-28T09:26:55-05:00","resource":"","skip_message":"The check for this control needs to be done manually","resource_class":"Object","resource_params":"[]","resource_id":"Ensure VCN flow logging is enabled for all subnets"}],"status":"not_reviewed"},{"id":"4_14","title":"Ensure Cloud Guard is enabled in the root compartment of the tenancy","desc":"Cloud Guard detects misconfigured resources and insecure activity within a tenancy and\nprovides security administrators with the visibility to resolve these issues. Upon\ndetection, Cloud Guard can suggest, assist, or take corrective actions to mitigate these\nissues. Cloud Guard should be enabled in the root compartment of your tenancy with the\ndefault configuration, activity detectors and responders. Cloud Guard provides an\nautomated means to monitor a tenancy for resources that are configured in an insecure\nmanner as well as risky network activity from these resources.","descriptions":[{"label":"default","data":"Cloud Guard detects misconfigured resources and insecure activity within a tenancy and\nprovides security administrators with the visibility to resolve these issues. Upon\ndetection, Cloud Guard can suggest, assist, or take corrective actions to mitigate these\nissues. Cloud Guard should be enabled in the root compartment of your tenancy with the\ndefault configuration, activity detectors and responders. Cloud Guard provides an\nautomated means to monitor a tenancy for resources that are configured in an insecure\nmanner as well as risky network activity from these resources."},{"label":"check","data":"From Console: Type Cloud Guard into the Search box at the top of the Console. Click Cloud\n\nGuard from the \"Services\" submenu. View if Cloud Guard is enabled From CLI: Retrieve the\nCloud Guard status from the console oci cloud-guard configuration get --compartment-id\n<tenancy-ocid> --query 'data.status' Ensure the returned value is \"ENABLED\"`"},{"label":"fix","data":"From Console: Type Cloud Guard into the Search box at the top of the Console. Click Cloud\n\nGuard from the \"Services\" submenu. Click Enable Cloud Guard . Click Create Policy . Click\nNext . Under Reporting Region , select a region. Under Compartments To Monitor , choose\nSelect Compartment . Under Select Compartments , select the root compartment. Under\nConfiguration Detector Recipe , select OCI Configuration Detector Recipe (Oracle Managed)\n. Under Activity Detector Recipe , select OCI Activity Detector Recipe (Oracle Managed) .\nClick Enable . From CLI: Create OCI IAM Policy for Cloud Guard oci iam policy create\n--compartment-id '<tenancy-id>' --name 'CloudGuardPolicies' --description 'Cloud Guard\nAccess Policy' --statements '[ \"allow service cloudguard to read vaults in tenancy\",\n\"allow service cloudguard to read keys in tenancy\", \"allow service cloudguard to read\ncompartments in tenancy\", \"allow service cloudguard to read tenancies in tenancy\", \"allow\nservice cloudguard to read audit-events in tenancy\", \"allow service cloudguard to read\ncompute-management-family in tenancy\", \"allow service cloudguard to read instance-family\nin tenancy\", \"allow service cloudguard to read virtual-network-family in tenancy\", \"allow\nservice cloudguard to read volume-family in tenancy\", \"allow service cloudguard to read\ndatabase-family in tenancy\", \"allow service cloudguard to read object-family in tenancy\",\n\"allow service cloudguard to read load-balancers in tenancy\", \"allow service cloudguard to\nread users in tenancy\", \"allow service cloudguard to read groups in tenancy\", \"allow\nservice cloudguard to read policies in tenancy\", \"allow service cloudguard to read\ndynamic-groups in tenancy\", \"allow service cloudguard to read authentication-policies in\ntenancy\" ]' Enable Cloud Guard in root compartment oci cloud-guard configuration update\n--reporting-region '<region-name>' --compartment-id '<tenancy-id>' --status 'ENABLED'"},{"label":"potential_impacts","data":"\"There is no performance"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-4_14","severity":"medium","gid":"CIS-4_14","rid":"xccdf_cis_cis_rule_4_14","stig_id":"4.14","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-000011","CCI-002124","CCI-002123","CCI-002121","CCI-000123","CCI-000169","CCI-000172","CCI-000126","CCI-000130","CCI-000131","CCI-000132","CCI-000172","CCI-000133","CCI-000134","CCI-001875","CCI-000135"],"nist":["AC-2 f","AC-2 h 2","AC-2 h 1","AC-2 f","AU-2 a","AU-12 a","AU-12 c","AU-2 c","AU-3 a","AU-3 b","AU-3 c","AU-12 c","AU-3 d","AU-3 e","AU-7 a","AU-3 (1)"]},"code":"control '4_14' do\n  title 'Ensure Cloud Guard is enabled in the root compartment of the tenancy'\n\n  desc <<~DESC\n    Cloud Guard detects misconfigured resources and insecure activity within a tenancy and\n    provides security administrators with the visibility to resolve these issues. Upon\n    detection, Cloud Guard can suggest, assist, or take corrective actions to mitigate these\n    issues. Cloud Guard should be enabled in the root compartment of your tenancy with the\n    default configuration, activity detectors and responders. Cloud Guard provides an\n    automated means to monitor a tenancy for resources that are configured in an insecure\n    manner as well as risky network activity from these resources.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Type Cloud Guard into the Search box at the top of the Console. Click Cloud\n\n    Guard from the \"Services\" submenu. View if Cloud Guard is enabled From CLI: Retrieve the\n    Cloud Guard status from the console oci cloud-guard configuration get --compartment-id\n    <tenancy-ocid> --query 'data.status' Ensure the returned value is \"ENABLED\"`\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Type Cloud Guard into the Search box at the top of the Console. Click Cloud\n\n    Guard from the \"Services\" submenu. Click Enable Cloud Guard . Click Create Policy . Click\n    Next . Under Reporting Region , select a region. Under Compartments To Monitor , choose\n    Select Compartment . Under Select Compartments , select the root compartment. Under\n    Configuration Detector Recipe , select OCI Configuration Detector Recipe (Oracle Managed)\n    . Under Activity Detector Recipe , select OCI Activity Detector Recipe (Oracle Managed) .\n    Click Enable . From CLI: Create OCI IAM Policy for Cloud Guard oci iam policy create\n    --compartment-id '<tenancy-id>' --name 'CloudGuardPolicies' --description 'Cloud Guard\n    Access Policy' --statements '[ \"allow service cloudguard to read vaults in tenancy\",\n    \"allow service cloudguard to read keys in tenancy\", \"allow service cloudguard to read\n    compartments in tenancy\", \"allow service cloudguard to read tenancies in tenancy\", \"allow\n    service cloudguard to read audit-events in tenancy\", \"allow service cloudguard to read\n    compute-management-family in tenancy\", \"allow service cloudguard to read instance-family\n    in tenancy\", \"allow service cloudguard to read virtual-network-family in tenancy\", \"allow\n    service cloudguard to read volume-family in tenancy\", \"allow service cloudguard to read\n    database-family in tenancy\", \"allow service cloudguard to read object-family in tenancy\",\n    \"allow service cloudguard to read load-balancers in tenancy\", \"allow service cloudguard to\n    read users in tenancy\", \"allow service cloudguard to read groups in tenancy\", \"allow\n    service cloudguard to read policies in tenancy\", \"allow service cloudguard to read\n    dynamic-groups in tenancy\", \"allow service cloudguard to read authentication-policies in\n    tenancy\" ]' Enable Cloud Guard in root compartment oci cloud-guard configuration update\n    --reporting-region '<region-name>' --compartment-id '<tenancy-id>' --status 'ENABLED'\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    \"There is no performance\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-4_14'\n  tag severity: 'medium'\n  tag gid: 'CIS-4_14'\n  tag rid: 'xccdf_cis_cis_rule_4_14'\n  tag stig_id: '4.14'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-000011',\n    'CCI-002124',\n    'CCI-002123',\n    'CCI-002121',\n    'CCI-000123',\n    'CCI-000169',\n    'CCI-000172',\n    'CCI-000126',\n    'CCI-000130',\n    'CCI-000131',\n    'CCI-000132',\n    'CCI-000172',\n    'CCI-000133',\n    'CCI-000134',\n    'CCI-001875',\n    'CCI-000135'\n  ]\n\n  tag nist: [\n    'AC-2 f',\n    'AC-2 h 2',\n    'AC-2 h 1',\n    'AC-2 f',\n    'AU-2 a',\n    'AU-12 a',\n    'AU-12 c',\n    'AU-2 c',\n    'AU-3 a',\n    'AU-3 b',\n    'AU-3 c',\n    'AU-12 c',\n    'AU-3 d',\n    'AU-3 e',\n    'AU-7 a',\n    'AU-3 (1)'\n  ]\n\n  tenancy_ocid = input('tenancy_ocid')\n\n  cmd = \"oci cloud-guard configuration get --compartment-id '#{tenancy_ocid}'\"\n  json_output = json(command: cmd)\n  cloud_guard_status = json_output.params.dig('data', 'status')\n\n  describe 'Ensure Cloud Guard is enabled in the root compartment of the tenancy' do\n    subject { cloud_guard_status }\n    it { should cmp 'ENABLED' }\n  end\nend\n","source_location":{"line":1,"ref":"./controls/4_14.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Ensure Cloud Guard is enabled in the root compartment of the tenancy is expected to cmp == \"ENABLED\"","run_time":0.000075,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Ensure Cloud Guard is enabled in the root compartment of the tenancy"}],"status":"passed"},{"id":"4_15","title":"Ensure a notification is configured for Oracle Cloud Guard problems detected","desc":"Cloud Guard detects misconfigured resources and insecure activity within a tenancy and\nprovides security administrators with the visibility to resolve these issues. Upon\ndetection, Cloud Guard generates a Problem. It is recommended to setup an Event Rule and\nNotification that gets triggered when Oracle Cloud Guard Problems are created, dismissed\nor remediated. Event Rules are compartment scoped and will detect events in child\ncompartments. It is recommended to create the Event rule at the root compartment level.\nCloud Guard provides an automated means to monitor a tenancy for resources that are\nconfigured in an insecure manner as well as risky network activity from these resources.\nMonitoring and alerting on Problems detected by Cloud Guard will help in identifying\nchanges to the security posture.","descriptions":[{"label":"default","data":"Cloud Guard detects misconfigured resources and insecure activity within a tenancy and\nprovides security administrators with the visibility to resolve these issues. Upon\ndetection, Cloud Guard generates a Problem. It is recommended to setup an Event Rule and\nNotification that gets triggered when Oracle Cloud Guard Problems are created, dismissed\nor remediated. Event Rules are compartment scoped and will detect events in child\ncompartments. It is recommended to create the Event rule at the root compartment level.\nCloud Guard provides an automated means to monitor a tenancy for resources that are\nconfigured in an insecure manner as well as risky network activity from these resources.\nMonitoring and alerting on Problems detected by Cloud Guard will help in identifying\nchanges to the security posture."},{"label":"check","data":"From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\nthe Compartment that hosts the rules Find and click the Rule that handles Cloud Guard\nChanges (if any) Click the Edit Rule button and verify that the RuleConditions section\ncontains a condition for the Service Cloud Guard and Event Types: Detected  Problem,\nRemediated  Problem, and Dismissed - Problem Verify that in the Actions section the\nAction Type contains: Notifications and that a valid Topic is referenced. From CLI: Find\nthe OCID of the specific Event Rule based on Display Name and Compartment OCID oci events\nrule list --compartment-id=<compartment OCID> --query \"data [?\"display-name\"=='<display\nname used>']\".{\"id:id\"} --output table List the details of a specific Event Rule based on\nthe OCID of the rule. In the JSON output locate the Conditions key-value pair and verify\nthat the following Conditions are present:\n\n\"com.oraclecloud.cloudguard.problemdetected\",\"com.oraclecloud.cloudguard.problemdismissed\",\"com.oraclecloud.cloudguard.problemremediated\"\nVerify the value of the is-enabled attribute is true In the JSON output verify that\nactionType is ONS and locate the topic-id Verify the correct topic is used by checking the\ntopic name oci ons topic get --topic-id=<topic id> --query data.{\"name:name\"} --output\ntable"},{"label":"fix","data":"From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\nthe compartment that should host the rule Click Create Rule Provide a Display Name and\nDescription Create a Rule Condition by selecting Cloud Guard in the Service Name Drop-down\nand selecting: Detected  Problem , Remediated  Problem , and Dismissed - Problem In the\nActions section select Notifications as Action Type Select the Compartment that hosts the\nTopic to be used. Select the Topic to be used Optionally add Tags to the Rule Click Create\nRule From CLI: Find the topic-id of the topic the Event Rule should use for sending\nNotifications by using the topic name and Compartment OCID oci ons topic list\n--compartment-id=<compartment OCID> --all --query \"data\n[?name=='<topic_name>']\".{\"name:name,topic_id:\"topic-id\"\"} --output table Create a JSON\nfile to be used when creating the Event Rule. Replace topic id, display name, description\nand compartment OCID. { \"actions\": { \"actions\": [ { \"actionType\": \"ONS\", \"isEnabled\":\n\ntrue, \"topicId\": \"<topic id>\" }] }, \"condition\": \"{\"eventType\":[\"\ncom.oraclecloud.cloudguard.problemdetected\",\"\ncom.oraclecloud.cloudguard.problemdismissed\",\"\ncom.oraclecloud.cloudguard.problemremediated\"],\"data\":{}}\", \"displayName\": \"<display\nname>\", \"description\": \"<description>\", \"isEnabled\": true, \"compartmentId\": \"compartment\nOCID\" } Create the actual event rule oci events rule create --from-json\nfile://event_rule.json Note in the JSON returned that it lists the parameters specified in\nthe JSON file provided and that there is an OCID provided for the Event Rule"},{"label":"potential_impacts","data":"\"There is no performance"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-4_15","severity":"medium","gid":"CIS-4_15","rid":"xccdf_cis_cis_rule_4_15","stig_id":"4.15","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-000123","CCI-000169","CCI-000172","CCI-000126","CCI-000133","CCI-000134","CCI-001875","CCI-000135"],"nist":["AU-2 a","AU-12 a","AU-12 c","AU-2 c","AU-3 d","AU-3 e","AU-7 a","AU-3 (1)"]},"code":"control '4_15' do\n  title 'Ensure a notification is configured for Oracle Cloud Guard problems detected'\n\n  desc <<~DESC\n    Cloud Guard detects misconfigured resources and insecure activity within a tenancy and\n    provides security administrators with the visibility to resolve these issues. Upon\n    detection, Cloud Guard generates a Problem. It is recommended to setup an Event Rule and\n    Notification that gets triggered when Oracle Cloud Guard Problems are created, dismissed\n    or remediated. Event Rules are compartment scoped and will detect events in child\n    compartments. It is recommended to create the Event rule at the root compartment level.\n    Cloud Guard provides an automated means to monitor a tenancy for resources that are\n    configured in an insecure manner as well as risky network activity from these resources.\n    Monitoring and alerting on Problems detected by Cloud Guard will help in identifying\n    changes to the security posture.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\n    the Compartment that hosts the rules Find and click the Rule that handles Cloud Guard\n    Changes (if any) Click the Edit Rule button and verify that the RuleConditions section\n    contains a condition for the Service Cloud Guard and Event Types: Detected  Problem,\n    Remediated  Problem, and Dismissed - Problem Verify that in the Actions section the\n    Action Type contains: Notifications and that a valid Topic is referenced. From CLI: Find\n    the OCID of the specific Event Rule based on Display Name and Compartment OCID oci events\n    rule list --compartment-id=<compartment OCID> --query \"data [?\\\"display-name\\\"=='<display\n    name used>']\".{\"id:id\"} --output table List the details of a specific Event Rule based on\n    the OCID of the rule. In the JSON output locate the Conditions key-value pair and verify\n    that the following Conditions are present:\n\n    \"com.oraclecloud.cloudguard.problemdetected\",\"com.oraclecloud.cloudguard.problemdismissed\",\"com.oraclecloud.cloudguard.problemremediated\"\n    Verify the value of the is-enabled attribute is true In the JSON output verify that\n    actionType is ONS and locate the topic-id Verify the correct topic is used by checking the\n    topic name oci ons topic get --topic-id=<topic id> --query data.{\"name:name\"} --output\n    table\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\n    the compartment that should host the rule Click Create Rule Provide a Display Name and\n    Description Create a Rule Condition by selecting Cloud Guard in the Service Name Drop-down\n    and selecting: Detected  Problem , Remediated  Problem , and Dismissed - Problem In the\n    Actions section select Notifications as Action Type Select the Compartment that hosts the\n    Topic to be used. Select the Topic to be used Optionally add Tags to the Rule Click Create\n    Rule From CLI: Find the topic-id of the topic the Event Rule should use for sending\n    Notifications by using the topic name and Compartment OCID oci ons topic list\n    --compartment-id=<compartment OCID> --all --query \"data\n    [?name=='<topic_name>']\".{\"name:name,topic_id:\\\"topic-id\\\"\"} --output table Create a JSON\n    file to be used when creating the Event Rule. Replace topic id, display name, description\n    and compartment OCID. { \"actions\": { \"actions\": [ { \"actionType\": \"ONS\", \"isEnabled\":\n\n    true, \"topicId\": \"<topic id>\" }] }, \"condition\": \"{\\\"eventType\\\":[\\\"\n    com.oraclecloud.cloudguard.problemdetected\\\",\\\"\n    com.oraclecloud.cloudguard.problemdismissed\\\",\\\"\n    com.oraclecloud.cloudguard.problemremediated\\\"],\\\"data\\\":{}}\", \"displayName\": \"<display\n    name>\", \"description\": \"<description>\", \"isEnabled\": true, \"compartmentId\": \"compartment\n    OCID\" } Create the actual event rule oci events rule create --from-json\n    file://event_rule.json Note in the JSON returned that it lists the parameters specified in\n    the JSON file provided and that there is an OCID provided for the Event Rule\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    \"There is no performance\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-4_15'\n  tag severity: 'medium'\n  tag gid: 'CIS-4_15'\n  tag rid: 'xccdf_cis_cis_rule_4_15'\n  tag stig_id: '4.15'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-000123',\n    'CCI-000169',\n    'CCI-000172',\n    'CCI-000126',\n    'CCI-000133',\n    'CCI-000134',\n    'CCI-001875',\n    'CCI-000135'\n  ]\n\n  tag nist: [\n    'AU-2 a',\n    'AU-12 a',\n    'AU-12 c',\n    'AU-2 c',\n    'AU-3 d',\n    'AU-3 e',\n    'AU-7 a',\n    'AU-3 (1)'\n  ]\n\n  required_rule_conditions = [\n    'com.oraclecloud.cloudguard.problemdetected',\n    'com.oraclecloud.cloudguard.problemdismissed',\n    'com.oraclecloud.cloudguard.problemremediated'\n  ]\n\n  tenancy_ocid = input('tenancy_ocid')\n  cloud_guard_notification_topic = input('cloud_guard_notification_topic')\n\n  regions = json(command: 'oci iam region-subscription list --all').params.fetch('data', []).map { |region| region['region-name'] }.compact\n\n  findings = regions.each_with_object([]) do |region, missing|\n    rules = json(command: %(oci events rule list --compartment-id \"#{tenancy_ocid}\" --region \"#{region}\" --all 2>/dev/null)).params.fetch('data', [])\n\n    rule_present = rules.any? do |rule|\n      rule_details = json(command: %(oci events rule get --rule-id \"#{rule['id']}\" --region \"#{region}\" 2>/dev/null)).params.fetch('data', {})\n\n      next false unless rule_details['is-enabled']\n\n      condition_data = begin\n        json(content: rule_details['condition'].to_s).params\n      rescue StandardError\n        {}\n      end\n\n      event_types = condition_data['eventType']\n      next false unless (required_rule_conditions - event_types).empty?\n\n      actions = rule_details.dig('actions', 'actions') || []\n      actions.any? do |action|\n        next false unless action['action-type'] == 'ONS' && action['is-enabled']\n\n        topic_id = action['topic-id']\n        next false if topic_id.to_s.strip.empty?\n\n        topic = json(command: %(oci ons topic get --topic-id \"#{topic_id}\" --region \"#{region}\" 2>/dev/null)).params.fetch('data', {})\n        topic['name'] == cloud_guard_notification_topic && topic['lifecycle-state'] == 'ACTIVE'\n      end\n    end\n\n    missing << { region: region, issue: 'Missing enabled Oracle Cloud Guard change notification rule(s)' } unless rule_present\n  end\n\n  describe 'Ensure a notification is configured for Oracle Cloud Guard problems detected' do\n    subject { findings }\n    it { should be_empty }\n  end\nend\n","source_location":{"line":1,"ref":"./controls/4_15.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Ensure a notification is configured for Oracle Cloud Guard problems detected is expected to be empty","run_time":0.001275,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Ensure a notification is configured for Oracle Cloud Guard problems detected"}],"status":"passed"},{"id":"4_16","title":"Ensure customer created Customer Managed Key (CMK) is rotated at least annually","desc":"Oracle Cloud Infrastructure Vault securely stores master encryption keys that protect your\nencrypted data. You can use the Vault service to rotate keys to generate new cryptographic\nmaterial. Periodically rotating keys limits the amount of data encrypted by one key\nversion. Rotating keys annually limits the data encrypted under one key version. Key\nrotation thereby reduces the risk in case a key is ever compromised.","descriptions":[{"label":"default","data":"Oracle Cloud Infrastructure Vault securely stores master encryption keys that protect your\nencrypted data. You can use the Vault service to rotate keys to generate new cryptographic\nmaterial. Periodically rotating keys limits the amount of data encrypted by one key\nversion. Rotating keys annually limits the data encrypted under one key version. Key\nrotation thereby reduces the risk in case a key is ever compromised."},{"label":"check","data":"From Console: Login into OCI Console. Select Identity & Security from the Services menu.\n\nSelect Vault . Click on the individual Vault under the Name heading. Ensure the date of\neach Master Encryption key under the Created column of the Master Encryption key is no\nmore than 365 days old, and that the key is in the ENABLED state Repeat for all Vaults in\nall compartments From CLI: Execute the following for each Vault in each compartment oci\nkms management key list --compartment-id '<compartment-id>' --endpoint\n'<management-endpoint-url>' --all --query\n\"data[*].[\"time-created\",\"display-name\",\"lifecycle-state\"]\" Ensure the date of the\nMaster Encryption key is no more than 365 days old and is also in the ENABLED state."},{"label":"fix","data":"From Console: Login into OCI Console. Select Identity & Security from the Services menu.\n\nSelect Vault . Click on the individual Vault under the Name heading. Click on the menu\nnext to the time created. Click Rotate Key From CLI: Execute the following: oci kms\nmanagement key rotate --key-id <key-ocid> --endpoint <management-endpoint-url>"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-4_16","severity":"medium","gid":"CIS-4_16","rid":"xccdf_cis_cis_rule_4_16","stig_id":"4.16","gtitle":"<GroupDescription></GroupDescription>","documentable":null},"code":"control '4_16' do\n  title 'Ensure customer created Customer Managed Key (CMK) is rotated at least annually'\n\n  desc <<~DESC\n    Oracle Cloud Infrastructure Vault securely stores master encryption keys that protect your\n    encrypted data. You can use the Vault service to rotate keys to generate new cryptographic\n    material. Periodically rotating keys limits the amount of data encrypted by one key\n    version. Rotating keys annually limits the data encrypted under one key version. Key\n    rotation thereby reduces the risk in case a key is ever compromised.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Login into OCI Console. Select Identity & Security from the Services menu.\n\n    Select Vault . Click on the individual Vault under the Name heading. Ensure the date of\n    each Master Encryption key under the Created column of the Master Encryption key is no\n    more than 365 days old, and that the key is in the ENABLED state Repeat for all Vaults in\n    all compartments From CLI: Execute the following for each Vault in each compartment oci\n    kms management key list --compartment-id '<compartment-id>' --endpoint\n    '<management-endpoint-url>' --all --query\n    \"data[*].[\\\"time-created\\\",\\\"display-name\\\",\\\"lifecycle-state\\\"]\" Ensure the date of the\n    Master Encryption key is no more than 365 days old and is also in the ENABLED state.\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Login into OCI Console. Select Identity & Security from the Services menu.\n\n    Select Vault . Click on the individual Vault under the Name heading. Click on the menu\n    next to the time created. Click Rotate Key From CLI: Execute the following: oci kms\n    management key rotate --key-id <key-ocid> --endpoint <management-endpoint-url>\n  FIX\n\n  impact 0.5\n\n  tag check_id: 'C-4_16'\n  tag severity: 'medium'\n  tag gid: 'CIS-4_16'\n  tag rid: 'xccdf_cis_cis_rule_4_16'\n  tag stig_id: '4.16'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\nend\n","source_location":{"line":1,"ref":"./controls/4_16.rb"},"waiver_data":{},"results":[],"status":"passed"},{"id":"4_17","title":"Ensure write level Object Storage logging is enabled for all buckets","desc":"Object Storage write logs will log all write requests made to objects in a bucket.\nEnabling an Object Storage write log, the requestAction property would contain values of\nPUT , POST , or DELETE . This will provide you more visibility into changes to objects in\nyour buckets.","descriptions":[{"label":"default","data":"Object Storage write logs will log all write requests made to objects in a bucket.\nEnabling an Object Storage write log, the requestAction property would contain values of\nPUT , POST , or DELETE . This will provide you more visibility into changes to objects in\nyour buckets."},{"label":"check","data":"From Console: Log into the OCI console. Select Storage from the Services, and click on\n\nBuckets . Click on the individual Bucket under the Name heading. Click Logs from the\nResource menu on the left. Click on the slider under Enable Log in row labeled Write\nAccess Events . Select the Compartment. Select the Log Group. Enter a Log Name . Select a\nLog Retention. Click Enable Log . From CLI: Find the bucket name of the specific bucket.\noci os bucket list --compartment-id <compartment-id> Find the OCID of the Log Group used\nfor FlowLogs . oci logging log-group list --compartment-id <compartment-id> --query \"data\n[?\"display-name\"=='<log-group-name>']\" List the logs associated with the bucket name for\nthis bucket oci logging log list --log-group-id <log-group-id> --query \"data\n[?configuration.source.resource=='<bucket-name>']\" Ensure a log is listed for this bucket\nname"},{"label":"fix","data":"From Console: First, if a log group for holding these logs has not already been created,\n\ncreate a log group by the following steps: Go to the Log Groups page Click the Create Log\nGroups button in the middle of the screen. Select the relevant compartment to place these\nlogs. Type a name for the log group in the Name box. Add an optional description in the\nDescription box. Click the Create button in the lower left-hand corner. Second, enable\nObject Storage write log logging for your bucket(s) by the following steps: Go to the Logs\npage https://cloud.oracle.com/logging/logs Click the Enable Service Log button in the\nmiddle of the screen. Select the relevant resource compartment. Select Object Storage from\nthe Service drop down menu. Select the relevant bucket from the resource drop down menu.\nSelect 'Write Access Events` from the Log Category drop down menu. Type a name for your\nObject Storage write log in the Log Name drop down menu. Click the Enable Log button in\nthe lower left-hand corner. From CLI: First, if a log group for holding these logs has not\nalready been created, create a log group by the following steps: Create a log group: oci\nlogging log-group create --compartment-id <compartment-id> --display-name \"<display-name>\"\n--description \"<description>\" The output of the command gives you a work request id. You\ncan query the work request to see the status of the job by issuing the following command:\n\noci logging work-request get --work-request-id <work-request-id> Look for status filed to\nbe SUCCEEDED . Second, enable Object Storage write log logging for your bucket(s) by the\nfollowing steps: Get the Log group ID needed for creating the Log: oci logging log-group\nlist --compartment-id <compartment-id> --query 'data[?contains(\"display-name\",\n`'\"<display-name>\"'`)].id|join(`\n`, @)' --raw-output Create a JSON file called\nconfig.json with the following content: { \"compartment-id\":\"<compartment-id>\", \"source\": {\n\"resource\": \"<bucket-name.\", \"service\": \"ObjectStorage\", \"source-type\": \"OCISERVICE\",\n\"category\": \"write\" } } The compartment-id is the Compartment OCID of where the bucket is\nexists. The resource value is the bucket name. Create the Service Log: oci logging log\ncreate --log-group-id <log-group-id> --display-name \"<display-name>\" --log-type SERVICE\n--is-enabled TRUE --configuration file://config.json The output of the command gives you a\nwork request id. You can query the work request to see that status of the job by issuing\nthe following command: oci logging work-request get --work-request-id <work-request-id>\nLook for the status filed to be SUCCEEDED ."},{"label":"potential_impacts","data":"\"There is no performance"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-4_17","severity":"medium","gid":"CIS-4_17","rid":"xccdf_cis_cis_rule_4_17","stig_id":"4.17","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-000011","CCI-002124","CCI-002123","CCI-002121","CCI-000123","CCI-000169","CCI-000172","CCI-000126"],"nist":["AC-2 f","AC-2 h 2","AC-2 h 1","AC-2 f","AU-2 a","AU-12 a","AU-12 c","AU-2 c"]},"code":"control '4_17' do\n  title 'Ensure write level Object Storage logging is enabled for all buckets'\n\n  desc <<~DESC\n    Object Storage write logs will log all write requests made to objects in a bucket.\n    Enabling an Object Storage write log, the requestAction property would contain values of\n    PUT , POST , or DELETE . This will provide you more visibility into changes to objects in\n    your buckets.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Log into the OCI console. Select Storage from the Services, and click on\n\n    Buckets . Click on the individual Bucket under the Name heading. Click Logs from the\n    Resource menu on the left. Click on the slider under Enable Log in row labeled Write\n    Access Events . Select the Compartment. Select the Log Group. Enter a Log Name . Select a\n    Log Retention. Click Enable Log . From CLI: Find the bucket name of the specific bucket.\n    oci os bucket list --compartment-id <compartment-id> Find the OCID of the Log Group used\n    for FlowLogs . oci logging log-group list --compartment-id <compartment-id> --query \"data\n    [?\\\"display-name\\\"=='<log-group-name>']\" List the logs associated with the bucket name for\n    this bucket oci logging log list --log-group-id <log-group-id> --query \"data\n    [?configuration.source.resource=='<bucket-name>']\" Ensure a log is listed for this bucket\n    name\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: First, if a log group for holding these logs has not already been created,\n\n    create a log group by the following steps: Go to the Log Groups page Click the Create Log\n    Groups button in the middle of the screen. Select the relevant compartment to place these\n    logs. Type a name for the log group in the Name box. Add an optional description in the\n    Description box. Click the Create button in the lower left-hand corner. Second, enable\n    Object Storage write log logging for your bucket(s) by the following steps: Go to the Logs\n    page https://cloud.oracle.com/logging/logs Click the Enable Service Log button in the\n    middle of the screen. Select the relevant resource compartment. Select Object Storage from\n    the Service drop down menu. Select the relevant bucket from the resource drop down menu.\n    Select 'Write Access Events` from the Log Category drop down menu. Type a name for your\n    Object Storage write log in the Log Name drop down menu. Click the Enable Log button in\n    the lower left-hand corner. From CLI: First, if a log group for holding these logs has not\n    already been created, create a log group by the following steps: Create a log group: oci\n    logging log-group create --compartment-id <compartment-id> --display-name \"<display-name>\"\n    --description \"<description>\" The output of the command gives you a work request id. You\n    can query the work request to see the status of the job by issuing the following command:\n\n    oci logging work-request get --work-request-id <work-request-id> Look for status filed to\n    be SUCCEEDED . Second, enable Object Storage write log logging for your bucket(s) by the\n    following steps: Get the Log group ID needed for creating the Log: oci logging log-group\n    list --compartment-id <compartment-id> --query 'data[?contains(\"display-name\",\n    `'\"<display-name>\"'`)].id|join(`\\n`, @)' --raw-output Create a JSON file called\n    config.json with the following content: { \"compartment-id\":\"<compartment-id>\", \"source\": {\n    \"resource\": \"<bucket-name.\", \"service\": \"ObjectStorage\", \"source-type\": \"OCISERVICE\",\n    \"category\": \"write\" } } The compartment-id is the Compartment OCID of where the bucket is\n    exists. The resource value is the bucket name. Create the Service Log: oci logging log\n    create --log-group-id <log-group-id> --display-name \"<display-name>\" --log-type SERVICE\n    --is-enabled TRUE --configuration file://config.json The output of the command gives you a\n    work request id. You can query the work request to see that status of the job by issuing\n    the following command: oci logging work-request get --work-request-id <work-request-id>\n    Look for the status filed to be SUCCEEDED .\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    \"There is no performance\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-4_17'\n  tag severity: 'medium'\n  tag gid: 'CIS-4_17'\n  tag rid: 'xccdf_cis_cis_rule_4_17'\n  tag stig_id: '4.17'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-000011',\n    'CCI-002124',\n    'CCI-002123',\n    'CCI-002121',\n    'CCI-000123',\n    'CCI-000169',\n    'CCI-000172',\n    'CCI-000126'\n  ]\n\n  tag nist: [\n    'AC-2 f',\n    'AC-2 h 2',\n    'AC-2 h 1',\n    'AC-2 f',\n    'AU-2 a',\n    'AU-12 a',\n    'AU-12 c',\n    'AU-2 c'\n  ]\nend\n","source_location":{"line":1,"ref":"./controls/4_17.rb"},"waiver_data":{},"results":[],"status":"passed"},{"id":"4_18","title":"Ensure a notification is configured for Local OCI User Authentication","desc":"\"It is recommended that an Event Rule and Notification be set up when a user in the via\nOCI local authentication. Event Rules are compartment-scoped and will detect events in\nchild compartments. This Event rule is required to be created at the root compartment\nlevel. Users should rarely use OCI local authenticated and be authenticated via\norganizational standard Identity providers, not local credentials. Access in this matter\nwould represent a break glass activity and should be monitored to see if changes made","descriptions":[{"label":"default","data":"\"It is recommended that an Event Rule and Notification be set up when a user in the via\nOCI local authentication. Event Rules are compartment-scoped and will detect events in\nchild compartments. This Event rule is required to be created at the root compartment\nlevel. Users should rarely use OCI local authenticated and be authenticated via\norganizational standard Identity providers, not local credentials. Access in this matter\nwould represent a break glass activity and should be monitored to see if changes made"},{"label":"check","data":"From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\nthe Root Compartment that hosts the rules Click the Rule that handles Identity SignOn\nChanges (if any) Click the Edit Rule button and verify that the RuleCondition s section\ncontains a condition Event Type for the Service Identity SignOn and Event Types:\n\nInteractive Login On the Action Type contains: Notifications and that a valid Topic is\nreferenced. From CLI: Find the OCID of the specific Event Rule based on Display Name and\nTenancy OCID oci events rule list --compartment-id <tenancy-ocid> --query \"data\n[?\"display-name\"=='<display-name>']\".{\"id:id\"} --output table List the details of a\nspecific Event Rule based on the OCID of the rule. oci events rule get --rule-id <rule-id>\nIn the JSON output locate the Conditions key value pair and verify that the following\nConditions are present: com.oraclecloud.identitysignon.interactivelogin Verify the value\nof the is-enabled attribute is true In the JSON output verify that actionType is ONS and\nlocate the topic-id Verify the correct topic is used by checking the topic name oci ons\ntopic get --topic-id <topic-id> --query data.{\"name:name\"} --output table"},{"label":"fix","data":"From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\nthe Root compartment that should host the rule Click Create Rule Provide a Display Name\nand Description Create a Rule Condition by selecting Identity SignOn in the Service Name\nDrop-down and selecting Interactive Login In the Actions section select Notifications as\nAction Type Select the Compartment that hosts the Topic to be used. Select the Topic to be\nused Optionally add Tags to the Rule Click Create Rule From CLI: Find the topic-id of the\ntopic the Event Rule should use for sending notifications by using the topic name and\nTenancy OCID oci ons topic list --compartment-id <tenacy-ocid> --all --query \"data\n[?name=='<topic-name>']\".{\"name:name,topic_id:\"topic-id\"\"} --output table Create a JSON\nfile to be used when creating the Event Rule. Replace topic id, display name, description\nand compartment OCID. { \"actions\": { \"actions\": [ { \"actionType\": \"ONS\", \"isEnabled\":\n\ntrue, \"topicId\": \"<topic-id>\" }] }, \"condition\":\n\n\"{\"eventType\":[\"com.oraclecloud.identitysignon.interactivelogin\",data\":{}}\",\n\"displayName\": \"<display-name>\", \"description\": \"<description>\", \"isEnabled\": true,\n\"compartmentId\": \"<tenancy-ocid>\" } Create the actual event rule oci events rule create\n--from-json file://event_rule.json Note in the JSON returned that it lists the parameters\nspecified in the JSON file provided and that there is an OCID provided for the Event Rule"},{"label":"potential_impacts","data":"\"There is no performance"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-4_18","severity":"medium","gid":"CIS-4_18","rid":"xccdf_cis_cis_rule_4_18","stig_id":"4.18","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-000133","CCI-000134","CCI-001875","CCI-000135"],"nist":["AU-3 d","AU-3 e","AU-7 a","AU-3 (1)"]},"code":"control '4_18' do\n  title 'Ensure a notification is configured for Local OCI User Authentication'\n\n  desc <<~DESC\n    \"It is recommended that an Event Rule and Notification be set up when a user in the via\n    OCI local authentication. Event Rules are compartment-scoped and will detect events in\n    child compartments. This Event rule is required to be created at the root compartment\n    level. Users should rarely use OCI local authenticated and be authenticated via\n    organizational standard Identity providers, not local credentials. Access in this matter\n    would represent a break glass activity and should be monitored to see if changes made\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\n    the Root Compartment that hosts the rules Click the Rule that handles Identity SignOn\n    Changes (if any) Click the Edit Rule button and verify that the RuleCondition s section\n    contains a condition Event Type for the Service Identity SignOn and Event Types:\n\n    Interactive Login On the Action Type contains: Notifications and that a valid Topic is\n    referenced. From CLI: Find the OCID of the specific Event Rule based on Display Name and\n    Tenancy OCID oci events rule list --compartment-id <tenancy-ocid> --query \"data\n    [?\\\"display-name\\\"=='<display-name>']\".{\"id:id\"} --output table List the details of a\n    specific Event Rule based on the OCID of the rule. oci events rule get --rule-id <rule-id>\n    In the JSON output locate the Conditions key value pair and verify that the following\n    Conditions are present: com.oraclecloud.identitysignon.interactivelogin Verify the value\n    of the is-enabled attribute is true In the JSON output verify that actionType is ONS and\n    locate the topic-id Verify the correct topic is used by checking the topic name oci ons\n    topic get --topic-id <topic-id> --query data.{\"name:name\"} --output table\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\n    the Root compartment that should host the rule Click Create Rule Provide a Display Name\n    and Description Create a Rule Condition by selecting Identity SignOn in the Service Name\n    Drop-down and selecting Interactive Login In the Actions section select Notifications as\n    Action Type Select the Compartment that hosts the Topic to be used. Select the Topic to be\n    used Optionally add Tags to the Rule Click Create Rule From CLI: Find the topic-id of the\n    topic the Event Rule should use for sending notifications by using the topic name and\n    Tenancy OCID oci ons topic list --compartment-id <tenacy-ocid> --all --query \"data\n    [?name=='<topic-name>']\".{\"name:name,topic_id:\\\"topic-id\\\"\"} --output table Create a JSON\n    file to be used when creating the Event Rule. Replace topic id, display name, description\n    and compartment OCID. { \"actions\": { \"actions\": [ { \"actionType\": \"ONS\", \"isEnabled\":\n\n    true, \"topicId\": \"<topic-id>\" }] }, \"condition\":\n\n    \"{\\\"eventType\\\":[\\\"com.oraclecloud.identitysignon.interactivelogin\\\",data\\\":{}}\",\n    \"displayName\": \"<display-name>\", \"description\": \"<description>\", \"isEnabled\": true,\n    \"compartmentId\": \"<tenancy-ocid>\" } Create the actual event rule oci events rule create\n    --from-json file://event_rule.json Note in the JSON returned that it lists the parameters\n    specified in the JSON file provided and that there is an OCID provided for the Event Rule\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    \"There is no performance\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-4_18'\n  tag severity: 'medium'\n  tag gid: 'CIS-4_18'\n  tag rid: 'xccdf_cis_cis_rule_4_18'\n  tag stig_id: '4.18'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-000133',\n    'CCI-000134',\n    'CCI-001875',\n    'CCI-000135'\n  ]\n\n  tag nist: [\n    'AU-3 d',\n    'AU-3 e',\n    'AU-7 a',\n    'AU-3 (1)'\n  ]\nend\n","source_location":{"line":1,"ref":"./controls/4_18.rb"},"waiver_data":{},"results":[],"status":"passed"},{"id":"4_2","title":"Create at least one notification topic and subscription to receive monitoring alerts","desc":"Notifications provide a multi-channel messaging service that allow users and applications\nto be notified of events of interest occurring within OCI. Messages can be sent via eMail,\nHTTPs, PagerDuty, Slack or the OCI Function service. Some channels, such as eMail require\nconfirmation of the subscription before it becomes active. Creating one or more\nnotification topics allow administrators to be notified of relevant changes made to OCI\ninfrastructure.","descriptions":[{"label":"default","data":"Notifications provide a multi-channel messaging service that allow users and applications\nto be notified of events of interest occurring within OCI. Messages can be sent via eMail,\nHTTPs, PagerDuty, Slack or the OCI Function service. Some channels, such as eMail require\nconfirmation of the subscription before it becomes active. Creating one or more\nnotification topics allow administrators to be notified of relevant changes made to OCI\ninfrastructure."},{"label":"check","data":"From Console: Go to the Notifications Service page:\n\nhttps://console.us-ashburn-1.oraclecloud.com/notification/topics Select the Compartment\nthat hosts the notifications Find and click the Topic relevant to your monitoring alerts.\nEnsure a valid active subscription is shown. From CLI: List the topics in the Compartment\nthat hosts the notifications oci ons topic list --compartment-id <compartment OCID> --all\nNote the OCID of the monitoring topic(s) using the topic-id field of the returned JSON and\nuse it to list the subscriptions oci ons subscription list --compartment-id <compartment\nOCID> --topic-id <topic OCID> --all Ensure at least one active subscription is returned"},{"label":"fix","data":"From Console: Go to the Notifications Service page:\n\nhttps://console.us-ashburn-1.oraclecloud.com/notification/topics Select the Compartment\nthat hosts the notifications Click Create Topic Set the name to something relevant Set the\ndescription to describe the purpose of the topic Click Create Click the newly created\ntopic Click Create Subscription Choose the correct protocol Complete the correct\nparameter, for instance email address Click Create From CLI: Create a topic in a\ncompartment oci ons topic create --name <topic name> --description <topic description>\n--compartment-id <compartment OCID> Note the OCID of the topic using the topic-id field of\nthe returned JSON and use it to create a new subscription oci ons subscription create\n--compartment-id <compartment OCID> --topic-id <topic OCID> --protocol <protocol>\n--subscription-endpoint <subscription endpoint> The returned JSON includes the id of the\nsubscription ."},{"label":"potential_impacts","data":"\"There is no performance"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-4_2","severity":"medium","gid":"CIS-4_2","rid":"xccdf_cis_cis_rule_4_2","stig_id":"4.2","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-000011","CCI-002124","CCI-002123","CCI-002121","CCI-001682","CCI-000766","CCI-001643","CCI-000011","CCI-000123","CCI-000169","CCI-000172","CCI-000126","CCI-000133","CCI-000134","CCI-001875","CCI-000135"],"nist":["AC-2 f","AC-2 h 2","AC-2 h 1","AC-2 f","AC-2 (2)","IA-2 (2)","RA-5 a","AC-2 f","AU-2 a","AU-12 a","AU-12 c","AU-2 c","AU-3 d","AU-3 e","AU-7 a","AU-3 (1)"]},"code":"control '4_2' do\n  title 'Create at least one notification topic and subscription to receive monitoring alerts'\n\n  desc <<~DESC\n    Notifications provide a multi-channel messaging service that allow users and applications\n    to be notified of events of interest occurring within OCI. Messages can be sent via eMail,\n    HTTPs, PagerDuty, Slack or the OCI Function service. Some channels, such as eMail require\n    confirmation of the subscription before it becomes active. Creating one or more\n    notification topics allow administrators to be notified of relevant changes made to OCI\n    infrastructure.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Go to the Notifications Service page:\n\n    https://console.us-ashburn-1.oraclecloud.com/notification/topics Select the Compartment\n    that hosts the notifications Find and click the Topic relevant to your monitoring alerts.\n    Ensure a valid active subscription is shown. From CLI: List the topics in the Compartment\n    that hosts the notifications oci ons topic list --compartment-id <compartment OCID> --all\n    Note the OCID of the monitoring topic(s) using the topic-id field of the returned JSON and\n    use it to list the subscriptions oci ons subscription list --compartment-id <compartment\n    OCID> --topic-id <topic OCID> --all Ensure at least one active subscription is returned\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Go to the Notifications Service page:\n\n    https://console.us-ashburn-1.oraclecloud.com/notification/topics Select the Compartment\n    that hosts the notifications Click Create Topic Set the name to something relevant Set the\n    description to describe the purpose of the topic Click Create Click the newly created\n    topic Click Create Subscription Choose the correct protocol Complete the correct\n    parameter, for instance email address Click Create From CLI: Create a topic in a\n    compartment oci ons topic create --name <topic name> --description <topic description>\n    --compartment-id <compartment OCID> Note the OCID of the topic using the topic-id field of\n    the returned JSON and use it to create a new subscription oci ons subscription create\n    --compartment-id <compartment OCID> --topic-id <topic OCID> --protocol <protocol>\n    --subscription-endpoint <subscription endpoint> The returned JSON includes the id of the\n    subscription .\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    \"There is no performance\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-4_2'\n  tag severity: 'medium'\n  tag gid: 'CIS-4_2'\n  tag rid: 'xccdf_cis_cis_rule_4_2'\n  tag stig_id: '4.2'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-000011',\n    'CCI-002124',\n    'CCI-002123',\n    'CCI-002121',\n    'CCI-001682',\n    'CCI-000766',\n    'CCI-001643',\n    'CCI-000011',\n    'CCI-000123',\n    'CCI-000169',\n    'CCI-000172',\n    'CCI-000126',\n    'CCI-000133',\n    'CCI-000134',\n    'CCI-001875',\n    'CCI-000135'\n  ]\n\n  tag nist: [\n    'AC-2 f',\n    'AC-2 h 2',\n    'AC-2 h 1',\n    'AC-2 f',\n    'AC-2 (2)',\n    'IA-2 (2)',\n    'RA-5 a',\n    'AC-2 f',\n    'AU-2 a',\n    'AU-12 a',\n    'AU-12 c',\n    'AU-2 c',\n    'AU-3 d',\n    'AU-3 e',\n    'AU-7 a',\n    'AU-3 (1)'\n  ]\n\n  tenancy_ocid = input('tenancy_ocid')\n\n  cmd = \"oci iam compartment list --compartment-id '#{tenancy_ocid}' --include-root --compartment-id-in-subtree true --all\"\n  compartments = json(command: cmd)\n\n  compartment_ids = compartments['data'].select { |field| field['lifecycle-state'] == 'ACTIVE' }.map { |field| field['id'] }\n\n  active_subs = []\n\n  compartment_ids.each do |compartment_id|\n    topics_cmd = \"oci ons topic list --compartment-id '#{compartment_id}' --all\"\n    topics = json(command: topics_cmd)\n    topic_data = topics['data'] || []\n    active_topics = topic_data.select { |field| field['lifecycle-state'] == 'ACTIVE' }\n\n    active_topics.each do |topic|\n      topic_id = topic['topic-id']\n      subs_cmd = \"oci ons subscription list --compartment-id '#{compartment_id}' --topic-id '#{topic_id}' --all\"\n      subs = json(command: subs_cmd)\n      subs_data = subs['data'] || []\n      topic_active_subs = subs_data.select { |field| field['lifecycle-state'] == 'ACTIVE' }\n\n      active_subs.concat(topic_active_subs) if topic_active_subs.any?\n    end\n  end\n\n  describe 'Create at least one notification topic and subscription to receive monitoring alerts' do\n    subject { active_subs }\n    it { should_not be_empty }\n  end\nend\n","source_location":{"line":1,"ref":"./controls/4_2.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Create at least one notification topic and subscription to receive monitoring alerts is expected not to be empty","run_time":0.001031,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Create at least one notification topic and subscription to receive monitoring alerts"}],"status":"passed"},{"id":"4_3","title":"Ensure a notification is configured for Identity Provider changes","desc":"It is recommended to setup an Event Rule and Notification that gets triggered when\nIdentity Providers are created, updated or deleted. Event Rules are compartment scoped and\nwill detect events in child compartments. It is recommended to create the Event rule at\nthe root compartment level. OCI Identity Providers allow management of User ID / passwords\nin external systems and use of those credentials to access OCI resources. Identity\nProviders allow users to single sign-on to OCI console and have other OCI credentials like\nAPI Keys. Monitoring and alerting on changes to Identity Providers will help in\nidentifying changes to the security posture.","descriptions":[{"label":"default","data":"It is recommended to setup an Event Rule and Notification that gets triggered when\nIdentity Providers are created, updated or deleted. Event Rules are compartment scoped and\nwill detect events in child compartments. It is recommended to create the Event rule at\nthe root compartment level. OCI Identity Providers allow management of User ID / passwords\nin external systems and use of those credentials to access OCI resources. Identity\nProviders allow users to single sign-on to OCI console and have other OCI credentials like\nAPI Keys. Monitoring and alerting on changes to Identity Providers will help in\nidentifying changes to the security posture."},{"label":"check","data":"From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\nthe Compartment that hosts the rules Find and click the Rule that handles Identity\nProvider Changes (if any) Click the Edit Rule button and verify that the RuleConditions\nsection contains a condition for the Service Identity and Event Types: Identity Provider \nCreate , Identity Provider - Delete and Identity Provider  Update Verify that in the\nActions section the Action Type contains: Notifications and that a valid Topic is\nreferenced. From CLI: Find the OCID of the specific Event Rule based on Display Name and\nCompartment OCID oci events rule list --compartment-id <compartment-ocid> --query \"data\n[?\"display-name\"=='<display-name>']\".{\"id:id\"} --output table List the details of a\nspecific Event Rule based on the OCID of the rule. oci events rule get --rule-id <rule-id>\nIn the JSON output locate the Conditions key value pair and verify that the following\nConditions are present: com.oraclecloud.identitycontrolplane.createidentityprovider\ncom.oraclecloud.identitycontrolplane.deleteidentityprovider\ncom.oraclecloud.identitycontrolplane.updateidentityprovider Verify the value of the\nis-enabled attribute is true In the JSON output verify that actionType is ONS and locate\nthe topic-id Verify the correct topic is used by checking the topic name oci ons topic get\n--topic-id <topic-id> --query data.{\"name:name\"} --output table"},{"label":"fix","data":"From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\nthe compartment that should host the rule Click Create Rule Provide a Display Name and\nDescription Create a Rule Condition by selecting Identity in the Service Name Drop-down\nand selecting Identity Provider  Create , Identity Provider - Delete and Identity\nProvider  Update In the Actions section select Notifications as Action Type Select the\nCompartment that hosts the Topic to be used. Select the Topic to be used Optionally add\nTags to the Rule Click Create Rule From CLI: Find the topic-id of the topic the Event Rule\nshould use for sending notifications by using the topic name and Compartment OCID oci ons\ntopic list --compartment-id <compartment-ocid> --all --query \"data\n[?name=='<topic-name>']\".{\"name:name,topic_id:\"topic-id\"\"} --output table Create a JSON\nfile to be used when creating the Event Rule. Replace topic id, display name, description\nand compartment OCID. { \"actions\": { \"actions\": [ { \"actionType\": \"ONS\", \"isEnabled\":\n\ntrue, \"topicId\": \"<topic-id>\" }] }, \"condition\":\n\n\"{\"eventType\":[\"com.oraclecloud.identitycontrolplane.createidentityprovider\",\"\ncom.oraclecloud.identitycontrolplane.deleteidentityprovider\",\"\ncom.oraclecloud.identitycontrolplane.updateidentityprovider\"],\"data\":{}}\",\n\"displayName\": \"<display-name>\", \"description\": \"<description>\", \"isEnabled\": true,\n\"compartmentId\": \"<compartment-ocid>\" } Create the actual event rule oci events rule\ncreate --from-json file://event_rule.json Note in the JSON returned that it lists the\nparameters specified in the JSON file provided and that there is an OCID provided for the\nEvent Rule"},{"label":"potential_impacts","data":"\"There is no performance"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-4_3","severity":"medium","gid":"CIS-4_3","rid":"xccdf_cis_cis_rule_4_3","stig_id":"4.3","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-002323","CCI-000364","CCI-000366","CCI-000381","CCI-001199","CCI-000540","CCI-002472"],"nist":["AC-18 a","CM-6 a","CM-6 b","CM-7 a","SC-28","CP-9 (d)","SC-28"]},"code":"control '4_3' do\n  title 'Ensure a notification is configured for Identity Provider changes'\n\n  desc <<~DESC\n    It is recommended to setup an Event Rule and Notification that gets triggered when\n    Identity Providers are created, updated or deleted. Event Rules are compartment scoped and\n    will detect events in child compartments. It is recommended to create the Event rule at\n    the root compartment level. OCI Identity Providers allow management of User ID / passwords\n    in external systems and use of those credentials to access OCI resources. Identity\n    Providers allow users to single sign-on to OCI console and have other OCI credentials like\n    API Keys. Monitoring and alerting on changes to Identity Providers will help in\n    identifying changes to the security posture.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\n    the Compartment that hosts the rules Find and click the Rule that handles Identity\n    Provider Changes (if any) Click the Edit Rule button and verify that the RuleConditions\n    section contains a condition for the Service Identity and Event Types: Identity Provider \n    Create , Identity Provider - Delete and Identity Provider  Update Verify that in the\n    Actions section the Action Type contains: Notifications and that a valid Topic is\n    referenced. From CLI: Find the OCID of the specific Event Rule based on Display Name and\n    Compartment OCID oci events rule list --compartment-id <compartment-ocid> --query \"data\n    [?\\\"display-name\\\"=='<display-name>']\".{\"id:id\"} --output table List the details of a\n    specific Event Rule based on the OCID of the rule. oci events rule get --rule-id <rule-id>\n    In the JSON output locate the Conditions key value pair and verify that the following\n    Conditions are present: com.oraclecloud.identitycontrolplane.createidentityprovider\n    com.oraclecloud.identitycontrolplane.deleteidentityprovider\n    com.oraclecloud.identitycontrolplane.updateidentityprovider Verify the value of the\n    is-enabled attribute is true In the JSON output verify that actionType is ONS and locate\n    the topic-id Verify the correct topic is used by checking the topic name oci ons topic get\n    --topic-id <topic-id> --query data.{\"name:name\"} --output table\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\n    the compartment that should host the rule Click Create Rule Provide a Display Name and\n    Description Create a Rule Condition by selecting Identity in the Service Name Drop-down\n    and selecting Identity Provider  Create , Identity Provider - Delete and Identity\n    Provider  Update In the Actions section select Notifications as Action Type Select the\n    Compartment that hosts the Topic to be used. Select the Topic to be used Optionally add\n    Tags to the Rule Click Create Rule From CLI: Find the topic-id of the topic the Event Rule\n    should use for sending notifications by using the topic name and Compartment OCID oci ons\n    topic list --compartment-id <compartment-ocid> --all --query \"data\n    [?name=='<topic-name>']\".{\"name:name,topic_id:\\\"topic-id\\\"\"} --output table Create a JSON\n    file to be used when creating the Event Rule. Replace topic id, display name, description\n    and compartment OCID. { \"actions\": { \"actions\": [ { \"actionType\": \"ONS\", \"isEnabled\":\n\n    true, \"topicId\": \"<topic-id>\" }] }, \"condition\":\n\n    \"{\\\"eventType\\\":[\\\"com.oraclecloud.identitycontrolplane.createidentityprovider\\\",\\\"\n    com.oraclecloud.identitycontrolplane.deleteidentityprovider\\\",\\\"\n    com.oraclecloud.identitycontrolplane.updateidentityprovider\\\"],\\\"data\\\":{}}\",\n    \"displayName\": \"<display-name>\", \"description\": \"<description>\", \"isEnabled\": true,\n    \"compartmentId\": \"<compartment-ocid>\" } Create the actual event rule oci events rule\n    create --from-json file://event_rule.json Note in the JSON returned that it lists the\n    parameters specified in the JSON file provided and that there is an OCID provided for the\n    Event Rule\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    \"There is no performance\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-4_3'\n  tag severity: 'medium'\n  tag gid: 'CIS-4_3'\n  tag rid: 'xccdf_cis_cis_rule_4_3'\n  tag stig_id: '4.3'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-002323',\n    'CCI-000364',\n    'CCI-000366',\n    'CCI-000381',\n    'CCI-001199',\n    'CCI-000540',\n    'CCI-002472'\n  ]\n\n  tag nist: [\n    'AC-18 a',\n    'CM-6 a',\n    'CM-6 b',\n    'CM-7 a',\n    'SC-28',\n    'CP-9 (d)',\n    'SC-28'\n  ]\n\n  required_rule_conditions = [\n    'com.oraclecloud.identitycontrolplane.createidentityprovider',\n    'com.oraclecloud.identitycontrolplane.deleteidentityprovider',\n    'com.oraclecloud.identitycontrolplane.updateidentityprovider'\n  ]\n\n  tenancy_ocid = input('tenancy_ocid')\n  identity_provider_notification_topic = input('identity_provider_notification_topic')\n\n  regions = json(command: 'oci iam region-subscription list --all').params.fetch('data', []).map { |region| region['region-name'] }.compact\n\n  findings = regions.each_with_object([]) do |region, missing|\n    rules = json(command: %(oci events rule list --compartment-id \"#{tenancy_ocid}\" --region \"#{region}\" --all 2>/dev/null)).params.fetch('data', [])\n\n    rule_present = rules.any? do |rule|\n      rule_details = json(command: %(oci events rule get --rule-id \"#{rule['id']}\" --region \"#{region}\" 2>/dev/null)).params.fetch('data', {})\n\n      next false unless rule_details['is-enabled']\n\n      condition_data = begin\n        json(content: rule_details['condition'].to_s).params\n      rescue StandardError\n        {}\n      end\n\n      event_types = condition_data['eventType']\n      next false unless (required_rule_conditions - event_types).empty?\n\n      actions = rule_details.dig('actions', 'actions') || []\n      actions.any? do |action|\n        next false unless action['action-type'] == 'ONS' && action['is-enabled']\n\n        topic_id = action['topic-id']\n        next false if topic_id.to_s.strip.empty?\n\n        topic = json(command: %(oci ons topic get --topic-id \"#{topic_id}\" --region \"#{region}\" 2>/dev/null)).params.fetch('data', {})\n        topic['name'] == identity_provider_notification_topic && topic['lifecycle-state'] == 'ACTIVE'\n      end\n    end\n\n    missing << { region: region, issue: 'Missing enabled Identity Provider change notification rule(s)' } unless rule_present\n  end\n\n  describe 'Ensure a notification is configured for Identity Provider changes' do\n    subject { findings }\n    it { should be_empty }\n  end\nend\n","source_location":{"line":1,"ref":"./controls/4_3.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Ensure a notification is configured for Identity Provider changes is expected to be empty","run_time":0.000998,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Ensure a notification is configured for Identity Provider changes"}],"status":"passed"},{"id":"4_4","title":"Ensure a notification is configured for IdP group mapping changes","desc":"It is recommended to setup an Event Rule and Notification that gets triggered when\nIdentity Provider Group Mappings are created, updated or deleted. Event Rules are\ncompartment scoped and will detect events in child compartments. It is recommended to\ncreate the Event rule at the root compartment level. IAM Policies govern access to all\nresources within an OCI Tenancy. IAM Policies use OCI Groups for assigning the privileges.\nIdentity Provider Groups could be mapped to OCI Groups to assign privileges to federated\nusers in OCI. Monitoring and alerting on changes to Identity Provider Group mappings will\nhelp in identifying changes to the security posture.","descriptions":[{"label":"default","data":"It is recommended to setup an Event Rule and Notification that gets triggered when\nIdentity Provider Group Mappings are created, updated or deleted. Event Rules are\ncompartment scoped and will detect events in child compartments. It is recommended to\ncreate the Event rule at the root compartment level. IAM Policies govern access to all\nresources within an OCI Tenancy. IAM Policies use OCI Groups for assigning the privileges.\nIdentity Provider Groups could be mapped to OCI Groups to assign privileges to federated\nusers in OCI. Monitoring and alerting on changes to Identity Provider Group mappings will\nhelp in identifying changes to the security posture."},{"label":"check","data":"From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\nthe Compartment that hosts the rules Find and click the Rule that handles Idp Group\nMapping Changes (if any) Click the Edit Rule button and verify that the RuleConditions\nsection contains a condition for the Service Identity and Event Types: Idp Group Mapping \nCreate , Idp Group Mapping  Delete and Idp Group Mapping  Update Verify that in the\nActions section the Action Type contains: Notifications and that a valid Topic is\nreferenced. From CLI: Find the OCID of the specific Event Rule based on Display Name and\nCompartment OCID oci events rule list --compartment-id <compartment-ocid> --query \"data\n[?\"display-name\"=='<displa-name>']\".{\"id:id\"} --output table List the details of a\nspecific Event Rule based on the OCID of the rule. oci events rule get --rule-id <rule-id>\nIn the JSON output locate the Conditions key value pair and verify that the following\nConditions are present: com.oraclecloud.identitycontrolplane.createidpgroupmapping\ncom.oraclecloud.identitycontrolplane.deleteidpgroupmapping\ncom.oraclecloud.identitycontrolplane.updateidpgroupmapping Verify the value of the\nis-enabled attribute is true In the JSON output verify that actionType is ONS and locate\nthe topic-id Verify the correct topic is used by checking the topic name oci ons topic get\n--topic-id <topic-id> --query data.{\"name:name\"} --output table"},{"label":"fix","data":"From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\nthe compartment that should host the rule Click Create Rule Provide a Display Name and\nDescription Create a Rule Condition by selecting Identity in the Service Name Drop-down\nand selecting Idp Group Mapping  Create , Idp Group Mapping  Delete and Idp Group\nMapping  Update In the Actions section select Notifications as Action Type Select the\nCompartment that hosts the Topic to be used. Select the Topic to be used Optionally add\nTags to the Rule Click Create Rule From CLI: Find the topic-id of the topic the Event Rule\nshould use for sending notifications by using the topic name and Compartment OCID oci ons\ntopic list --compartment-id <compartment-ocid> --all --query \"data\n[?name=='<topic-name>']\".{\"name:name,topic_id:\"topic-id\"\"} --output table Create a JSON\nfile to be used when creating the Event Rule. Replace topic id, display name, description\nand compartment OCID. { \"actions\": { \"actions\": [ { \"actionType\": \"ONS\", \"isEnabled\":\n\ntrue, \"topicId\": \"<topic-id>\" }] }, \"condition\":\n\n\"{\"eventType\":[\"com.oraclecloud.identitycontrolplane.createidpgroupmapping\",\"com.oraclecloud.identitycontrolplane.deleteidpgroupmapping\",\"com.oraclecloud.identitycontrolplane.updateidpgroupmapping\"],\"data\":{}}\",\n\"displayName\": \"<display-name>\", \"description\": \"<description>\", \"isEnabled\": true,\n\"compartmentId\": \"<compartment-ocid>\" } Create the actual event rule oci events rule\ncreate --from-json file://event_rule.json Note in the JSON returned that it lists the\nparameters specified in the JSON file provided and that there is an OCID provided for the\nEvent Rule"},{"label":"potential_impacts","data":"\"There is no performance"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-4_4","severity":"medium","gid":"CIS-4_4","rid":"xccdf_cis_cis_rule_4_4","stig_id":"4.4","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-002323","CCI-000364","CCI-000366","CCI-000381","CCI-001199","CCI-000540","CCI-002472"],"nist":["AC-18 a","CM-6 a","CM-6 b","CM-7 a","SC-28","CP-9 (d)","SC-28"]},"code":"control '4_4' do\n  title 'Ensure a notification is configured for IdP group mapping changes'\n\n  desc <<~DESC\n    It is recommended to setup an Event Rule and Notification that gets triggered when\n    Identity Provider Group Mappings are created, updated or deleted. Event Rules are\n    compartment scoped and will detect events in child compartments. It is recommended to\n    create the Event rule at the root compartment level. IAM Policies govern access to all\n    resources within an OCI Tenancy. IAM Policies use OCI Groups for assigning the privileges.\n    Identity Provider Groups could be mapped to OCI Groups to assign privileges to federated\n    users in OCI. Monitoring and alerting on changes to Identity Provider Group mappings will\n    help in identifying changes to the security posture.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\n    the Compartment that hosts the rules Find and click the Rule that handles Idp Group\n    Mapping Changes (if any) Click the Edit Rule button and verify that the RuleConditions\n    section contains a condition for the Service Identity and Event Types: Idp Group Mapping \n    Create , Idp Group Mapping  Delete and Idp Group Mapping  Update Verify that in the\n    Actions section the Action Type contains: Notifications and that a valid Topic is\n    referenced. From CLI: Find the OCID of the specific Event Rule based on Display Name and\n    Compartment OCID oci events rule list --compartment-id <compartment-ocid> --query \"data\n    [?\\\"display-name\\\"=='<displa-name>']\".{\"id:id\"} --output table List the details of a\n    specific Event Rule based on the OCID of the rule. oci events rule get --rule-id <rule-id>\n    In the JSON output locate the Conditions key value pair and verify that the following\n    Conditions are present: com.oraclecloud.identitycontrolplane.createidpgroupmapping\n    com.oraclecloud.identitycontrolplane.deleteidpgroupmapping\n    com.oraclecloud.identitycontrolplane.updateidpgroupmapping Verify the value of the\n    is-enabled attribute is true In the JSON output verify that actionType is ONS and locate\n    the topic-id Verify the correct topic is used by checking the topic name oci ons topic get\n    --topic-id <topic-id> --query data.{\"name:name\"} --output table\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\n    the compartment that should host the rule Click Create Rule Provide a Display Name and\n    Description Create a Rule Condition by selecting Identity in the Service Name Drop-down\n    and selecting Idp Group Mapping  Create , Idp Group Mapping  Delete and Idp Group\n    Mapping  Update In the Actions section select Notifications as Action Type Select the\n    Compartment that hosts the Topic to be used. Select the Topic to be used Optionally add\n    Tags to the Rule Click Create Rule From CLI: Find the topic-id of the topic the Event Rule\n    should use for sending notifications by using the topic name and Compartment OCID oci ons\n    topic list --compartment-id <compartment-ocid> --all --query \"data\n    [?name=='<topic-name>']\".{\"name:name,topic_id:\\\"topic-id\\\"\"} --output table Create a JSON\n    file to be used when creating the Event Rule. Replace topic id, display name, description\n    and compartment OCID. { \"actions\": { \"actions\": [ { \"actionType\": \"ONS\", \"isEnabled\":\n\n    true, \"topicId\": \"<topic-id>\" }] }, \"condition\":\n\n    \"{\\\"eventType\\\":[\\\"com.oraclecloud.identitycontrolplane.createidpgroupmapping\\\",\\\"com.oraclecloud.identitycontrolplane.deleteidpgroupmapping\\\",\\\"com.oraclecloud.identitycontrolplane.updateidpgroupmapping\\\"],\\\"data\\\":{}}\",\n    \"displayName\": \"<display-name>\", \"description\": \"<description>\", \"isEnabled\": true,\n    \"compartmentId\": \"<compartment-ocid>\" } Create the actual event rule oci events rule\n    create --from-json file://event_rule.json Note in the JSON returned that it lists the\n    parameters specified in the JSON file provided and that there is an OCID provided for the\n    Event Rule\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    \"There is no performance\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-4_4'\n  tag severity: 'medium'\n  tag gid: 'CIS-4_4'\n  tag rid: 'xccdf_cis_cis_rule_4_4'\n  tag stig_id: '4.4'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-002323',\n    'CCI-000364',\n    'CCI-000366',\n    'CCI-000381',\n    'CCI-001199',\n    'CCI-000540',\n    'CCI-002472'\n  ]\n\n  tag nist: [\n    'AC-18 a',\n    'CM-6 a',\n    'CM-6 b',\n    'CM-7 a',\n    'SC-28',\n    'CP-9 (d)',\n    'SC-28'\n  ]\n\n  required_rule_conditions = [\n    'com.oraclecloud.identitycontrolplane.addidpgroupmapping',\n    'com.oraclecloud.identitycontrolplane.removeidpgroupmapping',\n    'com.oraclecloud.identitycontrolplane.updateidpgroupmapping'\n  ]\n\n  tenancy_ocid = input('tenancy_ocid')\n  group_mapping_notification_topic = input('group_mapping_notification_topic')\n\n  regions = json(command: 'oci iam region-subscription list --all').params.fetch('data', []).map { |region| region['region-name'] }.compact\n\n  findings = regions.each_with_object([]) do |region, missing|\n    rules = json(command: %(oci events rule list --compartment-id \"#{tenancy_ocid}\" --region \"#{region}\" --all 2>/dev/null)).params.fetch('data', [])\n\n    rule_present = rules.any? do |rule|\n      rule_details = json(command: %(oci events rule get --rule-id \"#{rule['id']}\" --region \"#{region}\" 2>/dev/null)).params.fetch('data', {})\n\n      next false unless rule_details['is-enabled']\n\n      condition_data = begin\n        json(content: rule_details['condition'].to_s).params\n      rescue StandardError\n        {}\n      end\n\n      event_types = condition_data['eventType']\n      next false unless (required_rule_conditions - event_types).empty?\n\n      actions = rule_details.dig('actions', 'actions') || []\n      actions.any? do |action|\n        next false unless action['action-type'] == 'ONS' && action['is-enabled']\n\n        topic_id = action['topic-id']\n        next false if topic_id.to_s.strip.empty?\n\n        topic = json(command: %(oci ons topic get --topic-id \"#{topic_id}\" --region \"#{region}\" 2>/dev/null)).params.fetch('data', {})\n        topic['name'] == group_mapping_notification_topic && topic['lifecycle-state'] == 'ACTIVE'\n      end\n    end\n\n    missing << { region: region, issue: 'Missing enabled IdP group mapping change notification rule(s)' } unless rule_present\n  end\n\n  describe 'Ensure a notification is configured for IdP group mapping changes' do\n    subject { findings }\n    it { should be_empty }\n  end\nend\n","source_location":{"line":1,"ref":"./controls/4_4.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Ensure a notification is configured for IdP group mapping changes is expected to be empty","run_time":0.000973,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Ensure a notification is configured for IdP group mapping changes"}],"status":"passed"},{"id":"4_5","title":"Ensure a notification is configured for IAM group changes","desc":"It is recommended to setup an Event Rule and Notification that gets triggered when IAM\nGroups are created, updated or deleted. Event Rules are compartment scoped and will detect\nevents in child compartments, it is recommended to create the Event rule at the root\ncompartment level. IAM Groups control access to all resources within an OCI Tenancy.\nMonitoring and alerting on changes to IAM Groups will help in identifying changes to\nsatisfy least privilege principle.","descriptions":[{"label":"default","data":"It is recommended to setup an Event Rule and Notification that gets triggered when IAM\nGroups are created, updated or deleted. Event Rules are compartment scoped and will detect\nevents in child compartments, it is recommended to create the Event rule at the root\ncompartment level. IAM Groups control access to all resources within an OCI Tenancy.\nMonitoring and alerting on changes to IAM Groups will help in identifying changes to\nsatisfy least privilege principle."},{"label":"check","data":"From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\nthe Compartment that hosts the rules Find and click the Rule that handles IAM Group\nChanges Click the Edit Rule button and verify that the Rule Conditions section contains a\ncondition for the Service Identity and Event Types: Group  Create , Group  Delete and\nGroup  Update Verify that in the Actions section the Action Type contains: Notifications\nand that a valid Topic is referenced. From CLI: Find the OCID of the specific Event Rule\nbased on Display Name and Compartment OCID oci events rule list --compartment-id\n<compartment-ocid> --query \"data [?\"display-name\"=='<display-name>']\".{\"id:id\"} --output\ntable List the details of a specific Event Rule based on the OCID of the rule. oci events\nrule get --rule-id <rule-id> In the JSON output locate the Conditions key value pair and\nverify that the following Conditions are present:\n\ncom.oraclecloud.identitycontrolplane.creategroup\ncom.oraclecloud.identitycontrolplane.deletegroup\ncom.oraclecloud.identitycontrolplane.updategroup Verify the value of the is-enabled\nattribute is true In the JSON output verify that actionType is ONS and locate the topic-id\nVerify the correct topic is used by checking the topic name oci ons topic get --topic-id\n<topic-id> --query data.{\"name:name\"} --output table"},{"label":"fix","data":"From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\nthe compartment that should host the rule Click Create Rule Provide a Display Name and\nDescription Create a Rule Condition by selecting Identity in the Service Name Drop-down\nand selecting Group  Create , Group  Delete and Group  Update In the Actions section\nselect Notifications as Action Type Select the Compartment that hosts the Topic to be\nused. Select the Topic to be used Optionally add Tags to the Rule Click Create Rule From\nCLI: Find the topic-id of the topic the Event Rule should use for sending Notifications by\nusing the topic name and Compartment OCID oci ons topic list --compartment-id\n<compartment-ocid> --all --query \"data\n[?name=='<topic-name>']\".{\"name:name,topic_id:\"topic-id\"\"} --output table Create a JSON\nfile to be used when creating the Event Rule. Replace topic id, display name, description\nand compartment OCID. { \"actions\": { \"actions\": [ { \"actionType\": \"ONS\", \"isEnabled\":\n\ntrue, \"topicId\": \"<topic-id>\" }] }, \"condition\":\n\n\"{\"eventType\":[\"com.oraclecloud.identitycontrolplane.creategroup\",\"com.oraclecloud.identitycontrolplane.deletegroup\",\"com.oraclecloud.identitycontrolplane.updategroup\"],\"data\":{}}\",\n\"displayName\": \"<display-name>\", \"description\": \"<description>\", \"isEnabled\": true,\n\"compartmentId\": \"<compartment-ocid>\" } Create the actual event rule oci events rule\ncreate --from-json file://event_rule.json Note in the JSON returned that it lists the\nparameters specified in the JSON file provided and that there is an OCID provided for the\nEvent Rule"},{"label":"potential_impacts","data":"\"There is no performance"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-4_5","severity":"medium","gid":"CIS-4_5","rid":"xccdf_cis_cis_rule_4_5","stig_id":"4.5","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-002323","CCI-000364","CCI-000366","CCI-000381","CCI-001199","CCI-000540","CCI-002472"],"nist":["AC-18 a","CM-6 a","CM-6 b","CM-7 a","SC-28","CP-9 (d)","SC-28"]},"code":"control '4_5' do\n  title 'Ensure a notification is configured for IAM group changes'\n\n  desc <<~DESC\n    It is recommended to setup an Event Rule and Notification that gets triggered when IAM\n    Groups are created, updated or deleted. Event Rules are compartment scoped and will detect\n    events in child compartments, it is recommended to create the Event rule at the root\n    compartment level. IAM Groups control access to all resources within an OCI Tenancy.\n    Monitoring and alerting on changes to IAM Groups will help in identifying changes to\n    satisfy least privilege principle.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\n    the Compartment that hosts the rules Find and click the Rule that handles IAM Group\n    Changes Click the Edit Rule button and verify that the Rule Conditions section contains a\n    condition for the Service Identity and Event Types: Group  Create , Group  Delete and\n    Group  Update Verify that in the Actions section the Action Type contains: Notifications\n    and that a valid Topic is referenced. From CLI: Find the OCID of the specific Event Rule\n    based on Display Name and Compartment OCID oci events rule list --compartment-id\n    <compartment-ocid> --query \"data [?\\\"display-name\\\"=='<display-name>']\".{\"id:id\"} --output\n    table List the details of a specific Event Rule based on the OCID of the rule. oci events\n    rule get --rule-id <rule-id> In the JSON output locate the Conditions key value pair and\n    verify that the following Conditions are present:\n\n    com.oraclecloud.identitycontrolplane.creategroup\n    com.oraclecloud.identitycontrolplane.deletegroup\n    com.oraclecloud.identitycontrolplane.updategroup Verify the value of the is-enabled\n    attribute is true In the JSON output verify that actionType is ONS and locate the topic-id\n    Verify the correct topic is used by checking the topic name oci ons topic get --topic-id\n    <topic-id> --query data.{\"name:name\"} --output table\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\n    the compartment that should host the rule Click Create Rule Provide a Display Name and\n    Description Create a Rule Condition by selecting Identity in the Service Name Drop-down\n    and selecting Group  Create , Group  Delete and Group  Update In the Actions section\n    select Notifications as Action Type Select the Compartment that hosts the Topic to be\n    used. Select the Topic to be used Optionally add Tags to the Rule Click Create Rule From\n    CLI: Find the topic-id of the topic the Event Rule should use for sending Notifications by\n    using the topic name and Compartment OCID oci ons topic list --compartment-id\n    <compartment-ocid> --all --query \"data\n    [?name=='<topic-name>']\".{\"name:name,topic_id:\\\"topic-id\\\"\"} --output table Create a JSON\n    file to be used when creating the Event Rule. Replace topic id, display name, description\n    and compartment OCID. { \"actions\": { \"actions\": [ { \"actionType\": \"ONS\", \"isEnabled\":\n\n    true, \"topicId\": \"<topic-id>\" }] }, \"condition\":\n\n    \"{\\\"eventType\\\":[\\\"com.oraclecloud.identitycontrolplane.creategroup\\\",\\\"com.oraclecloud.identitycontrolplane.deletegroup\\\",\\\"com.oraclecloud.identitycontrolplane.updategroup\\\"],\\\"data\\\":{}}\",\n    \"displayName\": \"<display-name>\", \"description\": \"<description>\", \"isEnabled\": true,\n    \"compartmentId\": \"<compartment-ocid>\" } Create the actual event rule oci events rule\n    create --from-json file://event_rule.json Note in the JSON returned that it lists the\n    parameters specified in the JSON file provided and that there is an OCID provided for the\n    Event Rule\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    \"There is no performance\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-4_5'\n  tag severity: 'medium'\n  tag gid: 'CIS-4_5'\n  tag rid: 'xccdf_cis_cis_rule_4_5'\n  tag stig_id: '4.5'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-002323',\n    'CCI-000364',\n    'CCI-000366',\n    'CCI-000381',\n    'CCI-001199',\n    'CCI-000540',\n    'CCI-002472'\n  ]\n\n  tag nist: [\n    'AC-18 a',\n    'CM-6 a',\n    'CM-6 b',\n    'CM-7 a',\n    'SC-28',\n    'CP-9 (d)',\n    'SC-28'\n  ]\n\n  required_rule_conditions = [\n    'com.oraclecloud.identitycontrolplane.creategroup',\n    'com.oraclecloud.identitycontrolplane.deletegroup',\n    'com.oraclecloud.identitycontrolplane.updategroup'\n  ]\n\n  tenancy_ocid = input('tenancy_ocid')\n  iam_group_notification_topic = input('iam_group_notification_topic')\n\n  regions = json(command: 'oci iam region-subscription list --all').params.fetch('data', []).map { |region| region['region-name'] }.compact\n\n  findings = regions.each_with_object([]) do |region, missing|\n    rules = json(command: %(oci events rule list --compartment-id \"#{tenancy_ocid}\" --region \"#{region}\" --all 2>/dev/null)).params.fetch('data', [])\n\n    rule_present = rules.any? do |rule|\n      rule_details = json(command: %(oci events rule get --rule-id \"#{rule['id']}\" --region \"#{region}\" 2>/dev/null)).params.fetch('data', {})\n\n      next false unless rule_details['is-enabled']\n\n      condition_data = begin\n        json(content: rule_details['condition'].to_s).params\n      rescue StandardError\n        {}\n      end\n\n      event_types = condition_data['eventType']\n      next false unless (required_rule_conditions - event_types).empty?\n\n      actions = rule_details.dig('actions', 'actions') || []\n      actions.any? do |action|\n        next false unless action['action-type'] == 'ONS' && action['is-enabled']\n\n        topic_id = action['topic-id']\n        next false if topic_id.to_s.strip.empty?\n\n        topic = json(command: %(oci ons topic get --topic-id \"#{topic_id}\" --region \"#{region}\" 2>/dev/null)).params.fetch('data', {})\n        topic['name'] == iam_group_notification_topic && topic['lifecycle-state'] == 'ACTIVE'\n      end\n    end\n\n    missing << { region: region, issue: 'Missing enabled IAM group change notification rule(s)' } unless rule_present\n  end\n\n  describe 'Ensure a notification is configured for IAM group changes' do\n    subject { findings }\n    it { should be_empty }\n  end\nend\n","source_location":{"line":1,"ref":"./controls/4_5.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Ensure a notification is configured for IAM group changes is expected to be empty","run_time":0.00097,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Ensure a notification is configured for IAM group changes"}],"status":"passed"},{"id":"4_6","title":"Ensure a notification is configured for IAM policy changes","desc":"It is recommended to setup an Event Rule and Notification that gets triggered when IAM\nPolicies are created, updated or deleted. Event Rules are compartment scoped and will\ndetect events in child compartments, it is recommended to create the Event rule at the\nroot compartment level. IAM Policies govern access to all resources within an OCI Tenancy.\nMonitoring and alerting on changes to IAM policies will help in identifying changes to the\nsecurity posture.","descriptions":[{"label":"default","data":"It is recommended to setup an Event Rule and Notification that gets triggered when IAM\nPolicies are created, updated or deleted. Event Rules are compartment scoped and will\ndetect events in child compartments, it is recommended to create the Event rule at the\nroot compartment level. IAM Policies govern access to all resources within an OCI Tenancy.\nMonitoring and alerting on changes to IAM policies will help in identifying changes to the\nsecurity posture."},{"label":"check","data":"From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\nthe Compartment that hosts the rules Find and click the Rule that handles IAM Policy\nChanges (if any) Click the Edit Rule button and verify that the RuleConditions section\ncontains a condition for the Service Identity and Event Types: Policy  Create , Policy -\nDelete and Policy  Update Verify that in the Actions section the Action Type contains:\n\nNotifications and that a valid Topic is referenced. From CLI: Find the OCID of the\nspecific Event Rule based on Display Name and Compartment OCID oci events rule list\n--compartment-id <compartment-ocid> --query \"data\n[?\"display-name\"=='<display-name>']\".{\"id:id\"} --output table List the details of a\nspecific Event Rule based on the OCID of the rule. oci events rule get --rule-id <rule-id>\nIn the JSON output locate the Conditions key value pair and verify that the following\nConditions are present: com.oraclecloud.identitycontrolplane.createpolicy\ncom.oraclecloud.identitycontrolplane.deletepolicy\ncom.oraclecloud.identitycontrolplane.updatepolicy Verify the value of the is-enabled\nattribute is true In the JSON output verify that actionType is ONS and locate the topic-id\nVerify the correct topic is used by checking the topic name oci ons topic get --topic-id\n<topic-id> --query data.{\"name:name\"} --output table"},{"label":"fix","data":"From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\nthe compartment that should host the rule Click Create Rule Provide a Display Name and\nDescription Create a Rule Condition by selecting Identity in the Service Name Drop-down\nand selecting Policy  Change Compartment , Policy  Create , Policy - Delete and Policy \nUpdate In the Actions section select Notifications as Action Type Select the Compartment\nthat hosts the Topic to be used. Select the Topic to be used Optionally add Tags to the\nRule Click Create Rule From CLI: Find the topic-id of the topic the Event Rule should use\nfor sending Notifications by using the topic name and Compartment OCID oci ons topic list\n--compartment-id <compartment-ocid> --all --query \"data\n[?name=='<topic-name>']\".{\"name:name,topic_id:\"topic-id\"\"} --output table Create a JSON\nfile to be used when creating the Event Rule. Replace topic id, display name, description\nand compartment OCID. { \"actions\": { \"actions\": [ { \"actionType\": \"ONS\", \"isEnabled\":\n\ntrue, \"topicId\": \"<topic-id>\" }] }, \"condition\":\n\n\"{\"eventType\":[\"com.oraclecloud.identitycontrolplane.createpolicy\",\"com.oraclecloud.identitycontrolplane.deletepolicy\",\"com.oraclecloud.identitycontrolplane.updatepolicy\"],\"data\":{}}\",\n\"displayName\": \"<display-name>\", \"description\": \"<description>\", \"isEnabled\": true,\n\"compartmentId\": \"<compartment-ocid>\" } Create the actual event rule oci events rule\ncreate --from-json file://event_rule.json Note in the JSON returned that it lists the\nparameters specified in the JSON file provided and that there is an OCID provided for the\nEvent Rule"},{"label":"potential_impacts","data":"\"There is no performance"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-4_6","severity":"medium","gid":"CIS-4_6","rid":"xccdf_cis_cis_rule_4_6","stig_id":"4.6","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-002323","CCI-000364","CCI-000366","CCI-000381","CCI-001199","CCI-000540","CCI-002472"],"nist":["AC-18 a","CM-6 a","CM-6 b","CM-7 a","SC-28","CP-9 (d)","SC-28"]},"code":"control '4_6' do\n  title 'Ensure a notification is configured for IAM policy changes'\n\n  desc <<~DESC\n    It is recommended to setup an Event Rule and Notification that gets triggered when IAM\n    Policies are created, updated or deleted. Event Rules are compartment scoped and will\n    detect events in child compartments, it is recommended to create the Event rule at the\n    root compartment level. IAM Policies govern access to all resources within an OCI Tenancy.\n    Monitoring and alerting on changes to IAM policies will help in identifying changes to the\n    security posture.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\n    the Compartment that hosts the rules Find and click the Rule that handles IAM Policy\n    Changes (if any) Click the Edit Rule button and verify that the RuleConditions section\n    contains a condition for the Service Identity and Event Types: Policy  Create , Policy -\n    Delete and Policy  Update Verify that in the Actions section the Action Type contains:\n\n    Notifications and that a valid Topic is referenced. From CLI: Find the OCID of the\n    specific Event Rule based on Display Name and Compartment OCID oci events rule list\n    --compartment-id <compartment-ocid> --query \"data\n    [?\\\"display-name\\\"=='<display-name>']\".{\"id:id\"} --output table List the details of a\n    specific Event Rule based on the OCID of the rule. oci events rule get --rule-id <rule-id>\n    In the JSON output locate the Conditions key value pair and verify that the following\n    Conditions are present: com.oraclecloud.identitycontrolplane.createpolicy\n    com.oraclecloud.identitycontrolplane.deletepolicy\n    com.oraclecloud.identitycontrolplane.updatepolicy Verify the value of the is-enabled\n    attribute is true In the JSON output verify that actionType is ONS and locate the topic-id\n    Verify the correct topic is used by checking the topic name oci ons topic get --topic-id\n    <topic-id> --query data.{\"name:name\"} --output table\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\n    the compartment that should host the rule Click Create Rule Provide a Display Name and\n    Description Create a Rule Condition by selecting Identity in the Service Name Drop-down\n    and selecting Policy  Change Compartment , Policy  Create , Policy - Delete and Policy \n    Update In the Actions section select Notifications as Action Type Select the Compartment\n    that hosts the Topic to be used. Select the Topic to be used Optionally add Tags to the\n    Rule Click Create Rule From CLI: Find the topic-id of the topic the Event Rule should use\n    for sending Notifications by using the topic name and Compartment OCID oci ons topic list\n    --compartment-id <compartment-ocid> --all --query \"data\n    [?name=='<topic-name>']\".{\"name:name,topic_id:\\\"topic-id\\\"\"} --output table Create a JSON\n    file to be used when creating the Event Rule. Replace topic id, display name, description\n    and compartment OCID. { \"actions\": { \"actions\": [ { \"actionType\": \"ONS\", \"isEnabled\":\n\n    true, \"topicId\": \"<topic-id>\" }] }, \"condition\":\n\n    \"{\\\"eventType\\\":[\\\"com.oraclecloud.identitycontrolplane.createpolicy\\\",\\\"com.oraclecloud.identitycontrolplane.deletepolicy\\\",\\\"com.oraclecloud.identitycontrolplane.updatepolicy\\\"],\\\"data\\\":{}}\",\n    \"displayName\": \"<display-name>\", \"description\": \"<description>\", \"isEnabled\": true,\n    \"compartmentId\": \"<compartment-ocid>\" } Create the actual event rule oci events rule\n    create --from-json file://event_rule.json Note in the JSON returned that it lists the\n    parameters specified in the JSON file provided and that there is an OCID provided for the\n    Event Rule\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    \"There is no performance\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-4_6'\n  tag severity: 'medium'\n  tag gid: 'CIS-4_6'\n  tag rid: 'xccdf_cis_cis_rule_4_6'\n  tag stig_id: '4.6'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-002323',\n    'CCI-000364',\n    'CCI-000366',\n    'CCI-000381',\n    'CCI-001199',\n    'CCI-000540',\n    'CCI-002472'\n  ]\n\n  tag nist: [\n    'AC-18 a',\n    'CM-6 a',\n    'CM-6 b',\n    'CM-7 a',\n    'SC-28',\n    'CP-9 (d)',\n    'SC-28'\n  ]\n\n  required_rule_conditions = [\n    'com.oraclecloud.identitycontrolplane.createpolicy',\n    'com.oraclecloud.identitycontrolplane.deletepolicy',\n    'com.oraclecloud.identitycontrolplane.updatepolicy'\n  ]\n\n  tenancy_ocid = input('tenancy_ocid')\n  iam_policy_notification_topic = input('iam_policy_notification_topic')\n\n  regions = json(command: 'oci iam region-subscription list --all').params.fetch('data', []).map { |region| region['region-name'] }.compact\n\n  findings = regions.each_with_object([]) do |region, missing|\n    rules = json(command: %(oci events rule list --compartment-id \"#{tenancy_ocid}\" --region \"#{region}\" --all 2>/dev/null)).params.fetch('data', [])\n\n    rule_present = rules.any? do |rule|\n      rule_details = json(command: %(oci events rule get --rule-id \"#{rule['id']}\" --region \"#{region}\" 2>/dev/null)).params.fetch('data', {})\n\n      next false unless rule_details['is-enabled']\n\n      condition_data = begin\n        json(content: rule_details['condition'].to_s).params\n      rescue StandardError\n        {}\n      end\n\n      event_types = condition_data['eventType']\n      next false unless (required_rule_conditions - event_types).empty?\n\n      actions = rule_details.dig('actions', 'actions') || []\n      actions.any? do |action|\n        next false unless action['action-type'] == 'ONS' && action['is-enabled']\n\n        topic_id = action['topic-id']\n        next false if topic_id.to_s.strip.empty?\n\n        topic = json(command: %(oci ons topic get --topic-id \"#{topic_id}\" --region \"#{region}\" 2>/dev/null)).params.fetch('data', {})\n        topic['name'] == iam_policy_notification_topic && topic['lifecycle-state'] == 'ACTIVE'\n      end\n    end\n\n    missing << { region: region, issue: 'Missing enabled IAM policy change notification rule(s)' } unless rule_present\n  end\n\n  describe 'Ensure a notification is configured for IAM policy changes' do\n    subject { findings }\n    it { should be_empty }\n  end\nend\n","source_location":{"line":1,"ref":"./controls/4_6.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Ensure a notification is configured for IAM policy changes is expected to be empty","run_time":0.000975,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Ensure a notification is configured for IAM policy changes"}],"status":"passed"},{"id":"4_7","title":"Ensure a notification is configured for user changes","desc":"It is recommended to setup an Event Rule and Notification that gets triggered when IAM\nUsers are created, updated, deleted, capabilities updated, or state updated. Event Rules\nare compartment scoped and will detect events in child compartments, it is recommended to\ncreate the Event rule at the root compartment level. Users use or manage Oracle Cloud\nInfrastructure resources. Monitoring and alerting on changes to Users will help in\nidentifying changes to the security posture.","descriptions":[{"label":"default","data":"It is recommended to setup an Event Rule and Notification that gets triggered when IAM\nUsers are created, updated, deleted, capabilities updated, or state updated. Event Rules\nare compartment scoped and will detect events in child compartments, it is recommended to\ncreate the Event rule at the root compartment level. Users use or manage Oracle Cloud\nInfrastructure resources. Monitoring and alerting on changes to Users will help in\nidentifying changes to the security posture."},{"label":"check","data":"From Console: Using the search box to navigate to events Navigate to the rules page Select\n\nthe Compartment that hosts the rules Find and click the Rule that handles IAM User Changes\nClick the Edit Rule button and verify that the Rule Conditions section contains a\ncondition for the Service Identity and Event Types: User  Create , User  Delete , User \nUpdate , User Capabilities  Update , User State  Update Verify that in the Actions\nsection the Action Type contains: Notifications and that a valid Topic is referenced. From\nCLI: Find the OCID of the specific Event Rule based on Display Name and Compartment OCID\noci events rule list --compartment-id <compartment-ocid> --query \"data\n[?\"display-name\"=='<display-name>']\".{\"id:id\"} --output table List the details of a\nspecific Event Rule based on the OCID of the rule. oci events rule get --rule-id <rule-id>\nIn the JSON output locate the Conditions key value pair and verify that the following\nConditions are present: com.oraclecloud.identitycontrolplane.createuser\ncom.oraclecloud.identitycontrolplane.deleteuser\ncom.oraclecloud.identitycontrolplane.updateuser\ncom.oraclecloud.identitycontrolplane.updateusercapabilities\ncom.oraclecloud.identitycontrolplane.updateuserstate Verify the value of the is-enabled\nattribute is true In the JSON output verify that actionType is ONS and locate the topic-id\nVerify the correct topic is used by checking the topic name oci ons topic get --topic-id\n<topic-id> --query data.{\"name:name\"} --output table"},{"label":"fix","data":"From Console: Using the search box to navigate to events Navigate to the rules page Select\n\nthe compartment that should host the rule Click Create Rule Provide a Display Name and\nDescription Create a Rule Condition by selecting Identity in the Service Name Drop-down\nand selecting: User  Create , User  Delete , User  Update , User Capabilities  Update\n, User State  Update In the Actions section select Notifications as Action Type Select\nthe Compartment that hosts the Topic to be used. Select the Topic to be used Optionally\nadd Tags to the Rule Click Create Rule From CLI: Find the topic-id of the topic the Event\nRule should use for sending Notifications by using the topic name and Compartment OCID oci\nons topic list --compartment-id <compartment-ocid> --all --query \"data\n[?name=='<topic-name>']\".{\"name:name,topic_id:\"topic-id\"\"} --output table Create a JSON\nfile to be used when creating the Event Rule. Replace topic id, display name, description\nand compartment OCID. { \"actions\": { \"actions\": [ { \"actionType\": \"ONS\", \"isEnabled\":\n\ntrue, \"topicId\": \"<topic-id>\" }] }, \"condition\":\n\n\"{\"eventType\":[\"com.oraclecloud.identitycontrolplane.createuser\",\"com.oraclecloud.identitycontrolplane.deleteuser\",\"com.oraclecloud.identitycontrolplane.updateuser\",\"com.oraclecloud.identitycontrolplane.updateusercapabilities\",\"com.oraclecloud.identitycontrolplane.updateuserstate\"],\"data\":{}}\",\n\"displayName\": \"<display-name>\", \"description\": \"<description>\", \"isEnabled\": true,\n\"compartmentId\": \"<compartment-ocid>\" } Create the actual event rule oci events rule\ncreate --from-json file://event_rule.json Note in the JSON returned that it lists the\nparameters specified in the JSON file provided and that there is an OCID provided for the\nEvent Rule"},{"label":"potential_impacts","data":"\"There is no performance"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-4_7","severity":"medium","gid":"CIS-4_7","rid":"xccdf_cis_cis_rule_4_7","stig_id":"4.7","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-002323","CCI-000364","CCI-000366","CCI-000381","CCI-001199","CCI-000540","CCI-002472"],"nist":["AC-18 a","CM-6 a","CM-6 b","CM-7 a","SC-28","CP-9 (d)","SC-28"]},"code":"control '4_7' do\n  title 'Ensure a notification is configured for user changes'\n\n  desc <<~DESC\n    It is recommended to setup an Event Rule and Notification that gets triggered when IAM\n    Users are created, updated, deleted, capabilities updated, or state updated. Event Rules\n    are compartment scoped and will detect events in child compartments, it is recommended to\n    create the Event rule at the root compartment level. Users use or manage Oracle Cloud\n    Infrastructure resources. Monitoring and alerting on changes to Users will help in\n    identifying changes to the security posture.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Using the search box to navigate to events Navigate to the rules page Select\n\n    the Compartment that hosts the rules Find and click the Rule that handles IAM User Changes\n    Click the Edit Rule button and verify that the Rule Conditions section contains a\n    condition for the Service Identity and Event Types: User  Create , User  Delete , User \n    Update , User Capabilities  Update , User State  Update Verify that in the Actions\n    section the Action Type contains: Notifications and that a valid Topic is referenced. From\n    CLI: Find the OCID of the specific Event Rule based on Display Name and Compartment OCID\n    oci events rule list --compartment-id <compartment-ocid> --query \"data\n    [?\\\"display-name\\\"=='<display-name>']\".{\"id:id\"} --output table List the details of a\n    specific Event Rule based on the OCID of the rule. oci events rule get --rule-id <rule-id>\n    In the JSON output locate the Conditions key value pair and verify that the following\n    Conditions are present: com.oraclecloud.identitycontrolplane.createuser\n    com.oraclecloud.identitycontrolplane.deleteuser\n    com.oraclecloud.identitycontrolplane.updateuser\n    com.oraclecloud.identitycontrolplane.updateusercapabilities\n    com.oraclecloud.identitycontrolplane.updateuserstate Verify the value of the is-enabled\n    attribute is true In the JSON output verify that actionType is ONS and locate the topic-id\n    Verify the correct topic is used by checking the topic name oci ons topic get --topic-id\n    <topic-id> --query data.{\"name:name\"} --output table\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Using the search box to navigate to events Navigate to the rules page Select\n\n    the compartment that should host the rule Click Create Rule Provide a Display Name and\n    Description Create a Rule Condition by selecting Identity in the Service Name Drop-down\n    and selecting: User  Create , User  Delete , User  Update , User Capabilities  Update\n    , User State  Update In the Actions section select Notifications as Action Type Select\n    the Compartment that hosts the Topic to be used. Select the Topic to be used Optionally\n    add Tags to the Rule Click Create Rule From CLI: Find the topic-id of the topic the Event\n    Rule should use for sending Notifications by using the topic name and Compartment OCID oci\n    ons topic list --compartment-id <compartment-ocid> --all --query \"data\n    [?name=='<topic-name>']\".{\"name:name,topic_id:\\\"topic-id\\\"\"} --output table Create a JSON\n    file to be used when creating the Event Rule. Replace topic id, display name, description\n    and compartment OCID. { \"actions\": { \"actions\": [ { \"actionType\": \"ONS\", \"isEnabled\":\n\n    true, \"topicId\": \"<topic-id>\" }] }, \"condition\":\n\n    \"{\\\"eventType\\\":[\\\"com.oraclecloud.identitycontrolplane.createuser\\\",\\\"com.oraclecloud.identitycontrolplane.deleteuser\\\",\\\"com.oraclecloud.identitycontrolplane.updateuser\\\",\\\"com.oraclecloud.identitycontrolplane.updateusercapabilities\\\",\\\"com.oraclecloud.identitycontrolplane.updateuserstate\\\"],\\\"data\\\":{}}\",\n    \"displayName\": \"<display-name>\", \"description\": \"<description>\", \"isEnabled\": true,\n    \"compartmentId\": \"<compartment-ocid>\" } Create the actual event rule oci events rule\n    create --from-json file://event_rule.json Note in the JSON returned that it lists the\n    parameters specified in the JSON file provided and that there is an OCID provided for the\n    Event Rule\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    \"There is no performance\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-4_7'\n  tag severity: 'medium'\n  tag gid: 'CIS-4_7'\n  tag rid: 'xccdf_cis_cis_rule_4_7'\n  tag stig_id: '4.7'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-002323',\n    'CCI-000364',\n    'CCI-000366',\n    'CCI-000381',\n    'CCI-001199',\n    'CCI-000540',\n    'CCI-002472'\n  ]\n\n  tag nist: [\n    'AC-18 a',\n    'CM-6 a',\n    'CM-6 b',\n    'CM-7 a',\n    'SC-28',\n    'CP-9 (d)',\n    'SC-28'\n  ]\n\n  required_rule_conditions = [\n    'com.oraclecloud.identitycontrolplane.createuser',\n    'com.oraclecloud.identitycontrolplane.deleteuser',\n    'com.oraclecloud.identitycontrolplane.updateuser',\n    'com.oraclecloud.identitycontrolplane.updateusercapabilities',\n    'com.oraclecloud.identitycontrolplane.updateuserstate'\n  ]\n\n  tenancy_ocid = input('tenancy_ocid')\n  user_notification_topic = input('user_notification_topic')\n\n  regions = json(command: 'oci iam region-subscription list --all').params.fetch('data', []).map { |region| region['region-name'] }.compact\n\n  findings = regions.each_with_object([]) do |region, missing|\n    rules = json(command: %(oci events rule list --compartment-id \"#{tenancy_ocid}\" --region \"#{region}\" --all 2>/dev/null)).params.fetch('data', [])\n\n    rule_present = rules.any? do |rule|\n      rule_details = json(command: %(oci events rule get --rule-id \"#{rule['id']}\" --region \"#{region}\" 2>/dev/null)).params.fetch('data', {})\n\n      next false unless rule_details['is-enabled']\n\n      condition_data = begin\n        json(content: rule_details['condition'].to_s).params\n      rescue StandardError\n        {}\n      end\n\n      event_types = condition_data['eventType']\n      next false unless (required_rule_conditions - event_types).empty?\n\n      actions = rule_details.dig('actions', 'actions') || []\n      actions.any? do |action|\n        next false unless action['action-type'] == 'ONS' && action['is-enabled']\n\n        topic_id = action['topic-id']\n        next false if topic_id.to_s.strip.empty?\n\n        topic = json(command: %(oci ons topic get --topic-id \"#{topic_id}\" --region \"#{region}\" 2>/dev/null)).params.fetch('data', {})\n        topic['name'] == user_notification_topic && topic['lifecycle-state'] == 'ACTIVE'\n      end\n    end\n\n    missing << { region: region, issue: 'Missing enabled user change notification rule(s)' } unless rule_present\n  end\n\n  describe 'Ensure a notification is configured for user changes' do\n    subject { findings }\n    it { should be_empty }\n  end\nend\n","source_location":{"line":1,"ref":"./controls/4_7.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Ensure a notification is configured for user changes is expected to be empty","run_time":0.000997,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Ensure a notification is configured for user changes"}],"status":"passed"},{"id":"4_8","title":"Ensure a notification is configured for VCN changes","desc":"It is recommended to setup an Event Rule and Notification that gets triggered when Virtual\nCloud Networks are created, updated or deleted. Event Rules are compartment scoped and\nwill detect events in child compartments, it is recommended to create the Event rule at\nthe root compartment level. Virtual Cloud Networks (VCNs) closely resembles a traditional\nnetwork. Monitoring and alerting on changes to VCNs will help in identifying changes to\nthe security posture.","descriptions":[{"label":"default","data":"It is recommended to setup an Event Rule and Notification that gets triggered when Virtual\nCloud Networks are created, updated or deleted. Event Rules are compartment scoped and\nwill detect events in child compartments, it is recommended to create the Event rule at\nthe root compartment level. Virtual Cloud Networks (VCNs) closely resembles a traditional\nnetwork. Monitoring and alerting on changes to VCNs will help in identifying changes to\nthe security posture."},{"label":"check","data":"From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\nthe Compartment that hosts the rules Find and click the Rule that handles VCN Changes (if\nany) Click the Edit Rule button and verify that the RuleConditions section contains a\ncondition for the Service Networking and Event Types: VCN  Create , VCN - Delete and VCN\n Update Verify that in the Actions section the Action Type contains: Notifications and\nthat a valid Topic is referenced. From CLI: Find the OCID of the specific Event Rule based\non Display Name and Compartment OCID oci events rule list --compartment-id\n<compartment-ocid> --query \"data [?\"display-name\"=='<display-name>']\".{\"id:id\"} --output\ntable List the details of a specific Event Rule based on the OCID of the rule. oci events\nrule get --rule-id <rule-id> In the JSON output locate the Conditions key value pair and\nverify that the following Conditions are present: com.oraclecloud.virtualnetwork.createvcn\ncom.oraclecloud.virtualnetwork.deletevcn com.oraclecloud.virtualnetwork.updatevcn Verify\nthe value of the is-enabled attribute is true In the JSON output verify that actionType is\nONS and locate the topic-id Verify the correct topic is used by checking the topic name\noci ons topic get --topic-id <topic-id> --query data.{\"name:name\"} --output table"},{"label":"fix","data":"From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\nthe compartment that should host the rule Click Create Rule Provide a Display Name and\nDescription Create a Rule Condition by selecting Networking in the Service Name Drop-down\nand selecting VCN  Create , VCN - Delete and VCN  Update In the Actions section select\nNotifications as Action Type Select the Compartment that hosts the Topic to be used.\nSelect the Topic to be used Optionally add Tags to the Rule Click Create Rule From CLI:\n\nFind the topic-id of the topic the Event Rule should use for sending Notifications by\nusing the topic name and Compartment OCID oci ons topic list --compartment-id\n<compartment-ocid> --all --query \"data\n[?name=='<topic-name>']\".{\"name:name,topic_id:\"topic-id\"\"} --output table Create a JSON\nfile to be used when creating the Event Rule. Replace topic id, display name, description\nand compartment OCID. { \"actions\": { \"actions\": [ { \"actionType\": \"ONS\", \"isEnabled\":\n\ntrue, \"topicId\": \"<topic-id>\" }] }, \"condition\":\n\n\"{\"eventType\":[\"com.oraclecloud.virtualnetwork.createvcn\",\"com.oraclecloud.virtualnetwork.deletevcn\",\"com.oraclecloud.virtualnetwork.updatevcn\"],\"data\":{}}\",\n\"displayName\": \"<display-name>\", \"description\": \"<description>\", \"isEnabled\": true,\n\"compartmentId\": \"<compartment-ocid>\" } Create the actual event rule oci events rule\ncreate --from-json file://event_rule.json Note in the JSON returned that it lists the\nparameters specified in the JSON file provided and that there is an OCID provided for the\nEvent Rule"},{"label":"potential_impacts","data":"\"There is no performance"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-4_8","severity":"medium","gid":"CIS-4_8","rid":"xccdf_cis_cis_rule_4_8","stig_id":"4.8","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-002323","CCI-000364","CCI-000366","CCI-000381","CCI-001199","CCI-000540","CCI-002472"],"nist":["AC-18 a","CM-6 a","CM-6 b","CM-7 a","SC-28","CP-9 (d)","SC-28"]},"code":"control '4_8' do\n  title 'Ensure a notification is configured for VCN changes'\n\n  desc <<~DESC\n    It is recommended to setup an Event Rule and Notification that gets triggered when Virtual\n    Cloud Networks are created, updated or deleted. Event Rules are compartment scoped and\n    will detect events in child compartments, it is recommended to create the Event rule at\n    the root compartment level. Virtual Cloud Networks (VCNs) closely resembles a traditional\n    network. Monitoring and alerting on changes to VCNs will help in identifying changes to\n    the security posture.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\n    the Compartment that hosts the rules Find and click the Rule that handles VCN Changes (if\n    any) Click the Edit Rule button and verify that the RuleConditions section contains a\n    condition for the Service Networking and Event Types: VCN  Create , VCN - Delete and VCN\n     Update Verify that in the Actions section the Action Type contains: Notifications and\n    that a valid Topic is referenced. From CLI: Find the OCID of the specific Event Rule based\n    on Display Name and Compartment OCID oci events rule list --compartment-id\n    <compartment-ocid> --query \"data [?\\\"display-name\\\"=='<display-name>']\".{\"id:id\"} --output\n    table List the details of a specific Event Rule based on the OCID of the rule. oci events\n    rule get --rule-id <rule-id> In the JSON output locate the Conditions key value pair and\n    verify that the following Conditions are present: com.oraclecloud.virtualnetwork.createvcn\n    com.oraclecloud.virtualnetwork.deletevcn com.oraclecloud.virtualnetwork.updatevcn Verify\n    the value of the is-enabled attribute is true In the JSON output verify that actionType is\n    ONS and locate the topic-id Verify the correct topic is used by checking the topic name\n    oci ons topic get --topic-id <topic-id> --query data.{\"name:name\"} --output table\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\n    the compartment that should host the rule Click Create Rule Provide a Display Name and\n    Description Create a Rule Condition by selecting Networking in the Service Name Drop-down\n    and selecting VCN  Create , VCN - Delete and VCN  Update In the Actions section select\n    Notifications as Action Type Select the Compartment that hosts the Topic to be used.\n    Select the Topic to be used Optionally add Tags to the Rule Click Create Rule From CLI:\n\n    Find the topic-id of the topic the Event Rule should use for sending Notifications by\n    using the topic name and Compartment OCID oci ons topic list --compartment-id\n    <compartment-ocid> --all --query \"data\n    [?name=='<topic-name>']\".{\"name:name,topic_id:\\\"topic-id\\\"\"} --output table Create a JSON\n    file to be used when creating the Event Rule. Replace topic id, display name, description\n    and compartment OCID. { \"actions\": { \"actions\": [ { \"actionType\": \"ONS\", \"isEnabled\":\n\n    true, \"topicId\": \"<topic-id>\" }] }, \"condition\":\n\n    \"{\\\"eventType\\\":[\\\"com.oraclecloud.virtualnetwork.createvcn\\\",\\\"com.oraclecloud.virtualnetwork.deletevcn\\\",\\\"com.oraclecloud.virtualnetwork.updatevcn\\\"],\\\"data\\\":{}}\",\n    \"displayName\": \"<display-name>\", \"description\": \"<description>\", \"isEnabled\": true,\n    \"compartmentId\": \"<compartment-ocid>\" } Create the actual event rule oci events rule\n    create --from-json file://event_rule.json Note in the JSON returned that it lists the\n    parameters specified in the JSON file provided and that there is an OCID provided for the\n    Event Rule\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    \"There is no performance\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-4_8'\n  tag severity: 'medium'\n  tag gid: 'CIS-4_8'\n  tag rid: 'xccdf_cis_cis_rule_4_8'\n  tag stig_id: '4.8'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-002323',\n    'CCI-000364',\n    'CCI-000366',\n    'CCI-000381',\n    'CCI-001199',\n    'CCI-000540',\n    'CCI-002472'\n  ]\n\n  tag nist: [\n    'AC-18 a',\n    'CM-6 a',\n    'CM-6 b',\n    'CM-7 a',\n    'SC-28',\n    'CP-9 (d)',\n    'SC-28'\n  ]\n\n  required_rule_conditions = [\n    'com.oraclecloud.virtualnetwork.createvcn',\n    'com.oraclecloud.virtualnetwork.deletevcn',\n    'com.oraclecloud.virtualnetwork.updatevcn'\n  ]\n\n  tenancy_ocid = input('tenancy_ocid')\n  vcn_list_notification_topic = input('vcn_list_notification_topic')\n\n  regions = json(command: 'oci iam region-subscription list --all').params.fetch('data', []).map { |region| region['region-name'] }.compact\n\n  findings = regions.each_with_object([]) do |region, missing|\n    rules = json(command: %(oci events rule list --compartment-id \"#{tenancy_ocid}\" --region \"#{region}\" --all 2>/dev/null)).params.fetch('data', [])\n\n    rule_present = rules.any? do |rule|\n      rule_details = json(command: %(oci events rule get --rule-id \"#{rule['id']}\" --region \"#{region}\" 2>/dev/null)).params.fetch('data', {})\n\n      next false unless rule_details['is-enabled']\n\n      condition_data = begin\n        json(content: rule_details['condition'].to_s).params\n      rescue StandardError\n        {}\n      end\n\n      event_types = condition_data['eventType']\n      next false unless (required_rule_conditions - event_types).empty?\n\n      actions = rule_details.dig('actions', 'actions') || []\n      actions.any? do |action|\n        next false unless action['action-type'] == 'ONS' && action['is-enabled']\n\n        topic_id = action['topic-id']\n        next false if topic_id.to_s.strip.empty?\n\n        topic = json(command: %(oci ons topic get --topic-id \"#{topic_id}\" --region \"#{region}\" 2>/dev/null)).params.fetch('data', {})\n        topic['name'] == vcn_list_notification_topic && topic['lifecycle-state'] == 'ACTIVE'\n      end\n    end\n\n    missing << { region: region, issue: 'Missing enabled VCN change notification rule(s)' } unless rule_present\n  end\n\n  describe 'Ensure a notification is configured for VCN changes' do\n    subject { findings }\n    it { should be_empty }\n  end\nend\n","source_location":{"line":1,"ref":"./controls/4_8.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Ensure a notification is configured for VCN changes is expected to be empty","run_time":0.000996,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Ensure a notification is configured for VCN changes"}],"status":"passed"},{"id":"4_9","title":"Ensure a notification is configured for changes to route tables","desc":"It is recommended to setup an Event Rule and Notification that gets triggered when route\ntables are created, updated or deleted. Event Rules are compartment scoped and will detect\nevents in child compartments, it is recommended to create the Event rule at the root\ncompartment level. Route tables control traffic flowing to or from Virtual Cloud Networks\nand Subnets. Monitoring and alerting on changes to route tables will help in identifying\nchanges these traffic flows.","descriptions":[{"label":"default","data":"It is recommended to setup an Event Rule and Notification that gets triggered when route\ntables are created, updated or deleted. Event Rules are compartment scoped and will detect\nevents in child compartments, it is recommended to create the Event rule at the root\ncompartment level. Route tables control traffic flowing to or from Virtual Cloud Networks\nand Subnets. Monitoring and alerting on changes to route tables will help in identifying\nchanges these traffic flows."},{"label":"check","data":"From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\nthe Compartment that hosts the rules Find and click the Rule that handles Route Table\nChanges (if any) Click the Edit Rule button and verify that the RuleConditions section\ncontains a condition for the Service Networking and Event Types: Route Table  Change\nCompartment , Route Table  Create , Route Table - Delete and Route Table - Update Verify\nthat in the Actions section the Action Type contains: Notifications and that a valid Topic\nis referenced. From CLI: Find the OCID of the specific Event Rule based on Display Name\nand Compartment OCID oci events rule list --compartment-id <compartment-ocid> --query\n\"data [?\"display-name\"=='<display-name>']\".{\"id:id\"} --output table List the details of\na specific Event Rule based on the OCID of the rule. oci events rule get --rule-id\n<rule-id> In the JSON output locate the Conditions key value pair and verify that the\nfollowing Conditions are present:\n\ncom.oraclecloud.virtualnetwork.changeroutetablecompartment\ncom.oraclecloud.virtualnetwork.createroutetable\ncom.oraclecloud.virtualnetwork.deleteroutetable\ncom.oraclecloud.virtualnetwork.updateroutetable Verify the value of the is-enabled\nattribute is true In the JSON output verify that actionType is ONS and locate the topic-id\nVerify the correct topic is used by checking the topic name oci ons topic get --topic-id\n<topic-id> --query data.{\"name:name\"} --output table"},{"label":"fix","data":"From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\nthe compartment that should host the rule Click Create Rule Provide a Display Name and\nDescription Create a Rule Condition by selecting Networking in the Service Name Drop-down\nand selecting Route Table  Change Compartment , Route Table  Create , Route Table -\nDelete and Route Table  Update In the Actions section select Notifications as Action Type\nSelect the Compartment that hosts the Topic to be used. Select the Topic to be used\nOptionally add Tags to the Rule Click Create Rule From CLI: Find the topic-id of the topic\nthe Event Rule should use for sending Notifications by using the topic name and\nCompartment OCID oci ons topic list --compartment-id <compartment-ocid> --all --query\n\"data [?name=='<topic-name>']\".{\"name:name,topic_id:\"topic-id\"\"} --output table Create a\nJSON file to be used when creating the Event Rule. Replace topic id, display name,\ndescription and compartment OCID. { \"actions\": { \"actions\": [ { \"actionType\": \"ONS\",\n\"isEnabled\": true, \"topicId\": \"<topic-id>\" }] }, \"condition\":\n\n\"{\"eventType\":[\"com.oraclecloud.virtualnetwork.changeroutetablecompartment\",\"com.oraclecloud.virtualnetwork.createroutetable\",\"com.oraclecloud.virtualnetwork.deleteroutetable\",\"com.oraclecloud.virtualnetwork.updateroutetable\"],\"data\":{}}\",\n\"displayName\": \"<display-name>\", \"description\": \"<description>\", \"isEnabled\": true,\n\"compartmentId\": \"<compartment-ocid>\" } Create the actual event rule oci events rule\ncreate --from-json file://event_rule.json Note in the JSON returned that it lists the\nparameters specified in the JSON file provided and that there is an OCID provided for the\nEvent Rule"},{"label":"potential_impacts","data":"\"There is no performance"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-4_9","severity":"medium","gid":"CIS-4_9","rid":"xccdf_cis_cis_rule_4_9","stig_id":"4.9","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-002323","CCI-000364","CCI-000366","CCI-000381","CCI-001199","CCI-000540","CCI-002472"],"nist":["AC-18 a","CM-6 a","CM-6 b","CM-7 a","SC-28","CP-9 (d)","SC-28"]},"code":"control '4_9' do\n  title 'Ensure a notification is configured for changes to route tables'\n\n  desc <<~DESC\n    It is recommended to setup an Event Rule and Notification that gets triggered when route\n    tables are created, updated or deleted. Event Rules are compartment scoped and will detect\n    events in child compartments, it is recommended to create the Event rule at the root\n    compartment level. Route tables control traffic flowing to or from Virtual Cloud Networks\n    and Subnets. Monitoring and alerting on changes to route tables will help in identifying\n    changes these traffic flows.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\n    the Compartment that hosts the rules Find and click the Rule that handles Route Table\n    Changes (if any) Click the Edit Rule button and verify that the RuleConditions section\n    contains a condition for the Service Networking and Event Types: Route Table  Change\n    Compartment , Route Table  Create , Route Table - Delete and Route Table - Update Verify\n    that in the Actions section the Action Type contains: Notifications and that a valid Topic\n    is referenced. From CLI: Find the OCID of the specific Event Rule based on Display Name\n    and Compartment OCID oci events rule list --compartment-id <compartment-ocid> --query\n    \"data [?\\\"display-name\\\"=='<display-name>']\".{\"id:id\"} --output table List the details of\n    a specific Event Rule based on the OCID of the rule. oci events rule get --rule-id\n    <rule-id> In the JSON output locate the Conditions key value pair and verify that the\n    following Conditions are present:\n\n    com.oraclecloud.virtualnetwork.changeroutetablecompartment\n    com.oraclecloud.virtualnetwork.createroutetable\n    com.oraclecloud.virtualnetwork.deleteroutetable\n    com.oraclecloud.virtualnetwork.updateroutetable Verify the value of the is-enabled\n    attribute is true In the JSON output verify that actionType is ONS and locate the topic-id\n    Verify the correct topic is used by checking the topic name oci ons topic get --topic-id\n    <topic-id> --query data.{\"name:name\"} --output table\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Go to the Events Service page: https://cloud.oracle.com/events/rules Select\n\n    the compartment that should host the rule Click Create Rule Provide a Display Name and\n    Description Create a Rule Condition by selecting Networking in the Service Name Drop-down\n    and selecting Route Table  Change Compartment , Route Table  Create , Route Table -\n    Delete and Route Table  Update In the Actions section select Notifications as Action Type\n    Select the Compartment that hosts the Topic to be used. Select the Topic to be used\n    Optionally add Tags to the Rule Click Create Rule From CLI: Find the topic-id of the topic\n    the Event Rule should use for sending Notifications by using the topic name and\n    Compartment OCID oci ons topic list --compartment-id <compartment-ocid> --all --query\n    \"data [?name=='<topic-name>']\".{\"name:name,topic_id:\\\"topic-id\\\"\"} --output table Create a\n    JSON file to be used when creating the Event Rule. Replace topic id, display name,\n    description and compartment OCID. { \"actions\": { \"actions\": [ { \"actionType\": \"ONS\",\n    \"isEnabled\": true, \"topicId\": \"<topic-id>\" }] }, \"condition\":\n\n    \"{\\\"eventType\\\":[\\\"com.oraclecloud.virtualnetwork.changeroutetablecompartment\\\",\\\"com.oraclecloud.virtualnetwork.createroutetable\\\",\\\"com.oraclecloud.virtualnetwork.deleteroutetable\\\",\\\"com.oraclecloud.virtualnetwork.updateroutetable\\\"],\\\"data\\\":{}}\",\n    \"displayName\": \"<display-name>\", \"description\": \"<description>\", \"isEnabled\": true,\n    \"compartmentId\": \"<compartment-ocid>\" } Create the actual event rule oci events rule\n    create --from-json file://event_rule.json Note in the JSON returned that it lists the\n    parameters specified in the JSON file provided and that there is an OCID provided for the\n    Event Rule\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    \"There is no performance\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-4_9'\n  tag severity: 'medium'\n  tag gid: 'CIS-4_9'\n  tag rid: 'xccdf_cis_cis_rule_4_9'\n  tag stig_id: '4.9'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-002323',\n    'CCI-000364',\n    'CCI-000366',\n    'CCI-000381',\n    'CCI-001199',\n    'CCI-000540',\n    'CCI-002472'\n  ]\n\n  tag nist: [\n    'AC-18 a',\n    'CM-6 a',\n    'CM-6 b',\n    'CM-7 a',\n    'SC-28',\n    'CP-9 (d)',\n    'SC-28'\n  ]\n\n  required_rule_conditions = [\n    'com.oraclecloud.virtualnetwork.changeroutetablecompartment',\n    'com.oraclecloud.virtualnetwork.createroutetable',\n    'com.oraclecloud.virtualnetwork.deleteroutetable',\n    'com.oraclecloud.virtualnetwork.updateroutetable'\n  ]\n\n  tenancy_ocid = input('tenancy_ocid')\n  route_table_notification_topic = input('route_table_notification_topic')\n\n  regions = json(command: 'oci iam region-subscription list --all').params.fetch('data', []).map { |region| region['region-name'] }.compact\n\n  findings = regions.each_with_object([]) do |region, missing|\n    rules = json(command: %(oci events rule list --compartment-id \"#{tenancy_ocid}\" --region \"#{region}\" --all 2>/dev/null)).params.fetch('data', [])\n\n    rule_present = rules.any? do |rule|\n      rule_details = json(command: %(oci events rule get --rule-id \"#{rule['id']}\" --region \"#{region}\" 2>/dev/null)).params.fetch('data', {})\n\n      next false unless rule_details['is-enabled']\n\n      condition_data = begin\n        json(content: rule_details['condition'].to_s).params\n      rescue StandardError\n        {}\n      end\n\n      event_types = condition_data['eventType']\n      next false unless (required_rule_conditions - event_types).empty?\n\n      actions = rule_details.dig('actions', 'actions') || []\n      actions.any? do |action|\n        next false unless action['action-type'] == 'ONS' && action['is-enabled']\n\n        topic_id = action['topic-id']\n        next false if topic_id.to_s.strip.empty?\n\n        topic = json(command: %(oci ons topic get --topic-id \"#{topic_id}\" --region \"#{region}\" 2>/dev/null)).params.fetch('data', {})\n        topic['name'] == route_table_notification_topic && topic['lifecycle-state'] == 'ACTIVE'\n      end\n    end\n\n    missing << { region: region, issue: 'Missing enabled route table change notification rule(s)' } unless rule_present\n  end\n\n  describe 'Ensure a notification is configured for changes to route tables' do\n    subject { findings }\n    it { should be_empty }\n  end\nend\n","source_location":{"line":1,"ref":"./controls/4_9.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Ensure a notification is configured for changes to route tables is expected to be empty","run_time":0.000972,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Ensure a notification is configured for changes to route tables"}],"status":"passed"},{"id":"5_1_1","title":"Ensure no Object Storage buckets are publicly visible.","desc":"A bucket is a logical container for storing objects. It is associated with a single\ncompartment that has policies that determine what action a user can perform on a bucket\nand on all the objects in the bucket. By Default a newly created bucket is private. It is\nrecommended that no bucket be publicly accessible. Removing unfettered reading of objects\nin a bucket reduces an organization's exposure to data loss.","descriptions":[{"label":"default","data":"A bucket is a logical container for storing objects. It is associated with a single\ncompartment that has policies that determine what action a user can perform on a bucket\nand on all the objects in the bucket. By Default a newly created bucket is private. It is\nrecommended that no bucket be publicly accessible. Removing unfettered reading of objects\nin a bucket reduces an organization's exposure to data loss."},{"label":"check","data":"From Console: Login into the OCI Console Click in the search bar at the top of the screen.\n\nType Advanced Resource Query and click enter . Click the Advanced Resource Query button in\nthe upper right of the screen. Enter the following query in the query box: query bucket\nresources where (publicAccessType == 'ObjectRead') || (publicAccessType ==\n'ObjectReadWithoutList') Ensure query returns no results From CLI: Execute the following\ncommand: oci search resource structured-search --query-text \"query bucket resources where\n(publicAccessType == 'ObjectRead') || (publicAccessType == 'ObjectReadWithoutList')\"\nEnsure query returns no results Cloud Guard To Enable Cloud Guard Auditing: Ensure Cloud\nGuard is enabled in the root compartment of the tenancy. For more information about\nenabling Cloud Guard, please look at the instructions included in Recommendation 3.15.\n\nFrom Console: Type Cloud Guard into the Search box at the top of the Console. Click Cloud\n\nGuard from the Services submenu. Click Detector Recipes in the Cloud Guard menu. Click\nOCI Configuration Detector Recipe (Oracle Managed) under the Recipe Name column. Find\nBucket is public in the Detector Rules column. Verify that the Bucket is public Detector\nRule is Enabled. From CLI: Verify the Bucket is public Detector Rule in Cloud Guard is\nenabled to generate Problems if Object Storage Buckets are configured to be accessible\nover the public Internet with the following command: oci cloud-guard\ndetector-recipe-detector-rule get --detector-recipe-id <insert detector recipe ocid>\n--detector-rule-id BUCKET_IS_PUBLIC"},{"label":"fix","data":"From Console: Follow the audit procedure above. For each bucket in the returned results,\n\nclick the Bucket Display Name Click Edit Visibility Select Private Click Save Changes From\nCLI: Follow the audit procedure For each of the buckets identified, execute the following\ncommand: oci os bucket update --bucket-name <bucket-name> --public-access-type\nNoPublicAccess"},{"label":"potential_impacts","data":"For updating an existing bucket, care should be taken to ensure objects in the bucket can\nbe accessed through either IAM policies or pre-authenticated requests."}],"impact":0.5,"refs":[],"tags":{"check_id":"C-5_1_1","severity":"medium","gid":"CIS-5_1_1","rid":"xccdf_cis_cis_rule_5_1_1","stig_id":"5.1.1","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-000213","CCI-000225","CCI-000036","CCI-001003","CCI-000051","CCI-002856","CCI-003205"],"nist":["AC-3","AC-6","AC-5 a","MP-2","AC-8 a","CP-12","SA-12 (8)"]},"code":"control '5_1_1' do\n  title 'Ensure no Object Storage buckets are publicly visible.'\n\n  desc <<~DESC\n    A bucket is a logical container for storing objects. It is associated with a single\n    compartment that has policies that determine what action a user can perform on a bucket\n    and on all the objects in the bucket. By Default a newly created bucket is private. It is\n    recommended that no bucket be publicly accessible. Removing unfettered reading of objects\n    in a bucket reduces an organization's exposure to data loss.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Login into the OCI Console Click in the search bar at the top of the screen.\n\n    Type Advanced Resource Query and click enter . Click the Advanced Resource Query button in\n    the upper right of the screen. Enter the following query in the query box: query bucket\n    resources where (publicAccessType == 'ObjectRead') || (publicAccessType ==\n    'ObjectReadWithoutList') Ensure query returns no results From CLI: Execute the following\n    command: oci search resource structured-search --query-text \"query bucket resources where\n    (publicAccessType == 'ObjectRead') || (publicAccessType == 'ObjectReadWithoutList')\"\n    Ensure query returns no results Cloud Guard To Enable Cloud Guard Auditing: Ensure Cloud\n    Guard is enabled in the root compartment of the tenancy. For more information about\n    enabling Cloud Guard, please look at the instructions included in Recommendation 3.15.\n\n    From Console: Type Cloud Guard into the Search box at the top of the Console. Click Cloud\n\n    Guard from the Services submenu. Click Detector Recipes in the Cloud Guard menu. Click\n    OCI Configuration Detector Recipe (Oracle Managed) under the Recipe Name column. Find\n    Bucket is public in the Detector Rules column. Verify that the Bucket is public Detector\n    Rule is Enabled. From CLI: Verify the Bucket is public Detector Rule in Cloud Guard is\n    enabled to generate Problems if Object Storage Buckets are configured to be accessible\n    over the public Internet with the following command: oci cloud-guard\n    detector-recipe-detector-rule get --detector-recipe-id <insert detector recipe ocid>\n    --detector-rule-id BUCKET_IS_PUBLIC\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Follow the audit procedure above. For each bucket in the returned results,\n\n    click the Bucket Display Name Click Edit Visibility Select Private Click Save Changes From\n    CLI: Follow the audit procedure For each of the buckets identified, execute the following\n    command: oci os bucket update --bucket-name <bucket-name> --public-access-type\n    NoPublicAccess\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    For updating an existing bucket, care should be taken to ensure objects in the bucket can\n    be accessed through either IAM policies or pre-authenticated requests.\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-5_1_1'\n  tag severity: 'medium'\n  tag gid: 'CIS-5_1_1'\n  tag rid: 'xccdf_cis_cis_rule_5_1_1'\n  tag stig_id: '5.1.1'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-000213',\n    'CCI-000225',\n    'CCI-000036',\n    'CCI-001003',\n    'CCI-000051',\n    'CCI-002856',\n    'CCI-003205'\n  ]\n\n  tag nist: [\n    'AC-3',\n    'AC-6',\n    'AC-5 a',\n    'MP-2',\n    'AC-8 a',\n    'CP-12',\n    'SA-12 (8)'\n  ]\n\n  cmd = %q{oci search resource structured-search --query-text \"query bucket resources where (publicAccessType == 'ObjectRead') || (publicAccessType == 'ObjectReadWithoutList')\"}\n  json_output = json(command: cmd)\n  output = json_output.params.dig('data', 'items')\n\n  describe 'Ensure no Object Storage buckets are publicly visible' do\n    subject { output }\n    it { should be_empty }\n  end\n\n  cloud_guard_check = input('cloud_guard_check')\n  detector_recipe_ocid = input('detector_recipe_ocid')\n\n  if cloud_guard_check\n    tenancy_ocid = input('tenancy_ocid')\n    cloud_guard = cloud_guard_helper(tenancy_ocid: tenancy_ocid, detector_recipe_ocid: detector_recipe_ocid)\n    cloud_guard_status = cloud_guard.status\n    cloud_guard_rule_enabled = cloud_guard.detector_rule_enabled?(rule_id: 'VCN_NSG_INGRESS_RULE_PORTS_CHECK')\n  end\n\n  describe 'Cloud Guard' do\n    if cloud_guard_check\n      it 'is enabled' do\n        expect(cloud_guard_status).to cmp 'ENABLED'\n      end\n\n      it 'detector rule \"Bucket is public\" is enabled' do\n        expect(cloud_guard_rule_enabled).to cmp true\n      end\n    else\n      skip 'Cloud Guard check skipped. cloud_guard_check is set to false.'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"./controls/5_1_1.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Ensure no Object Storage buckets are publicly visible is expected to be empty","run_time":0.000978,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Ensure no Object Storage buckets are publicly visible"},{"status":"passed","code_desc":"Cloud Guard is enabled","run_time":0.000071,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Cloud Guard"},{"status":"passed","code_desc":"Cloud Guard detector rule \"Bucket is public\" is enabled","run_time":0.000049,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Cloud Guard"}],"status":"passed"},{"id":"5_1_2","title":"Ensure Object Storage Buckets are encrypted with a Customer Managed Key (CMK).","desc":"Oracle Object Storage buckets support encryption with a Customer Managed Key (CMK). By\ndefault, Object Storage buckets are encrypted with an Oracle managed key. Encryption of\nObject Storage buckets with a Customer Managed Key (CMK) provides an additional level of\nsecurity on your data by allowing you to manage your own encryption key lifecycle\nmanagement for the bucket.","descriptions":[{"label":"default","data":"Oracle Object Storage buckets support encryption with a Customer Managed Key (CMK). By\ndefault, Object Storage buckets are encrypted with an Oracle managed key. Encryption of\nObject Storage buckets with a Customer Managed Key (CMK) provides an additional level of\nsecurity on your data by allowing you to manage your own encryption key lifecycle\nmanagement for the bucket."},{"label":"check","data":"From Console: Go to https://cloud.oracle.com/object-storage/buckets Click on an individual\n\nbucket under the Name heading. Ensure that the Encryption Key is not set to Oracle managed\nkey . Repeat for each compartment From CLI: Execute the following command oci os bucket\nget --bucket-name <bucket-name> Ensure kms-key-id is not null Cloud Guard To Enable Cloud\nGuard Auditing: Ensure Cloud Guard is enabled in the root compartment of the tenancy. For\nmore information about enabling Cloud Guard, please look at the instructions included in\nRecommendation 3.15. From Console: Type Cloud Guard into the Search box at the top of the\nConsole. Click Cloud Guard from the Services submenu. Click Detector Recipes in the\nCloud Guard menu. Click OCI Configuration Detector Recipe (Oracle Managed) under the\nRecipe Name column. Find Object Storage bucket is encrypted with Oracle-managed key in the\nDetector Rules column. Verify that the Object Storage bucket is encrypted with\nOracle-managed key Detector Rule is Enabled. From CLI: Verify the Object Storage bucket is\nencrypted with Oracle-managed key Detector Rule in Cloud Guard is enabled to generate\nProblems if Object Storage Buckets are configured without a customer managed key with the\nfollowing command: oci cloud-guard detector-recipe-detector-rule get --detector-recipe-id\n<insert detector recipe ocid> --detector-rule-id BUCKET_ENCRYPTED_WITH_ORACLE_MANAGED_KEY"},{"label":"fix","data":"From Console: Go to https://cloud.oracle.com/object-storage/buckets Click on an individual\n\nbucket under the Name heading. Click Assign next to Encryption Key: Oracle managed key .\nSelect a Vault Select a Master Encryption Key Click Assign From CLI: Execute the following\ncommand oci os bucket update --bucket-name <bucket-name> --kms-key-id\n<master-encryption-key-id>"},{"label":"potential_impacts","data":"[object Object]"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-5_1_2","severity":"medium","gid":"CIS-5_1_2","rid":"xccdf_cis_cis_rule_5_1_2","stig_id":"5.1.2","gtitle":"<GroupDescription></GroupDescription>","cci":["CCI-001199","CCI-002472","CCI-000183","CCI-000051","CCI-002856","CCI-003205"],"nist":["SC-28","SC-28","IA-5 g","AC-8 a","CP-12","SA-12 (8)"]},"code":"control '5_1_2' do\n  title 'Ensure Object Storage Buckets are encrypted with a Customer Managed Key (CMK).'\n\n  desc <<~DESC\n    Oracle Object Storage buckets support encryption with a Customer Managed Key (CMK). By\n    default, Object Storage buckets are encrypted with an Oracle managed key. Encryption of\n    Object Storage buckets with a Customer Managed Key (CMK) provides an additional level of\n    security on your data by allowing you to manage your own encryption key lifecycle\n    management for the bucket.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Go to https://cloud.oracle.com/object-storage/buckets Click on an individual\n\n    bucket under the Name heading. Ensure that the Encryption Key is not set to Oracle managed\n    key . Repeat for each compartment From CLI: Execute the following command oci os bucket\n    get --bucket-name <bucket-name> Ensure kms-key-id is not null Cloud Guard To Enable Cloud\n    Guard Auditing: Ensure Cloud Guard is enabled in the root compartment of the tenancy. For\n    more information about enabling Cloud Guard, please look at the instructions included in\n    Recommendation 3.15. From Console: Type Cloud Guard into the Search box at the top of the\n    Console. Click Cloud Guard from the Services submenu. Click Detector Recipes in the\n    Cloud Guard menu. Click OCI Configuration Detector Recipe (Oracle Managed) under the\n    Recipe Name column. Find Object Storage bucket is encrypted with Oracle-managed key in the\n    Detector Rules column. Verify that the Object Storage bucket is encrypted with\n    Oracle-managed key Detector Rule is Enabled. From CLI: Verify the Object Storage bucket is\n    encrypted with Oracle-managed key Detector Rule in Cloud Guard is enabled to generate\n    Problems if Object Storage Buckets are configured without a customer managed key with the\n    following command: oci cloud-guard detector-recipe-detector-rule get --detector-recipe-id\n    <insert detector recipe ocid> --detector-rule-id BUCKET_ENCRYPTED_WITH_ORACLE_MANAGED_KEY\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Go to https://cloud.oracle.com/object-storage/buckets Click on an individual\n\n    bucket under the Name heading. Click Assign next to Encryption Key: Oracle managed key .\n    Select a Vault Select a Master Encryption Key Click Assign From CLI: Execute the following\n    command oci os bucket update --bucket-name <bucket-name> --kms-key-id\n    <master-encryption-key-id>\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    [object Object]\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-5_1_2'\n  tag severity: 'medium'\n  tag gid: 'CIS-5_1_2'\n  tag rid: 'xccdf_cis_cis_rule_5_1_2'\n  tag stig_id: '5.1.2'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n\n  tag cci: [\n    'CCI-001199',\n    'CCI-002472',\n    'CCI-000183',\n    'CCI-000051',\n    'CCI-002856',\n    'CCI-003205'\n  ]\n\n  tag nist: [\n    'SC-28',\n    'SC-28',\n    'IA-5 g',\n    'AC-8 a',\n    'CP-12',\n    'SA-12 (8)'\n  ]\n\n  regions_response = json(command: 'oci iam region-subscription list --all')\n  regions_data = regions_response.params.fetch('data', [])\n  regions = regions_data.map { |region| region['region-name'] }.compact\n\n  compartments_response = json(command: 'oci iam compartment list --include-root --compartment-id-in-subtree TRUE 2>/dev/null')\n  compartments_data = compartments_response.params.fetch('data', [])\n  compartments = compartments_data.map { |compartment| compartment['id'] }.compact\n\n  buckets_missing_cmk = []\n\n  regions.each do |region|\n    compartments.each do |compartment_id|\n      buckets_response = json(\n        command: %(oci os bucket list --compartment-id \"#{compartment_id}\" --region \"#{region}\" 2>/dev/null)\n      )\n      buckets = buckets_response.params.fetch('data', [])\n\n      buckets.each do |bucket|\n        bucket_name = bucket['name']\n        bucket_details = json(\n          command: %(oci os bucket get --bucket-name \"#{bucket_name}\" --region \"#{region}\" 2>/dev/null)\n        )\n        kms_key_id = bucket_details.params.dig('data', 'kms-key-id')\n\n        next unless kms_key_id.to_s.strip.empty?\n\n        buckets_missing_cmk << {\n          'name' => bucket_name,\n          'region' => region\n        }\n      end\n    end\n  end\n\n  describe 'Ensure Object Storage Buckets are encrypted with a Customer Managed Key (CMK)' do\n    subject { buckets_missing_cmk }\n    it { should be_empty }\n  end\n\n  cloud_guard_check = input('cloud_guard_check')\n  detector_recipe_ocid = input('detector_recipe_ocid')\n\n  if cloud_guard_check\n    tenancy_ocid = input('tenancy_ocid')\n    cloud_guard = cloud_guard_helper(tenancy_ocid: tenancy_ocid, detector_recipe_ocid: detector_recipe_ocid)\n    cloud_guard_status = cloud_guard.status\n    cloud_guard_rule_enabled = cloud_guard.detector_rule_enabled?(rule_id: 'BUCKET_ENCRYPTED_WITH_ORACLE_MANAGED_KEY')\n  end\n\n  describe 'Cloud Guard' do\n    if cloud_guard_check\n      it 'is enabled' do\n        expect(cloud_guard_status).to cmp 'ENABLED'\n      end\n\n      it 'detector rule \"Object Storage bucket is encrypted with Oracle-managed key\" is enabled' do\n        expect(cloud_guard_rule_enabled).to cmp true\n      end\n    else\n      skip 'Cloud Guard check skipped. cloud_guard_check is set to false.'\n    end\n  end\nend\n","source_location":{"line":1,"ref":"./controls/5_1_2.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"Ensure Object Storage Buckets are encrypted with a Customer Managed Key (CMK) is expected to be empty","run_time":0.001168,"start_time":"2026-01-28T09:26:55-05:00","message":"expected `[{\"name\"=>\"bucket-20251202-1129\", \"region\"=>\"us-ashburn-1\"}, {\"name\"=>\"bucket-20251202-1132\", \"region\"=>\"us-ashburn-1\"}, {\"name\"=>\"bucket-20251211-1457\", \"region\"=>\"us-ashburn-1\"}].empty?` to be truthy, got false","resource_class":"Object","resource_params":"[]","resource_id":"Ensure Object Storage Buckets are encrypted with a Customer Managed Key (CMK)"},{"status":"passed","code_desc":"Cloud Guard is enabled","run_time":0.000057,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Cloud Guard"},{"status":"failed","code_desc":"Cloud Guard detector rule \"Object Storage bucket is encrypted with Oracle-managed key\" is enabled","run_time":0.000057,"start_time":"2026-01-28T09:26:55-05:00","message":"\nexpected: true\n     got: false\n\n(compared using `cmp` matcher)\n","resource_class":"Object","resource_params":"[]","resource_id":"Cloud Guard"}],"status":"failed"},{"id":"5_1_3","title":"Ensure Versioning is Enabled for Object Storage Buckets","desc":"A bucket is a logical container for storing objects. Object versioning is enabled at the\nbucket level and is disabled by default upon creation. Versioning directs Object Storage\nto automatically create an object version each time a new object is uploaded, an existing\nobject is overwritten, or when an object is deleted. You can enable object versioning at\nbucket creation time or later. Versioning object storage buckets provides for additional\nintegrity of your data. Management of data integrity is critical to protecting and\naccessing protected data. Some customers want to identify object storage buckets without\nversioning in order to apply their own data lifecycle protection and management policy.","descriptions":[{"label":"default","data":"A bucket is a logical container for storing objects. Object versioning is enabled at the\nbucket level and is disabled by default upon creation. Versioning directs Object Storage\nto automatically create an object version each time a new object is uploaded, an existing\nobject is overwritten, or when an object is deleted. You can enable object versioning at\nbucket creation time or later. Versioning object storage buckets provides for additional\nintegrity of your data. Management of data integrity is critical to protecting and\naccessing protected data. Some customers want to identify object storage buckets without\nversioning in order to apply their own data lifecycle protection and management policy."},{"label":"check","data":"From Console: Login to OCI Console. Select Storage from the Services menu. Select Buckets\n\nfrom under the Object Storage & Archive Storage section. Click on an individual bucket\nunder the Name heading. Ensure that the Object Versioning is set to Enabled. Repeat for\neach compartment From CLI: Execute the following command: for region in $(oci iam\nregion-subscription list --all | jq -r '.data[] | .\"region-name\"') do echo \"Enumerating\nregion $region\" for compid in $(oci iam compartment list --include-root\n--compartment-id-in-subtree TRUE 2>/dev/null | jq -r '.data[] | .id') do echo \"Enumerating\ncompartment $compid\" for bkt in $(oci os bucket list --compartment-id $compid --region\n$region 2>/dev/null | jq -r '.data[] | .name') do output=$(oci os bucket get --bucket-name\n$bkt --region $region 2>/dev/null | jq -r '.data | select(.\"versioning\" ==\n\"Disabled\").name') if [ ! -z \"$output\" ]; then echo $output; fi done done done Ensure no\nresults are returned."},{"label":"fix","data":"From Console: Follow the audit procedure above. For each bucket in the returned results,\n\nclick the Bucket Display Name Click Edit next to Object Versioning: Disabled Click Enable\nVersioning From CLI: Follow the audit procedure For each of the buckets identified,\nexecute the following command: oci os bucket update --bucket-name <bucket name>\n--versioning Enabled"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-5_1_3","severity":"medium","gid":"CIS-5_1_3","rid":"xccdf_cis_cis_rule_5_1_3","stig_id":"5.1.3","gtitle":"<GroupDescription></GroupDescription>","documentable":null},"code":"control '5_1_3' do\n  title 'Ensure Versioning is Enabled for Object Storage Buckets'\n\n  desc <<~DESC\n    A bucket is a logical container for storing objects. Object versioning is enabled at the\n    bucket level and is disabled by default upon creation. Versioning directs Object Storage\n    to automatically create an object version each time a new object is uploaded, an existing\n    object is overwritten, or when an object is deleted. You can enable object versioning at\n    bucket creation time or later. Versioning object storage buckets provides for additional\n    integrity of your data. Management of data integrity is critical to protecting and\n    accessing protected data. Some customers want to identify object storage buckets without\n    versioning in order to apply their own data lifecycle protection and management policy.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Login to OCI Console. Select Storage from the Services menu. Select Buckets\n\n    from under the Object Storage & Archive Storage section. Click on an individual bucket\n    under the Name heading. Ensure that the Object Versioning is set to Enabled. Repeat for\n    each compartment From CLI: Execute the following command: for region in $(oci iam\n    region-subscription list --all | jq -r '.data[] | .\"region-name\"') do echo \"Enumerating\n    region $region\" for compid in $(oci iam compartment list --include-root\n    --compartment-id-in-subtree TRUE 2>/dev/null | jq -r '.data[] | .id') do echo \"Enumerating\n    compartment $compid\" for bkt in $(oci os bucket list --compartment-id $compid --region\n    $region 2>/dev/null | jq -r '.data[] | .name') do output=$(oci os bucket get --bucket-name\n    $bkt --region $region 2>/dev/null | jq -r '.data | select(.\"versioning\" ==\n    \"Disabled\").name') if [ ! -z \"$output\" ]; then echo $output; fi done done done Ensure no\n    results are returned.\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Follow the audit procedure above. For each bucket in the returned results,\n\n    click the Bucket Display Name Click Edit next to Object Versioning: Disabled Click Enable\n    Versioning From CLI: Follow the audit procedure For each of the buckets identified,\n    execute the following command: oci os bucket update --bucket-name <bucket name>\n    --versioning Enabled\n  FIX\n\n  impact 0.5\n\n  tag check_id: 'C-5_1_3'\n  tag severity: 'medium'\n  tag gid: 'CIS-5_1_3'\n  tag rid: 'xccdf_cis_cis_rule_5_1_3'\n  tag stig_id: '5.1.3'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  cmd = <<~CMD\n    (\n      for region in $(oci iam region-subscription list --all | jq -r '.data[] | .\"region-name\"'); do\n        for compid in $(oci iam compartment list --include-root --compartment-id-in-subtree TRUE 2>/dev/null | jq -r '.data[] | .id'); do\n          for bkt in $(oci os bucket list --compartment-id \"$compid\" --region \"$region\" 2>/dev/null | jq -r '.data[] | .name'); do\n            oci os bucket get --bucket-name \"$bkt\" --region \"$region\" 2>/dev/null |\n              jq -r 'select(.data.versioning == \"Disabled\") | .data.name'\n          done\n        done\n      done\n    ) | jq -nR '[inputs]'\n  CMD\n\n  json_output = json(command: cmd)\n  output = json_output.params\n\n  describe 'Ensure Versioning is Enabled for Object Storage Buckets' do\n    subject { output }\n    it { should be_empty }\n  end\nend\n","source_location":{"line":1,"ref":"./controls/5_1_3.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"Ensure Versioning is Enabled for Object Storage Buckets is expected to be empty","run_time":0.001184,"start_time":"2026-01-28T09:26:55-05:00","message":"expected `[\"bucket-20251202-1129\", \"bucket-20251211-1457\"].empty?` to be truthy, got false","resource_class":"Object","resource_params":"[]","resource_id":"Ensure Versioning is Enabled for Object Storage Buckets"}],"status":"failed"},{"id":"5_2_1","title":"Ensure Block Volumes are encrypted with Customer Managed Keys (CMK).","desc":"Oracle Cloud Infrastructure Block Volume service lets you dynamically provision and manage\nblock storage volumes. By default, the Oracle service manages the keys that encrypt block\nvolumes. Block Volumes can also be encrypted using a customer managed key. Terminated\nBlock Volumes cannot be recovered and any data on a terminated volume is permanently lost.\nHowever, Block Volumes can exist in a terminated state within the OCI Portal and CLI for\nsome time after deleting. As such, any Block Volumes in this state should not be\nconsidered when assessing this policy. Encryption of block volumes provides an additional\nlevel of security for your data. Management of encryption keys is critical to protecting\nand accessing protected data. Customers should identify block volumes encrypted with\nOracle service managed keys in order to determine if they want to manage the keys for\ncertain volumes and then apply their own key lifecycle management to the selected block\nvolumes.","descriptions":[{"label":"default","data":"Oracle Cloud Infrastructure Block Volume service lets you dynamically provision and manage\nblock storage volumes. By default, the Oracle service manages the keys that encrypt block\nvolumes. Block Volumes can also be encrypted using a customer managed key. Terminated\nBlock Volumes cannot be recovered and any data on a terminated volume is permanently lost.\nHowever, Block Volumes can exist in a terminated state within the OCI Portal and CLI for\nsome time after deleting. As such, any Block Volumes in this state should not be\nconsidered when assessing this policy. Encryption of block volumes provides an additional\nlevel of security for your data. Management of encryption keys is critical to protecting\nand accessing protected data. Customers should identify block volumes encrypted with\nOracle service managed keys in order to determine if they want to manage the keys for\ncertain volumes and then apply their own key lifecycle management to the selected block\nvolumes."},{"label":"check","data":"From Console: Login to the OCI Console. Click the search bar at the top of the screen.\n\nType 'Advanced Resource Query' and press return. Click Advanced resource query. Enter the\nfollowing query in the query box: query volume resources For each block volume returned,\nclick the link under Display name. Ensure the value for Encryption Key is not\nOracle-managed key. Repeat for other subscribed regions.\n\nFrom CLI: Execute the following command:\nfor region in $(oci iam region-subscription list --all | jq -r '.data[] | .\"region-name\"'); do\n  for volid in $(oci search resource structured-search --region $region --query-text \"query volume resources\" --limit 1000 2>/dev/null | jq -r '.data.items[]?.identifier'); do\n    oci bv volume get --volume-id $volid --region $region 2>/dev/null |\n      jq -r '.data | select(.\"kms-key-id\" == null and .\"lifecycle-state\" != \"TERMINATED\") | .id'\n  done\ndone\nEnsure the query returns no results."},{"label":"fix","data":"From Console: Follow the audit procedure above. For each block volume returned, click the\n\nlink under Display name. If the value for Encryption Key is Oracle-managed key , click\nAssign next to Oracle-managed key . Select a Vault Compartment and Vault . Select a Master\nEncryption Key Compartment and Master Encryption key . Click Assign . From CLI: Follow the\naudit procedure. For each block volume identified, get the OCID. Execute the following\ncommand: oci bv volume-kms-key update --volume-id <volume OCID> --kms-key-id <kms key OCID>"},{"label":"potential_impacts","data":"[object Object]"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-5_2_1","severity":"medium","gid":"CIS-5_2_1","rid":"xccdf_cis_cis_rule_5_2_1","stig_id":"5.2.1","gtitle":"<GroupDescription></GroupDescription>","cci":["CCI-001199","CCI-002472","CCI-000183","CCI-000051","CCI-002856","CCI-003205"],"nist":["SC-28","SC-28","IA-5 g","AC-8 a","CP-12","SA-12 (8)"]},"code":"control '5_2_1' do\n  title 'Ensure Block Volumes are encrypted with Customer Managed Keys (CMK).'\n\n  desc <<~DESC\n    Oracle Cloud Infrastructure Block Volume service lets you dynamically provision and manage\n    block storage volumes. By default, the Oracle service manages the keys that encrypt block\n    volumes. Block Volumes can also be encrypted using a customer managed key. Terminated\n    Block Volumes cannot be recovered and any data on a terminated volume is permanently lost.\n    However, Block Volumes can exist in a terminated state within the OCI Portal and CLI for\n    some time after deleting. As such, any Block Volumes in this state should not be\n    considered when assessing this policy. Encryption of block volumes provides an additional\n    level of security for your data. Management of encryption keys is critical to protecting\n    and accessing protected data. Customers should identify block volumes encrypted with\n    Oracle service managed keys in order to determine if they want to manage the keys for\n    certain volumes and then apply their own key lifecycle management to the selected block\n    volumes.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Login to the OCI Console. Click the search bar at the top of the screen.\n\n    Type 'Advanced Resource Query' and press return. Click Advanced resource query. Enter the\n    following query in the query box: query volume resources For each block volume returned,\n    click the link under Display name. Ensure the value for Encryption Key is not\n    Oracle-managed key. Repeat for other subscribed regions.\n\n    From CLI: Execute the following command:\n    for region in $(oci iam region-subscription list --all | jq -r '.data[] | .\"region-name\"'); do\n      for volid in $(oci search resource structured-search --region $region --query-text \"query volume resources\" --limit 1000 2>/dev/null | jq -r '.data.items[]?.identifier'); do\n        oci bv volume get --volume-id $volid --region $region 2>/dev/null |\n          jq -r '.data | select(.\"kms-key-id\" == null and .\"lifecycle-state\" != \"TERMINATED\") | .id'\n      done\n    done\n    Ensure the query returns no results.\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Follow the audit procedure above. For each block volume returned, click the\n\n    link under Display name. If the value for Encryption Key is Oracle-managed key , click\n    Assign next to Oracle-managed key . Select a Vault Compartment and Vault . Select a Master\n    Encryption Key Compartment and Master Encryption key . Click Assign . From CLI: Follow the\n    audit procedure. For each block volume identified, get the OCID. Execute the following\n    command: oci bv volume-kms-key update --volume-id <volume OCID> --kms-key-id <kms key OCID>\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    [object Object]\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-5_2_1'\n  tag severity: 'medium'\n  tag gid: 'CIS-5_2_1'\n  tag rid: 'xccdf_cis_cis_rule_5_2_1'\n  tag stig_id: '5.2.1'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n\n  tag cci: [\n    'CCI-001199',\n    'CCI-002472',\n    'CCI-000183',\n    'CCI-000051',\n    'CCI-002856',\n    'CCI-003205'\n  ]\n\n  tag nist: [\n    'SC-28',\n    'SC-28',\n    'IA-5 g',\n    'AC-8 a',\n    'CP-12',\n    'SA-12 (8)'\n  ]\n\n  # regions_response = json(command: 'oci iam region-subscription list --all')\n  # regions_data = regions_response.params.fetch('data', [])\n  # regions = regions_data.map { |region| region['region-name'] }.compact\n\n  # volumes_missing_cmk = []\n\n  # regions.each do |region|\n  #   search_cmd = %(oci search resource structured-search --region \"#{region}\" --query-text \"query volume resources\" --limit 1000 2>/dev/null)\n  #   search_response = json(command: search_cmd)\n  #   volume_ids = search_response.params.fetch('data', {}).fetch('items', []).map { |item| item['identifier'] }.compact\n\n  #   volume_ids.each do |volume_id|\n  #     volume_details = json(command: %(oci bv volume get --volume-id \"#{volume_id}\" --region \"#{region}\" 2>/dev/null))\n  #     volume_data = volume_details.params.fetch('data', {})\n\n  #     next if volume_data.empty?\n  #     puts volume_data\n  #     lifecycle_state = volume_data['lifecycle-state']\n  #     kms_key_id = volume_data['kms-key-id']\n\n  #     next if lifecycle_state.to_s.casecmp('TERMINATED').zero?\n  #     next unless kms_key_id.to_s.empty?\n\n  #     volumes_missing_cmk << {\n  #       'display-name' => volume_data['display-name'],\n  #       'region' => region\n  #     }.compact\n  #   end\n  # end\n\n  # describe 'Ensure Block Volumes are encrypted with Customer Managed Keys (CMK).' do\n  #   subject { volumes_missing_cmk }\n  #   it { should be_empty }\n  # end\nend\n","source_location":{"line":1,"ref":"./controls/5_2_1.rb"},"waiver_data":{},"results":[],"status":"passed"},{"id":"5_2_2","title":"Ensure boot volumes are encrypted with Customer Managed Key (CMK).","desc":"When you launch a virtual machine (VM) or bare metal instance based on a platform image or\ncustom image, a new boot volume for the instance is created in the same compartment. That\nboot volume is associated with that instance until you terminate the instance. By default,\nthe Oracle service manages the keys that encrypt this boot volume. Boot Volumes can also\nbe encrypted using a customer managed key. Encryption of boot volumes provides an\nadditional level of security for your data. Management of encryption keys is critical to\nprotecting and accessing protected data. Customers should identify boot volumes encrypted\nwith Oracle service managed keys in order to determine if they want to manage the keys for\ncertain boot volumes and then apply their own key lifecycle management to the selected\nboot volumes.","descriptions":[{"label":"default","data":"When you launch a virtual machine (VM) or bare metal instance based on a platform image or\ncustom image, a new boot volume for the instance is created in the same compartment. That\nboot volume is associated with that instance until you terminate the instance. By default,\nthe Oracle service manages the keys that encrypt this boot volume. Boot Volumes can also\nbe encrypted using a customer managed key. Encryption of boot volumes provides an\nadditional level of security for your data. Management of encryption keys is critical to\nprotecting and accessing protected data. Customers should identify boot volumes encrypted\nwith Oracle service managed keys in order to determine if they want to manage the keys for\ncertain boot volumes and then apply their own key lifecycle management to the selected\nboot volumes."},{"label":"check","data":"From Console: Login into the OCI Console Click in the search bar, top of the screen. Type\n\nAdvanced Resource Query and click enter. Click the Advanced Resource Query button in the\nupper right of the screen. Enter the following query in the query box: query bootvolume\nresources For each boot volume returned click on the link under Display name Ensure\nEncryption Key does not say Oracle managed key Repeat for other subscribed regions From\nCLI: Execute the following command: for region in `oci iam region list | jq -r '.data[] |\n.name'`; do for bvid in `oci search resource structured-search --region $region\n--query-text \"query bootvolume resources\" 2>/dev/null | jq -r '.data.items[] |\n.identifier'` do output=`oci bv boot-volume get --boot-volume-id $bvid 2>/dev/null | jq -r\n'.data | select(.\"kms-key-id\" == null).id'` if [ ! -z \"$output\" ]; then echo $output; fi\ndone done Ensure query returns no results."},{"label":"fix","data":"From Console: Follow the audit procedure above. For each Boot Volume in the returned\n\nresults, click the Boot Volume name Click Assign next to Encryption Key Select the Vault\nCompartment and Vault Select the Master Encryption Key Compartment and Master Encryption\nkey Click Assign From CLI: Follow the audit procedure. For each boot volume identified get\nits OCID. Execute the following command: oci bv boot-volume-kms-key update\n--boot-volume-id <Boot Volume OCID> --kms-key-id <KMS Key OCID>"},{"label":"potential_impacts","data":"[object Object]"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-5_2_2","severity":"medium","gid":"CIS-5_2_2","rid":"xccdf_cis_cis_rule_5_2_2","stig_id":"5.2.2","gtitle":"<GroupDescription></GroupDescription>","cci":["CCI-001199","CCI-002472","CCI-000183","CCI-000051","CCI-002856","CCI-003205"],"nist":["SC-28","SC-28","IA-5 g","AC-8 a","CP-12","SA-12 (8)"]},"code":"control '5_2_2' do\n  title 'Ensure boot volumes are encrypted with Customer Managed Key (CMK).'\n\n  desc <<~DESC\n    When you launch a virtual machine (VM) or bare metal instance based on a platform image or\n    custom image, a new boot volume for the instance is created in the same compartment. That\n    boot volume is associated with that instance until you terminate the instance. By default,\n    the Oracle service manages the keys that encrypt this boot volume. Boot Volumes can also\n    be encrypted using a customer managed key. Encryption of boot volumes provides an\n    additional level of security for your data. Management of encryption keys is critical to\n    protecting and accessing protected data. Customers should identify boot volumes encrypted\n    with Oracle service managed keys in order to determine if they want to manage the keys for\n    certain boot volumes and then apply their own key lifecycle management to the selected\n    boot volumes.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Login into the OCI Console Click in the search bar, top of the screen. Type\n\n    Advanced Resource Query and click enter. Click the Advanced Resource Query button in the\n    upper right of the screen. Enter the following query in the query box: query bootvolume\n    resources For each boot volume returned click on the link under Display name Ensure\n    Encryption Key does not say Oracle managed key Repeat for other subscribed regions From\n    CLI: Execute the following command: for region in `oci iam region list | jq -r '.data[] |\n    .name'`; do for bvid in `oci search resource structured-search --region $region\n    --query-text \"query bootvolume resources\" 2>/dev/null | jq -r '.data.items[] |\n    .identifier'` do output=`oci bv boot-volume get --boot-volume-id $bvid 2>/dev/null | jq -r\n    '.data | select(.\"kms-key-id\" == null).id'` if [ ! -z \"$output\" ]; then echo $output; fi\n    done done Ensure query returns no results.\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Follow the audit procedure above. For each Boot Volume in the returned\n\n    results, click the Boot Volume name Click Assign next to Encryption Key Select the Vault\n    Compartment and Vault Select the Master Encryption Key Compartment and Master Encryption\n    key Click Assign From CLI: Follow the audit procedure. For each boot volume identified get\n    its OCID. Execute the following command: oci bv boot-volume-kms-key update\n    --boot-volume-id <Boot Volume OCID> --kms-key-id <KMS Key OCID>\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    [object Object]\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-5_2_2'\n  tag severity: 'medium'\n  tag gid: 'CIS-5_2_2'\n  tag rid: 'xccdf_cis_cis_rule_5_2_2'\n  tag stig_id: '5.2.2'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n\n  tag cci: [\n    'CCI-001199',\n    'CCI-002472',\n    'CCI-000183',\n    'CCI-000051',\n    'CCI-002856',\n    'CCI-003205'\n  ]\n\n  tag nist: [\n    'SC-28',\n    'SC-28',\n    'IA-5 g',\n    'AC-8 a',\n    'CP-12',\n    'SA-12 (8)'\n  ]\n\n  cmd = <<~CMD\n    (\n      for region in `oci iam region-subscription list | jq -r '.data[] | .\"region-name\"'`;\n      do\n        for bvid in `oci search resource structured-search --region $region --query-text \"query bootvolume resources\" 2>/dev/null | jq -r '.data.items[] |.identifier'`\n        do\n          output=`oci bv boot-volume get --boot-volume-id $bvid 2>/dev/null| jq -r '.data | select(.\"kms-key-id\" == null).id'`\n          if [ ! -z \"$output\" ]; then echo $output; fi\n        done\n      done\n    ) | jq -nR '[inputs]'\n  CMD\n\n  json_output = json(command: cmd)\n  output = json_output.params\n\n  describe 'Ensure boot volumes are encrypted with Customer Managed Key (CMK)' do\n    subject { output }\n    it { should be_empty }\n  end\nend\n","source_location":{"line":1,"ref":"./controls/5_2_2.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"Ensure boot volumes are encrypted with Customer Managed Key (CMK) is expected to be empty","run_time":0.00104,"start_time":"2026-01-28T09:26:55-05:00","message":"expected `[\"ocid1.bootvolume.oc1.iad.abuwcljtk27x3ao63j4lbmsvxsjtre2k5ptjwu6vzf4xqs7mpz5lithi6paq\", \"ocid1.boot...mlyyvwuyq\", \"ocid1.bootvolume.oc1.iad.abuwcljt6zydxsxxdw3pnbayl6637ng7y2guwr7bqay76hlnjlijdeknpuna\"].empty?` to be truthy, got false","resource_class":"Object","resource_params":"[]","resource_id":"Ensure boot volumes are encrypted with Customer Managed Key (CMK)"}],"status":"failed"},{"id":"5_3_1","title":"Ensure File Storage Systems are encrypted with Customer Managed Keys (CMK)","desc":"Oracle Cloud Infrastructure File Storage service (FSS) provides a durable, scalable,\nsecure, enterprise-grade network file system. By default, the Oracle service manages the\nkeys that encrypt FSS file systems. FSS file systems can also be encrypted using a\ncustomer managed key. Encryption of FSS systems provides an additional level of security\nfor your data. Management of encryption keys is critical to protecting and accessing\nprotected data. Customers should identify FSS file systems that are encrypted with Oracle\nservice managed keys in order to determine if they want to manage the keys for certain FSS\nfile systems and then apply their own key lifecycle management to the selected FSS file\nsystems.","descriptions":[{"label":"default","data":"Oracle Cloud Infrastructure File Storage service (FSS) provides a durable, scalable,\nsecure, enterprise-grade network file system. By default, the Oracle service manages the\nkeys that encrypt FSS file systems. FSS file systems can also be encrypted using a\ncustomer managed key. Encryption of FSS systems provides an additional level of security\nfor your data. Management of encryption keys is critical to protecting and accessing\nprotected data. Customers should identify FSS file systems that are encrypted with Oracle\nservice managed keys in order to determine if they want to manage the keys for certain FSS\nfile systems and then apply their own key lifecycle management to the selected FSS file\nsystems."},{"label":"check","data":"From Console: Login into the OCI Console Click in the search bar, top of the screen. Type\n\nAdvanced Resource Query and click enter. Click the Advanced Resource Query button in the\nupper right of the screen. Enter the following query in the query box: query filesystem\nresources For each file storage system returned click on the link under Display name\nEnsure Encryption Key does not say Oracle-managed key Repeat for other subscribed regions\n\nFrom CLI: Execute the following command: for region in `oci iam region list | jq -r\n\n'.data[] | .name'`; do for fssid in `oci search resource structured-search --region\n$region --query-text \"query filesystem resources\" 2>/dev/null | jq -r '.data.items[] |\n.identifier'` do output=`oci fs file-system get --file-system-id $fssid --region $region\n2>/dev/null | jq -r '.data | select(.\"kms-key-id\" == \"\").id'` if [ ! -z \"$output\" ]; then\necho $output; fi done done Ensure query returns no results"},{"label":"fix","data":"From Console: Follow the audit procedure above. For each File Storage System in the\n\nreturned results, click the File System Storage Click Edit next to Encryption Key Select\nEncrypt using customer-managed keys Select the Vault Compartment and Vault Select the\nMaster Encryption Key Compartment and Master Encryption key Click Save Changes From CLI:\n\nFollow the audit procedure. For each File Storage System identified get its OCID. Execute\nthe following command: oci bv volume-kms-key update volume-id <volume OCID> --kms-key-id\n<kms key OCID>"},{"label":"potential_impacts","data":"[object Object]"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-5_3_1","severity":"medium","gid":"CIS-5_3_1","rid":"xccdf_cis_cis_rule_5_3_1","stig_id":"5.3.1","gtitle":"<GroupDescription></GroupDescription>","cci":["CCI-001199","CCI-002472","CCI-000183","CCI-000051","CCI-002856","CCI-003205"],"nist":["SC-28","SC-28","IA-5 g","AC-8 a","CP-12","SA-12 (8)"]},"code":"control '5_3_1' do\n  title 'Ensure File Storage Systems are encrypted with Customer Managed Keys (CMK)'\n\n  desc <<~DESC\n    Oracle Cloud Infrastructure File Storage service (FSS) provides a durable, scalable,\n    secure, enterprise-grade network file system. By default, the Oracle service manages the\n    keys that encrypt FSS file systems. FSS file systems can also be encrypted using a\n    customer managed key. Encryption of FSS systems provides an additional level of security\n    for your data. Management of encryption keys is critical to protecting and accessing\n    protected data. Customers should identify FSS file systems that are encrypted with Oracle\n    service managed keys in order to determine if they want to manage the keys for certain FSS\n    file systems and then apply their own key lifecycle management to the selected FSS file\n    systems.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Login into the OCI Console Click in the search bar, top of the screen. Type\n\n    Advanced Resource Query and click enter. Click the Advanced Resource Query button in the\n    upper right of the screen. Enter the following query in the query box: query filesystem\n    resources For each file storage system returned click on the link under Display name\n    Ensure Encryption Key does not say Oracle-managed key Repeat for other subscribed regions\n\n    From CLI: Execute the following command: for region in `oci iam region list | jq -r\n\n    '.data[] | .name'`; do for fssid in `oci search resource structured-search --region\n    $region --query-text \"query filesystem resources\" 2>/dev/null | jq -r '.data.items[] |\n    .identifier'` do output=`oci fs file-system get --file-system-id $fssid --region $region\n    2>/dev/null | jq -r '.data | select(.\"kms-key-id\" == \"\").id'` if [ ! -z \"$output\" ]; then\n    echo $output; fi done done Ensure query returns no results\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Follow the audit procedure above. For each File Storage System in the\n\n    returned results, click the File System Storage Click Edit next to Encryption Key Select\n    Encrypt using customer-managed keys Select the Vault Compartment and Vault Select the\n    Master Encryption Key Compartment and Master Encryption key Click Save Changes From CLI:\n\n    Follow the audit procedure. For each File Storage System identified get its OCID. Execute\n    the following command: oci bv volume-kms-key update volume-id <volume OCID> --kms-key-id\n    <kms key OCID>\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    [object Object]\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-5_3_1'\n  tag severity: 'medium'\n  tag gid: 'CIS-5_3_1'\n  tag rid: 'xccdf_cis_cis_rule_5_3_1'\n  tag stig_id: '5.3.1'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n\n  tag cci: [\n    'CCI-001199',\n    'CCI-002472',\n    'CCI-000183',\n    'CCI-000051',\n    'CCI-002856',\n    'CCI-003205'\n  ]\n\n  tag nist: [\n    'SC-28',\n    'SC-28',\n    'IA-5 g',\n    'AC-8 a',\n    'CP-12',\n    'SA-12 (8)'\n  ]\n\n  cmd = <<~CMD\n    (\n      for region in `oci iam region-subscription list | jq -r '.data[] | .\"region-name\"'`;\n      do\n        for fssid in `oci search resource structured-search --region $region --query-text \"query filesystem resources\" 2>/dev/null | jq -r '.data.items[] |.identifier'`\n        do\n          output=`oci fs file-system get --file-system-id $fssid --region $region 2>/dev/null | jq -r '.data | select(.\"kms-key-id\" == \"\").id'`\n          if [ ! -z \"$output\" ]; then echo $output; fi\n        done\n      done\n    ) | jq -nR '[inputs]'\n  CMD\n\n  json_output = json(command: cmd)\n  output = json_output.params\n\n  describe 'Ensure File Storage Systems are encrypted with Customer Managed Keys (CMK)' do\n    subject { output }\n    it { should be_empty }\n  end\nend\n","source_location":{"line":1,"ref":"./controls/5_3_1.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"Ensure File Storage Systems are encrypted with Customer Managed Keys (CMK) is expected to be empty","run_time":0.000992,"start_time":"2026-01-28T09:26:55-05:00","message":"expected `[\"ocid1.filesystem.oc1.iad.aaaaaaaaaamw5rh6nfqwillqojxwiotjmfsc2ylefuyqaaaa\"].empty?` to be truthy, got false","resource_class":"Object","resource_params":"[]","resource_id":"Ensure File Storage Systems are encrypted with Customer Managed Keys (CMK)"}],"status":"failed"},{"id":"6_1","title":"Create at least one compartment in your tenancy to store cloud resources","desc":"When you sign up for Oracle Cloud Infrastructure, Oracle creates your tenancy, which is\nthe root compartment that holds all your cloud resources. You then create additional\ncompartments within the tenancy (root compartment) and corresponding policies to control\naccess to the resources in each compartment. Compartments allow you to organize and\ncontrol access to your cloud resources. A compartment is a collection of related resources\n(such as instances, databases, virtual cloud networks, block volumes) that can be accessed\nonly by certain groups that have been given permission by an administrator. Compartments\nare a logical group that adds an extra layer of isolation, organization and authorization\nmaking it harder for unauthorized users to gain access to OCI resources.","descriptions":[{"label":"default","data":"When you sign up for Oracle Cloud Infrastructure, Oracle creates your tenancy, which is\nthe root compartment that holds all your cloud resources. You then create additional\ncompartments within the tenancy (root compartment) and corresponding policies to control\naccess to the resources in each compartment. Compartments allow you to organize and\ncontrol access to your cloud resources. A compartment is a collection of related resources\n(such as instances, databases, virtual cloud networks, block volumes) that can be accessed\nonly by certain groups that have been given permission by an administrator. Compartments\nare a logical group that adds an extra layer of isolation, organization and authorization\nmaking it harder for unauthorized users to gain access to OCI resources."},{"label":"check","data":"From Console: Login into the OCI Console. Click in the search bar, top of the screen. Type\n\nAdvanced Resource Query and hit enter . Click the Advanced Resource Query button in the\nupper right of the screen. Enter the following query in the query box: query compartment\nresources where (compartmentId='<tenancy-id>' && lifecycleState='ACTIVE') Ensure query\nreturns at least one compartment in addition to the ManagedCompartmentForPaaS compartment\n\nFrom CLI: Execute the following command oci search resource structured-search --query-text\n\n\"query compartment resources where (compartmentId='<tenancy-id>' &&\nlifecycleState='ACTIVE')\" Ensure items are returned."},{"label":"fix","data":"From Console: Login to OCI Console. Select Identity from the Services menu. Select\n\nCompartments from the Identity menu. Click Create Compartment Enter a Name Enter a\nDescription Select the root compartment as the Parent Compartment Click Create Compartment\n\nFrom CLI: Execute the following command oci iam compartment create --compartment-id\n\n'<tenancy-id>' --name '<compartment-name>' --description '<compartment description>'"},{"label":"potential_impacts","data":"Once the compartment is created an OCI IAM policy must be created to allow a group to\nresources in the compartment otherwise only group with tenancy access will have access."}],"impact":0.5,"refs":[],"tags":{"check_id":"C-6_1","severity":"medium","gid":"CIS-6_1","rid":"xccdf_cis_cis_rule_6_1","stig_id":"6.1","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-001315","CCI-001678","CCI-000167"],"nist":["SI-12","SI-12","AU-11"]},"code":"control '6_1' do\n  title 'Create at least one compartment in your tenancy to store cloud resources'\n\n  desc <<~DESC\n    When you sign up for Oracle Cloud Infrastructure, Oracle creates your tenancy, which is\n    the root compartment that holds all your cloud resources. You then create additional\n    compartments within the tenancy (root compartment) and corresponding policies to control\n    access to the resources in each compartment. Compartments allow you to organize and\n    control access to your cloud resources. A compartment is a collection of related resources\n    (such as instances, databases, virtual cloud networks, block volumes) that can be accessed\n    only by certain groups that have been given permission by an administrator. Compartments\n    are a logical group that adds an extra layer of isolation, organization and authorization\n    making it harder for unauthorized users to gain access to OCI resources.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Login into the OCI Console. Click in the search bar, top of the screen. Type\n\n    Advanced Resource Query and hit enter . Click the Advanced Resource Query button in the\n    upper right of the screen. Enter the following query in the query box: query compartment\n    resources where (compartmentId='<tenancy-id>' && lifecycleState='ACTIVE') Ensure query\n    returns at least one compartment in addition to the ManagedCompartmentForPaaS compartment\n\n    From CLI: Execute the following command oci search resource structured-search --query-text\n\n    \"query compartment resources where (compartmentId='<tenancy-id>' &&\n    lifecycleState='ACTIVE')\" Ensure items are returned.\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Login to OCI Console. Select Identity from the Services menu. Select\n\n    Compartments from the Identity menu. Click Create Compartment Enter a Name Enter a\n    Description Select the root compartment as the Parent Compartment Click Create Compartment\n\n    From CLI: Execute the following command oci iam compartment create --compartment-id\n\n    '<tenancy-id>' --name '<compartment-name>' --description '<compartment description>'\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    Once the compartment is created an OCI IAM policy must be created to allow a group to\n    resources in the compartment otherwise only group with tenancy access will have access.\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-6_1'\n  tag severity: 'medium'\n  tag gid: 'CIS-6_1'\n  tag rid: 'xccdf_cis_cis_rule_6_1'\n  tag stig_id: '6.1'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-001315',\n    'CCI-001678',\n    'CCI-000167'\n  ]\n\n  tag nist: [\n    'SI-12',\n    'SI-12',\n    'AU-11'\n  ]\n\n  tenancy_ocid = input('tenancy_ocid')\n\n  cmd = \"oci search resource structured-search --query-text \\\"query compartment resources where (compartmentId='#{tenancy_ocid}' && lifecycleState='ACTIVE')\\\"\"\n\n  json_output = json(command: cmd)\n  output = json_output.params.dig('data', 'items')\n\n  describe 'Create at least one compartment in your tenancy to store cloud resources' do\n    subject { output }\n    it { should_not be_empty }\n  end\nend\n","source_location":{"line":1,"ref":"./controls/6_1.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Create at least one compartment in your tenancy to store cloud resources is expected not to be empty","run_time":0.000979,"start_time":"2026-01-28T09:26:55-05:00","resource_class":"Object","resource_params":"[]","resource_id":"Create at least one compartment in your tenancy to store cloud resources"}],"status":"passed"},{"id":"6_2","title":"Ensure no resources are created in the root compartment","desc":"When you create a cloud resource such as an instance, block volume, or cloud network, you\nmust specify to which compartment you want the resource to belong. Placing resources in\nthe root compartment makes it difficult to organize and isolate those resources. Placing\nresources into a compartment will allow you to organize and have more granular access\ncontrols to your cloud resources.","descriptions":[{"label":"default","data":"When you create a cloud resource such as an instance, block volume, or cloud network, you\nmust specify to which compartment you want the resource to belong. Placing resources in\nthe root compartment makes it difficult to organize and isolate those resources. Placing\nresources into a compartment will allow you to organize and have more granular access\ncontrols to your cloud resources."},{"label":"check","data":"From Console: Login into the OCI Console. Click in the search bar, top of the screen. Type\n\nAdvance Resource Query and hit enter . Click the Advanced Resource Query button in the\nupper right of the screen. Enter the following query into the query box: query VCN,\ninstance, bootvolume, volume, filesystem, bucket, autonomousdatabase, database, dbsystem\nresources where compartmentId = '<tenancy-id>' Ensure query returns no results. From CLI:\n\nExecute the following command: oci search resource structured-search --query-text \"query\nVCN, instance, volume, bootvolume, filesystem, bucket, autonomousdatabase, database,\ndbsystem resources where compartmentId = '<tenancy-id>'\" Ensure query return no results."},{"label":"fix","data":"From Console: Follow audit procedure above. For each item in the returned results, click\n\nthe item name. Then select Move Resource or More Actions then Move Resource . Select a\ncompartment that is not the root compartment in CHOOSE NEW COMPARTMENT . Click Move\nResource . From CLI: Follow the audit procedure above. For each bucket item execute the\nbelow command: oci os bucket update --bucket-name <bucket-name> --compartment-id <not root\ncompartment-id> For other resources use the change-compartment command for the resource\ntype: oci <service-command> <resource-command> change-compartment --<item-id> <item-id>\n--compartment-id <not root compartment-id> i. Example for an Autonomous Database: oci db\nautonomous-database change-compartment --autonomous-database-id <autonmous-database-id>\n--compartment-id <not root compartment-id>"},{"label":"potential_impacts","data":"\"Placing a resource in a compartment will"}],"impact":0.5,"refs":[],"tags":{"check_id":"C-6_2","severity":"medium","gid":"CIS-6_2","rid":"xccdf_cis_cis_rule_6_2","stig_id":"6.2","gtitle":"<GroupDescription></GroupDescription>","documentable":null,"cci":["CCI-000051","CCI-002856","CCI-003205","CCI-000050"],"nist":["AC-8 a","CP-12","SA-12 (8)","AC-8 b"]},"code":"control '6_2' do\n  title 'Ensure no resources are created in the root compartment'\n\n  desc <<~DESC\n    When you create a cloud resource such as an instance, block volume, or cloud network, you\n    must specify to which compartment you want the resource to belong. Placing resources in\n    the root compartment makes it difficult to organize and isolate those resources. Placing\n    resources into a compartment will allow you to organize and have more granular access\n    controls to your cloud resources.\n  DESC\n\n  desc 'check', <<~CHECK\n    From Console: Login into the OCI Console. Click in the search bar, top of the screen. Type\n\n    Advance Resource Query and hit enter . Click the Advanced Resource Query button in the\n    upper right of the screen. Enter the following query into the query box: query VCN,\n    instance, bootvolume, volume, filesystem, bucket, autonomousdatabase, database, dbsystem\n    resources where compartmentId = '<tenancy-id>' Ensure query returns no results. From CLI:\n\n    Execute the following command: oci search resource structured-search --query-text \"query\n    VCN, instance, volume, bootvolume, filesystem, bucket, autonomousdatabase, database,\n    dbsystem resources where compartmentId = '<tenancy-id>'\" Ensure query return no results.\n  CHECK\n\n  desc 'fix', <<~FIX\n    From Console: Follow audit procedure above. For each item in the returned results, click\n\n    the item name. Then select Move Resource or More Actions then Move Resource . Select a\n    compartment that is not the root compartment in CHOOSE NEW COMPARTMENT . Click Move\n    Resource . From CLI: Follow the audit procedure above. For each bucket item execute the\n    below command: oci os bucket update --bucket-name <bucket-name> --compartment-id <not root\n    compartment-id> For other resources use the change-compartment command for the resource\n    type: oci <service-command> <resource-command> change-compartment --<item-id> <item-id>\n    --compartment-id <not root compartment-id> i. Example for an Autonomous Database: oci db\n    autonomous-database change-compartment --autonomous-database-id <autonmous-database-id>\n    --compartment-id <not root compartment-id>\n  FIX\n\n  desc 'potential_impacts', <<~POTENTIAL_IMPACTS\n    \"Placing a resource in a compartment will\n  POTENTIAL_IMPACTS\n\n  impact 0.5\n\n  tag check_id: 'C-6_2'\n  tag severity: 'medium'\n  tag gid: 'CIS-6_2'\n  tag rid: 'xccdf_cis_cis_rule_6_2'\n  tag stig_id: '6.2'\n  tag gtitle: '<GroupDescription></GroupDescription>'\n  tag 'documentable'\n\n  tag cci: [\n    'CCI-000051',\n    'CCI-002856',\n    'CCI-003205',\n    'CCI-000050'\n  ]\n\n  tag nist: [\n    'AC-8 a',\n    'CP-12',\n    'SA-12 (8)',\n    'AC-8 b'\n  ]\n\n  tenancy_ocid = input('tenancy_ocid')\n\n  cmd = \"oci search resource structured-search --query-text \\\"query VCN, instance, volume, bootvolume, filesystem, bucket, autonomousdatabase, database, dbsystem resources where compartmentId = '#{tenancy_ocid}'\\\"\"\n  json_output = json(command: cmd)\n  output = json_output.params.dig('data', 'items')\n\n  describe 'Create at least one compartment in your tenancy to store cloud resources' do\n    subject { output }\n    it { should be_empty }\n  end\nend\n","source_location":{"line":1,"ref":"./controls/6_2.rb"},"waiver_data":{},"results":[{"status":"failed","code_desc":"Create at least one compartment in your tenancy to store cloud resources is expected to be empty","run_time":0.002062,"start_time":"2026-01-28T09:26:55-05:00","message":"expected `[{\"additional-details\"=>{}, \"availability-domain\"=>\"gNpG:US-ASHBURN-AD-3\", \"compartment-id\"=>\"ocid1.t...ket\", \"search-context\"=>nil, \"system-tags\"=>{}, \"time-created\"=>\"2025-12-02T16:29:22.095000+00:00\"}].empty?` to be truthy, got false","resource_class":"Object","resource_params":"[]","resource_id":"Create at least one compartment in your tenancy to store cloud resources"}],"status":"failed"}],"status":"loaded","status_message":""}],"statistics":{"duration":0.065735},"version":"6.8.24"}